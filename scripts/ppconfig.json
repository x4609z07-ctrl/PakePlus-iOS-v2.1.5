{"name":"aceabe","url":"https://i.chaoxing.com/","showName":"chaoxing","appid":"com.chaoxing.app","icon":"","iconPath":"C:\\Users\\q1572\\AppData\\Roaming\\com.pakeplus.pacbao\\q7kmsqqfqr.png","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":false,"version":"0.0.1","preview":"iPad","platform":["1-1"],"width":768,"height":1024,"desc":"","jsFile":[],"filterCss":"","customJs":"// ==UserScript==\n// @name       \t\t\t\tOCS 网课助手\n// @version    \t\t\t\t4.12.4\n// @description\t\t\t\tOCS(online-course-script) 网课助手，官网 https://docs.ocsjs.com ，专注于帮助大学生从网课中释放出来 让自己的时间把握在自己的手中，拥有人性化的操作页面，流畅的步骤提示，支持  【超星学习通】 【知到智慧树】 【职教云】 【智慧职教】 【中国大学MOOC】 等网课的学习，作业。具体的功能请查看脚本悬浮窗中的教程页面。\n// @author     \t\t\t\tenncy\n// @license    \t\t\t\tMIT\n// @match      \t\t\t\t*://*.zhihuishu.com/*\n// @match      \t\t\t\t*://*.hike-teaching-center.polymas.com/*\n// @match      \t\t\t\t*://*.chaoxing.com/*\n// @match      \t\t\t\t*://*.edu.cn/*\n// @match      \t\t\t\t*://*.org.cn/*\n// @match      \t\t\t\t*://*.xueyinonline.com/*\n// @match      \t\t\t\t*://*.hnsyu.net/*\n// @match      \t\t\t\t*://*.qutjxjy.cn/*\n// @match      \t\t\t\t*://*.ynny.cn/*\n// @match      \t\t\t\t*://*.hnvist.cn/*\n// @match      \t\t\t\t*://*.fjlecb.cn/*\n// @match      \t\t\t\t*://*.gdhkmooc.com/*\n// @match      \t\t\t\t*://*.cugbonline.cn/*\n// @match      \t\t\t\t*://*.zjelib.cn/*\n// @match      \t\t\t\t*://*.cqrspx.cn/*\n// @match      \t\t\t\t*://*.neauce.com/*\n// @match      \t\t\t\t*://*.zhihui-yun.com/*\n// @match      \t\t\t\t*://*.cqie.cn/*\n// @match      \t\t\t\t*://*.ccqmxx.com/*\n// @match      \t\t\t\t*://*.jxgmxy.com/*\n// @match      \t\t\t\t*://*.sslibrary.com/*\n// @match      \t\t\t\t*://*.icve.com.cn/*\n// @match      \t\t\t\t*://*.ai.icve.com.cn/*\n// @match      \t\t\t\t*://*.course.icve.com.cn/*\n// @match      \t\t\t\t*://*.courshare.cn/*\n// @match      \t\t\t\t*://*.webtrn.cn/*\n// @match      \t\t\t\t*://*.zjy2.icve.com.cn/*\n// @match      \t\t\t\t*://*.zyk.icve.com.cn/*\n// @match      \t\t\t\t*://*.icourse163.org/*\n// @grant      \t\t\t\tGM_info\n// @grant      \t\t\t\tGM_getTab\n// @grant      \t\t\t\tGM_saveTab\n// @grant      \t\t\t\tGM_setValue\n// @grant      \t\t\t\tGM_getValue\n// @grant      \t\t\t\tunsafeWindow\n// @grant      \t\t\t\tGM_listValues\n// @grant      \t\t\t\tGM_deleteValue\n// @grant      \t\t\t\tGM_notification\n// @grant      \t\t\t\tGM_xmlhttpRequest\n// @grant      \t\t\t\tGM_getResourceText\n// @grant      \t\t\t\tGM_addValueChangeListener\n// @grant      \t\t\t\tGM_removeValueChangeListener\n// @run-at     \t\t\t\tdocument-start\n// @namespace  \t\t\t\thttps://enncy.cn\n// @homepage   \t\t\t\thttps://docs.ocsjs.com\n// @source     \t\t\t\thttps://github.com/ocsjs/ocsjs\n// @icon       \t\t\t\thttps://cdn.ocsjs.com/logo.png\n// @connect    \t\t\t\tenncy.cn\n// @connect    \t\t\t\ticodef.com\n// @connect    \t\t\t\tocsjs.com\n// @connect    \t\t\t\tlocalhost\n// @connect    \t\t\t\t127.0.0.1\n// @antifeature\t\t\t\tpayment\n// ==/UserScript==\n\nvar __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\n(function(global2, factory) {\n  typeof exports === \"object\" && typeof module !== \"undefined\" ? factory(exports) : typeof define === \"function\" && define.amd ? define([\"exports\"], factory) : (global2 = typeof globalThis !== \"undefined\" ? globalThis : global2 || self, factory(global2.OCS = {}));\n})(this, function(exports2) {\n  \"use strict\";\n  var commonjsGlobal = typeof globalThis !== \"undefined\" ? globalThis : typeof window !== \"undefined\" ? window : typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : {};\n  function isObject$2(value) {\n    var type = typeof value;\n    return value != null && (type == \"object\" || type == \"function\");\n  }\n  var isObject_1 = isObject$2;\n  var freeGlobal$1 = typeof commonjsGlobal == \"object\" && commonjsGlobal && commonjsGlobal.Object === Object && commonjsGlobal;\n  var _freeGlobal = freeGlobal$1;\n  var freeGlobal = _freeGlobal;\n  var freeSelf = typeof self == \"object\" && self && self.Object === Object && self;\n  var root$2 = freeGlobal || freeSelf || Function(\"return this\")();\n  var _root = root$2;\n  var root$1 = _root;\n  var now$1 = function() {\n    return root$1.Date.now();\n  };\n  var now_1 = now$1;\n  var reWhitespace = /\\s/;\n  function trimmedEndIndex$1(string) {\n    var index = string.length;\n    while (index-- && reWhitespace.test(string.charAt(index))) {\n    }\n    return index;\n  }\n  var _trimmedEndIndex = trimmedEndIndex$1;\n  var trimmedEndIndex = _trimmedEndIndex;\n  var reTrimStart = /^\\s+/;\n  function baseTrim$1(string) {\n    return string ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, \"\") : string;\n  }\n  var _baseTrim = baseTrim$1;\n  var root = _root;\n  var Symbol$3 = root.Symbol;\n  var _Symbol = Symbol$3;\n  var Symbol$2 = _Symbol;\n  var objectProto$1 = Object.prototype;\n  var hasOwnProperty = objectProto$1.hasOwnProperty;\n  var nativeObjectToString$1 = objectProto$1.toString;\n  var symToStringTag$1 = Symbol$2 ? Symbol$2.toStringTag : void 0;\n  function getRawTag$1(value) {\n    var isOwn = hasOwnProperty.call(value, symToStringTag$1), tag = value[symToStringTag$1];\n    try {\n      value[symToStringTag$1] = void 0;\n      var unmasked = true;\n    } catch (e) {\n    }\n    var result = nativeObjectToString$1.call(value);\n    if (unmasked) {\n      if (isOwn) {\n        value[symToStringTag$1] = tag;\n      } else {\n        delete value[symToStringTag$1];\n      }\n    }\n    return result;\n  }\n  var _getRawTag = getRawTag$1;\n  var objectProto = Object.prototype;\n  var nativeObjectToString = objectProto.toString;\n  function objectToString$1(value) {\n    return nativeObjectToString.call(value);\n  }\n  var _objectToString = objectToString$1;\n  var Symbol$1 = _Symbol, getRawTag = _getRawTag, objectToString = _objectToString;\n  var nullTag = \"[object Null]\", undefinedTag = \"[object Undefined]\";\n  var symToStringTag = Symbol$1 ? Symbol$1.toStringTag : void 0;\n  function baseGetTag$1(value) {\n    if (value == null) {\n      return value === void 0 ? undefinedTag : nullTag;\n    }\n    return symToStringTag && symToStringTag in Object(value) ? getRawTag(value) : objectToString(value);\n  }\n  var _baseGetTag = baseGetTag$1;\n  function isObjectLike$1(value) {\n    return value != null && typeof value == \"object\";\n  }\n  var isObjectLike_1 = isObjectLike$1;\n  var baseGetTag = _baseGetTag, isObjectLike = isObjectLike_1;\n  var symbolTag = \"[object Symbol]\";\n  function isSymbol$1(value) {\n    return typeof value == \"symbol\" || isObjectLike(value) && baseGetTag(value) == symbolTag;\n  }\n  var isSymbol_1 = isSymbol$1;\n  var baseTrim = _baseTrim, isObject$1 = isObject_1, isSymbol = isSymbol_1;\n  var NAN = 0 / 0;\n  var reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n  var reIsBinary = /^0b[01]+$/i;\n  var reIsOctal = /^0o[0-7]+$/i;\n  var freeParseInt = parseInt;\n  function toNumber$1(value) {\n    if (typeof value == \"number\") {\n      return value;\n    }\n    if (isSymbol(value)) {\n      return NAN;\n    }\n    if (isObject$1(value)) {\n      var other = typeof value.valueOf == \"function\" ? value.valueOf() : value;\n      value = isObject$1(other) ? other + \"\" : other;\n    }\n    if (typeof value != \"string\") {\n      return value === 0 ? value : +value;\n    }\n    value = baseTrim(value);\n    var isBinary = reIsBinary.test(value);\n    return isBinary || reIsOctal.test(value) ? freeParseInt(value.slice(2), isBinary ? 2 : 8) : reIsBadHex.test(value) ? NAN : +value;\n  }\n  var toNumber_1 = toNumber$1;\n  var isObject = isObject_1, now = now_1, toNumber = toNumber_1;\n  var FUNC_ERROR_TEXT = \"Expected a function\";\n  var nativeMax = Math.max, nativeMin = Math.min;\n  function debounce(func, wait, options) {\n    var lastArgs, lastThis, maxWait, result, timerId, lastCallTime, lastInvokeTime = 0, leading = false, maxing = false, trailing = true;\n    if (typeof func != \"function\") {\n      throw new TypeError(FUNC_ERROR_TEXT);\n    }\n    wait = toNumber(wait) || 0;\n    if (isObject(options)) {\n      leading = !!options.leading;\n      maxing = \"maxWait\" in options;\n      maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n      trailing = \"trailing\" in options ? !!options.trailing : trailing;\n    }\n    function invokeFunc(time) {\n      var args = lastArgs, thisArg = lastThis;\n      lastArgs = lastThis = void 0;\n      lastInvokeTime = time;\n      result = func.apply(thisArg, args);\n      return result;\n    }\n    function leadingEdge(time) {\n      lastInvokeTime = time;\n      timerId = setTimeout(timerExpired, wait);\n      return leading ? invokeFunc(time) : result;\n    }\n    function remainingWait(time) {\n      var timeSinceLastCall = time - lastCallTime, timeSinceLastInvoke = time - lastInvokeTime, timeWaiting = wait - timeSinceLastCall;\n      return maxing ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke) : timeWaiting;\n    }\n    function shouldInvoke(time) {\n      var timeSinceLastCall = time - lastCallTime, timeSinceLastInvoke = time - lastInvokeTime;\n      return lastCallTime === void 0 || timeSinceLastCall >= wait || timeSinceLastCall < 0 || maxing && timeSinceLastInvoke >= maxWait;\n    }\n    function timerExpired() {\n      var time = now();\n      if (shouldInvoke(time)) {\n        return trailingEdge(time);\n      }\n      timerId = setTimeout(timerExpired, remainingWait(time));\n    }\n    function trailingEdge(time) {\n      timerId = void 0;\n      if (trailing && lastArgs) {\n        return invokeFunc(time);\n      }\n      lastArgs = lastThis = void 0;\n      return result;\n    }\n    function cancel() {\n      if (timerId !== void 0) {\n        clearTimeout(timerId);\n      }\n      lastInvokeTime = 0;\n      lastArgs = lastCallTime = lastThis = timerId = void 0;\n    }\n    function flush() {\n      return timerId === void 0 ? result : trailingEdge(now());\n    }\n    function debounced() {\n      var time = now(), isInvoking = shouldInvoke(time);\n      lastArgs = arguments;\n      lastThis = this;\n      lastCallTime = time;\n      if (isInvoking) {\n        if (timerId === void 0) {\n          return leadingEdge(lastCallTime);\n        }\n        if (maxing) {\n          clearTimeout(timerId);\n          timerId = setTimeout(timerExpired, wait);\n          return invokeFunc(lastCallTime);\n        }\n      }\n      if (timerId === void 0) {\n        timerId = setTimeout(timerExpired, wait);\n      }\n      return result;\n    }\n    debounced.cancel = cancel;\n    debounced.flush = flush;\n    return debounced;\n  }\n  var debounce_1$1 = debounce;\n  const $ = {\n    uuid() {\n      return \"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n        const r = Math.random() * 16 | 0;\n        const v = c === \"x\" ? r : r & 3 | 8;\n        return v.toString(16);\n      });\n    },\n    random(min, max) {\n      return Math.round(Math.random() * (max - min)) + min;\n    },\n    async sleep(period) {\n      return new Promise((resolve) => {\n        setTimeout(resolve, period);\n      });\n    },\n    isInBrowser() {\n      return typeof window !== \"undefined\" && typeof window.document !== \"undefined\";\n    },\n    elementToRawObject(el) {\n      return {\n        innerText: el == null ? void 0 : el.innerText,\n        innerHTML: el == null ? void 0 : el.innerHTML,\n        textContent: el == null ? void 0 : el.textContent\n      };\n    },\n    onresize(el, handler) {\n      const resize = debounce_1$1(() => {\n        if (el.parentNode === null) {\n          window.removeEventListener(\"resize\", resize);\n        } else {\n          handler(el);\n        }\n      }, 200);\n      resize();\n      window.addEventListener(\"resize\", resize);\n    },\n    isInTopWindow() {\n      return self === top;\n    },\n    createCenteredPopupWindow(url, winName, opts) {\n      const { width, height, scrollbars, resizable } = opts;\n      const LeftPosition = screen.width ? (screen.width - width) / 2 : 0;\n      const TopPosition = screen.height ? (screen.height - height) / 2 : 0;\n      const settings = \"height=\" + height + \",width=\" + width + \",top=\" + TopPosition + \",left=\" + LeftPosition + \",scrollbars=\" + (scrollbars ? \"yes\" : \"no\") + \",resizable=\" + (resizable ? \"yes\" : \"no\");\n      return window.open(url, winName, settings);\n    },\n    transition: async (el, properties, duration_ms, val, options) => {\n      return new Promise((resolve) => {\n        const original_val = Reflect.get(el.style, properties) || \"\";\n        el.style.transition = `${String(properties)} ${duration_ms}s ${(options == null ? void 0 : options.timing_function) || \"ease-in-out\"}`;\n        Reflect.set(el.style, properties, val);\n        el.addEventListener(\"transitionend\", function handler() {\n          el.removeEventListener(\"transitionend\", handler);\n          setTimeout(() => {\n            Reflect.set(el.style, properties, original_val);\n            setTimeout(() => {\n              el.style.transition = \"\";\n            }, duration_ms * 1e3);\n          }, ((options == null ? void 0 : options.reset_ms) || 0) * 1e3);\n          resolve();\n        });\n      });\n    }\n  };\n  const $string = {\n    humpToTarget(value, target) {\n      return value.replace(/([A-Z])/g, target + \"$1\").toLowerCase().split(target).slice(1).join(target);\n    }\n  };\n  class StringUtils {\n    constructor(_text) {\n      this._text = _text;\n    }\n    static nowrap(str, replace_str) {\n      return (str == null ? void 0 : str.replace(/\\n/g, replace_str)) || \"\";\n    }\n    nowrap(replace_str) {\n      this._text = StringUtils.nowrap(this._text, replace_str);\n      return this;\n    }\n    static nospace(str) {\n      return (str == null ? void 0 : str.replace(/ +/g, \" \")) || \"\";\n    }\n    nospace() {\n      this._text = StringUtils.nospace(this._text);\n      return this;\n    }\n    static noSpecialChar(str) {\n      return (str == null ? void 0 : str.replace(/[^\\w\\s]/gi, \"\")) || \"\";\n    }\n    noSpecialChar() {\n      this._text = StringUtils.noSpecialChar(this._text);\n      return this;\n    }\n    static max(str, len) {\n      return str.length > len ? str.substring(0, len) + \"...\" : str;\n    }\n    max(len) {\n      this._text = StringUtils.max(this._text, len);\n      return this;\n    }\n    static hide(str, start2, end, replacer = \"*\") {\n      return str.substring(0, start2) + str.substring(start2, end).replace(/./g, replacer) + str.substring(end);\n    }\n    hide(start2, end, replacer = \"*\") {\n      this._text = StringUtils.hide(this._text, start2, end, replacer);\n      return this;\n    }\n    static of(text) {\n      return new StringUtils(text);\n    }\n    toString() {\n      return this._text;\n    }\n  }\n  const $const = {\n    TAB_UID: \"_uid_\",\n    TAB_URLS: \"_urls_\",\n    TAB_CURRENT_PANEL_NAME: \"_current_panel_name_\"\n  };\n  function domSearch(wrapper, root2 = window.document) {\n    const obj = /* @__PURE__ */ Object.create({});\n    Reflect.ownKeys(wrapper).forEach((key) => {\n      const item = wrapper[key.toString()];\n      Reflect.set(\n        obj,\n        key,\n        typeof item === \"string\" ? root2.querySelector(item) : typeof item === \"function\" ? item(root2) : item.map((fun) => fun(root2))\n      );\n    });\n    return obj;\n  }\n  function domSearchAll(wrapper, root2 = window.document) {\n    const obj = /* @__PURE__ */ Object.create({});\n    Reflect.ownKeys(wrapper).forEach((key) => {\n      const item = wrapper[key.toString()];\n      Reflect.set(\n        obj,\n        key,\n        typeof item === \"string\" ? Array.from(root2.querySelectorAll(item)) : typeof item === \"function\" ? item(root2) : item.map((fun) => fun(root2))\n      );\n    });\n    return obj;\n  }\n  var src = {\n    compareTwoStrings,\n    findBestMatch\n  };\n  function compareTwoStrings(first, second) {\n    first = first.replace(/\\s+/g, \"\");\n    second = second.replace(/\\s+/g, \"\");\n    if (first === second)\n      return 1;\n    if (first.length < 2 || second.length < 2)\n      return 0;\n    let firstBigrams = /* @__PURE__ */ new Map();\n    for (let i = 0; i < first.length - 1; i++) {\n      const bigram = first.substring(i, i + 2);\n      const count = firstBigrams.has(bigram) ? firstBigrams.get(bigram) + 1 : 1;\n      firstBigrams.set(bigram, count);\n    }\n    let intersectionSize = 0;\n    for (let i = 0; i < second.length - 1; i++) {\n      const bigram = second.substring(i, i + 2);\n      const count = firstBigrams.has(bigram) ? firstBigrams.get(bigram) : 0;\n      if (count > 0) {\n        firstBigrams.set(bigram, count - 1);\n        intersectionSize++;\n      }\n    }\n    return 2 * intersectionSize / (first.length + second.length - 2);\n  }\n  function findBestMatch(mainString, targetStrings) {\n    if (!areArgsValid(mainString, targetStrings))\n      throw new Error(\"Bad arguments: First argument should be a string, second should be an array of strings\");\n    const ratings = [];\n    let bestMatchIndex = 0;\n    for (let i = 0; i < targetStrings.length; i++) {\n      const currentTargetString = targetStrings[i];\n      const currentRating = compareTwoStrings(mainString, currentTargetString);\n      ratings.push({ target: currentTargetString, rating: currentRating });\n      if (currentRating > ratings[bestMatchIndex].rating) {\n        bestMatchIndex = i;\n      }\n    }\n    const bestMatch = ratings[bestMatchIndex];\n    return { ratings, bestMatch, bestMatchIndex };\n  }\n  function areArgsValid(mainString, targetStrings) {\n    if (typeof mainString !== \"string\")\n      return false;\n    if (!Array.isArray(targetStrings))\n      return false;\n    if (!targetStrings.length)\n      return false;\n    if (targetStrings.find(function(s) {\n      return typeof s !== \"string\";\n    }))\n      return false;\n    return true;\n  }\n  function clearString(str, ...exclude) {\n    exclude.push(...[\"①②③④⑤⑥⑦⑧⑨\"]);\n    return str.trim().toLocaleLowerCase().replace(RegExp(`[^\\\\u2E80-\\\\u9FFFA-Za-z0-9${exclude.join(\"\")}]*`, \"g\"), \"\");\n  }\n  function answerSimilar(answers, options) {\n    const _answers = answers.map(removeRedundant).map((a) => clearString(a));\n    const _options = options.map(removeRedundant).map((o) => clearString(o));\n    const similar = _answers.length !== 0 ? _options.map((option) => {\n      if (option.trim() === \"\") {\n        return { rating: 0, target: \"\" };\n      }\n      return src.findBestMatch(option, _answers).bestMatch;\n    }) : _options.map(() => ({ rating: 0, target: \"\" }));\n    return similar;\n  }\n  function answerExactMatch(answers, options) {\n    const _answers = answers.map(removeRedundant);\n    const _options = options.map(removeRedundant);\n    const result = _answers.length !== 0 ? _options.filter((option) => {\n      return _answers.find((answer) => answer.trim() === option.trim());\n    }) : [];\n    return result;\n  }\n  function removeRedundant(str) {\n    return (str == null ? void 0 : str.trim().replace(/[A-Z]{1}[^A-Za-z0-9\\u2E80-\\u9FFF]+([A-Za-z0-9\\u2E80-\\u9FFF]+)/, \"$1\")) || \"\";\n  }\n  function request(url, opts) {\n    return new Promise((resolve, reject) => {\n      try {\n        const { responseType = \"json\", method = \"get\", type = \"fetch\", data = {}, headers = {} } = opts || {};\n        const env = $.isInBrowser() ? \"browser\" : \"node\";\n        if (type === \"GM_xmlhttpRequest\" && env === \"browser\") {\n          if (typeof GM_xmlhttpRequest !== \"undefined\") {\n            const contentType = headers[\"Content-Type\"] || headers[\"content-type\"];\n            const requestData = contentType === \"application/x-www-form-urlencoded\" ? new URLSearchParams(data).toString() : Object.keys(data).length ? JSON.stringify(data) : void 0;\n            GM_xmlhttpRequest({\n              url,\n              method: method.toUpperCase(),\n              data: requestData,\n              headers: Object.keys(headers).length ? headers : void 0,\n              responseType: responseType === \"json\" ? \"json\" : void 0,\n              onload: (response) => {\n                if (response.status === 200) {\n                  if (responseType === \"json\") {\n                    try {\n                      resolve(JSON.parse(response.responseText));\n                    } catch (error) {\n                      reject(error);\n                    }\n                  } else {\n                    resolve(response.responseText || \"\");\n                  }\n                } else {\n                  reject(response.responseText);\n                }\n              },\n              onerror: (err) => {\n                console.error(\"GM_xmlhttpRequest error\", err);\n                reject(err);\n              }\n            });\n          } else {\n            reject(new Error(\"GM_xmlhttpRequest is not defined\"));\n          }\n        } else {\n          const fet = env === \"node\" ? require(\"node-fetch\").default : fetch;\n          fet(url, { body: method === \"post\" ? JSON.stringify(data) : void 0, method, headers }).then((response) => {\n            if (responseType === \"json\") {\n              response.json().then(resolve).catch(reject);\n            } else {\n              response.text().then(resolve).catch(reject);\n            }\n          }).catch((error) => {\n            reject(new Error(error));\n          });\n        }\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n  var lib = {};\n  var start$1 = {};\n  var customWindow = {};\n  var interfaces = {};\n  var common$1 = {};\n  var events = { exports: {} };\n  var R = typeof Reflect === \"object\" ? Reflect : null;\n  var ReflectApply = R && typeof R.apply === \"function\" ? R.apply : function ReflectApply2(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  };\n  var ReflectOwnKeys;\n  if (R && typeof R.ownKeys === \"function\") {\n    ReflectOwnKeys = R.ownKeys;\n  } else if (Object.getOwnPropertySymbols) {\n    ReflectOwnKeys = function ReflectOwnKeys2(target) {\n      return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target));\n    };\n  } else {\n    ReflectOwnKeys = function ReflectOwnKeys2(target) {\n      return Object.getOwnPropertyNames(target);\n    };\n  }\n  function ProcessEmitWarning(warning) {\n    if (console && console.warn)\n      console.warn(warning);\n  }\n  var NumberIsNaN = Number.isNaN || function NumberIsNaN2(value) {\n    return value !== value;\n  };\n  function EventEmitter() {\n    EventEmitter.init.call(this);\n  }\n  events.exports = EventEmitter;\n  events.exports.once = once;\n  EventEmitter.EventEmitter = EventEmitter;\n  EventEmitter.prototype._events = void 0;\n  EventEmitter.prototype._eventsCount = 0;\n  EventEmitter.prototype._maxListeners = void 0;\n  var defaultMaxListeners = 10;\n  function checkListener(listener) {\n    if (typeof listener !== \"function\") {\n      throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n    }\n  }\n  Object.defineProperty(EventEmitter, \"defaultMaxListeners\", {\n    enumerable: true,\n    get: function() {\n      return defaultMaxListeners;\n    },\n    set: function(arg) {\n      if (typeof arg !== \"number\" || arg < 0 || NumberIsNaN(arg)) {\n        throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + \".\");\n      }\n      defaultMaxListeners = arg;\n    }\n  });\n  EventEmitter.init = function() {\n    if (this._events === void 0 || this._events === Object.getPrototypeOf(this)._events) {\n      this._events = /* @__PURE__ */ Object.create(null);\n      this._eventsCount = 0;\n    }\n    this._maxListeners = this._maxListeners || void 0;\n  };\n  EventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n    if (typeof n !== \"number\" || n < 0 || NumberIsNaN(n)) {\n      throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + \".\");\n    }\n    this._maxListeners = n;\n    return this;\n  };\n  function _getMaxListeners(that) {\n    if (that._maxListeners === void 0)\n      return EventEmitter.defaultMaxListeners;\n    return that._maxListeners;\n  }\n  EventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n    return _getMaxListeners(this);\n  };\n  EventEmitter.prototype.emit = function emit(type) {\n    var args = [];\n    for (var i = 1; i < arguments.length; i++)\n      args.push(arguments[i]);\n    var doError = type === \"error\";\n    var events2 = this._events;\n    if (events2 !== void 0)\n      doError = doError && events2.error === void 0;\n    else if (!doError)\n      return false;\n    if (doError) {\n      var er;\n      if (args.length > 0)\n        er = args[0];\n      if (er instanceof Error) {\n        throw er;\n      }\n      var err = new Error(\"Unhandled error.\" + (er ? \" (\" + er.message + \")\" : \"\"));\n      err.context = er;\n      throw err;\n    }\n    var handler = events2[type];\n    if (handler === void 0)\n      return false;\n    if (typeof handler === \"function\") {\n      ReflectApply(handler, this, args);\n    } else {\n      var len = handler.length;\n      var listeners = arrayClone(handler, len);\n      for (var i = 0; i < len; ++i)\n        ReflectApply(listeners[i], this, args);\n    }\n    return true;\n  };\n  function _addListener(target, type, listener, prepend) {\n    var m;\n    var events2;\n    var existing;\n    checkListener(listener);\n    events2 = target._events;\n    if (events2 === void 0) {\n      events2 = target._events = /* @__PURE__ */ Object.create(null);\n      target._eventsCount = 0;\n    } else {\n      if (events2.newListener !== void 0) {\n        target.emit(\n          \"newListener\",\n          type,\n          listener.listener ? listener.listener : listener\n        );\n        events2 = target._events;\n      }\n      existing = events2[type];\n    }\n    if (existing === void 0) {\n      existing = events2[type] = listener;\n      ++target._eventsCount;\n    } else {\n      if (typeof existing === \"function\") {\n        existing = events2[type] = prepend ? [listener, existing] : [existing, listener];\n      } else if (prepend) {\n        existing.unshift(listener);\n      } else {\n        existing.push(listener);\n      }\n      m = _getMaxListeners(target);\n      if (m > 0 && existing.length > m && !existing.warned) {\n        existing.warned = true;\n        var w = new Error(\"Possible EventEmitter memory leak detected. \" + existing.length + \" \" + String(type) + \" listeners added. Use emitter.setMaxListeners() to increase limit\");\n        w.name = \"MaxListenersExceededWarning\";\n        w.emitter = target;\n        w.type = type;\n        w.count = existing.length;\n        ProcessEmitWarning(w);\n      }\n    }\n    return target;\n  }\n  EventEmitter.prototype.addListener = function addListener(type, listener) {\n    return _addListener(this, type, listener, false);\n  };\n  EventEmitter.prototype.on = EventEmitter.prototype.addListener;\n  EventEmitter.prototype.prependListener = function prependListener(type, listener) {\n    return _addListener(this, type, listener, true);\n  };\n  function onceWrapper() {\n    if (!this.fired) {\n      this.target.removeListener(this.type, this.wrapFn);\n      this.fired = true;\n      if (arguments.length === 0)\n        return this.listener.call(this.target);\n      return this.listener.apply(this.target, arguments);\n    }\n  }\n  function _onceWrap(target, type, listener) {\n    var state2 = { fired: false, wrapFn: void 0, target, type, listener };\n    var wrapped = onceWrapper.bind(state2);\n    wrapped.listener = listener;\n    state2.wrapFn = wrapped;\n    return wrapped;\n  }\n  EventEmitter.prototype.once = function once2(type, listener) {\n    checkListener(listener);\n    this.on(type, _onceWrap(this, type, listener));\n    return this;\n  };\n  EventEmitter.prototype.prependOnceListener = function prependOnceListener(type, listener) {\n    checkListener(listener);\n    this.prependListener(type, _onceWrap(this, type, listener));\n    return this;\n  };\n  EventEmitter.prototype.removeListener = function removeListener(type, listener) {\n    var list, events2, position, i, originalListener;\n    checkListener(listener);\n    events2 = this._events;\n    if (events2 === void 0)\n      return this;\n    list = events2[type];\n    if (list === void 0)\n      return this;\n    if (list === listener || list.listener === listener) {\n      if (--this._eventsCount === 0)\n        this._events = /* @__PURE__ */ Object.create(null);\n      else {\n        delete events2[type];\n        if (events2.removeListener)\n          this.emit(\"removeListener\", type, list.listener || listener);\n      }\n    } else if (typeof list !== \"function\") {\n      position = -1;\n      for (i = list.length - 1; i >= 0; i--) {\n        if (list[i] === listener || list[i].listener === listener) {\n          originalListener = list[i].listener;\n          position = i;\n          break;\n        }\n      }\n      if (position < 0)\n        return this;\n      if (position === 0)\n        list.shift();\n      else {\n        spliceOne(list, position);\n      }\n      if (list.length === 1)\n        events2[type] = list[0];\n      if (events2.removeListener !== void 0)\n        this.emit(\"removeListener\", type, originalListener || listener);\n    }\n    return this;\n  };\n  EventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n  EventEmitter.prototype.removeAllListeners = function removeAllListeners(type) {\n    var listeners, events2, i;\n    events2 = this._events;\n    if (events2 === void 0)\n      return this;\n    if (events2.removeListener === void 0) {\n      if (arguments.length === 0) {\n        this._events = /* @__PURE__ */ Object.create(null);\n        this._eventsCount = 0;\n      } else if (events2[type] !== void 0) {\n        if (--this._eventsCount === 0)\n          this._events = /* @__PURE__ */ Object.create(null);\n        else\n          delete events2[type];\n      }\n      return this;\n    }\n    if (arguments.length === 0) {\n      var keys = Object.keys(events2);\n      var key;\n      for (i = 0; i < keys.length; ++i) {\n        key = keys[i];\n        if (key === \"removeListener\")\n          continue;\n        this.removeAllListeners(key);\n      }\n      this.removeAllListeners(\"removeListener\");\n      this._events = /* @__PURE__ */ Object.create(null);\n      this._eventsCount = 0;\n      return this;\n    }\n    listeners = events2[type];\n    if (typeof listeners === \"function\") {\n      this.removeListener(type, listeners);\n    } else if (listeners !== void 0) {\n      for (i = listeners.length - 1; i >= 0; i--) {\n        this.removeListener(type, listeners[i]);\n      }\n    }\n    return this;\n  };\n  function _listeners(target, type, unwrap) {\n    var events2 = target._events;\n    if (events2 === void 0)\n      return [];\n    var evlistener = events2[type];\n    if (evlistener === void 0)\n      return [];\n    if (typeof evlistener === \"function\")\n      return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n    return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n  }\n  EventEmitter.prototype.listeners = function listeners(type) {\n    return _listeners(this, type, true);\n  };\n  EventEmitter.prototype.rawListeners = function rawListeners(type) {\n    return _listeners(this, type, false);\n  };\n  EventEmitter.listenerCount = function(emitter, type) {\n    if (typeof emitter.listenerCount === \"function\") {\n      return emitter.listenerCount(type);\n    } else {\n      return listenerCount.call(emitter, type);\n    }\n  };\n  EventEmitter.prototype.listenerCount = listenerCount;\n  function listenerCount(type) {\n    var events2 = this._events;\n    if (events2 !== void 0) {\n      var evlistener = events2[type];\n      if (typeof evlistener === \"function\") {\n        return 1;\n      } else if (evlistener !== void 0) {\n        return evlistener.length;\n      }\n    }\n    return 0;\n  }\n  EventEmitter.prototype.eventNames = function eventNames() {\n    return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n  };\n  function arrayClone(arr, n) {\n    var copy = new Array(n);\n    for (var i = 0; i < n; ++i)\n      copy[i] = arr[i];\n    return copy;\n  }\n  function spliceOne(list, index) {\n    for (; index + 1 < list.length; index++)\n      list[index] = list[index + 1];\n    list.pop();\n  }\n  function unwrapListeners(arr) {\n    var ret = new Array(arr.length);\n    for (var i = 0; i < ret.length; ++i) {\n      ret[i] = arr[i].listener || arr[i];\n    }\n    return ret;\n  }\n  function once(emitter, name) {\n    return new Promise(function(resolve, reject) {\n      function errorListener(err) {\n        emitter.removeListener(name, resolver);\n        reject(err);\n      }\n      function resolver() {\n        if (typeof emitter.removeListener === \"function\") {\n          emitter.removeListener(\"error\", errorListener);\n        }\n        resolve([].slice.call(arguments));\n      }\n      eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n      if (name !== \"error\") {\n        addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n      }\n    });\n  }\n  function addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n    if (typeof emitter.on === \"function\") {\n      eventTargetAgnosticAddListener(emitter, \"error\", handler, flags);\n    }\n  }\n  function eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n    if (typeof emitter.on === \"function\") {\n      if (flags.once) {\n        emitter.once(name, listener);\n      } else {\n        emitter.on(name, listener);\n      }\n    } else if (typeof emitter.addEventListener === \"function\") {\n      emitter.addEventListener(name, function wrapListener(arg) {\n        if (flags.once) {\n          emitter.removeEventListener(name, wrapListener);\n        }\n        listener(arg);\n      });\n    } else {\n      throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n    }\n  }\n  var __importDefault$2 = commonjsGlobal && commonjsGlobal.__importDefault || function(mod) {\n    return mod && mod.__esModule ? mod : { \"default\": mod };\n  };\n  Object.defineProperty(common$1, \"__esModule\", { value: true });\n  common$1.CommonEventEmitter = void 0;\n  const events_1$1 = __importDefault$2(events.exports);\n  class CommonEventEmitter extends events_1$1.default {\n    on(eventName, listener) {\n      return super.on(eventName.toString(), listener);\n    }\n    once(eventName, listener) {\n      return super.once(eventName.toString(), listener);\n    }\n    emit(eventName, ...args) {\n      return super.emit(eventName.toString(), ...args);\n    }\n    off(eventName, listener) {\n      return super.off(eventName.toString(), listener);\n    }\n  }\n  common$1.CommonEventEmitter = CommonEventEmitter;\n  var config$1 = {};\n  Object.defineProperty(config$1, \"__esModule\", { value: true });\n  var cors = {};\n  var utils = {};\n  var common = {};\n  var store = {};\n  var store_provider = {};\n  var _const = {};\n  Object.defineProperty(_const, \"__esModule\", { value: true });\n  _const.$const = void 0;\n  _const.$const = {\n    TAB_UID: \"_uid_\",\n    TAB_URLS: \"_urls_\",\n    TAB_CURRENT_PANEL_NAME: \"_current_panel_name_\"\n  };\n  var __awaiter$3 = commonjsGlobal && commonjsGlobal.__awaiter || function(thisArg, _arguments, P, generator) {\n    function adopt(value) {\n      return value instanceof P ? value : new P(function(resolve) {\n        resolve(value);\n      });\n    }\n    return new (P || (P = Promise))(function(resolve, reject) {\n      function fulfilled(value) {\n        try {\n          step(generator.next(value));\n        } catch (e) {\n          reject(e);\n        }\n      }\n      function rejected(value) {\n        try {\n          step(generator[\"throw\"](value));\n        } catch (e) {\n          reject(e);\n        }\n      }\n      function step(result) {\n        result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n      }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n  };\n  Object.defineProperty(store_provider, \"__esModule\", { value: true });\n  store_provider.GMStoreProvider = store_provider.MemoryStoreProvider = store_provider.LocalStoreChangeEvent = void 0;\n  const const_1$1 = _const;\n  class LocalStoreChangeEvent extends Event {\n    constructor() {\n      super(...arguments);\n      this.key = \"\";\n    }\n  }\n  store_provider.LocalStoreChangeEvent = LocalStoreChangeEvent;\n  class MemoryStoreProvider {\n    get(key, defaultValue) {\n      var _a;\n      return (_a = Reflect.get(MemoryStoreProvider._source.store, key)) !== null && _a !== void 0 ? _a : defaultValue;\n    }\n    set(key, value) {\n      var _a;\n      const pre = Reflect.get(MemoryStoreProvider._source.store, key);\n      Reflect.set(MemoryStoreProvider._source.store, key, value);\n      (_a = MemoryStoreProvider.storeListeners.get(key)) === null || _a === void 0 ? void 0 : _a.forEach((lis) => lis(value, pre));\n    }\n    delete(key) {\n      Reflect.deleteProperty(MemoryStoreProvider._source.store, key);\n    }\n    list() {\n      return Object.keys(MemoryStoreProvider._source.store);\n    }\n    getTab(key) {\n      return __awaiter$3(this, void 0, void 0, function* () {\n        return Reflect.get(MemoryStoreProvider._source.tab, key);\n      });\n    }\n    setTab(key, value) {\n      var _a;\n      return __awaiter$3(this, void 0, void 0, function* () {\n        Reflect.set(MemoryStoreProvider._source.tab, key, value);\n        (_a = MemoryStoreProvider.tabListeners.get(key)) === null || _a === void 0 ? void 0 : _a.forEach((lis) => lis(value, this.getTab(key)));\n      });\n    }\n    addChangeListener(key, listener) {\n      const listeners = MemoryStoreProvider.storeListeners.get(key) || [];\n      listeners.push(listener);\n      MemoryStoreProvider.storeListeners.set(key, listeners);\n    }\n    removeChangeListener(listener) {\n      MemoryStoreProvider.tabListeners.forEach((lis, key) => {\n        const index = lis.findIndex((l) => l === listener);\n        if (index !== -1) {\n          lis.splice(index, 1);\n          MemoryStoreProvider.tabListeners.set(key, lis);\n        }\n      });\n    }\n    addTabChangeListener(key, listener) {\n      const listeners = MemoryStoreProvider.tabListeners.get(key) || [];\n      listeners.push(listener);\n      MemoryStoreProvider.tabListeners.set(key, listeners);\n    }\n    removeTabChangeListener(key, listener) {\n      const listeners = MemoryStoreProvider.tabListeners.get(key) || [];\n      const index = listeners.findIndex((l) => l === listener);\n      if (index !== -1) {\n        listeners.splice(index, 1);\n        MemoryStoreProvider.tabListeners.set(key, listeners);\n      }\n    }\n  }\n  MemoryStoreProvider._source = { store: {}, tab: {} };\n  MemoryStoreProvider.storeListeners = /* @__PURE__ */ new Map();\n  MemoryStoreProvider.tabListeners = /* @__PURE__ */ new Map();\n  store_provider.MemoryStoreProvider = MemoryStoreProvider;\n  class GMStoreProvider {\n    constructor() {\n      if (self === top && typeof globalThis.GM_listValues !== \"undefined\") {\n        for (const val of GM_listValues()) {\n          if (val.startsWith(\"_tab_change_\")) {\n            GM_deleteValue(val);\n          }\n        }\n      }\n    }\n    getTabChangeHandleKey(tabUid, key) {\n      return `_tab_change_${tabUid}_${key}`;\n    }\n    get(key, defaultValue) {\n      return GM_getValue(key, defaultValue);\n    }\n    set(key, value) {\n      GM_setValue(key, value);\n    }\n    delete(key) {\n      GM_deleteValue(key);\n    }\n    list() {\n      return GM_listValues();\n    }\n    getTab(key) {\n      return new Promise((resolve, reject) => {\n        GM_getTab((tab = {}) => resolve(Reflect.get(tab, key)));\n      });\n    }\n    setTab(key, value) {\n      return new Promise((resolve, reject) => {\n        GM_getTab((tab = {}) => {\n          Reflect.set(tab, key, value);\n          GM_saveTab(tab);\n          this.set(this.getTabChangeHandleKey(Reflect.get(tab, const_1$1.$const.TAB_UID), key), value);\n          resolve();\n        });\n      });\n    }\n    addChangeListener(key, listener) {\n      return GM_addValueChangeListener(key, (_, pre, curr, remote) => {\n        listener(curr, pre, remote);\n      });\n    }\n    removeChangeListener(listenerId) {\n      if (typeof listenerId === \"number\") {\n        GM_removeValueChangeListener(listenerId);\n      }\n    }\n    addTabChangeListener(key, listener) {\n      return __awaiter$3(this, void 0, void 0, function* () {\n        const uid = yield this.getTab(const_1$1.$const.TAB_UID);\n        return GM_addValueChangeListener(this.getTabChangeHandleKey(uid, key), (_, pre, curr) => {\n          listener(curr, pre);\n        });\n      });\n    }\n    removeTabChangeListener(key, listener) {\n      return this.removeChangeListener(listener);\n    }\n  }\n  store_provider.GMStoreProvider = GMStoreProvider;\n  (function(exports3) {\n    Object.defineProperty(exports3, \"__esModule\", { value: true });\n    exports3.$store = exports3.MemoryStoreProvider = exports3.GMStoreProvider = void 0;\n    const store_provider_1 = store_provider;\n    var store_provider_2 = store_provider;\n    Object.defineProperty(exports3, \"GMStoreProvider\", { enumerable: true, get: function() {\n      return store_provider_2.GMStoreProvider;\n    } });\n    Object.defineProperty(exports3, \"MemoryStoreProvider\", { enumerable: true, get: function() {\n      return store_provider_2.MemoryStoreProvider;\n    } });\n    exports3.$store = typeof globalThis.unsafeWindow === \"undefined\" ? new store_provider_1.MemoryStoreProvider() : new store_provider_1.GMStoreProvider();\n  })(store);\n  (function(exports3) {\n    var __awaiter2 = commonjsGlobal && commonjsGlobal.__awaiter || function(thisArg, _arguments, P, generator) {\n      function adopt(value) {\n        return value instanceof P ? value : new P(function(resolve) {\n          resolve(value);\n        });\n      }\n      return new (P || (P = Promise))(function(resolve, reject) {\n        function fulfilled(value) {\n          try {\n            step(generator.next(value));\n          } catch (e) {\n            reject(e);\n          }\n        }\n        function rejected(value) {\n          try {\n            step(generator[\"throw\"](value));\n          } catch (e) {\n            reject(e);\n          }\n        }\n        function step(result) {\n          result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n        }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n      });\n    };\n    var __rest2 = commonjsGlobal && commonjsGlobal.__rest || function(s, e) {\n      var t2 = {};\n      for (var p in s)\n        if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n          t2[p] = s[p];\n      if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n          if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n            t2[p[i]] = s[p[i]];\n        }\n      return t2;\n    };\n    var __importDefault2 = commonjsGlobal && commonjsGlobal.__importDefault || function(mod) {\n      return mod && mod.__esModule ? mod : { \"default\": mod };\n    };\n    Object.defineProperty(exports3, \"__esModule\", { value: true });\n    exports3.resolveCustomElementName = exports3.$ = void 0;\n    const debounce_12 = __importDefault2(debounce_1$1);\n    const store_12 = store;\n    exports3.$ = {\n      createConfigProxy(script2) {\n        var _a, _b;\n        const proxy = new Proxy(script2.cfg, {\n          set(target, propertyKey, value) {\n            const key = exports3.$.namespaceKey(script2.namespace, propertyKey);\n            store_12.$store.set(key, value);\n            return Reflect.set(target, propertyKey, value);\n          },\n          get(target, propertyKey) {\n            const value = store_12.$store.get(exports3.$.namespaceKey(script2.namespace, propertyKey));\n            Reflect.set(target, propertyKey, value);\n            return value;\n          }\n        });\n        for (const key in script2.configs) {\n          if (Object.prototype.hasOwnProperty.call(script2.configs, key)) {\n            const element = Reflect.get(script2.configs, key);\n            Reflect.set(proxy, key, store_12.$store.get(exports3.$.namespaceKey(script2.namespace, key), element.defaultValue));\n          }\n        }\n        if (script2.namespace) {\n          proxy.notes = (_b = (_a = script2.configs) === null || _a === void 0 ? void 0 : _a.notes) === null || _b === void 0 ? void 0 : _b.defaultValue;\n        }\n        return proxy;\n      },\n      getAllRawConfigs(scripts) {\n        const object = {};\n        for (const script2 of scripts) {\n          for (const key in script2.configs) {\n            if (Object.prototype.hasOwnProperty.call(script2.configs, key)) {\n              const _a = script2.configs[key], element = __rest2(_a, [\"label\"]);\n              Reflect.set(object, exports3.$.namespaceKey(script2.namespace, key), Object.assign({ label: exports3.$.namespaceKey(script2.namespace, key) }, element));\n            }\n          }\n        }\n        return object;\n      },\n      getMatchedScripts(projects, urls) {\n        const scripts = [];\n        for (const project2 of projects) {\n          for (const key in project2.scripts) {\n            if (Object.prototype.hasOwnProperty.call(project2.scripts, key)) {\n              const script2 = project2.scripts[key];\n              const script_matches_urls = script2.matches.map((u) => Array.isArray(u) ? u[1] : u);\n              const script_excludes_urls = (script2.excludes || []).map((u) => Array.isArray(u) ? u[1] : u);\n              if (project2.domains === void 0 || project2.domains.length === 0 || project2.domains.some((d) => urls.some((url) => new URL(url).origin.includes(d)))) {\n                if (script_excludes_urls.some((u) => urls.some((url) => RegExp(u).test(url)))) {\n                  continue;\n                }\n                if (script_matches_urls.some((u) => urls.some((url) => RegExp(u).test(url)))) {\n                  scripts.push(script2);\n                }\n              }\n            }\n          }\n        }\n        return scripts;\n      },\n      namespaceKey(namespace, key) {\n        return namespace ? namespace + \".\" + key.toString() : key.toString();\n      },\n      uuid() {\n        return \"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\n          const r = Math.random() * 16 | 0;\n          const v = c === \"x\" ? r : r & 3 | 8;\n          return v.toString(16);\n        });\n      },\n      random(min, max) {\n        return Math.round(Math.random() * (max - min)) + min;\n      },\n      sleep(period) {\n        return __awaiter2(this, void 0, void 0, function* () {\n          return new Promise((resolve) => {\n            setTimeout(resolve, period);\n          });\n        });\n      },\n      isInBrowser() {\n        return typeof window !== \"undefined\" && typeof window.document !== \"undefined\";\n      },\n      onresize(el, handler) {\n        const resize = (0, debounce_12.default)(() => {\n          if (el.parentNode === null) {\n            window.removeEventListener(\"resize\", resize);\n          } else {\n            handler(el);\n          }\n        }, 200);\n        resize();\n        window.addEventListener(\"resize\", resize);\n      },\n      loadCustomElements(elements2) {\n        for (const element of elements2) {\n          const name = resolveCustomElementName(element, \"-\");\n          if (customElements.get(name) === void 0) {\n            customElements.define(name, element);\n          }\n        }\n      },\n      isInTopWindow() {\n        return self === top;\n      },\n      createCenteredPopupWindow(url, winName, opts) {\n        const { width, height, scrollbars, resizable } = opts;\n        const LeftPosition = screen.width ? (screen.width - width) / 2 : 0;\n        const TopPosition = screen.height ? (screen.height - height) / 2 : 0;\n        const settings = \"height=\" + height + \",width=\" + width + \",top=\" + TopPosition + \",left=\" + LeftPosition + \",scrollbars=\" + (scrollbars ? \"yes\" : \"no\") + \",resizable=\" + (resizable ? \"yes\" : \"no\");\n        return window.open(url, winName, settings);\n      }\n    };\n    function resolveCustomElementName(el, target) {\n      return el.name.replace(/([A-Z])/g, target + \"$1\").toLowerCase().split(target).slice(1).join(target);\n    }\n    exports3.resolveCustomElementName = resolveCustomElementName;\n  })(common);\n  var ui = {};\n  var dom = {};\n  Object.defineProperty(dom, \"__esModule\", { value: true });\n  dom.enableElementTouchDraggable = dom.enableElementDraggable = dom.$$el = dom.$el = dom.h = void 0;\n  const common_1$5 = common;\n  function h(element, attrsOrChildren, childrenOrHandler) {\n    let name = \"\";\n    if (typeof element === \"function\") {\n      name = (0, common_1$5.resolveCustomElementName)(element, \"-\");\n    } else {\n      name = element;\n    }\n    const el = document.createElement(name);\n    if (attrsOrChildren) {\n      if (Array.isArray(attrsOrChildren)) {\n        for (const child of attrsOrChildren) {\n          if (typeof child === \"function\") {\n            el.append(document.createElement(child.name));\n          } else {\n            el.append(child);\n          }\n        }\n      } else if (typeof attrsOrChildren === \"string\") {\n        el.append(attrsOrChildren);\n      } else {\n        const attrs = attrsOrChildren;\n        for (const key in attrs) {\n          if (Object.prototype.hasOwnProperty.call(attrs, key)) {\n            if (key === \"style\") {\n              Object.assign(el.style, attrs[key]);\n            } else {\n              const value = attrs[key];\n              Reflect.set(el, key, value);\n            }\n          }\n        }\n      }\n    }\n    if (childrenOrHandler) {\n      if (typeof childrenOrHandler === \"function\") {\n        childrenOrHandler.call(el, el);\n      } else if (Array.isArray(childrenOrHandler)) {\n        for (const child of childrenOrHandler) {\n          if (typeof child === \"function\") {\n            el.append(document.createElement(child.name));\n          } else {\n            el.append(child);\n          }\n        }\n      } else if (typeof childrenOrHandler === \"string\") {\n        el.append(childrenOrHandler);\n      }\n    }\n    return el;\n  }\n  dom.h = h;\n  function $el(selector, root2 = window.document) {\n    const el = root2.querySelector(selector);\n    return el === null ? void 0 : el;\n  }\n  dom.$el = $el;\n  function $$el(selector, root2 = window.document) {\n    return Array.from(root2.querySelectorAll(selector));\n  }\n  dom.$$el = $$el;\n  function enableElementDraggable(header2, target, ondrag) {\n    let pos1 = 0;\n    let pos2 = 0;\n    let pos3 = 0;\n    let pos4 = 0;\n    header2.addEventListener(\"mousedown\", dragMouseDown);\n    function dragMouseDown(e) {\n      e = e || window.event;\n      pos3 = e.clientX;\n      pos4 = e.clientY;\n      document.addEventListener(\"mouseup\", closeDragElement);\n      document.addEventListener(\"mousemove\", elementDrag);\n    }\n    function elementDrag(e) {\n      e.stopPropagation();\n      e = e || window.event;\n      pos1 = pos3 - e.clientX;\n      pos2 = pos4 - e.clientY;\n      pos3 = e.clientX;\n      pos4 = e.clientY;\n      target.style.top = Math.max(target.offsetTop - pos2, 10) + \"px\";\n      target.style.left = target.offsetLeft - pos1 + \"px\";\n    }\n    function closeDragElement() {\n      ondrag === null || ondrag === void 0 ? void 0 : ondrag();\n      document.removeEventListener(\"mouseup\", closeDragElement);\n      document.removeEventListener(\"mousemove\", elementDrag);\n    }\n  }\n  dom.enableElementDraggable = enableElementDraggable;\n  function enableElementTouchDraggable(header2, target, ondrag) {\n    let pos1 = 0;\n    let pos2 = 0;\n    let pos3 = 0;\n    let pos4 = 0;\n    header2.addEventListener(\"touchstart\", dragTouchStart);\n    function dragTouchStart(e) {\n      e = e || window.event;\n      const touch = e.touches[0];\n      pos3 = touch.clientX;\n      pos4 = touch.clientY;\n      document.addEventListener(\"touchend\", closeDragElement);\n      document.addEventListener(\"touchmove\", elementDrag);\n    }\n    function elementDrag(e) {\n      e.stopPropagation();\n      e = e || window.event;\n      const touch = e.touches[0];\n      pos1 = pos3 - touch.clientX;\n      pos2 = pos4 - touch.clientY;\n      pos3 = touch.clientX;\n      pos4 = touch.clientY;\n      target.style.top = Math.max(target.offsetTop - pos2, 10) + \"px\";\n      target.style.left = target.offsetLeft - pos1 + \"px\";\n    }\n    function closeDragElement() {\n      ondrag === null || ondrag === void 0 ? void 0 : ondrag();\n      document.removeEventListener(\"touchend\", closeDragElement);\n      document.removeEventListener(\"touchmove\", elementDrag);\n    }\n  }\n  dom.enableElementTouchDraggable = enableElementTouchDraggable;\n  var elements$1 = {};\n  Object.defineProperty(elements$1, \"__esModule\", { value: true });\n  elements$1.$elements = void 0;\n  elements$1.$elements = {\n    tooltipContainer: void 0,\n    root: void 0\n  };\n  var tampermonkey = {};\n  (function(exports3) {\n    Object.defineProperty(exports3, \"__esModule\", { value: true });\n    exports3.$gm = void 0;\n    exports3.$gm = {\n      unsafeWindow: typeof globalThis.unsafeWindow === \"undefined\" ? globalThis.window : globalThis.unsafeWindow,\n      isInGMContext() {\n        return typeof GM_info !== \"undefined\";\n      },\n      getInfos() {\n        return typeof GM_info === \"undefined\" ? void 0 : GM_info;\n      },\n      getTab(callback) {\n        return typeof GM_getTab === \"undefined\" ? void 0 : GM_getTab(callback);\n      },\n      notification(content, options) {\n        var _a;\n        const { onclick, ondone, important, duration = 30, silent = true, extraTitle = \"\" } = options || {};\n        const { icon, name } = ((_a = exports3.$gm.getInfos()) === null || _a === void 0 ? void 0 : _a.script) || {};\n        GM_notification({\n          title: name + (extraTitle ? \"-\" + extraTitle : \"\"),\n          text: content,\n          image: icon || \"\",\n          highlight: important,\n          onclick,\n          ondone,\n          silent,\n          timeout: duration * 1e3\n        });\n      },\n      getMetadataFromScriptHead(key) {\n        var _a, _b;\n        const metadataString = (_a = this.getInfos()) === null || _a === void 0 ? void 0 : _a.scriptMetaStr;\n        if (!metadataString) {\n          return [];\n        } else {\n          const metadata = ((_b = metadataString.match(/\\/\\/\\s+==UserScript==([\\s\\S]+)\\/\\/\\s+==\\/UserScript==/)) === null || _b === void 0 ? void 0 : _b[1]) || \"\";\n          const metadataList = (metadata.match(/\\/\\/\\s+@(.+?)\\s+(.*?)(?:\\n|$)/g) || []).map((line) => {\n            const words = line.match(/[\\S]+/g) || [];\n            return {\n              key: (words[1] || \"\").replace(\"@\", \"\"),\n              value: words.slice(2).join(\" \")\n            };\n          });\n          return metadataList.filter((l) => l.key === key).map((l) => l.value);\n        }\n      }\n    };\n  })(tampermonkey);\n  Object.defineProperty(ui, \"__esModule\", { value: true });\n  ui.$ui = void 0;\n  const common_1$4 = common;\n  const dom_1$7 = dom;\n  const elements_1$2 = elements$1;\n  const tampermonkey_1$1 = tampermonkey;\n  ui.$ui = {\n    tooltip(target) {\n      target.setAttribute(\"data-title\", target.title);\n      if (tampermonkey_1$1.$gm.isInGMContext()) {\n        target.removeAttribute(\"title\");\n      }\n      const onMouseMove = (e) => {\n        if (elements_1$2.$elements.tooltipContainer && elements_1$2.$elements.tooltipContainer.style.display !== \"none\") {\n          elements_1$2.$elements.tooltipContainer.style.top = e.y + \"px\";\n          elements_1$2.$elements.tooltipContainer.style.left = e.x + \"px\";\n        }\n      };\n      const onTouchMove = (e) => {\n        if (elements_1$2.$elements.tooltipContainer && elements_1$2.$elements.tooltipContainer.style.display !== \"none\") {\n          const touch = e.touches[0];\n          elements_1$2.$elements.tooltipContainer.style.top = touch.clientY + \"px\";\n          elements_1$2.$elements.tooltipContainer.style.left = touch.clientX + \"px\";\n        }\n      };\n      const showTitle = (e) => {\n        const dataTitle = target.getAttribute(\"data-title\");\n        if (elements_1$2.$elements.tooltipContainer) {\n          if (dataTitle) {\n            elements_1$2.$elements.tooltipContainer.innerHTML = dataTitle.split(\"\\n\").join(\"<br>\") || \"\";\n            if (e instanceof MouseEvent) {\n              elements_1$2.$elements.tooltipContainer.style.top = e.y + \"px\";\n              elements_1$2.$elements.tooltipContainer.style.left = e.x + \"px\";\n            } else if (e instanceof TouchEvent) {\n              const touch = e.touches[0];\n              elements_1$2.$elements.tooltipContainer.style.top = touch.clientY + \"px\";\n              elements_1$2.$elements.tooltipContainer.style.left = touch.clientX + \"px\";\n            }\n            elements_1$2.$elements.tooltipContainer.style.display = \"block\";\n          } else {\n            elements_1$2.$elements.tooltipContainer.style.display = \"none\";\n          }\n        }\n        window.addEventListener(\"mousemove\", onMouseMove);\n        window.addEventListener(\"touchmove\", onTouchMove);\n      };\n      const hideTitle = () => {\n        if (elements_1$2.$elements.tooltipContainer) {\n          elements_1$2.$elements.tooltipContainer.style.display = \"none\";\n        }\n        window.removeEventListener(\"mousemove\", onMouseMove);\n        window.removeEventListener(\"touchmove\", onTouchMove);\n      };\n      hideTitle();\n      target.addEventListener(\"mouseenter\", showTitle);\n      target.addEventListener(\"click\", showTitle);\n      target.addEventListener(\"mouseout\", hideTitle);\n      target.addEventListener(\"mouseleave\", hideTitle);\n      target.addEventListener(\"touchstart\", showTitle);\n      target.addEventListener(\"touchend\", hideTitle);\n      target.addEventListener(\"touchcancel\", hideTitle);\n      target.addEventListener(\"blur\", hideTitle);\n      return target;\n    },\n    scriptPanel(script2, store2, opts) {\n      var _a, _b;\n      const scriptPanel = (0, dom_1$7.h)(\"script-panel-element\", { name: script2.name });\n      script2.onConfigChange(\"notes\", (pre, curr) => {\n        scriptPanel.notesContainer.innerHTML = script2.cfg.notes || \"\";\n      });\n      script2.panel = scriptPanel;\n      scriptPanel.notesContainer.innerHTML = ((_b = (_a = script2.configs) === null || _a === void 0 ? void 0 : _a.notes) === null || _b === void 0 ? void 0 : _b.defaultValue) || \"\";\n      let configs = /* @__PURE__ */ Object.create({});\n      const elList = [];\n      for (const key in script2.configs) {\n        if (Object.prototype.hasOwnProperty.call(script2.configs, key)) {\n          const cfg = script2.configs[key];\n          if (cfg.separator) {\n            elList.push(this.configsArea(this.configs(script2.namespace, store2, configs || {}, opts === null || opts === void 0 ? void 0 : opts.onload)));\n            elList.push((0, dom_1$7.h)(\"div\", { className: \"separator\", style: { margin: \"0px 8px\" } }, cfg.separator));\n            configs = /* @__PURE__ */ Object.create({});\n          }\n          configs[key] = cfg;\n        }\n      }\n      if (Object.keys(configs).length > 0) {\n        elList.push(this.configsArea(this.configs(script2.namespace, store2, configs || {}, opts === null || opts === void 0 ? void 0 : opts.onload)));\n      }\n      scriptPanel.configsContainer.replaceChildren(...elList);\n      return scriptPanel;\n    },\n    configsArea(configElements) {\n      const configsContainer = (0, dom_1$7.h)(\"div\", { className: \"configs card\" });\n      const configsBody = (0, dom_1$7.h)(\"div\", { className: \"configs-body\" });\n      configsBody.append(...Object.entries(configElements).map(([key, el]) => el));\n      configsContainer.append(configsBody);\n      return configsContainer;\n    },\n    configs(namespace, store2, configs, onload) {\n      const elements2 = /* @__PURE__ */ Object.create({});\n      for (const key in configs) {\n        if (Object.prototype.hasOwnProperty.call(configs, key)) {\n          const config2 = configs[key];\n          if (config2.label !== void 0) {\n            const element = (0, dom_1$7.h)(\"config-element\", {\n              key: common_1$4.$.namespaceKey(namespace, key),\n              tag: config2.tag,\n              sync: config2.sync,\n              attrs: config2.attrs,\n              _onload: function(el) {\n                var _a;\n                (_a = config2.onload) === null || _a === void 0 ? void 0 : _a.call(this, el);\n                onload === null || onload === void 0 ? void 0 : onload(el);\n              },\n              defaultValue: config2.defaultValue,\n              options: config2.options,\n              showIf: config2.showIf,\n              elementClassName: config2.elementClassName,\n              labelClassName: config2.labelClassName,\n              providerClassName: config2.providerClassName,\n              enableForAttribute: config2.enableForAttribute\n            });\n            element.store = store2;\n            element.label.textContent = config2.label;\n            elements2[key] = element;\n          }\n        }\n      }\n      return elements2;\n    },\n    notes(lines, tag = \"ul\") {\n      return (0, dom_1$7.h)(tag, lines.map((line) => (0, dom_1$7.h)(\"li\", Array.isArray(line) ? line.map((node) => typeof node === \"string\" ? (0, dom_1$7.h)(\"div\", { innerHTML: node }) : node) : [typeof line === \"string\" ? (0, dom_1$7.h)(\"div\", { innerHTML: line }) : line])));\n    },\n    copy(name, value) {\n      return (0, dom_1$7.h)(\"span\", \"📄\" + name, (btn) => {\n        btn.className = \"copy\";\n        btn.addEventListener(\"click\", () => {\n          btn.innerText = \"已复制√\";\n          navigator.clipboard.writeText(value);\n          setTimeout(() => {\n            btn.innerText = \"📄\" + name;\n          }, 500);\n        });\n      });\n    },\n    preventText(opts) {\n      const { name, delay = 3, autoRemove = true, ondefault, onprevent } = opts;\n      const span = (0, dom_1$7.h)(\"span\", name);\n      span.style.textDecoration = \"underline\";\n      span.style.cursor = \"pointer\";\n      span.onclick = () => {\n        clearTimeout(id);\n        if (autoRemove) {\n          span.remove();\n        }\n        onprevent === null || onprevent === void 0 ? void 0 : onprevent(span);\n      };\n      const id = setTimeout(() => {\n        if (autoRemove) {\n          span.remove();\n        }\n        ondefault(span);\n      }, delay * 1e3);\n      return span;\n    },\n    space(children, options) {\n      return (0, dom_1$7.h)(\"div\", { className: \"space\" }, (div) => {\n        var _a, _b, _c;\n        for (let index = 0; index < children.length; index++) {\n          const child = (0, dom_1$7.h)(\"span\", { className: \"space-item\" }, [children[index]]);\n          child.style.display = \"inline-block\";\n          const x = (_a = options === null || options === void 0 ? void 0 : options.x) !== null && _a !== void 0 ? _a : 12;\n          const y = (_b = options === null || options === void 0 ? void 0 : options.y) !== null && _b !== void 0 ? _b : 0;\n          if (index > 0) {\n            child.style.marginLeft = x / 2 + \"px\";\n            child.style.marginRight = x / 2 + \"px\";\n            child.style.marginTop = y / 2 + \"px\";\n            child.style.marginBottom = y / 2 + \"px\";\n          } else {\n            child.style.marginRight = x / 2 + \"px\";\n            child.style.marginBottom = y / 2 + \"px\";\n          }\n          div.append(child);\n          if (index !== children.length - 1) {\n            div.append((0, dom_1$7.h)(\"span\", [(_c = options === null || options === void 0 ? void 0 : options.separator) !== null && _c !== void 0 ? _c : \" \"]));\n          }\n        }\n      });\n    },\n    button(text, attrs, handler) {\n      return (0, dom_1$7.h)(\"input\", Object.assign({ type: \"button\" }, attrs), function(btn) {\n        btn.value = text || \"\";\n        btn.classList.add(\"base-style-button\");\n        handler === null || handler === void 0 ? void 0 : handler.apply(this, [btn]);\n      });\n    }\n  };\n  (function(exports3) {\n    var __createBinding = commonjsGlobal && commonjsGlobal.__createBinding || (Object.create ? function(o, m, k, k2) {\n      if (k2 === void 0)\n        k2 = k;\n      var desc = Object.getOwnPropertyDescriptor(m, k);\n      if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n        desc = { enumerable: true, get: function() {\n          return m[k];\n        } };\n      }\n      Object.defineProperty(o, k2, desc);\n    } : function(o, m, k, k2) {\n      if (k2 === void 0)\n        k2 = k;\n      o[k2] = m[k];\n    });\n    var __exportStar = commonjsGlobal && commonjsGlobal.__exportStar || function(m, exports4) {\n      for (var p in m)\n        if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports4, p))\n          __createBinding(exports4, m, p);\n    };\n    Object.defineProperty(exports3, \"__esModule\", { value: true });\n    __exportStar(common, exports3);\n    __exportStar(ui, exports3);\n    __exportStar(dom, exports3);\n    __exportStar(elements$1, exports3);\n    __exportStar(tampermonkey, exports3);\n    __exportStar(store, exports3);\n    __exportStar(_const, exports3);\n  })(utils);\n  (function(exports3) {\n    var __awaiter2 = commonjsGlobal && commonjsGlobal.__awaiter || function(thisArg, _arguments, P, generator) {\n      function adopt(value) {\n        return value instanceof P ? value : new P(function(resolve) {\n          resolve(value);\n        });\n      }\n      return new (P || (P = Promise))(function(resolve, reject) {\n        function fulfilled(value) {\n          try {\n            step(generator.next(value));\n          } catch (e) {\n            reject(e);\n          }\n        }\n        function rejected(value) {\n          try {\n            step(generator[\"throw\"](value));\n          } catch (e) {\n            reject(e);\n          }\n        }\n        function step(result) {\n          result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n        }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n      });\n    };\n    Object.defineProperty(exports3, \"__esModule\", { value: true });\n    exports3.cors = exports3.CorsEventEmitter = void 0;\n    const utils_12 = utils;\n    const common_12 = common;\n    const const_12 = _const;\n    const store_12 = store;\n    class CorsEventEmitter {\n      constructor() {\n        this.eventMap = /* @__PURE__ */ new Map();\n      }\n      eventKey(name) {\n        return \"cors.events.\" + name;\n      }\n      tempKey(...args) {\n        return [\"_temp_\", ...args].join(\".\");\n      }\n      keyOfReturn(id) {\n        return this.tempKey(\"event\", id, \"return\");\n      }\n      keyOfArguments(id) {\n        return this.tempKey(\"event\", id, \"arguments\");\n      }\n      keyOfState(id) {\n        return this.tempKey(\"event\", id, \"state\");\n      }\n      emit(name, args = [], callback) {\n        store_12.$store.getTab(const_12.$const.TAB_UID).then((uid) => {\n          const id = common_12.$.uuid().replace(/-/g, \"\");\n          const key = uid + \".\" + this.eventKey(name);\n          store_12.$store.set(this.keyOfState(id), 0);\n          store_12.$store.set(this.keyOfArguments(id), args);\n          setTimeout(() => {\n            const listenerId = store_12.$store.addChangeListener(this.keyOfState(id), () => {\n              store_12.$store.removeChangeListener(listenerId);\n              callback === null || callback === void 0 ? void 0 : callback(store_12.$store.get(this.keyOfReturn(id)));\n              store_12.$store.delete(this.keyOfState(id));\n              store_12.$store.delete(this.keyOfReturn(id));\n              store_12.$store.delete(this.keyOfArguments(id));\n            }) || 0;\n            store_12.$store.set(key, (store_12.$store.get(key) ? String(store_12.$store.get(key)).split(\",\") : []).concat(id).join(\",\"));\n          }, 100);\n        }).catch(console.error);\n      }\n      on(name, handler) {\n        return new Promise((resolve) => {\n          store_12.$store.getTab(const_12.$const.TAB_UID).then((uid) => {\n            const key = uid + \".\" + this.eventKey(name);\n            const originId = this.eventMap.get(key);\n            if (originId) {\n              resolve(originId);\n            } else {\n              const id = store_12.$store.addChangeListener(key, (curr, pre, remote) => __awaiter2(this, void 0, void 0, function* () {\n                if (remote) {\n                  if (curr === void 0) {\n                    return;\n                  }\n                  const list = String(curr).split(\",\");\n                  const id2 = list.pop();\n                  if (id2) {\n                    store_12.$store.set(this.keyOfReturn(id2), yield handler(store_12.$store.get(this.keyOfArguments(id2))));\n                    setTimeout(() => {\n                      store_12.$store.set(this.keyOfState(id2), 1);\n                      store_12.$store.set(key, list.join(\",\"));\n                    }, 100);\n                  }\n                }\n              })) || 0;\n              this.eventMap.set(key, id);\n              resolve(id);\n            }\n          }).catch(console.error);\n        });\n      }\n      off(name) {\n        const key = this.eventKey(name);\n        const originId = this.eventMap.get(key);\n        if (originId) {\n          this.eventMap.delete(key);\n          store_12.$store.removeChangeListener(originId);\n        }\n      }\n      defineTopFunction(func) {\n        if (utils_12.$gm.isInGMContext() === false) {\n          return () => {\n          };\n        }\n        const randomId = common_12.$.uuid().replace(/-/g, \"\");\n        const event_name = \"_top_function_.\" + randomId;\n        if (self === top) {\n          exports3.cors.on(event_name, (args) => __awaiter2(this, void 0, void 0, function* () {\n            return yield func(...args);\n          }));\n        }\n        return (...args) => __awaiter2(this, void 0, void 0, function* () {\n          if (self === top) {\n            return yield func(...args);\n          }\n          const res = yield new Promise((resolve, reject) => {\n            try {\n              exports3.cors.emit(event_name, args, (val) => {\n                resolve(val);\n              });\n            } catch (e) {\n              reject(e);\n            }\n          });\n          return res;\n        });\n      }\n    }\n    exports3.CorsEventEmitter = CorsEventEmitter;\n    if (typeof GM_listValues !== \"undefined\" && self === top) {\n      window.onload = () => {\n        store_12.$store.list().forEach((key) => {\n          if (/_temp_.event.[0-9a-z]{32}.(state|return|arguments)/.test(key)) {\n            store_12.$store.delete(key);\n          }\n          if (/_top_function_.*/.test(key)) {\n            store_12.$store.delete(key);\n          }\n          if (/[0-9a-z]{32}.cors.events/.test(key)) {\n            store_12.$store.delete(key);\n          }\n        });\n      };\n    }\n    exports3.cors = new CorsEventEmitter();\n  })(cors);\n  var project = {};\n  Object.defineProperty(project, \"__esModule\", { value: true });\n  project.Project = void 0;\n  class Project {\n    constructor({ name, domains, scripts }) {\n      this.name = name;\n      this.domains = domains;\n      for (const key in scripts) {\n        if (Object.prototype.hasOwnProperty.call(scripts, key)) {\n          const element = scripts[key];\n          element.projectName = name;\n        }\n      }\n      this.scripts = scripts;\n    }\n    static create(opts) {\n      return new Project(opts);\n    }\n  }\n  project.Project = Project;\n  var script = {};\n  var __importDefault$1 = commonjsGlobal && commonjsGlobal.__importDefault || function(mod) {\n    return mod && mod.__esModule ? mod : { \"default\": mod };\n  };\n  Object.defineProperty(script, \"__esModule\", { value: true });\n  script.Script = script.BaseScript = void 0;\n  const common_1$3 = common;\n  const store_1$1 = store;\n  const common_2 = common$1;\n  const events_1 = __importDefault$1(events.exports);\n  class BaseScript extends common_2.CommonEventEmitter {\n  }\n  script.BaseScript = BaseScript;\n  class Script extends BaseScript {\n    get configs() {\n      if (!this._resolvedConfigs) {\n        this._resolvedConfigs = typeof this._configs === \"function\" ? this._configs() : this._configs;\n      }\n      return this._resolvedConfigs;\n    }\n    set configs(c) {\n      this._configs = c;\n    }\n    constructor({ name, namespace, matches, excludes, configs, hideInPanel, onstart, onactive, oncomplete, onbeforeunload, onrender, onhistorychange, methods, priority }) {\n      super();\n      this.excludes = [];\n      this.cfg = {};\n      this.methods = /* @__PURE__ */ Object.create({});\n      this.event = new events_1.default();\n      this.name = name;\n      this.namespace = namespace;\n      this.matches = matches;\n      this.excludes = excludes;\n      this._configs = configs;\n      this.hideInPanel = hideInPanel;\n      this.onstart = this.errorHandler(onstart);\n      this.onactive = this.errorHandler(onactive);\n      this.oncomplete = this.errorHandler(oncomplete);\n      this.onbeforeunload = this.errorHandler(onbeforeunload);\n      this.onrender = this.errorHandler(onrender);\n      this.onhistorychange = this.errorHandler(onhistorychange);\n      this.methods = (methods === null || methods === void 0 ? void 0 : methods.bind(this)()) || /* @__PURE__ */ Object.create({});\n      this.priority = priority !== null && priority !== void 0 ? priority : 0;\n      if (this.methods) {\n        for (const key in methods) {\n          if (Reflect.has(this.methods, key) && typeof this.methods[key] !== \"function\") {\n            Reflect.set(this.methods, key, this.errorHandler(this.methods[key]));\n          }\n        }\n      }\n    }\n    onConfigChange(key, handler) {\n      const _key = common_1$3.$.namespaceKey(this.namespace, key.toString());\n      return store_1$1.$store.addChangeListener(_key, (curr, pre, remote) => {\n        handler(curr, pre, !!remote);\n      });\n    }\n    offConfigChange(listener) {\n      store_1$1.$store.removeChangeListener(listener);\n    }\n    fullName() {\n      return this.projectName ? `${this.projectName}-${this.name}` : this.name;\n    }\n    errorHandler(func) {\n      return (...args) => {\n        try {\n          return func === null || func === void 0 ? void 0 : func.apply(this, args);\n        } catch (err) {\n          console.error(err);\n          if (err instanceof Error) {\n            this.emit(\"scripterror\", err.message);\n          } else {\n            this.emit(\"scripterror\", String(err));\n          }\n        }\n      };\n    }\n  }\n  script.Script = Script;\n  (function(exports3) {\n    var __createBinding = commonjsGlobal && commonjsGlobal.__createBinding || (Object.create ? function(o, m, k, k2) {\n      if (k2 === void 0)\n        k2 = k;\n      var desc = Object.getOwnPropertyDescriptor(m, k);\n      if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n        desc = { enumerable: true, get: function() {\n          return m[k];\n        } };\n      }\n      Object.defineProperty(o, k2, desc);\n    } : function(o, m, k, k2) {\n      if (k2 === void 0)\n        k2 = k;\n      o[k2] = m[k];\n    });\n    var __exportStar = commonjsGlobal && commonjsGlobal.__exportStar || function(m, exports4) {\n      for (var p in m)\n        if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports4, p))\n          __createBinding(exports4, m, p);\n    };\n    Object.defineProperty(exports3, \"__esModule\", { value: true });\n    __exportStar(common$1, exports3);\n    __exportStar(config$1, exports3);\n    __exportStar(cors, exports3);\n    __exportStar(project, exports3);\n    __exportStar(script, exports3);\n    __exportStar(store_provider, exports3);\n  })(interfaces);\n  var elements = {};\n  var config = {};\n  var _interface = {};\n  Object.defineProperty(_interface, \"__esModule\", { value: true });\n  _interface.IElement = void 0;\n  class IElement extends HTMLElement {\n    connectedCallback() {\n    }\n    disconnectedCallback() {\n    }\n    adoptedCallback() {\n    }\n    attributeChangedCallback(name, oldValue, newValue) {\n    }\n  }\n  _interface.IElement = IElement;\n  Object.defineProperty(config, \"__esModule\", { value: true });\n  config.ConfigElement = void 0;\n  const ui_1$1 = ui;\n  const dom_1$6 = dom;\n  const interface_1$6 = _interface;\n  class ConfigElement extends interface_1$6.IElement {\n    constructor(store2) {\n      super();\n      this.label = (0, dom_1$6.h)(\"label\");\n      this.wrapper = (0, dom_1$6.h)(\"div\", { className: \"config-wrapper\" });\n      this.key = \"\";\n      this.store = store2;\n    }\n    get value() {\n      return this.store.get(this.key, this.defaultValue);\n    }\n    set value(value) {\n      this.provider.value = value;\n      this.store.set(this.key, value);\n    }\n    connectedCallback() {\n      var _a, _b, _c;\n      switch (this.tag) {\n        case \"select\": {\n          this.provider = (0, dom_1$6.h)(\"select\");\n          const value = this.store.get(this.key, this.defaultValue);\n          for (const item of this.options || []) {\n            const option = ui_1$1.$ui.tooltip((0, dom_1$6.h)(\"option\"));\n            if (Array.isArray(item)) {\n              option.value = item[0];\n              option.textContent = (_a = item[1]) !== null && _a !== void 0 ? _a : item[0];\n              if (item[2]) {\n                option.title = item[2];\n              }\n              if (String(item[0]) === String(value)) {\n                option.selected = true;\n                option.toggleAttribute(\"selected\");\n              }\n              this.provider.add(option);\n            } else {\n              option.value = item.value;\n              option.textContent = (_b = item.label) !== null && _b !== void 0 ? _b : item.value;\n              if (item.title) {\n                option.title = item.title;\n              }\n              if (String(item.value) === String(value)) {\n                option.selected = true;\n                option.toggleAttribute(\"selected\");\n              }\n              this.provider.add(option);\n            }\n          }\n          this.provider.onchange = () => {\n            this.store.set(this.key, this.provider.value);\n          };\n          break;\n        }\n        case \"textarea\": {\n          this.provider = (0, dom_1$6.h)(\"textarea\");\n          this.provider.value = this.store.get(this.key, this.defaultValue);\n          this.provider.onchange = () => {\n            this.store.set(this.key, this.provider.value);\n          };\n          break;\n        }\n        default: {\n          this.provider = (0, dom_1$6.h)(\"input\");\n          if ([\"checkbox\", \"radio\"].some((t2) => {\n            var _a2;\n            return t2 === ((_a2 = this.attrs) === null || _a2 === void 0 ? void 0 : _a2.type);\n          })) {\n            this.provider.checked = this.store.get(this.key, this.defaultValue);\n            const provider = this.provider;\n            provider.onchange = () => {\n              this.store.set(this.key, provider.checked);\n            };\n          } else {\n            this.provider.value = this.store.get(this.key, this.defaultValue);\n            this.provider.setAttribute(\"value\", this.provider.value);\n            this.provider.onchange = () => {\n              const { min, max, type } = this.attrs || {};\n              if (type === \"number\") {\n                if (this.provider.value.trim() === \"\") {\n                  this.provider.value = this.defaultValue;\n                  this.store.set(this.key, this.defaultValue);\n                  return;\n                }\n                const val = parseFloat(this.provider.value);\n                const _min = min ? parseFloat(min) : void 0;\n                const _max = max ? parseFloat(max) : void 0;\n                if (_min && val < _min) {\n                  this.provider.value = _min.toString();\n                  this.store.set(this.key, parseFloat(this.provider.value));\n                } else if (_max && val > _max) {\n                  this.provider.value = _max.toString();\n                  this.store.set(this.key, parseFloat(this.provider.value));\n                } else {\n                  this.store.set(this.key, val);\n                }\n              } else {\n                this.store.set(this.key, this.provider.value);\n              }\n            };\n          }\n          break;\n        }\n      }\n      if (this.enableForAttribute) {\n        this.provider.setAttribute(\"id\", this.key);\n        this.label.setAttribute(\"for\", this.key);\n      }\n      if (this.labelClassName) {\n        this.label.className = this.labelClassName;\n      }\n      if (this.providerClassName) {\n        this.provider.className = this.providerClassName;\n      }\n      if (this.elementClassName) {\n        this.className = this.elementClassName;\n      }\n      this.wrapper.replaceChildren(this.provider);\n      this.append(this.label, this.wrapper);\n      for (const key in this.attrs) {\n        if (key === \"style\") {\n          Object.assign(this.provider.style, this.attrs[key]);\n          continue;\n        }\n        if (Object.prototype.hasOwnProperty.call(this.attrs, key)) {\n          Reflect.set(this.provider, key, Reflect.get(this.attrs, key));\n        }\n      }\n      if (this.sync) {\n        this.store.addChangeListener(this.key, (curr) => {\n          this.provider.value = curr;\n        });\n      }\n      ui_1$1.$ui.tooltip(this.provider);\n      if (this.showIf) {\n        let show_if = false;\n        if (Array.isArray(this.showIf)) {\n          if (typeof this.showIf[0] !== \"string\") {\n            throw new Error(\"EUS Config.showIf first element must be a string\");\n          }\n          const val = this.store.get(this.showIf[0], false) || false;\n          const res = this.showIf[1].call(null, val, val, this.store);\n          show_if = Boolean(res);\n        } else {\n          show_if = this.store.get(this.showIf, false) || false;\n        }\n        if (show_if) {\n          this.style.display = \"\";\n        } else {\n          this.style.display = \"none\";\n        }\n        if (Array.isArray(this.showIf)) {\n          if (typeof this.showIf[1] !== \"function\") {\n            throw new Error(\"EUS Config.showIf second element must be a function\");\n          }\n          this.store.addChangeListener(this.showIf[0], (curr, pre) => {\n            if (this.isConnected) {\n              if (this.showIf && Array.isArray(this.showIf)) {\n                const res = this.showIf[1].call(null, curr, pre, this.store);\n                if (res) {\n                  this.style.display = \"\";\n                } else {\n                  this.style.display = \"none\";\n                }\n              }\n            }\n          });\n        } else {\n          this.store.addChangeListener(this.showIf, (curr) => {\n            if (this.isConnected) {\n              const res = Boolean(curr);\n              if (res) {\n                this.style.display = \"\";\n              } else {\n                this.style.display = \"none\";\n              }\n            }\n          });\n        }\n      }\n      (_c = this._onload) === null || _c === void 0 ? void 0 : _c.call(this.provider, this);\n    }\n  }\n  config.ConfigElement = ConfigElement;\n  var container = {};\n  Object.defineProperty(container, \"__esModule\", { value: true });\n  container.ContainerElement = void 0;\n  const common_1$2 = common;\n  const ui_1 = ui;\n  const dom_1$5 = dom;\n  const interface_1$5 = _interface;\n  class ContainerElement extends interface_1$5.IElement {\n    constructor() {\n      super(...arguments);\n      this.header = ui_1.$ui.tooltip((0, dom_1$5.h)(\"header-element\", { title: \"菜单栏-可拖动区域\" }));\n      this.body = (0, dom_1$5.h)(\"div\", { className: \"body\", clientHeight: window.innerHeight / 2 });\n      this.footer = (0, dom_1$5.h)(\"div\", { className: \"footer\" });\n    }\n    connectedCallback() {\n      this.append(this.header, this.body, this.footer);\n      common_1$2.$.onresize(this, (cont) => {\n        cont.body.style.maxHeight = window.innerHeight - this.header.clientHeight - 100 + \"px\";\n        cont.body.style.maxWidth = window.innerWidth - 50 + \"px\";\n      });\n    }\n  }\n  container.ContainerElement = ContainerElement;\n  var dropdown = {};\n  Object.defineProperty(dropdown, \"__esModule\", { value: true });\n  dropdown.DropdownElement = void 0;\n  const interface_1$4 = _interface;\n  const dom_1$4 = dom;\n  class DropdownElement extends interface_1$4.IElement {\n    constructor() {\n      super(...arguments);\n      this.triggerElement = (0, dom_1$4.h)(\"button\");\n      this.content = (0, dom_1$4.h)(\"div\", { className: \"dropdown-content\" });\n      this.trigger = \"hover\";\n    }\n    connectedCallback() {\n      this.append(this.triggerElement, this.content);\n      this.classList.add(\"dropdown\");\n      if (this.trigger === \"click\") {\n        this.triggerElement.onclick = () => {\n          this.content.classList.toggle(\"show\");\n        };\n      } else {\n        this.triggerElement.onmouseover = () => {\n          this.content.classList.add(\"show\");\n        };\n        this.triggerElement.onmouseout = () => {\n          this.content.classList.remove(\"show\");\n        };\n        this.content.onmouseover = () => {\n          this.content.classList.add(\"show\");\n        };\n        this.content.onmouseout = () => {\n          this.content.classList.remove(\"show\");\n        };\n      }\n      this.content.onclick = () => {\n        this.content.classList.remove(\"show\");\n      };\n    }\n  }\n  dropdown.DropdownElement = DropdownElement;\n  var header = {};\n  Object.defineProperty(header, \"__esModule\", { value: true });\n  header.HeaderElement = void 0;\n  const interface_1$3 = _interface;\n  class HeaderElement extends interface_1$3.IElement {\n    connectedCallback() {\n      this.append(this.visualSwitcher || \"\");\n    }\n  }\n  header.HeaderElement = HeaderElement;\n  var message = {};\n  Object.defineProperty(message, \"__esModule\", { value: true });\n  message.MessageElement = void 0;\n  const dom_1$3 = dom;\n  const interface_1$2 = _interface;\n  class MessageElement extends interface_1$2.IElement {\n    constructor() {\n      super(...arguments);\n      this.closer = (0, dom_1$3.h)(\"span\", { className: \"message-closer\" }, \"x\");\n      this.contentContainer = (0, dom_1$3.h)(\"span\", { className: \"message-content-container\" });\n      this.type = \"info\";\n      this.content = \"\";\n      this.closeable = true;\n    }\n    connectedCallback() {\n      var _a;\n      this.classList.add(this.type);\n      if (typeof this.content === \"string\") {\n        this.contentContainer.innerHTML = this.content;\n      } else {\n        this.contentContainer.append(this.content);\n      }\n      this.duration = Math.max((_a = this.duration) !== null && _a !== void 0 ? _a : 5, 0);\n      this.append(this.contentContainer);\n      if (this.closeable) {\n        this.append(this.closer);\n        this.closer.addEventListener(\"click\", () => {\n          var _a2;\n          (_a2 = this.onClose) === null || _a2 === void 0 ? void 0 : _a2.call(this);\n          this.remove();\n        });\n      }\n      if (this.duration) {\n        setTimeout(() => {\n          var _a2;\n          (_a2 = this.onClose) === null || _a2 === void 0 ? void 0 : _a2.call(this);\n          this.remove();\n        }, this.duration * 1e3);\n      }\n    }\n  }\n  message.MessageElement = MessageElement;\n  var modal$1 = {};\n  var __awaiter$2 = commonjsGlobal && commonjsGlobal.__awaiter || function(thisArg, _arguments, P, generator) {\n    function adopt(value) {\n      return value instanceof P ? value : new P(function(resolve) {\n        resolve(value);\n      });\n    }\n    return new (P || (P = Promise))(function(resolve, reject) {\n      function fulfilled(value) {\n        try {\n          step(generator.next(value));\n        } catch (e) {\n          reject(e);\n        }\n      }\n      function rejected(value) {\n        try {\n          step(generator[\"throw\"](value));\n        } catch (e) {\n          reject(e);\n        }\n      }\n      function step(result) {\n        result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n      }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n  };\n  Object.defineProperty(modal$1, \"__esModule\", { value: true });\n  modal$1.ModalElement = void 0;\n  const common_1$1 = common;\n  const dom_1$2 = dom;\n  const tampermonkey_1 = tampermonkey;\n  const interface_1$1 = _interface;\n  class ModalElement extends interface_1$1.IElement {\n    constructor() {\n      super(...arguments);\n      this._title = (0, dom_1$2.h)(\"div\", { className: \"modal-title\" });\n      this.body = (0, dom_1$2.h)(\"div\", { className: \"modal-body\" });\n      this.footerContainer = (0, dom_1$2.h)(\"div\", { className: \"modal-footer\" });\n      this.modalInput = (0, dom_1$2.h)(\"input\", { className: \"modal-input\" });\n      this.modalInputType = \"input\";\n      this.type = \"alert\";\n      this.content = \"\";\n      this.inputDefaultValue = \"\";\n      this.placeholder = \"\";\n      this.modalStyle = {};\n    }\n    connectedCallback() {\n      var _a;\n      this.classList.add(this.type);\n      Object.assign(this.style, this.modalStyle || {});\n      const profile = (0, dom_1$2.h)(\"div\", {\n        innerText: this.profile || \"弹窗来自: OCS \" + (((_a = tampermonkey_1.$gm.getInfos()) === null || _a === void 0 ? void 0 : _a.script.version) || \"\"),\n        className: \"modal-profile\"\n      });\n      this._title.innerText = this.title;\n      this.body.append(typeof this.content === \"string\" ? (0, dom_1$2.h)(\"div\", { innerHTML: this.content }) : this.content);\n      if (this.modalInputType === \"textarea\") {\n        this.modalInput = (0, dom_1$2.h)(\"textarea\", { className: \"modal-input\", style: { height: \"100px\" } });\n      }\n      this.modalInput.placeholder = this.placeholder || \"\";\n      this.modalInput.value = this.inputDefaultValue || \"\";\n      this.append(profile, this._title, this.body, this.footerContainer);\n      this.style.width = (this.width || 400) + \"px\";\n      if (this.footer === void 0) {\n        this.footerContainer.append(this.modalInput);\n        if (this.cancelButton === void 0) {\n          this.cancelButton = (0, dom_1$2.h)(\"button\", { className: \"modal-cancel-button\" });\n          this.cancelButton.innerText = this.cancelButtonText || \"取消\";\n          this.cancelButton.onclick = () => {\n            var _a2, _b;\n            (_a2 = this.onCancel) === null || _a2 === void 0 ? void 0 : _a2.call(this);\n            (_b = this.onClose) === null || _b === void 0 ? void 0 : _b.call(this);\n            this.remove();\n          };\n        }\n        if (this.confirmButton === void 0) {\n          this.confirmButton = (0, dom_1$2.h)(\"button\", { className: \"modal-confirm-button\" });\n          this.confirmButton.innerText = this.confirmButtonText || \"确定\";\n          this.confirmButton.onclick = () => __awaiter$2(this, void 0, void 0, function* () {\n            var _b, _c;\n            if ((yield (_b = this.onConfirm) === null || _b === void 0 ? void 0 : _b.call(this, this.modalInput.value)) !== false) {\n              this.remove();\n              (_c = this.onClose) === null || _c === void 0 ? void 0 : _c.call(this, this.modalInput.value);\n            }\n          });\n        }\n        this.cancelButton && this.footerContainer.append(this.cancelButton);\n        this.confirmButton && this.footerContainer.append(this.confirmButton);\n        if (this.type === \"simple\") {\n          this.footerContainer.remove();\n        } else if (this.type === \"prompt\") {\n          this.modalInput.focus();\n        }\n      } else {\n        this.footerContainer.append(this.footer);\n      }\n      common_1$1.$.onresize(this.body, (modal2) => {\n        this.body.style.maxHeight = window.innerHeight - 100 + \"px\";\n        this.body.style.maxWidth = window.innerWidth - 50 + \"px\";\n      });\n    }\n  }\n  modal$1.ModalElement = ModalElement;\n  var script_panel = {};\n  Object.defineProperty(script_panel, \"__esModule\", { value: true });\n  script_panel.ScriptPanelElement = void 0;\n  const dom_1$1 = dom;\n  const interface_1 = _interface;\n  class ScriptPanelElement extends interface_1.IElement {\n    constructor() {\n      super(...arguments);\n      this.separator = (0, dom_1$1.h)(\"div\", { className: \"separator\" });\n      this.notesContainer = (0, dom_1$1.h)(\"div\", { className: \"notes card\" });\n      this.configsContainer = (0, dom_1$1.h)(\"div\", { className: \"configs-container card\" });\n      this.body = (0, dom_1$1.h)(\"div\", { className: \"script-panel-body\" });\n      this.lockWrapper = (0, dom_1$1.h)(\"div\", { className: \"lock-wrapper\" });\n    }\n    connectedCallback() {\n      this.separator.innerText = this.name || \"\";\n      this.append(this.separator);\n      this.append(this.notesContainer);\n      this.append(this.configsContainer);\n      this.append(this.body);\n    }\n  }\n  script_panel.ScriptPanelElement = ScriptPanelElement;\n  (function(exports3) {\n    Object.defineProperty(exports3, \"__esModule\", { value: true });\n    exports3.definedCustomElements = exports3.ScriptPanelElement = exports3.ModalElement = exports3.MessageElement = exports3.HeaderElement = exports3.ContainerElement = exports3.ConfigElement = void 0;\n    const config_1 = config;\n    const container_1 = container;\n    const dropdown_1 = dropdown;\n    const header_1 = header;\n    const message_1 = message;\n    const modal_1 = modal$1;\n    const script_panel_1 = script_panel;\n    var config_2 = config;\n    Object.defineProperty(exports3, \"ConfigElement\", { enumerable: true, get: function() {\n      return config_2.ConfigElement;\n    } });\n    var container_2 = container;\n    Object.defineProperty(exports3, \"ContainerElement\", { enumerable: true, get: function() {\n      return container_2.ContainerElement;\n    } });\n    var header_2 = header;\n    Object.defineProperty(exports3, \"HeaderElement\", { enumerable: true, get: function() {\n      return header_2.HeaderElement;\n    } });\n    var message_2 = message;\n    Object.defineProperty(exports3, \"MessageElement\", { enumerable: true, get: function() {\n      return message_2.MessageElement;\n    } });\n    var modal_2 = modal$1;\n    Object.defineProperty(exports3, \"ModalElement\", { enumerable: true, get: function() {\n      return modal_2.ModalElement;\n    } });\n    var script_panel_2 = script_panel;\n    Object.defineProperty(exports3, \"ScriptPanelElement\", { enumerable: true, get: function() {\n      return script_panel_2.ScriptPanelElement;\n    } });\n    exports3.definedCustomElements = [\n      config_1.ConfigElement,\n      container_1.ContainerElement,\n      header_1.HeaderElement,\n      modal_1.ModalElement,\n      message_1.MessageElement,\n      script_panel_1.ScriptPanelElement,\n      dropdown_1.DropdownElement\n    ];\n  })(elements);\n  var __awaiter$1 = commonjsGlobal && commonjsGlobal.__awaiter || function(thisArg, _arguments, P, generator) {\n    function adopt(value) {\n      return value instanceof P ? value : new P(function(resolve) {\n        resolve(value);\n      });\n    }\n    return new (P || (P = Promise))(function(resolve, reject) {\n      function fulfilled(value) {\n        try {\n          step(generator.next(value));\n        } catch (e) {\n          reject(e);\n        }\n      }\n      function rejected(value) {\n        try {\n          step(generator[\"throw\"](value));\n        } catch (e) {\n          reject(e);\n        }\n      }\n      function step(result) {\n        result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n      }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n  };\n  var __rest = commonjsGlobal && commonjsGlobal.__rest || function(s, e) {\n    var t2 = {};\n    for (var p in s)\n      if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t2[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n        if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n          t2[p[i]] = s[p[i]];\n      }\n    return t2;\n  };\n  Object.defineProperty(customWindow, \"__esModule\", { value: true });\n  customWindow.modal = customWindow.CustomWindow = void 0;\n  const _1 = interfaces;\n  const elements_1$1 = elements;\n  const utils_1 = utils;\n  const start_1 = start$1;\n  const minimizeSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\"><path d=\"M0 0h24v24H0V0z\" fill=\"none\"/><path d=\"M19 13H5v-2h14v2z\"/></svg>';\n  const expandSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\"><path d=\"M0 0h24v24H0V0z\" fill=\"none\"/><path d=\"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H6V6h12v12z\"/></svg>';\n  class CustomWindow {\n    constructor(projects, inputStoreProvider, config2) {\n      this.messageContainer = (0, utils_1.h)(\"div\", { className: \"message-container\" });\n      this.extraMenuBar = (0, utils_1.h)(\"div\", { className: \"extra-menu-bar\" });\n      this.defaults = {\n        urls: (urls) => urls && urls.length ? urls : [location.href],\n        panelName: (name) => name || this.config.render.defaultPanelName || \"\"\n      };\n      this.projects = projects;\n      this.inputStoreProvider = inputStoreProvider;\n      this.config = config2;\n      handleLowLevelBrowser();\n      utils_1.$.loadCustomElements(elements_1$1.definedCustomElements);\n      this.wrapper = (0, utils_1.h)(\"div\");\n      this.root = this.wrapper.attachShadow({ mode: \"closed\" });\n      this.container = (0, utils_1.h)(\"container-element\");\n      this.root.append(this.container);\n      const styles = config2.render.styles.map((s) => (0, utils_1.h)(\"style\", s));\n      this.container.append(...styles, this.messageContainer);\n      const handlePosition = () => {\n        const pos = config2.store.getPosition();\n        if (pos.x > document.documentElement.clientWidth || pos.x < 0) {\n          config2.store.setPosition(10, 10);\n        }\n        if (pos.y > document.documentElement.clientHeight || pos.y < 0) {\n          config2.store.setPosition(10, 10);\n        }\n        this.container.style.left = pos.x + \"px\";\n        this.container.style.top = pos.y + \"px\";\n        const positionHandler = () => {\n          config2.store.setPosition(this.container.offsetLeft, this.container.offsetTop);\n        };\n        (0, utils_1.enableElementDraggable)(this.container.header, this.container, positionHandler);\n        (0, utils_1.enableElementTouchDraggable)(this.container.header, this.container, positionHandler);\n      };\n      const handleVisible = () => {\n        window.addEventListener(\"click\", (e) => {\n          if (e.detail === Math.max(config2.render.switchPoint, 3)) {\n            this.container.style.top = e.y + \"px\";\n            this.container.style.left = e.x + \"px\";\n            config2.store.setPosition(e.x, e.y);\n            this.setVisual(\"normal\");\n          }\n        });\n      };\n      const initCorsModalSystem = () => {\n        _1.cors.on(\"modal\", (args) => __awaiter$1(this, void 0, void 0, function* () {\n          const [type, _attrs] = args || [];\n          return new Promise((resolve, reject) => {\n            const attrs = _attrs;\n            attrs.onCancel = () => resolve(\"\");\n            attrs.onConfirm = resolve;\n            attrs.onClose = resolve;\n            modal(type, attrs);\n          });\n        }));\n      };\n      const initCorsMessageSystem = () => {\n        _1.cors.on(\"message\", (args) => __awaiter$1(this, void 0, void 0, function* () {\n          const [type, attrs] = args || [];\n          console.log(\"message\", type, attrs);\n          this.message(type, attrs);\n        }));\n      };\n      window.addEventListener(\"keydown\", (e) => {\n        if (e.ctrlKey && e.key === config2.render.switchKey) {\n          e.stopPropagation();\n          e.preventDefault();\n          this.setVisual(config2.store.getVisual() === \"hidden\" ? \"normal\" : \"hidden\");\n        }\n      }, { capture: true });\n      handleVisible();\n      this.setVisual(config2.store.getVisual());\n      (() => __awaiter$1(this, void 0, void 0, function* () {\n        const urls = yield config2.store.getRenderURLs();\n        const currentPanelName = yield config2.store.getCurrentPanelName();\n        yield this.rerender(this.defaults.urls(urls), this.defaults.panelName(currentPanelName));\n      }))();\n      initCorsModalSystem();\n      initCorsMessageSystem();\n      handlePosition();\n      this.setFontSize(config2.render.fontsize);\n    }\n    rerender(urls, currentPanelName) {\n      return __awaiter$1(this, void 0, void 0, function* () {\n        this.initHeader(urls, currentPanelName);\n        yield this.renderBody(currentPanelName);\n      });\n    }\n    initHeader(urls, currentPanelName) {\n      const profile = utils_1.$ui.tooltip((0, utils_1.h)(\"div\", { className: \"profile\", title: \"菜单栏（可拖动区域）\" }, this.config.render.title || \"无标题\"));\n      const scriptDropdowns = [];\n      for (const project2 of this.projects) {\n        const dropdown2 = (0, utils_1.h)(\"dropdown-element\");\n        let selected = false;\n        const options = [];\n        const scripts = utils_1.$.getMatchedScripts([project2], urls).filter((s) => !s.hideInPanel);\n        if (scripts.length) {\n          for (const key in project2.scripts) {\n            if (Object.prototype.hasOwnProperty.call(project2.scripts, key)) {\n              const script2 = project2.scripts[key];\n              if (!script2.hideInPanel) {\n                const optionSelected = isCurrentPanel(project2.name, script2, currentPanelName);\n                const option = (0, utils_1.h)(\"div\", { className: \"dropdown-option\" }, script2.name);\n                if (optionSelected) {\n                  option.classList.add(\"active\");\n                }\n                if (selected !== true && optionSelected) {\n                  selected = true;\n                }\n                option.onclick = () => __awaiter$1(this, void 0, void 0, function* () {\n                  yield this.config.store.setCurrentPanelName(project2.name + \"-\" + script2.name);\n                });\n                options.push(option);\n              }\n            }\n          }\n          if (selected) {\n            dropdown2.classList.add(\"active\");\n          }\n          dropdown2.triggerElement = (0, utils_1.h)(\"div\", { className: \"dropdown-trigger-element\" }, project2.name);\n          dropdown2.triggerElement.style.padding = \"0px 8px\";\n          dropdown2.content.append(...options);\n          scriptDropdowns.push(dropdown2);\n        }\n      }\n      const isMinimize = () => this.config.store.getVisual() === \"minimize\";\n      const visualSwitcher = utils_1.$ui.tooltip((0, utils_1.h)(\"div\", {\n        className: \"switch \",\n        title: isMinimize() ? \"点击展开窗口\" : \"点击最小化窗口\",\n        innerHTML: isMinimize() ? expandSvg : minimizeSvg,\n        onclick: () => {\n          this.setVisual(isMinimize() ? \"normal\" : \"minimize\");\n          visualSwitcher.title = isMinimize() ? \"点击展开窗口\" : \"点击最小化窗口\";\n          visualSwitcher.innerHTML = isMinimize() ? expandSvg : minimizeSvg;\n        }\n      }));\n      this.container.header.visualSwitcher = visualSwitcher;\n      this.container.header.replaceChildren();\n      this.container.header.append((0, utils_1.h)(\"div\", { style: { width: \"100%\" } }, [\n        (0, utils_1.h)(\"div\", { style: { display: \"flex\", width: \"100%\" } }, [\n          profile,\n          ...scriptDropdowns,\n          this.container.header.visualSwitcher || \"\"\n        ]),\n        (0, utils_1.h)(\"div\", { style: { display: \"flex\", width: \"100%\" } }, [this.extraMenuBar])\n      ]));\n    }\n    renderBody(currentPanelName) {\n      var _a;\n      return __awaiter$1(this, void 0, void 0, function* () {\n        for (const project2 of this.projects) {\n          for (const key in project2.scripts) {\n            if (Object.prototype.hasOwnProperty.call(project2.scripts, key)) {\n              const script2 = project2.scripts[key];\n              if (isCurrentPanel(project2.name, script2, currentPanelName)) {\n                const panel = utils_1.$ui.scriptPanel(script2, this.inputStoreProvider);\n                script2.projectName = project2.name;\n                script2.panel = panel;\n                script2.header = this.container.header;\n                this.container.body.replaceChildren(panel);\n                (_a = script2.onrender) === null || _a === void 0 ? void 0 : _a.call(script2, { panel, header: this.container.header });\n                script2.emit(\"render\", { panel, header: this.container.header });\n              }\n            }\n          }\n        }\n      });\n    }\n    setFontSize(fontsize) {\n      this.container.style.font = `${fontsize}px  Menlo, Monaco, Consolas, 'Courier New', monospace`;\n    }\n    setVisual(value) {\n      this.container.className = \"\";\n      if (value === \"minimize\") {\n        this.container.classList.add(\"minimize\");\n      } else if (value === \"hidden\") {\n        this.container.classList.add(\"hidden\");\n      } else {\n        this.container.classList.add(\"normal\");\n      }\n      this.config.store.setVisual(value);\n    }\n    changeRenderURLs(urls) {\n      return __awaiter$1(this, void 0, void 0, function* () {\n        const currentPanelName = yield this.config.store.getCurrentPanelName();\n        yield this.rerender(this.defaults.urls(urls), this.defaults.panelName(currentPanelName));\n      });\n    }\n    changePanel(currentPanelName) {\n      return __awaiter$1(this, void 0, void 0, function* () {\n        const urls = (yield this.config.store.getRenderURLs()) || [location.href];\n        yield this.rerender(this.defaults.urls(urls), this.defaults.panelName(currentPanelName));\n      });\n    }\n    pin(script2) {\n      return __awaiter$1(this, void 0, void 0, function* () {\n        if (script2.projectName) {\n          yield this.config.store.setCurrentPanelName(`${script2.projectName}-${script2.name}`);\n        } else if (script2.namespace) {\n          yield this.config.store.setCurrentPanelName(script2.namespace);\n        } else {\n          console.warn(\"[ERROR]\", `${script2.name} 无法置顶， projectName 与 namespace 都为 undefined`);\n        }\n      });\n    }\n    minimize() {\n      this.setVisual(\"minimize\");\n    }\n    normal() {\n      this.setVisual(\"normal\");\n    }\n    hidden() {\n      this.setVisual(\"hidden\");\n    }\n    message(type, attrs) {\n      if (typeof attrs === \"string\") {\n        attrs = { content: attrs };\n      }\n      const message2 = (0, utils_1.h)(\"message-element\", Object.assign({ type }, attrs));\n      this.messageContainer.append(message2);\n      return message2;\n    }\n    menu(label, config2) {\n      return __awaiter$1(this, void 0, void 0, function* () {\n        this.extraMenuBar.style.display = \"flex\";\n        const btn = (0, utils_1.h)(\"button\", label);\n        btn.addEventListener(\"click\", () => {\n          if (config2.scriptPanelLink) {\n            this.pin(config2.scriptPanelLink).then(() => {\n              this.normal();\n            }).catch(console.error);\n          }\n        });\n        if (config2.scriptPanelLink) {\n          const full_name = (config2.scriptPanelLink.projectName ? config2.scriptPanelLink.projectName + \" -> \" : \"\") + config2.scriptPanelLink.name;\n          btn.title = \"快捷跳转：\" + full_name;\n          btn.setAttribute(\"data-name\", (config2.scriptPanelLink.projectName + \"-\" + config2.scriptPanelLink.name).replace(/\\s/g, \"_\"));\n          btn.classList.add(\"script-panel-link\");\n        }\n        this.extraMenuBar.append(utils_1.$ui.tooltip(btn));\n        const name = yield utils_1.$store.getTab(utils_1.$const.TAB_CURRENT_PANEL_NAME);\n        if (config2.scriptPanelLink) {\n          if (isCurrentPanel(config2.scriptPanelLink.projectName, config2.scriptPanelLink, name)) {\n            this.extraMenuBar.querySelectorAll(\".script-panel-link\").forEach((el) => el.classList.remove(\"active\"));\n            btn.classList.add(\"active\");\n          }\n        }\n        return btn;\n      });\n    }\n    mount(parent) {\n      parent.children[utils_1.$.random(0, parent.children.length - 1)].after(this.wrapper);\n    }\n  }\n  customWindow.CustomWindow = CustomWindow;\n  function isCurrentPanel(projectName, script2, currentPanelName) {\n    return projectName + \"-\" + script2.name === currentPanelName || script2.namespace === currentPanelName;\n  }\n  function handleLowLevelBrowser() {\n    if (typeof Element.prototype.replaceChildren === \"undefined\") {\n      Element.prototype.replaceChildren = function(...nodes) {\n        this.innerHTML = \"\";\n        for (const node of nodes) {\n          this.append(node);\n        }\n      };\n    }\n  }\n  function modal(type, attrs, parent = (start_1.$win === null || start_1.$win === void 0 ? void 0 : start_1.$win.container) || utils_1.$elements.root || document.body) {\n    const { maskCloseable = true, onConfirm, onCancel, onClose, notification: notify, notificationOptions, duration } = attrs, _attrs = __rest(attrs, [\"maskCloseable\", \"onConfirm\", \"onCancel\", \"onClose\", \"notification\", \"notificationOptions\", \"duration\"]);\n    if (notify) {\n      utils_1.$gm.notification(typeof _attrs.content === \"string\" ? _attrs.content : _attrs.content.textContent || \"\", notificationOptions);\n    }\n    const wrapper = (0, utils_1.h)(\"div\", { className: \"modal-wrapper\" }, (wrapper2) => {\n      const modal2 = (0, utils_1.h)(\"modal-element\", Object.assign({\n        onConfirm(val) {\n          return __awaiter$1(this, void 0, void 0, function* () {\n            const isClose = yield onConfirm === null || onConfirm === void 0 ? void 0 : onConfirm.apply(modal2, [val]);\n            if (isClose !== false) {\n              wrapper2.remove();\n            }\n            return isClose;\n          });\n        },\n        onCancel() {\n          onCancel === null || onCancel === void 0 ? void 0 : onCancel.apply(modal2);\n          wrapper2.remove();\n        },\n        onClose(val) {\n          onClose === null || onClose === void 0 ? void 0 : onClose.apply(modal2, [val]);\n          wrapper2.remove();\n        },\n        type\n      }, _attrs));\n      wrapper2.append(modal2);\n      modal2.addEventListener(\"click\", (e) => {\n        e.stopPropagation();\n      });\n      if (maskCloseable) {\n        wrapper2.addEventListener(\"click\", () => {\n          onClose === null || onClose === void 0 ? void 0 : onClose.apply(modal2);\n          wrapper2.remove();\n        });\n      }\n    });\n    if (duration) {\n      setTimeout(() => {\n        wrapper.remove();\n      }, duration * 1e3);\n    }\n    parent.append(wrapper);\n    return wrapper;\n  }\n  customWindow.modal = modal;\n  var __awaiter = commonjsGlobal && commonjsGlobal.__awaiter || function(thisArg, _arguments, P, generator) {\n    function adopt(value) {\n      return value instanceof P ? value : new P(function(resolve) {\n        resolve(value);\n      });\n    }\n    return new (P || (P = Promise))(function(resolve, reject) {\n      function fulfilled(value) {\n        try {\n          step(generator.next(value));\n        } catch (e) {\n          reject(e);\n        }\n      }\n      function rejected(value) {\n        try {\n          step(generator[\"throw\"](value));\n        } catch (e) {\n          reject(e);\n        }\n      }\n      function step(result) {\n        result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n      }\n      step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n  };\n  var __importDefault = commonjsGlobal && commonjsGlobal.__importDefault || function(mod) {\n    return mod && mod.__esModule ? mod : { \"default\": mod };\n  };\n  Object.defineProperty(start$1, \"__esModule\", { value: true });\n  start$1.addFunctionEventListener = start$1.start = start$1.$win = void 0;\n  const custom_window_1 = customWindow;\n  const common_1 = common;\n  const const_1 = _const;\n  const dom_1 = dom;\n  const elements_1 = elements$1;\n  const store_1 = store;\n  const debounce_1 = __importDefault(debounce_1$1);\n  let mounted = false;\n  function start(startConfig) {\n    return __awaiter(this, void 0, void 0, function* () {\n      startConfig.projects = startConfig.projects.map((p) => {\n        for (const key in p.scripts) {\n          if (Object.prototype.hasOwnProperty.call(p.scripts, key)) {\n            p.scripts[key].cfg = common_1.$.createConfigProxy(p.scripts[key]);\n          }\n        }\n        return p;\n      });\n      const scripts = common_1.$.getMatchedScripts(startConfig.projects, [location.href]).sort((a, b) => b.priority - a.priority);\n      scripts.forEach((script2) => {\n        var _a;\n        script2.startConfig = startConfig;\n        script2.emit(\"start\", startConfig);\n        (_a = script2.onstart) === null || _a === void 0 ? void 0 : _a.call(script2, startConfig);\n      });\n      const uid = yield store_1.$store.getTab(const_1.$const.TAB_UID);\n      if (uid === void 0) {\n        yield store_1.$store.setTab(const_1.$const.TAB_UID, common_1.$.uuid());\n      }\n      const urls = yield store_1.$store.getTab(const_1.$const.TAB_URLS);\n      yield store_1.$store.setTab(const_1.$const.TAB_URLS, Array.from(new Set((urls || []).concat(location.href))));\n      let active = false;\n      if (document.readyState === \"interactive\") {\n        active = true;\n        mount(startConfig);\n        scripts.forEach((script2) => {\n          var _a;\n          return (_a = script2.onactive) === null || _a === void 0 ? void 0 : _a.call(script2, startConfig);\n        });\n      } else if (document.readyState === \"complete\") {\n        mount(startConfig);\n        scripts.forEach((script2) => {\n          var _a;\n          return (_a = script2.onactive) === null || _a === void 0 ? void 0 : _a.call(script2, startConfig);\n        });\n        scripts.forEach((script2) => {\n          var _a;\n          return (_a = script2.oncomplete) === null || _a === void 0 ? void 0 : _a.call(script2, startConfig);\n        });\n      }\n      document.addEventListener(\"readystatechange\", () => {\n        mount(startConfig);\n        if (document.readyState === \"interactive\" && active === false) {\n          scripts.forEach((script2) => {\n            var _a;\n            script2.emit(\"active\", startConfig);\n            (_a = script2.onactive) === null || _a === void 0 ? void 0 : _a.call(script2, startConfig);\n          });\n        }\n        if (document.readyState === \"complete\") {\n          scripts.forEach((script2) => {\n            var _a;\n            script2.emit(\"complete\");\n            (_a = script2.oncomplete) === null || _a === void 0 ? void 0 : _a.call(script2, startConfig);\n          });\n        }\n      });\n      window.addEventListener(\"hashchange\", () => {\n        scripts.forEach((script2) => {\n          var _a;\n          script2.emit(\"hashchange\", startConfig);\n          (_a = script2.onhashchange) === null || _a === void 0 ? void 0 : _a.call(script2, startConfig);\n        });\n      });\n      history.pushState = addFunctionEventListener(history, \"pushState\");\n      history.replaceState = addFunctionEventListener(history, \"replaceState\");\n      window.addEventListener(\"pushState\", () => {\n        scripts.forEach((script2) => {\n          var _a;\n          script2.emit(\"historychange\", \"push\", startConfig);\n          (_a = script2.onhistorychange) === null || _a === void 0 ? void 0 : _a.call(script2, \"push\", startConfig);\n        });\n      });\n      window.addEventListener(\"replaceState\", () => {\n        scripts.forEach((script2) => {\n          var _a;\n          script2.emit(\"historychange\", \"replace\", startConfig);\n          (_a = script2.onhistorychange) === null || _a === void 0 ? void 0 : _a.call(script2, \"replace\", startConfig);\n        });\n      });\n      window.addEventListener(\"beforeunload\", (e) => {\n        var _a;\n        let prevent;\n        for (const script2 of scripts) {\n          script2.emit(\"beforeunload\");\n          if ((_a = script2.onbeforeunload) === null || _a === void 0 ? void 0 : _a.call(script2, startConfig)) {\n            prevent = true;\n          }\n        }\n        if (prevent) {\n          e.preventDefault();\n          e.returnValue = true;\n          return true;\n        }\n      });\n    });\n  }\n  start$1.start = start;\n  function addFunctionEventListener(obj, type) {\n    const origin = obj[type];\n    return function(...args) {\n      const res = origin.apply(this, args);\n      const e = new Event(type.toString());\n      e.arguments = args;\n      window.dispatchEvent(e);\n      return res;\n    };\n  }\n  start$1.addFunctionEventListener = addFunctionEventListener;\n  function mount(startConfig) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (mounted === true) {\n        return;\n      }\n      mounted = true;\n      if (startConfig === void 0 || startConfig.renderConfig === void 0) {\n        console.warn(\"the script will not have ui because the renderConfig is not defined.\");\n        return;\n      }\n      if (self === top) {\n        const { projects, renderConfig } = startConfig;\n        if (typeof renderConfig.renderScript === \"undefined\") {\n          console.warn(\"the script will not have ui because the RenderScript is not defined.\");\n          return;\n        }\n        const scripts = common_1.$.getMatchedScripts(projects, [location.href]).filter((s) => !!s.hideInPanel === false);\n        if (scripts.length <= 0) {\n          return;\n        }\n        const RenderScript2 = renderConfig.renderScript;\n        const win = new custom_window_1.CustomWindow(startConfig.projects, store_1.$store, {\n          render: {\n            title: renderConfig.title,\n            styles: renderConfig.styles,\n            defaultPanelName: renderConfig.defaultPanelName,\n            fontsize: RenderScript2.cfg.fontsize,\n            switchPoint: RenderScript2.cfg.switchPoint,\n            switchKey: \"o\"\n          },\n          store: {\n            getPosition: () => {\n              return { x: RenderScript2.cfg.x, y: RenderScript2.cfg.y };\n            },\n            setPosition: (x, y) => {\n              RenderScript2.cfg.x = x;\n              RenderScript2.cfg.y = y;\n            },\n            getVisual: () => {\n              return RenderScript2.cfg.visual;\n            },\n            setVisual: (size) => {\n              RenderScript2.cfg.visual = size;\n            },\n            getRenderURLs() {\n              return __awaiter(this, void 0, void 0, function* () {\n                return yield store_1.$store.getTab(const_1.$const.TAB_URLS);\n              });\n            },\n            setRenderURLs(urls) {\n              return __awaiter(this, void 0, void 0, function* () {\n                return yield store_1.$store.setTab(const_1.$const.TAB_URLS, urls);\n              });\n            },\n            getCurrentPanelName() {\n              return __awaiter(this, void 0, void 0, function* () {\n                return yield store_1.$store.getTab(const_1.$const.TAB_CURRENT_PANEL_NAME);\n              });\n            },\n            setCurrentPanelName(name) {\n              return __awaiter(this, void 0, void 0, function* () {\n                return yield store_1.$store.setTab(const_1.$const.TAB_CURRENT_PANEL_NAME, name);\n              });\n            }\n          }\n        });\n        RenderScript2.onConfigChange(\"fontsize\", (fs) => {\n          win.setFontSize(fs);\n        });\n        store_1.$store.addTabChangeListener(const_1.$const.TAB_URLS, (0, debounce_1.default)((curr, pre) => {\n          if (JSON.stringify(curr) === JSON.stringify(pre)) {\n            return;\n          }\n          win.changeRenderURLs(curr);\n        }, 2e3));\n        store_1.$store.addTabChangeListener(const_1.$const.TAB_CURRENT_PANEL_NAME, (curr, pre) => {\n          if (curr === pre) {\n            return;\n          }\n          win.changePanel(curr);\n          updateMenusState(win, curr);\n        });\n        win.mount(document.body);\n        elements_1.$elements.tooltipContainer = (0, dom_1.h)(\"div\", { className: \"tooltip-container\" });\n        elements_1.$elements.root = win.root;\n        win.container.append(elements_1.$elements.tooltipContainer);\n        start$1.$win = win;\n      }\n    });\n  }\n  function updateMenusState(win, name) {\n    var _a;\n    win.root.querySelectorAll(\".extra-menu-bar .script-panel-link\").forEach((el) => el.classList.remove(\"active\"));\n    (_a = win.root.querySelector('.extra-menu-bar [data-name=\"' + name.replace(/\\s/g, \"_\") + '\"]')) === null || _a === void 0 ? void 0 : _a.classList.add(\"active\");\n  }\n  var render = {};\n  (function(exports3) {\n    Object.defineProperty(exports3, \"__esModule\", { value: true });\n    exports3.$menu = exports3.$message = exports3.$modal = exports3.createRenderScript = void 0;\n    const script_1 = script;\n    const ui_12 = ui;\n    const dom_12 = dom;\n    const custom_window_12 = customWindow;\n    const start_12 = start$1;\n    const interfaces_1 = interfaces;\n    const createRenderScript = (config2) => new script_1.Script({\n      name: (config2 === null || config2 === void 0 ? void 0 : config2.name) || \"窗口设置\",\n      matches: (config2 === null || config2 === void 0 ? void 0 : config2.matches) || [[\"所有\", /.*/]],\n      namespace: \"render.panel\",\n      configs: {\n        notes: {\n          defaultValue: ui_12.$ui.notes([\n            [\n              \"如果需要隐藏整个窗口，可以点击下方隐藏按钮，\",\n              \"隐藏后可以快速三击屏幕中的任意地方\",\n              \"来重新在鼠标位置显示窗口。\"\n            ],\n            \"窗口连续点击显示的次数可以自定义，默认为三次\",\n            [\"窗口快捷键列表：\", \"ctrl + o : 隐藏/打开 面板\"]\n          ]).outerHTML\n        },\n        x: { defaultValue: window.innerWidth * 0.1 },\n        y: { defaultValue: window.innerWidth * 0.1 },\n        visual: { defaultValue: \"normal\" },\n        firstCloseAlert: {\n          defaultValue: true\n        },\n        fontsize: {\n          label: \"字体大小（像素）\",\n          attrs: { type: \"number\", min: 12, max: 24, step: 1 },\n          defaultValue: 14\n        },\n        switchPoint: {\n          label: \"窗口显示连点（次数）\",\n          attrs: {\n            type: \"number\",\n            min: 3,\n            max: 10,\n            step: 1,\n            title: \"设置当连续点击屏幕 N 次时，可以进行面板的 隐藏/显示 切换，默认连续点击屏幕三下\"\n          },\n          defaultValue: 3\n        }\n      },\n      methods() {\n        return {\n          pin: (script2) => start_12.$win === null || start_12.$win === void 0 ? void 0 : start_12.$win.pin(script2),\n          minimize: () => start_12.$win === null || start_12.$win === void 0 ? void 0 : start_12.$win.minimize(),\n          setPosition: (x, y) => {\n            if (start_12.$win) {\n              start_12.$win.config.store.setPosition(x, y);\n              start_12.$win.container.style.left = x + \"px\";\n              start_12.$win.container.style.top = y + \"px\";\n            }\n          },\n          normal: () => {\n            start_12.$win === null || start_12.$win === void 0 ? void 0 : start_12.$win.normal();\n          }\n        };\n      },\n      onrender({ panel }) {\n        const closeBtn = (0, dom_12.h)(\"button\", { className: \"base-style-button\" }, \"隐藏窗口\");\n        closeBtn.onclick = () => {\n          if (this.cfg.firstCloseAlert) {\n            exports3.$modal.confirm({\n              content: ui_12.$ui.notes([\n                \"隐藏脚本页面后，快速点击页面三下（可以在悬浮窗设置中调整次数）即可重新显示脚本。如果三下无效，可以尝试删除脚本重新安装。\",\n                \"请确认是否关闭。（此后不再显示此弹窗）\"\n              ]),\n              onConfirm: () => {\n                start_12.$win === null || start_12.$win === void 0 ? void 0 : start_12.$win.hidden();\n                this.cfg.firstCloseAlert = false;\n              }\n            });\n          } else {\n            start_12.$win === null || start_12.$win === void 0 ? void 0 : start_12.$win.hidden();\n          }\n        };\n        panel.body.replaceChildren((0, dom_12.h)(\"hr\"), closeBtn);\n      }\n    });\n    exports3.createRenderScript = createRenderScript;\n    function _modal(type, attrs, parent) {\n      if (self === top) {\n        return (0, custom_window_12.modal)(type, attrs, parent);\n      } else {\n        interfaces_1.cors.emit(\"modal\", [type, attrs], (args) => {\n          var _a, _b, _c;\n          if (args) {\n            (_a = attrs.onConfirm) === null || _a === void 0 ? void 0 : _a.call(attrs, args);\n          } else {\n            (_b = attrs.onCancel) === null || _b === void 0 ? void 0 : _b.call(attrs);\n          }\n          (_c = attrs.onClose) === null || _c === void 0 ? void 0 : _c.call(attrs, args);\n        });\n      }\n    }\n    exports3.$modal = {\n      confirm: (attrs, parent) => _modal(\"confirm\", attrs, parent),\n      alert: (attrs, parent) => _modal(\"alert\", attrs, parent),\n      prompt: (attrs, parent) => _modal(\"prompt\", attrs, parent),\n      simple: (attrs, parent) => _modal(\"simple\", attrs, parent)\n    };\n    function _message(type, attrs) {\n      if (self === top) {\n        return start_12.$win === null || start_12.$win === void 0 ? void 0 : start_12.$win.message(type, attrs);\n      } else {\n        if (typeof attrs === \"string\") {\n          attrs = { content: attrs };\n        } else if (typeof attrs.content !== \"string\") {\n          attrs.content = attrs.content.innerHTML;\n        }\n        interfaces_1.cors.emit(\"message\", [type, attrs]);\n      }\n    }\n    exports3.$message = {\n      info: (attrs) => _message(\"info\", attrs),\n      success: (attrs) => _message(\"success\", attrs),\n      warn: (attrs) => _message(\"warn\", attrs),\n      error: (attrs) => _message(\"error\", attrs)\n    };\n    function $menu(label, config2) {\n      if (self !== top) {\n        return;\n      }\n      return start_12.$win === null || start_12.$win === void 0 ? void 0 : start_12.$win.menu(label, config2);\n    }\n    exports3.$menu = $menu;\n  })(render);\n  (function(exports3) {\n    var __createBinding = commonjsGlobal && commonjsGlobal.__createBinding || (Object.create ? function(o, m, k, k2) {\n      if (k2 === void 0)\n        k2 = k;\n      var desc = Object.getOwnPropertyDescriptor(m, k);\n      if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n        desc = { enumerable: true, get: function() {\n          return m[k];\n        } };\n      }\n      Object.defineProperty(o, k2, desc);\n    } : function(o, m, k, k2) {\n      if (k2 === void 0)\n        k2 = k;\n      o[k2] = m[k];\n    });\n    var __exportStar = commonjsGlobal && commonjsGlobal.__exportStar || function(m, exports4) {\n      for (var p in m)\n        if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports4, p))\n          __createBinding(exports4, m, p);\n    };\n    Object.defineProperty(exports3, \"__esModule\", { value: true });\n    exports3.start = void 0;\n    var start_12 = start$1;\n    Object.defineProperty(exports3, \"start\", { enumerable: true, get: function() {\n      return start_12.start;\n    } });\n    __exportStar(utils, exports3);\n    __exportStar(render, exports3);\n    __exportStar(elements, exports3);\n    __exportStar(interfaces, exports3);\n  })(lib);\n  const ListOfActions = [\n    \"click\",\n    \"check\",\n    \"dblclick\",\n    \"bringToFront\",\n    \"dragAndDrop\",\n    \"fill\",\n    \"focus\",\n    \"hover\",\n    \"screenshot\",\n    \"selectOption\",\n    \"setInputFiles\",\n    \"tap\",\n    \"press\",\n    \"reload\",\n    \"waitForRequest\",\n    \"waitForResponse\",\n    \"waitForSelector\",\n    \"keyboard.type\",\n    \"keyboard.press\",\n    \"mouse.wheel\",\n    \"mouse.click\",\n    \"mouse.dblclick\",\n    \"mouse.down\",\n    \"mouse.up\",\n    \"mouse.move\"\n  ];\n  const mouseIdleRequireActions = [\n    \"click\",\n    \"dblclick\",\n    \"dragAndDrop\",\n    \"fill\",\n    \"hover\",\n    \"tap\",\n    \"press\",\n    \"keyboard.type\",\n    \"keyboard.press\",\n    \"mouse.wheel\",\n    \"mouse.click\",\n    \"mouse.dblclick\",\n    \"mouse.down\",\n    \"mouse.up\",\n    \"mouse.move\"\n  ];\n  class RemotePlaywright {\n    static async getRemotePage(show_debug_cursor, logger) {\n      if (this.currentPage) {\n        return this.currentPage;\n      }\n      if (!this.authToken) {\n        try {\n          this.authToken = await request(\"http://localhost:15319/get-actions-key\", {\n            type: \"GM_xmlhttpRequest\",\n            method: \"get\",\n            responseType: \"text\"\n          });\n          this.currentPage = this.createRemotePage(this.authToken, { show_debug_cursor, logger });\n          return this.currentPage;\n        } catch (e) {\n          console.log(e);\n          return void 0;\n        }\n      } else {\n        this.currentPage = this.createRemotePage(this.authToken, { show_debug_cursor, logger });\n        return this.currentPage;\n      }\n    }\n    static createRemotePage(authToken, configs) {\n      const page = /* @__PURE__ */ Object.create({});\n      configs = configs || {};\n      configs.logger = configs.logger || console.debug;\n      for (const property of ListOfActions) {\n        Reflect.set(page, property, async (...args) => {\n          var _a, _b, _c;\n          let data;\n          if (mouseIdleRequireActions.includes(property)) {\n            await waitForMouseIdle();\n          }\n          if (property === \"click\") {\n            if (args[0] instanceof Element) {\n              const el = args[0];\n              const options = args[1] || {};\n              await scrollToElement(el);\n              await $.sleep(500);\n              const rect = el.getBoundingClientRect();\n              const elFromPoint = (_a = lib.$elements.root) == null ? void 0 : _a.elementFromPoint(\n                rect.left + rect.width / 2,\n                rect.top + rect.height / 2\n              );\n              if (elFromPoint && lib.$elements.root && lib.$elements.root.contains(elFromPoint)) {\n                const panel = lib.$elements.root.querySelector(\"container-element\");\n                if (panel) {\n                  lib.$message.info({ content: \"检测到脚本阻挡点击位置，已自动移开\", duration: 2 });\n                  await $.transition(panel, \"left\", 0.1, rect.left + rect.width / 2 + 100 + \"px\", { reset_ms: 1 });\n                }\n              }\n              if (configs == null ? void 0 : configs.show_debug_cursor) {\n                showMousePointer(el);\n              }\n              data = {\n                page: window.location.href,\n                property: \"mouse.click\",\n                args: [\n                  rect.left + rect.width / 2,\n                  rect.top + rect.height / 2,\n                  {\n                    button: options.button,\n                    clickCount: options.clickCount,\n                    delay: options.delay\n                  }\n                ]\n              };\n            } else if (typeof args[0] === \"string\") {\n              const el = document.querySelector(args[0]);\n              if (el) {\n                await scrollToElement(el);\n                if (configs == null ? void 0 : configs.show_debug_cursor) {\n                  showMousePointer(el);\n                }\n              }\n            }\n          }\n          if (!data) {\n            data = { page: window.location.href, property, args };\n          }\n          (_b = configs == null ? void 0 : configs.logger) == null ? void 0 : _b.call(configs, \"[RP]: \", JSON.stringify(data));\n          try {\n            const res = await request(\"/ocs-script-actions\", {\n              type: \"fetch\",\n              method: \"post\",\n              responseType: [\"waitForRequest\", \"waitForResponse\", \"reload\"].includes(property) ? \"json\" : \"text\",\n              headers: {\n                \"auth-token\": authToken\n              },\n              data\n            });\n            return res;\n          } catch (e) {\n            (_c = configs == null ? void 0 : configs.logger) == null ? void 0 : _c.call(configs, \"[RP-ERROR]: \", JSON.stringify(data));\n            return void 0;\n          }\n        });\n      }\n      console.log(page);\n      return page;\n    }\n  }\n  RemotePlaywright.authToken = \"\";\n  RemotePlaywright.currentPage = void 0;\n  function scrollToElement(el) {\n    el.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n    return $.sleep(200);\n  }\n  function showMousePointer(el) {\n    setTimeout(() => {\n      const rect = el.getBoundingClientRect();\n      const div = document.createElement(\"div\");\n      div.textContent = \"\";\n      div.style.position = \"fixed\";\n      div.style.zIndex = \"99999\";\n      div.style.width = \"20px\";\n      div.style.height = \"20px\";\n      div.style.border = \"2px solid red\";\n      div.style.borderRadius = \"50%\";\n      div.style.left = rect.left + rect.width / 2 - 11 + \"px\";\n      div.style.top = rect.top + rect.height / 2 - 11 + \"px\";\n      document.body.append(div);\n      setTimeout(() => {\n        div.remove();\n      }, 500);\n    }, 100);\n  }\n  function waitForMouseIdle(timeout = 200) {\n    return new Promise((resolve) => {\n      let timer;\n      const default_timer = setTimeout(() => {\n        window.removeEventListener(\"mousemove\", onMouseMove);\n        resolve();\n      }, timeout);\n      function onMouseMove() {\n        clearTimeout(default_timer);\n        if (timer) {\n          clearTimeout(timer);\n        }\n        timer = setTimeout(() => {\n          window.removeEventListener(\"mousemove\", onMouseMove);\n          resolve();\n        }, timeout);\n      }\n      window.addEventListener(\"mousemove\", onMouseMove);\n    });\n  }\n  function defaultWorkTypeResolver(ctx) {\n    function count(selector) {\n      let c = 0;\n      for (const option of ctx.elements.options || []) {\n        if ((option == null ? void 0 : option.querySelector(selector)) !== null) {\n          c++;\n        }\n      }\n      return c;\n    }\n    return count('[type=\"radio\"]') === 2 ? \"judgement\" : count('[type=\"radio\"]') > 2 ? \"single\" : count('[type=\"checkbox\"]') > 2 ? \"multiple\" : count(\"textarea\") >= 1 ? \"completion\" : void 0;\n  }\n  function isPlainAnswer(answer) {\n    answer = answer.trim();\n    if (answer.length > 8 || !/[A-Z]/.test(answer)) {\n      return false;\n    }\n    const counter = {};\n    let min = 0;\n    for (let i = 0; i < answer.length; i++) {\n      if (answer.charCodeAt(i) < min) {\n        return false;\n      }\n      min = answer.charCodeAt(i);\n      counter[min] = (counter[min] || 0) + 1;\n    }\n    for (const key in counter) {\n      if (counter[key] !== 1) {\n        return false;\n      }\n    }\n    return true;\n  }\n  function resolvePlainAnswer(answer) {\n    const resolve = answer.trim().replace(/[,，、 #]/g, \"\").trim();\n    if (isPlainAnswer(resolve)) {\n      return resolve;\n    }\n  }\n  function splitAnswer(answer, separators = [\"===\", \"#\", \"---\", \"###\", \"|\", \";\", \"；\"]) {\n    answer = answer.trim();\n    if (answer.length === 0) {\n      return [];\n    }\n    separators = separators.length === 0 ? [\"===\", \"#\", \"---\", \"###\", \"|\", \";\", \"；\"] : separators;\n    separators = separators.filter((el) => el.trim().length > 0);\n    try {\n      const json = JSON.parse(answer);\n      if (Array.isArray(json)) {\n        return json.map(String).filter((el) => el.trim().length > 0);\n      }\n    } catch {\n      for (const sep of separators) {\n        if (answer.split(sep).length > 1) {\n          return answer.split(sep).filter((el) => el.trim().length > 0);\n        }\n      }\n    }\n    return [answer];\n  }\n  function createDefaultQuestionResolver(ctx) {\n    return {\n      async single(infos, options, handler) {\n        const allAnswer = infos.map((res) => res.results.map((res2) => splitAnswer(res2.answer, ctx.answerSeparators)).flat()).flat();\n        const optionStrings = options.map((o) => removeRedundant(o.innerText));\n        let ratings = [];\n        if (ctx.answerMatchMode === \"similar\") {\n          ratings = answerSimilar(allAnswer, optionStrings);\n          let index = -1;\n          let max = 0;\n          let ans = \"\";\n          ratings.forEach((rating, i) => {\n            if (rating.rating > max) {\n              max = rating.rating;\n              index = i;\n              ans = rating.target;\n            }\n          });\n          if (index !== -1 && max > 0.6) {\n            await handler(\"single\", ans, options[index], ctx);\n            return {\n              finish: true,\n              ratings: ratings.map((r) => r.rating)\n            };\n          }\n        } else if (ctx.answerMatchMode === \"exact\") {\n          const result = answerExactMatch(allAnswer, optionStrings);\n          const index = optionStrings.findIndex((option) => result.includes(option));\n          if (result.length) {\n            await handler(\"single\", options[index].innerText, options[index], ctx);\n            return {\n              finish: true\n            };\n          }\n        }\n        for (const info of infos) {\n          for (const res of info.results) {\n            const ans = StringUtils.nowrap(res.answer, \"\").trim();\n            if (ans.length === 1 && /[A-Z]/.test(ans)) {\n              const index = ans.charCodeAt(0) - 65;\n              if (options[index] === void 0) {\n                continue;\n              }\n              await handler(\"single\", options[index].innerText, options[index], ctx);\n              return { finish: true, option: options[index] };\n            }\n          }\n        }\n        return { finish: false, allAnswer, ratings: ratings.map((r) => r.rating), options: optionStrings };\n      },\n      async multiple(infos, options, handler) {\n        var _a;\n        const targetAnswers = [];\n        const targetOptions = [];\n        const similar_list = [];\n        const exact_list = [];\n        const results = infos.map((info) => info.results).flat();\n        for (let i = 0; i < results.length; i++) {\n          const result = results[i];\n          const answers = splitAnswer(result.answer.trim(), ctx.answerSeparators);\n          if (ctx.answerMatchMode === \"similar\") {\n            const matchResult = { options: [], answers: [], ratings: [], similarSum: 0, similarCount: 0 };\n            for (const option of options) {\n              const ans = answers.find(\n                (answer) => answer.includes(removeRedundant(option.textContent || option.innerText))\n              );\n              if (ans) {\n                matchResult.options.push(option);\n                matchResult.answers.push(ans);\n                matchResult.ratings.push(1);\n                matchResult.similarSum += 1;\n                matchResult.similarCount += 1;\n              }\n            }\n            const ratingResult = { options: [], answers: [], ratings: [], similarSum: 0, similarCount: 0 };\n            const ratings = answerSimilar(\n              answers,\n              options.map((o) => removeRedundant(o.innerText))\n            );\n            for (let j = 0; j < ratings.length; j++) {\n              const rating = ratings[j];\n              if (rating.rating > 0.6) {\n                ratingResult.options.push(options[j]);\n                ratingResult.answers.push(ratings[j].target);\n                ratingResult.ratings.push(ratings[j].rating);\n                ratingResult.similarSum += rating.rating;\n                ratingResult.similarCount += 1;\n              }\n            }\n            if (matchResult.similarSum > ratingResult.similarSum) {\n              similar_list[i] = matchResult;\n            } else {\n              similar_list[i] = ratingResult;\n            }\n          } else if (ctx.answerMatchMode === \"exact\") {\n            exact_list[i] = answerExactMatch(\n              answers,\n              options.map((o) => removeRedundant(o.innerText))\n            ).map((option) => options.find((o) => removeRedundant(o.innerText) === option)).filter(Boolean);\n          }\n        }\n        if (ctx.answerMatchMode === \"similar\") {\n          const sorted_similar_list = similar_list.filter((i) => i.similarCount !== 0).sort((a, b) => {\n            const bsc = b.similarCount * 100;\n            const asc = a.similarCount * 100;\n            const bss = b.similarSum;\n            const ass = a.similarSum;\n            return bsc + bss - asc + ass;\n          });\n          if (sorted_similar_list[0]) {\n            for (let i = 0; i < sorted_similar_list[0].options.length; i++) {\n              await handler(\"multiple\", sorted_similar_list[0].answers[i], sorted_similar_list[0].options[i], ctx);\n            }\n            return { finish: true, sorted_similar_list, targetOptions, targetAnswers };\n          }\n        } else if (ctx.answerMatchMode === \"exact\") {\n          const sorted_exact_list = exact_list.sort((a, b) => b.length - a.length);\n          if ((_a = sorted_exact_list[0]) == null ? void 0 : _a.length) {\n            for (let i = 0; i < sorted_exact_list[0].length; i++) {\n              await handler(\"multiple\", sorted_exact_list[0][i].innerText, sorted_exact_list[0][i], ctx);\n            }\n            return {\n              finish: true,\n              sorted_exact_list: sorted_exact_list.map((i) => i.map((e) => e.innerText)),\n              targetOptions,\n              targetAnswers\n            };\n          }\n        }\n        const plainOptions = [];\n        for (const result of results) {\n          const ans = StringUtils.nowrap(result.answer, \"\").trim();\n          const plainAnswer = resolvePlainAnswer(ans);\n          if (plainAnswer) {\n            for (const char of ans) {\n              const index = char.charCodeAt(0) - 65;\n              if (options[index] === void 0) {\n                continue;\n              }\n              await handler(\"multiple\", options[index].innerText, options[index], ctx);\n              plainOptions.push(options[index]);\n            }\n          }\n        }\n        if (plainOptions.length) {\n          return { finish: true, plainOptions };\n        } else {\n          return { finish: false };\n        }\n      },\n      async judgement(infos, options, handler) {\n        for (const answers of infos.map((info) => info.results.map((res) => res.answer))) {\n          let matches = function(target, options2) {\n            return options2.some(\n              (option) => clearString(removeRedundant(option), \"√\", \"×\") === clearString(removeRedundant(target), \"√\", \"×\")\n            );\n          };\n          const correctWords = [\n            \"是\",\n            \"对\",\n            \"正确\",\n            \"确定\",\n            \"√\",\n            \"对的\",\n            \"是的\",\n            \"正确的\",\n            \"true\",\n            \"True\",\n            \"T\",\n            \"yes\",\n            \"1\"\n          ];\n          const incorrectWords = [\n            \"非\",\n            \"否\",\n            \"错\",\n            \"错误\",\n            \"×\",\n            \"X\",\n            \"错的\",\n            \"不对\",\n            \"不正确的\",\n            \"不正确\",\n            \"不是\",\n            \"不是的\",\n            \"false\",\n            \"False\",\n            \"F\",\n            \"no\",\n            \"0\"\n          ];\n          const answerShowCorrect = answers.find((answer) => matches(answer, correctWords));\n          const answerShowIncorrect = answers.find((answer) => matches(answer, incorrectWords));\n          if (answerShowCorrect || answerShowIncorrect) {\n            let option;\n            for (const el of options) {\n              const textShowCorrect = matches(el.innerText, correctWords);\n              const textShowIncorrect = matches(el.innerText, incorrectWords);\n              if (answerShowCorrect && textShowCorrect) {\n                option = el;\n                await handler(\"judgement\", answerShowCorrect, el, ctx);\n                break;\n              }\n              if (answerShowIncorrect && textShowIncorrect) {\n                option = el;\n                await handler(\"judgement\", answerShowIncorrect, el, ctx);\n                break;\n              }\n            }\n            return { finish: true, option };\n          }\n        }\n        return { finish: false };\n      },\n      async completion(infos, options, handler) {\n        for (const answers of infos.map((info) => info.results.map((res) => res.answer))) {\n          let ans = answers.filter((ans2) => ans2);\n          if (ans.length === 1) {\n            ans = splitAnswer(ans[0], ctx.answerSeparators);\n          }\n          if (ans.length !== 0 && (ans.length === options.length || options.length === 1)) {\n            if (ans.length === options.length) {\n              for (let index = 0; index < options.length; index++) {\n                const element = options[index];\n                await handler(\"completion\", ans[index], element, ctx);\n              }\n              return { finish: true };\n            } else if (options.length === 1) {\n              await handler(\"completion\", ans.join(\" \"), options[0], ctx);\n              return { finish: true };\n            }\n            return { finish: false };\n          }\n        }\n        return { finish: false };\n      }\n    };\n  }\n  const AnswerWrapperHandlerConfig = {\n    timeout_seconds: 60\n  };\n  async function defaultAnswerWrapperHandler(answererWrappers, env) {\n    const searchInfos = [];\n    const temp = JSON.parse(JSON.stringify(answererWrappers));\n    if (temp.length === 0) {\n      throw new Error(\"题库配置不能为空，请配置后重新开始自动答题。\");\n    }\n    await Promise.all(\n      temp.map(async (wrapper) => {\n        var _a;\n        const {\n          name = \"未知题库\",\n          homepage = \"#\",\n          method = \"get\",\n          type = \"fetch\",\n          contentType = \"json\",\n          headers = {},\n          data: wrapperData = {},\n          handler = \"return (res)=> [JSON.stringify(res), undefined]\"\n        } = wrapper;\n        try {\n          let results = [];\n          let requestData;\n          let url;\n          if (method.toLocaleLowerCase() === \"get\") {\n            url = new URL(resolvePlaceHolder(wrapper.url, { encodeURI: true }));\n            Object.keys(wrapperData).forEach((key) => {\n              url.searchParams.set(key, resolvePlaceHolder(wrapperData[key]));\n            });\n            requestData = {};\n          } else if (method.toLocaleLowerCase() === \"post\") {\n            url = new URL(wrapper.url);\n            const data = /* @__PURE__ */ Object.create({});\n            Object.keys(wrapperData).forEach((key) => {\n              if (typeof wrapperData[key] === \"object\" && Reflect.has(wrapperData[key], \"handler\")) {\n                const handler2 = Function(Reflect.get(wrapperData[key], \"handler\"))();\n                if (typeof handler2 !== \"function\") {\n                  throw new Error(\"data 字段解析器必须返回一个函数\");\n                }\n                const result = handler2(env);\n                Reflect.set(data, key, result);\n              } else {\n                Reflect.set(data, key, resolvePlaceHolder(wrapperData[key]));\n              }\n            });\n            requestData = data;\n          } else {\n            throw new Error(\"不支持的请求方式\");\n          }\n          const responseData = await Promise.race([\n            request(url.toString(), {\n              method,\n              responseType: contentType,\n              data: requestData,\n              type,\n              headers: JSON.parse(JSON.stringify(headers || {}))\n            }),\n            $.sleep(((_a = AnswerWrapperHandlerConfig.timeout_seconds) != null ? _a : 60) * 1e3)\n          ]);\n          if (responseData === void 0) {\n            throw new Error(\"题库请求超时，可能是题库问题，或者请检查网络或者重试。\");\n          }\n          const responseHandler = Function(handler)();\n          if (typeof responseHandler !== \"function\") {\n            throw new Error(\"handler 响应处理器必须返回一个函数\");\n          }\n          const info = responseHandler(responseData);\n          if (info && Array.isArray(info)) {\n            if (info.every((item) => Array.isArray(item))) {\n              results = results.concat(\n                info.map((item) => ({\n                  question: item[0],\n                  answer: item[1],\n                  extra_data: item[2] || {}\n                }))\n              );\n            } else {\n              results.push({\n                question: info[0],\n                answer: info[1],\n                extra_data: info[2] || {}\n              });\n            }\n          }\n          searchInfos.push({\n            url: wrapper.url,\n            name,\n            homepage,\n            results,\n            response: responseData,\n            data: requestData\n          });\n        } catch (error) {\n          console.error(error);\n          searchInfos.push({\n            url: wrapper.url,\n            name,\n            homepage,\n            results: [],\n            response: void 0,\n            data: void 0,\n            error: (error == null ? void 0 : error.message) || \"题库连接失败\"\n          });\n        }\n      })\n    );\n    function resolvePlaceHolder(data, options) {\n      if (typeof data === \"string\") {\n        const matches = data.match(/\\${(.*?)}/g) || [];\n        matches.forEach((placeHolder) => {\n          const value = env[placeHolder.replace(/\\${(.*)}/, \"$1\")];\n          data = data.replace(placeHolder, (options == null ? void 0 : options.encodeURI) ? encodeURIComponent(value) : value);\n        });\n      } else if (typeof data === \"object\") {\n        const keys = Object.keys(data);\n        for (const key of keys) {\n          data[key] = resolvePlaceHolder(data[key], options);\n        }\n      }\n      return data;\n    }\n    return searchInfos;\n  }\n  class AnswerWrapperParser {\n    static fromObject(json) {\n      const aw = json;\n      if (aw && Array.isArray(aw)) {\n        if (aw.length) {\n          for (let i = 0; i < aw.length; i++) {\n            const item = aw[i];\n            if (typeof item.name !== \"string\") {\n              throw new Error(`第 ${i + 1} 个题库的 名字(name) 为空`);\n            }\n            if (typeof item.url !== \"string\") {\n              throw new Error(`第 ${i + 1} 个题库的 接口地址(url) 为空`);\n            }\n            if (typeof item.handler !== \"string\") {\n              throw new Error(`第 ${i + 1} 个题库的 解析器(handler) 为空`);\n            }\n            if (item.headers && typeof item.headers !== \"object\") {\n              throw new Error(`第 ${i + 1} 个题库的 头部信息(header) 应为 对象 格式`);\n            }\n            if (item.data && typeof item.data !== \"object\") {\n              throw new Error(`第 ${i + 1} 个题库的 提交数据(data) 应为 对象 格式`);\n            }\n            const contentTypes = [\"json\", \"text\"];\n            if (item.contentType && contentTypes.every((i2) => i2 !== item.contentType)) {\n              throw new Error(`第 ${i + 1} 个题库的 contentType 必须为以下选项中的一个  ${contentTypes.join(\", \")}`);\n            }\n            const methods = [\"post\", \"get\"];\n            if (item.method && methods.every((i2) => i2 !== item.method)) {\n              throw new Error(`第 ${i + 1} 个题库的 method 必须为以下选项中的一个  ${methods.join(\", \")}`);\n            }\n            const types = [\"fetch\", \"GM_xmlhttpRequest\"];\n            if (item.type && types.every((i2) => i2 !== item.type)) {\n              throw new Error(`第 ${i + 1} 个题库的 type 必须为以下选项中的一个  ${types.join(\", \")}`);\n            }\n          }\n          return aw;\n        } else {\n          throw new Error(\"题库为空！\");\n        }\n      } else {\n        throw new Error(\"题库配置格式错误！\");\n      }\n    }\n    static fromJSONString(json) {\n      const raw = json.toString();\n      try {\n        return JSON.parse(raw);\n      } catch {\n        throw new Error(`格式错误，必须为：json字符串 或 题库配置链接`);\n      }\n    }\n    static async fromURL(url) {\n      const text = await request(url, {\n        responseType: \"text\",\n        method: \"get\",\n        type: \"fetch\"\n      });\n      return this.fromJSONString(text);\n    }\n    static fromBase64(base64) {\n      return this.fromJSONString(Buffer.from(base64, \"base64\").toString(\"utf8\"));\n    }\n    static from(value) {\n      if (typeof value === \"string\") {\n        if (value.startsWith(\"http\")) {\n          return this.fromURL(value);\n        } else {\n          return this.fromJSONString(value);\n        }\n      } else {\n        return this.fromObject(value);\n      }\n    }\n  }\n  class OCSWorker extends lib.CommonEventEmitter {\n    constructor(opts) {\n      super();\n      this.isRunning = false;\n      this.isClose = false;\n      this.isStop = false;\n      this.totalQuestionCount = 0;\n      this.opts = opts;\n    }\n    async doWork(options) {\n      var _a, _b, _c, _d;\n      this.emit(\"start\");\n      this.isRunning = true;\n      this.once(\"close\", () => {\n        this.isClose = true;\n      });\n      this.on(\"stop\", () => {\n        this.isStop = true;\n      });\n      this.on(\"continuate\", () => {\n        this.isStop = false;\n      });\n      const questionRoots = typeof this.opts.root === \"string\" ? Array.from(document.querySelectorAll(this.opts.root)) : this.opts.root;\n      this.totalQuestionCount += questionRoots.length;\n      if (options == null ? void 0 : options.enable_debug) {\n        console.debug(\"开始答题\", this);\n        console.debug(\"题目数量: \", questionRoots.length);\n        console.debug(\"父节点列表: \", questionRoots);\n      }\n      const results = [];\n      if (questionRoots.length === 0) {\n        throw new Error(\"未找到任何题目，答题结束。\");\n      }\n      for (const questionRoot of questionRoots) {\n        const ctx = {\n          searchInfos: [],\n          root: questionRoot,\n          elements: domSearchAll(this.opts.elements, questionRoot),\n          type: void 0,\n          answerSeparators: this.opts.answerSeparators,\n          answerMatchMode: this.opts.answerMatchMode || \"similar\"\n        };\n        await ((_b = (_a = this.opts).onElementSearched) == null ? void 0 : _b.call(_a, ctx.elements, questionRoot));\n        ctx.elements.title = (_c = ctx.elements.title) == null ? void 0 : _c.filter(Boolean);\n        ctx.elements.options = (_d = ctx.elements.options) == null ? void 0 : _d.filter(Boolean);\n        if (typeof this.opts.work === \"object\") {\n          ctx.type = this.opts.work.type === void 0 ? defaultWorkTypeResolver(ctx) : typeof this.opts.work.type === \"string\" ? this.opts.work.type : this.opts.work.type(ctx);\n        }\n        results.push({\n          requested: false,\n          resolved: false,\n          ctx\n        });\n      }\n      if (options == null ? void 0 : options.enable_debug) {\n        console.debug(\"上下文已初始化: \", results);\n      }\n      const requestThread = async (index) => {\n        var _a2, _b2, _c2;\n        let error;\n        const result = results[index];\n        const ctx = result.ctx || {};\n        if (this.isClose === true) {\n          this.isRunning = false;\n          return;\n        }\n        if (this.isStop) {\n          await waitForContinuate(() => this.isStop);\n        }\n        ctx.searchInfos = [];\n        if (options == null ? void 0 : options.enable_debug) {\n          console.groupEnd();\n          console.group(\n            \"开始搜题: \",\n            (_a2 = ctx.elements.title) == null ? void 0 : _a2.map((t2) => t2 == null ? void 0 : t2.innerText).filter(Boolean).join(\", \").slice(0, 20)\n          );\n          console.log(\"ctx\", result.ctx);\n        }\n        try {\n          ctx.searchInfos = await this.opts.answerer(ctx.elements, ctx) || [];\n          ctx.searchInfos.forEach((info) => {\n            info.results = info.results.map((ans) => {\n              ans.answer = ans.answer ? ans.answer.trim() : \"\";\n              return ans;\n            });\n          });\n        } catch (err) {\n          error = String(err);\n        }\n        result.ctx = ctx;\n        result.requested = true;\n        result.error = error;\n        if (options == null ? void 0 : options.enable_debug) {\n          console.log(\"搜题结果: \", ctx.searchInfos);\n        }\n        await ((_c2 = (_b2 = this.opts).onResultsUpdate) == null ? void 0 : _c2.call(_b2, results[index], index, results));\n      };\n      const waitForRequested = async (result) => {\n        return new Promise((resolve, reject) => {\n          const interval = setInterval(() => {\n            if ((result == null ? void 0 : result.requested) === true) {\n              clearInterval(interval);\n              clearTimeout(timeout);\n              resolve();\n            }\n          }, 200);\n          const timeout = setTimeout(() => {\n            clearInterval(interval);\n            reject(new Error(\"答题超时！\"));\n          }, (AnswerWrapperHandlerConfig.timeout_seconds + 10) * 1e3);\n        });\n      };\n      const resolverThread = async () => {\n        var _a2, _b2, _c2, _d2;\n        for (let index = 0; index < results.length; index++) {\n          const result = results[index];\n          let error;\n          let res;\n          if (this.isClose === true) {\n            this.isRunning = false;\n            return;\n          }\n          try {\n            if (this.isStop) {\n              await waitForContinuate(() => this.isStop);\n            }\n            await waitForRequested(result);\n          } catch (err) {\n          }\n          try {\n            if (result.ctx && result.ctx.searchInfos.length !== 0) {\n              if (typeof this.opts.work === \"object\") {\n                if (result.ctx.elements.options) {\n                  if (result.ctx.type) {\n                    const resolver = createDefaultQuestionResolver(result.ctx)[result.ctx.type];\n                    const handler = this.opts.work.handler;\n                    res = await resolver(result.ctx.searchInfos, result.ctx.elements.options, handler);\n                  } else {\n                    error = \"题目类型解析失败, 请自行提供解析器, 或者忽略此题。\";\n                  }\n                } else {\n                  error = \"elements.options 为空 ! 使用默认处理器, 必须提供题目选项的选择器。\";\n                }\n              } else {\n                const work2 = this.opts.work;\n                res = await work2(result.ctx);\n              }\n            } else {\n              error = \"搜索不到答案, 请重新运行, 或者忽略此题。\";\n            }\n          } catch (err) {\n            error = (err == null ? void 0 : err.message) || err;\n          }\n          result.error = error;\n          result.result = res || { finish: false };\n          result.resolved = true;\n          if (options == null ? void 0 : options.enable_debug) {\n            console.log(\n              \"答题完成: \",\n              (_b2 = (_a2 = result.ctx) == null ? void 0 : _a2.elements.title) == null ? void 0 : _b2.map((t2) => t2 == null ? void 0 : t2.innerText).join(\", \").slice(0, 20),\n              result\n            );\n          }\n          await ((_d2 = (_c2 = this.opts).onResultsUpdate) == null ? void 0 : _d2.call(_c2, result, index, results));\n        }\n      };\n      const requestThreadHandler = async () => {\n        const locks = [];\n        const waitForLock = () => {\n          return new Promise((resolve, reject) => {\n            const interval = setInterval(() => {\n              if (locks.length > 0) {\n                const lock = locks.shift();\n                if (lock) {\n                  resolve(lock);\n                  clearInterval(interval);\n                  clearTimeout(timeout);\n                }\n              }\n            }, 100);\n            const timeout = setTimeout(() => {\n              clearInterval(interval);\n              reject(new Error(\"获取线程锁超时！\"));\n            }, 3 * 60 * 1e3);\n          });\n        };\n        const requestThreads = [];\n        for (let index = 0; index < results.length; index++) {\n          requestThreads.push(() => requestThread(index));\n        }\n        for (let index = 0; index < (this.opts.thread || 1); index++) {\n          locks.push(index + 1);\n        }\n        let requestFinished = 0;\n        const promises = [];\n        for (let index = 0; index < (this.opts.thread || 1); index++) {\n          promises.push(async () => {\n            try {\n              while (requestFinished < results.length && requestThreads.length > 0 && this.isClose === false) {\n                const thread = requestThreads.shift();\n                if (thread) {\n                  const lock = await waitForLock();\n                  await thread();\n                  requestFinished++;\n                  locks.push(lock);\n                }\n              }\n            } catch (err) {\n              console.error(err);\n            }\n          });\n        }\n        await Promise.all(promises.map((f) => f()));\n      };\n      await Promise.all([resolverThread(), requestThreadHandler()]);\n      this.isRunning = false;\n      return results;\n    }\n    uploadHandler(options) {\n      var _a;\n      const { results, type, callback } = options;\n      if (type !== \"nomove\") {\n        let finished = 0;\n        for (const result of results) {\n          if ((_a = result.result) == null ? void 0 : _a.finish) {\n            finished++;\n          }\n        }\n        const rate = results.length === 0 ? 0 : finished / results.length * 100;\n        if (type === \"force\") {\n          return callback(rate, true);\n        } else {\n          return callback(rate, type === \"save\" ? false : rate >= parseFloat(type.toString()));\n        }\n      }\n    }\n  }\n  class CustomOCSWorker extends lib.CommonEventEmitter {\n    constructor(opts) {\n      super();\n      this.isRunning = false;\n      this.isClose = false;\n      this.isStop = false;\n      this.opts = opts;\n    }\n    async doWork(options) {\n      var _a, _b, _c, _d, _e, _f, _g, _h;\n      this.emit(\"start\");\n      this.isRunning = true;\n      this.once(\"close\", () => {\n        this.isClose = true;\n      });\n      this.on(\"stop\", () => {\n        this.isStop = true;\n      });\n      this.on(\"continuate\", () => {\n        this.isStop = false;\n      });\n      const questions = await ((_b = (_a = this.opts).questions) == null ? void 0 : _b.call(_a));\n      if (options == null ? void 0 : options.enable_debug) {\n        console.debug(\"开始答题\", this);\n        console.debug(\"题目数量: \", this.opts.questions.length);\n      }\n      const results = [];\n      for (let index = 0; index < questions.length; index++) {\n        if (this.isClose === true) {\n          this.isRunning = false;\n          return;\n        }\n        if (this.isStop) {\n          await waitForContinuate(() => this.isStop);\n        }\n        const question = questions[index];\n        results[index] = {\n          question: question.text,\n          requested: false,\n          resolved: false,\n          searchInfos: [],\n          type: question.type,\n          finish: false,\n          error: \"\"\n        };\n        try {\n          const infos = await this.opts.answerer(question.text);\n          results[index].searchInfos = infos.map((i) => ({\n            name: i.name,\n            homepage: i.homepage,\n            results: i.results.map((r) => [r.question, r.answer, r.extra_data || {}]),\n            error: i.error\n          }));\n          results[index].requested = true;\n          (_d = (_c = this.opts).onResultsUpdate) == null ? void 0 : _d.call(_c, results[index], index, results);\n          try {\n            const resolved = await this.opts.resolver(infos);\n            results[index].finish = resolved.finish;\n            results[index].error = resolved.error;\n            results[index].resolved = true;\n          } catch (err) {\n            results[index].finish = false;\n            results[index].error = err instanceof Error ? err.message : String(err);\n            results[index].resolved = true;\n          }\n          (_f = (_e = this.opts).onResultsUpdate) == null ? void 0 : _f.call(_e, results[index], index, results);\n        } catch (err) {\n          results[index].requested = true;\n          results[index].resolved = false;\n          results[index].finish = true;\n          results[index].error = err instanceof Error ? err.message : String(err);\n          (_h = (_g = this.opts).onResultsUpdate) == null ? void 0 : _h.call(_g, results[index], index, results);\n        }\n        await lib.$.sleep(this.opts.period);\n      }\n    }\n  }\n  async function waitForContinuate(isStopping) {\n    if (isStopping()) {\n      await new Promise((resolve, reject) => {\n        const interval = setInterval(() => {\n          if (isStopping() === false) {\n            clearInterval(interval);\n            resolve();\n          }\n        }, 200);\n      });\n    }\n  }\n  function getDefaults() {\n    return {\n      async: false,\n      baseUrl: null,\n      breaks: false,\n      extensions: null,\n      gfm: true,\n      headerIds: true,\n      headerPrefix: \"\",\n      highlight: null,\n      hooks: null,\n      langPrefix: \"language-\",\n      mangle: true,\n      pedantic: false,\n      renderer: null,\n      sanitize: false,\n      sanitizer: null,\n      silent: false,\n      smartypants: false,\n      tokenizer: null,\n      walkTokens: null,\n      xhtml: false\n    };\n  }\n  let defaults = getDefaults();\n  function changeDefaults(newDefaults) {\n    defaults = newDefaults;\n  }\n  const escapeTest = /[&<>\"']/;\n  const escapeReplace = new RegExp(escapeTest.source, \"g\");\n  const escapeTestNoEncode = /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/;\n  const escapeReplaceNoEncode = new RegExp(escapeTestNoEncode.source, \"g\");\n  const escapeReplacements = {\n    \"&\": \"&amp;\",\n    \"<\": \"&lt;\",\n    \">\": \"&gt;\",\n    '\"': \"&quot;\",\n    \"'\": \"&#39;\"\n  };\n  const getEscapeReplacement = (ch) => escapeReplacements[ch];\n  function escape$1(html, encode) {\n    if (encode) {\n      if (escapeTest.test(html)) {\n        return html.replace(escapeReplace, getEscapeReplacement);\n      }\n    } else {\n      if (escapeTestNoEncode.test(html)) {\n        return html.replace(escapeReplaceNoEncode, getEscapeReplacement);\n      }\n    }\n    return html;\n  }\n  const unescapeTest = /&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig;\n  function unescape$1(html) {\n    return html.replace(unescapeTest, (_, n) => {\n      n = n.toLowerCase();\n      if (n === \"colon\")\n        return \":\";\n      if (n.charAt(0) === \"#\") {\n        return n.charAt(1) === \"x\" ? String.fromCharCode(parseInt(n.substring(2), 16)) : String.fromCharCode(+n.substring(1));\n      }\n      return \"\";\n    });\n  }\n  const caret = /(^|[^\\[])\\^/g;\n  function edit(regex, opt) {\n    regex = typeof regex === \"string\" ? regex : regex.source;\n    opt = opt || \"\";\n    const obj = {\n      replace: (name, val) => {\n        val = val.source || val;\n        val = val.replace(caret, \"$1\");\n        regex = regex.replace(name, val);\n        return obj;\n      },\n      getRegex: () => {\n        return new RegExp(regex, opt);\n      }\n    };\n    return obj;\n  }\n  const nonWordAndColonTest = /[^\\w:]/g;\n  const originIndependentUrl = /^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;\n  function cleanUrl(sanitize, base, href) {\n    if (sanitize) {\n      let prot;\n      try {\n        prot = decodeURIComponent(unescape$1(href)).replace(nonWordAndColonTest, \"\").toLowerCase();\n      } catch (e) {\n        return null;\n      }\n      if (prot.indexOf(\"javascript:\") === 0 || prot.indexOf(\"vbscript:\") === 0 || prot.indexOf(\"data:\") === 0) {\n        return null;\n      }\n    }\n    if (base && !originIndependentUrl.test(href)) {\n      href = resolveUrl(base, href);\n    }\n    try {\n      href = encodeURI(href).replace(/%25/g, \"%\");\n    } catch (e) {\n      return null;\n    }\n    return href;\n  }\n  const baseUrls = {};\n  const justDomain = /^[^:]+:\\/*[^/]*$/;\n  const protocol = /^([^:]+:)[\\s\\S]*$/;\n  const domain = /^([^:]+:\\/*[^/]*)[\\s\\S]*$/;\n  function resolveUrl(base, href) {\n    if (!baseUrls[\" \" + base]) {\n      if (justDomain.test(base)) {\n        baseUrls[\" \" + base] = base + \"/\";\n      } else {\n        baseUrls[\" \" + base] = rtrim(base, \"/\", true);\n      }\n    }\n    base = baseUrls[\" \" + base];\n    const relativeBase = base.indexOf(\":\") === -1;\n    if (href.substring(0, 2) === \"//\") {\n      if (relativeBase) {\n        return href;\n      }\n      return base.replace(protocol, \"$1\") + href;\n    } else if (href.charAt(0) === \"/\") {\n      if (relativeBase) {\n        return href;\n      }\n      return base.replace(domain, \"$1\") + href;\n    } else {\n      return base + href;\n    }\n  }\n  const noopTest = { exec: function noopTest2() {\n  } };\n  function splitCells(tableRow, count) {\n    const row = tableRow.replace(/\\|/g, (match, offset, str) => {\n      let escaped = false, curr = offset;\n      while (--curr >= 0 && str[curr] === \"\\\\\")\n        escaped = !escaped;\n      if (escaped) {\n        return \"|\";\n      } else {\n        return \" |\";\n      }\n    }), cells = row.split(/ \\|/);\n    let i = 0;\n    if (!cells[0].trim()) {\n      cells.shift();\n    }\n    if (cells.length > 0 && !cells[cells.length - 1].trim()) {\n      cells.pop();\n    }\n    if (cells.length > count) {\n      cells.splice(count);\n    } else {\n      while (cells.length < count)\n        cells.push(\"\");\n    }\n    for (; i < cells.length; i++) {\n      cells[i] = cells[i].trim().replace(/\\\\\\|/g, \"|\");\n    }\n    return cells;\n  }\n  function rtrim(str, c, invert) {\n    const l = str.length;\n    if (l === 0) {\n      return \"\";\n    }\n    let suffLen = 0;\n    while (suffLen < l) {\n      const currChar = str.charAt(l - suffLen - 1);\n      if (currChar === c && !invert) {\n        suffLen++;\n      } else if (currChar !== c && invert) {\n        suffLen++;\n      } else {\n        break;\n      }\n    }\n    return str.slice(0, l - suffLen);\n  }\n  function findClosingBracket(str, b) {\n    if (str.indexOf(b[1]) === -1) {\n      return -1;\n    }\n    const l = str.length;\n    let level = 0, i = 0;\n    for (; i < l; i++) {\n      if (str[i] === \"\\\\\") {\n        i++;\n      } else if (str[i] === b[0]) {\n        level++;\n      } else if (str[i] === b[1]) {\n        level--;\n        if (level < 0) {\n          return i;\n        }\n      }\n    }\n    return -1;\n  }\n  function checkSanitizeDeprecation(opt) {\n    if (opt && opt.sanitize && !opt.silent) {\n      console.warn(\"marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options\");\n    }\n  }\n  function repeatString(pattern, count) {\n    if (count < 1) {\n      return \"\";\n    }\n    let result = \"\";\n    while (count > 1) {\n      if (count & 1) {\n        result += pattern;\n      }\n      count >>= 1;\n      pattern += pattern;\n    }\n    return result + pattern;\n  }\n  function outputLink(cap, link, raw, lexer) {\n    const href = link.href;\n    const title = link.title ? escape$1(link.title) : null;\n    const text = cap[1].replace(/\\\\([\\[\\]])/g, \"$1\");\n    if (cap[0].charAt(0) !== \"!\") {\n      lexer.state.inLink = true;\n      const token = {\n        type: \"link\",\n        raw,\n        href,\n        title,\n        text,\n        tokens: lexer.inlineTokens(text)\n      };\n      lexer.state.inLink = false;\n      return token;\n    }\n    return {\n      type: \"image\",\n      raw,\n      href,\n      title,\n      text: escape$1(text)\n    };\n  }\n  function indentCodeCompensation(raw, text) {\n    const matchIndentToCode = raw.match(/^(\\s+)(?:```)/);\n    if (matchIndentToCode === null) {\n      return text;\n    }\n    const indentToCode = matchIndentToCode[1];\n    return text.split(\"\\n\").map((node) => {\n      const matchIndentInNode = node.match(/^\\s+/);\n      if (matchIndentInNode === null) {\n        return node;\n      }\n      const [indentInNode] = matchIndentInNode;\n      if (indentInNode.length >= indentToCode.length) {\n        return node.slice(indentToCode.length);\n      }\n      return node;\n    }).join(\"\\n\");\n  }\n  class Tokenizer {\n    constructor(options) {\n      this.options = options || defaults;\n    }\n    space(src2) {\n      const cap = this.rules.block.newline.exec(src2);\n      if (cap && cap[0].length > 0) {\n        return {\n          type: \"space\",\n          raw: cap[0]\n        };\n      }\n    }\n    code(src2) {\n      const cap = this.rules.block.code.exec(src2);\n      if (cap) {\n        const text = cap[0].replace(/^ {1,4}/gm, \"\");\n        return {\n          type: \"code\",\n          raw: cap[0],\n          codeBlockStyle: \"indented\",\n          text: !this.options.pedantic ? rtrim(text, \"\\n\") : text\n        };\n      }\n    }\n    fences(src2) {\n      const cap = this.rules.block.fences.exec(src2);\n      if (cap) {\n        const raw = cap[0];\n        const text = indentCodeCompensation(raw, cap[3] || \"\");\n        return {\n          type: \"code\",\n          raw,\n          lang: cap[2] ? cap[2].trim().replace(this.rules.inline._escapes, \"$1\") : cap[2],\n          text\n        };\n      }\n    }\n    heading(src2) {\n      const cap = this.rules.block.heading.exec(src2);\n      if (cap) {\n        let text = cap[2].trim();\n        if (/#$/.test(text)) {\n          const trimmed = rtrim(text, \"#\");\n          if (this.options.pedantic) {\n            text = trimmed.trim();\n          } else if (!trimmed || / $/.test(trimmed)) {\n            text = trimmed.trim();\n          }\n        }\n        return {\n          type: \"heading\",\n          raw: cap[0],\n          depth: cap[1].length,\n          text,\n          tokens: this.lexer.inline(text)\n        };\n      }\n    }\n    hr(src2) {\n      const cap = this.rules.block.hr.exec(src2);\n      if (cap) {\n        return {\n          type: \"hr\",\n          raw: cap[0]\n        };\n      }\n    }\n    blockquote(src2) {\n      const cap = this.rules.block.blockquote.exec(src2);\n      if (cap) {\n        const text = cap[0].replace(/^ *>[ \\t]?/gm, \"\");\n        const top2 = this.lexer.state.top;\n        this.lexer.state.top = true;\n        const tokens = this.lexer.blockTokens(text);\n        this.lexer.state.top = top2;\n        return {\n          type: \"blockquote\",\n          raw: cap[0],\n          tokens,\n          text\n        };\n      }\n    }\n    list(src2) {\n      let cap = this.rules.block.list.exec(src2);\n      if (cap) {\n        let raw, istask, ischecked, indent, i, blankLine, endsWithBlankLine, line, nextLine, rawLine, itemContents, endEarly;\n        let bull = cap[1].trim();\n        const isordered = bull.length > 1;\n        const list = {\n          type: \"list\",\n          raw: \"\",\n          ordered: isordered,\n          start: isordered ? +bull.slice(0, -1) : \"\",\n          loose: false,\n          items: []\n        };\n        bull = isordered ? `\\\\d{1,9}\\\\${bull.slice(-1)}` : `\\\\${bull}`;\n        if (this.options.pedantic) {\n          bull = isordered ? bull : \"[*+-]\";\n        }\n        const itemRegex = new RegExp(`^( {0,3}${bull})((?:[\t ][^\\\\n]*)?(?:\\\\n|$))`);\n        while (src2) {\n          endEarly = false;\n          if (!(cap = itemRegex.exec(src2))) {\n            break;\n          }\n          if (this.rules.block.hr.test(src2)) {\n            break;\n          }\n          raw = cap[0];\n          src2 = src2.substring(raw.length);\n          line = cap[2].split(\"\\n\", 1)[0].replace(/^\\t+/, (t2) => \" \".repeat(3 * t2.length));\n          nextLine = src2.split(\"\\n\", 1)[0];\n          if (this.options.pedantic) {\n            indent = 2;\n            itemContents = line.trimLeft();\n          } else {\n            indent = cap[2].search(/[^ ]/);\n            indent = indent > 4 ? 1 : indent;\n            itemContents = line.slice(indent);\n            indent += cap[1].length;\n          }\n          blankLine = false;\n          if (!line && /^ *$/.test(nextLine)) {\n            raw += nextLine + \"\\n\";\n            src2 = src2.substring(nextLine.length + 1);\n            endEarly = true;\n          }\n          if (!endEarly) {\n            const nextBulletRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \t][^\\\\n]*)?(?:\\\\n|$))`);\n            const hrRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`);\n            const fencesBeginRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}(?:\\`\\`\\`|~~~)`);\n            const headingBeginRegex = new RegExp(`^ {0,${Math.min(3, indent - 1)}}#`);\n            while (src2) {\n              rawLine = src2.split(\"\\n\", 1)[0];\n              nextLine = rawLine;\n              if (this.options.pedantic) {\n                nextLine = nextLine.replace(/^ {1,4}(?=( {4})*[^ ])/g, \"  \");\n              }\n              if (fencesBeginRegex.test(nextLine)) {\n                break;\n              }\n              if (headingBeginRegex.test(nextLine)) {\n                break;\n              }\n              if (nextBulletRegex.test(nextLine)) {\n                break;\n              }\n              if (hrRegex.test(src2)) {\n                break;\n              }\n              if (nextLine.search(/[^ ]/) >= indent || !nextLine.trim()) {\n                itemContents += \"\\n\" + nextLine.slice(indent);\n              } else {\n                if (blankLine) {\n                  break;\n                }\n                if (line.search(/[^ ]/) >= 4) {\n                  break;\n                }\n                if (fencesBeginRegex.test(line)) {\n                  break;\n                }\n                if (headingBeginRegex.test(line)) {\n                  break;\n                }\n                if (hrRegex.test(line)) {\n                  break;\n                }\n                itemContents += \"\\n\" + nextLine;\n              }\n              if (!blankLine && !nextLine.trim()) {\n                blankLine = true;\n              }\n              raw += rawLine + \"\\n\";\n              src2 = src2.substring(rawLine.length + 1);\n              line = nextLine.slice(indent);\n            }\n          }\n          if (!list.loose) {\n            if (endsWithBlankLine) {\n              list.loose = true;\n            } else if (/\\n *\\n *$/.test(raw)) {\n              endsWithBlankLine = true;\n            }\n          }\n          if (this.options.gfm) {\n            istask = /^\\[[ xX]\\] /.exec(itemContents);\n            if (istask) {\n              ischecked = istask[0] !== \"[ ] \";\n              itemContents = itemContents.replace(/^\\[[ xX]\\] +/, \"\");\n            }\n          }\n          list.items.push({\n            type: \"list_item\",\n            raw,\n            task: !!istask,\n            checked: ischecked,\n            loose: false,\n            text: itemContents\n          });\n          list.raw += raw;\n        }\n        list.items[list.items.length - 1].raw = raw.trimRight();\n        list.items[list.items.length - 1].text = itemContents.trimRight();\n        list.raw = list.raw.trimRight();\n        const l = list.items.length;\n        for (i = 0; i < l; i++) {\n          this.lexer.state.top = false;\n          list.items[i].tokens = this.lexer.blockTokens(list.items[i].text, []);\n          if (!list.loose) {\n            const spacers = list.items[i].tokens.filter((t2) => t2.type === \"space\");\n            const hasMultipleLineBreaks = spacers.length > 0 && spacers.some((t2) => /\\n.*\\n/.test(t2.raw));\n            list.loose = hasMultipleLineBreaks;\n          }\n        }\n        if (list.loose) {\n          for (i = 0; i < l; i++) {\n            list.items[i].loose = true;\n          }\n        }\n        return list;\n      }\n    }\n    html(src2) {\n      const cap = this.rules.block.html.exec(src2);\n      if (cap) {\n        const token = {\n          type: \"html\",\n          raw: cap[0],\n          pre: !this.options.sanitizer && (cap[1] === \"pre\" || cap[1] === \"script\" || cap[1] === \"style\"),\n          text: cap[0]\n        };\n        if (this.options.sanitize) {\n          const text = this.options.sanitizer ? this.options.sanitizer(cap[0]) : escape$1(cap[0]);\n          token.type = \"paragraph\";\n          token.text = text;\n          token.tokens = this.lexer.inline(text);\n        }\n        return token;\n      }\n    }\n    def(src2) {\n      const cap = this.rules.block.def.exec(src2);\n      if (cap) {\n        const tag = cap[1].toLowerCase().replace(/\\s+/g, \" \");\n        const href = cap[2] ? cap[2].replace(/^<(.*)>$/, \"$1\").replace(this.rules.inline._escapes, \"$1\") : \"\";\n        const title = cap[3] ? cap[3].substring(1, cap[3].length - 1).replace(this.rules.inline._escapes, \"$1\") : cap[3];\n        return {\n          type: \"def\",\n          tag,\n          raw: cap[0],\n          href,\n          title\n        };\n      }\n    }\n    table(src2) {\n      const cap = this.rules.block.table.exec(src2);\n      if (cap) {\n        const item = {\n          type: \"table\",\n          header: splitCells(cap[1]).map((c) => {\n            return { text: c };\n          }),\n          align: cap[2].replace(/^ *|\\| *$/g, \"\").split(/ *\\| */),\n          rows: cap[3] && cap[3].trim() ? cap[3].replace(/\\n[ \\t]*$/, \"\").split(\"\\n\") : []\n        };\n        if (item.header.length === item.align.length) {\n          item.raw = cap[0];\n          let l = item.align.length;\n          let i, j, k, row;\n          for (i = 0; i < l; i++) {\n            if (/^ *-+: *$/.test(item.align[i])) {\n              item.align[i] = \"right\";\n            } else if (/^ *:-+: *$/.test(item.align[i])) {\n              item.align[i] = \"center\";\n            } else if (/^ *:-+ *$/.test(item.align[i])) {\n              item.align[i] = \"left\";\n            } else {\n              item.align[i] = null;\n            }\n          }\n          l = item.rows.length;\n          for (i = 0; i < l; i++) {\n            item.rows[i] = splitCells(item.rows[i], item.header.length).map((c) => {\n              return { text: c };\n            });\n          }\n          l = item.header.length;\n          for (j = 0; j < l; j++) {\n            item.header[j].tokens = this.lexer.inline(item.header[j].text);\n          }\n          l = item.rows.length;\n          for (j = 0; j < l; j++) {\n            row = item.rows[j];\n            for (k = 0; k < row.length; k++) {\n              row[k].tokens = this.lexer.inline(row[k].text);\n            }\n          }\n          return item;\n        }\n      }\n    }\n    lheading(src2) {\n      const cap = this.rules.block.lheading.exec(src2);\n      if (cap) {\n        return {\n          type: \"heading\",\n          raw: cap[0],\n          depth: cap[2].charAt(0) === \"=\" ? 1 : 2,\n          text: cap[1],\n          tokens: this.lexer.inline(cap[1])\n        };\n      }\n    }\n    paragraph(src2) {\n      const cap = this.rules.block.paragraph.exec(src2);\n      if (cap) {\n        const text = cap[1].charAt(cap[1].length - 1) === \"\\n\" ? cap[1].slice(0, -1) : cap[1];\n        return {\n          type: \"paragraph\",\n          raw: cap[0],\n          text,\n          tokens: this.lexer.inline(text)\n        };\n      }\n    }\n    text(src2) {\n      const cap = this.rules.block.text.exec(src2);\n      if (cap) {\n        return {\n          type: \"text\",\n          raw: cap[0],\n          text: cap[0],\n          tokens: this.lexer.inline(cap[0])\n        };\n      }\n    }\n    escape(src2) {\n      const cap = this.rules.inline.escape.exec(src2);\n      if (cap) {\n        return {\n          type: \"escape\",\n          raw: cap[0],\n          text: escape$1(cap[1])\n        };\n      }\n    }\n    tag(src2) {\n      const cap = this.rules.inline.tag.exec(src2);\n      if (cap) {\n        if (!this.lexer.state.inLink && /^<a /i.test(cap[0])) {\n          this.lexer.state.inLink = true;\n        } else if (this.lexer.state.inLink && /^<\\/a>/i.test(cap[0])) {\n          this.lexer.state.inLink = false;\n        }\n        if (!this.lexer.state.inRawBlock && /^<(pre|code|kbd|script)(\\s|>)/i.test(cap[0])) {\n          this.lexer.state.inRawBlock = true;\n        } else if (this.lexer.state.inRawBlock && /^<\\/(pre|code|kbd|script)(\\s|>)/i.test(cap[0])) {\n          this.lexer.state.inRawBlock = false;\n        }\n        return {\n          type: this.options.sanitize ? \"text\" : \"html\",\n          raw: cap[0],\n          inLink: this.lexer.state.inLink,\n          inRawBlock: this.lexer.state.inRawBlock,\n          text: this.options.sanitize ? this.options.sanitizer ? this.options.sanitizer(cap[0]) : escape$1(cap[0]) : cap[0]\n        };\n      }\n    }\n    link(src2) {\n      const cap = this.rules.inline.link.exec(src2);\n      if (cap) {\n        const trimmedUrl = cap[2].trim();\n        if (!this.options.pedantic && /^</.test(trimmedUrl)) {\n          if (!/>$/.test(trimmedUrl)) {\n            return;\n          }\n          const rtrimSlash = rtrim(trimmedUrl.slice(0, -1), \"\\\\\");\n          if ((trimmedUrl.length - rtrimSlash.length) % 2 === 0) {\n            return;\n          }\n        } else {\n          const lastParenIndex = findClosingBracket(cap[2], \"()\");\n          if (lastParenIndex > -1) {\n            const start2 = cap[0].indexOf(\"!\") === 0 ? 5 : 4;\n            const linkLen = start2 + cap[1].length + lastParenIndex;\n            cap[2] = cap[2].substring(0, lastParenIndex);\n            cap[0] = cap[0].substring(0, linkLen).trim();\n            cap[3] = \"\";\n          }\n        }\n        let href = cap[2];\n        let title = \"\";\n        if (this.options.pedantic) {\n          const link = /^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/.exec(href);\n          if (link) {\n            href = link[1];\n            title = link[3];\n          }\n        } else {\n          title = cap[3] ? cap[3].slice(1, -1) : \"\";\n        }\n        href = href.trim();\n        if (/^</.test(href)) {\n          if (this.options.pedantic && !/>$/.test(trimmedUrl)) {\n            href = href.slice(1);\n          } else {\n            href = href.slice(1, -1);\n          }\n        }\n        return outputLink(cap, {\n          href: href ? href.replace(this.rules.inline._escapes, \"$1\") : href,\n          title: title ? title.replace(this.rules.inline._escapes, \"$1\") : title\n        }, cap[0], this.lexer);\n      }\n    }\n    reflink(src2, links) {\n      let cap;\n      if ((cap = this.rules.inline.reflink.exec(src2)) || (cap = this.rules.inline.nolink.exec(src2))) {\n        let link = (cap[2] || cap[1]).replace(/\\s+/g, \" \");\n        link = links[link.toLowerCase()];\n        if (!link) {\n          const text = cap[0].charAt(0);\n          return {\n            type: \"text\",\n            raw: text,\n            text\n          };\n        }\n        return outputLink(cap, link, cap[0], this.lexer);\n      }\n    }\n    emStrong(src2, maskedSrc, prevChar = \"\") {\n      let match = this.rules.inline.emStrong.lDelim.exec(src2);\n      if (!match)\n        return;\n      if (match[3] && prevChar.match(/[\\p{L}\\p{N}]/u))\n        return;\n      const nextChar = match[1] || match[2] || \"\";\n      if (!nextChar || nextChar && (prevChar === \"\" || this.rules.inline.punctuation.exec(prevChar))) {\n        const lLength = match[0].length - 1;\n        let rDelim, rLength, delimTotal = lLength, midDelimTotal = 0;\n        const endReg = match[0][0] === \"*\" ? this.rules.inline.emStrong.rDelimAst : this.rules.inline.emStrong.rDelimUnd;\n        endReg.lastIndex = 0;\n        maskedSrc = maskedSrc.slice(-1 * src2.length + lLength);\n        while ((match = endReg.exec(maskedSrc)) != null) {\n          rDelim = match[1] || match[2] || match[3] || match[4] || match[5] || match[6];\n          if (!rDelim)\n            continue;\n          rLength = rDelim.length;\n          if (match[3] || match[4]) {\n            delimTotal += rLength;\n            continue;\n          } else if (match[5] || match[6]) {\n            if (lLength % 3 && !((lLength + rLength) % 3)) {\n              midDelimTotal += rLength;\n              continue;\n            }\n          }\n          delimTotal -= rLength;\n          if (delimTotal > 0)\n            continue;\n          rLength = Math.min(rLength, rLength + delimTotal + midDelimTotal);\n          const raw = src2.slice(0, lLength + match.index + (match[0].length - rDelim.length) + rLength);\n          if (Math.min(lLength, rLength) % 2) {\n            const text2 = raw.slice(1, -1);\n            return {\n              type: \"em\",\n              raw,\n              text: text2,\n              tokens: this.lexer.inlineTokens(text2)\n            };\n          }\n          const text = raw.slice(2, -2);\n          return {\n            type: \"strong\",\n            raw,\n            text,\n            tokens: this.lexer.inlineTokens(text)\n          };\n        }\n      }\n    }\n    codespan(src2) {\n      const cap = this.rules.inline.code.exec(src2);\n      if (cap) {\n        let text = cap[2].replace(/\\n/g, \" \");\n        const hasNonSpaceChars = /[^ ]/.test(text);\n        const hasSpaceCharsOnBothEnds = /^ /.test(text) && / $/.test(text);\n        if (hasNonSpaceChars && hasSpaceCharsOnBothEnds) {\n          text = text.substring(1, text.length - 1);\n        }\n        text = escape$1(text, true);\n        return {\n          type: \"codespan\",\n          raw: cap[0],\n          text\n        };\n      }\n    }\n    br(src2) {\n      const cap = this.rules.inline.br.exec(src2);\n      if (cap) {\n        return {\n          type: \"br\",\n          raw: cap[0]\n        };\n      }\n    }\n    del(src2) {\n      const cap = this.rules.inline.del.exec(src2);\n      if (cap) {\n        return {\n          type: \"del\",\n          raw: cap[0],\n          text: cap[2],\n          tokens: this.lexer.inlineTokens(cap[2])\n        };\n      }\n    }\n    autolink(src2, mangle2) {\n      const cap = this.rules.inline.autolink.exec(src2);\n      if (cap) {\n        let text, href;\n        if (cap[2] === \"@\") {\n          text = escape$1(this.options.mangle ? mangle2(cap[1]) : cap[1]);\n          href = \"mailto:\" + text;\n        } else {\n          text = escape$1(cap[1]);\n          href = text;\n        }\n        return {\n          type: \"link\",\n          raw: cap[0],\n          text,\n          href,\n          tokens: [\n            {\n              type: \"text\",\n              raw: text,\n              text\n            }\n          ]\n        };\n      }\n    }\n    url(src2, mangle2) {\n      let cap;\n      if (cap = this.rules.inline.url.exec(src2)) {\n        let text, href;\n        if (cap[2] === \"@\") {\n          text = escape$1(this.options.mangle ? mangle2(cap[0]) : cap[0]);\n          href = \"mailto:\" + text;\n        } else {\n          let prevCapZero;\n          do {\n            prevCapZero = cap[0];\n            cap[0] = this.rules.inline._backpedal.exec(cap[0])[0];\n          } while (prevCapZero !== cap[0]);\n          text = escape$1(cap[0]);\n          if (cap[1] === \"www.\") {\n            href = \"http://\" + cap[0];\n          } else {\n            href = cap[0];\n          }\n        }\n        return {\n          type: \"link\",\n          raw: cap[0],\n          text,\n          href,\n          tokens: [\n            {\n              type: \"text\",\n              raw: text,\n              text\n            }\n          ]\n        };\n      }\n    }\n    inlineText(src2, smartypants2) {\n      const cap = this.rules.inline.text.exec(src2);\n      if (cap) {\n        let text;\n        if (this.lexer.state.inRawBlock) {\n          text = this.options.sanitize ? this.options.sanitizer ? this.options.sanitizer(cap[0]) : escape$1(cap[0]) : cap[0];\n        } else {\n          text = escape$1(this.options.smartypants ? smartypants2(cap[0]) : cap[0]);\n        }\n        return {\n          type: \"text\",\n          raw: cap[0],\n          text\n        };\n      }\n    }\n  }\n  const block = {\n    newline: /^(?: *(?:\\n|$))+/,\n    code: /^( {4}[^\\n]+(?:\\n(?: *(?:\\n|$))*)?)+/,\n    fences: /^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/,\n    hr: /^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/,\n    heading: /^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/,\n    blockquote: /^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/,\n    list: /^( {0,3}bull)([ \\t][^\\n]+?)?(?:\\n|$)/,\n    html: \"^ {0,3}(?:<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)|comment[^\\\\n]*(\\\\n+|$)|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$))\",\n    def: /^ {0,3}\\[(label)\\]: *(?:\\n *)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n *)?| *\\n *)(title))? *(?:\\n+|$)/,\n    table: noopTest,\n    lheading: /^((?:.|\\n(?!\\n))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n    _paragraph: /^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/,\n    text: /^[^\\n]+/\n  };\n  block._label = /(?!\\s*\\])(?:\\\\.|[^\\[\\]\\\\])+/;\n  block._title = /(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/;\n  block.def = edit(block.def).replace(\"label\", block._label).replace(\"title\", block._title).getRegex();\n  block.bullet = /(?:[*+-]|\\d{1,9}[.)])/;\n  block.listItemStart = edit(/^( *)(bull) */).replace(\"bull\", block.bullet).getRegex();\n  block.list = edit(block.list).replace(/bull/g, block.bullet).replace(\"hr\", \"\\\\n+(?=\\\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$))\").replace(\"def\", \"\\\\n+(?=\" + block.def.source + \")\").getRegex();\n  block._tag = \"address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul\";\n  block._comment = /<!--(?!-?>)[\\s\\S]*?(?:-->|$)/;\n  block.html = edit(block.html, \"i\").replace(\"comment\", block._comment).replace(\"tag\", block._tag).replace(\"attribute\", / +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/).getRegex();\n  block.paragraph = edit(block._paragraph).replace(\"hr\", block.hr).replace(\"heading\", \" {0,3}#{1,6} \").replace(\"|lheading\", \"\").replace(\"|table\", \"\").replace(\"blockquote\", \" {0,3}>\").replace(\"fences\", \" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\", \" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\", \"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\", block._tag).getRegex();\n  block.blockquote = edit(block.blockquote).replace(\"paragraph\", block.paragraph).getRegex();\n  block.normal = { ...block };\n  block.gfm = {\n    ...block.normal,\n    table: \"^ *([^\\\\n ].*\\\\|.*)\\\\n {0,3}(?:\\\\| *)?(:?-+:? *(?:\\\\| *:?-+:? *)*)(?:\\\\| *)?(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)\"\n  };\n  block.gfm.table = edit(block.gfm.table).replace(\"hr\", block.hr).replace(\"heading\", \" {0,3}#{1,6} \").replace(\"blockquote\", \" {0,3}>\").replace(\"code\", \" {4}[^\\\\n]\").replace(\"fences\", \" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\", \" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\", \"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\", block._tag).getRegex();\n  block.gfm.paragraph = edit(block._paragraph).replace(\"hr\", block.hr).replace(\"heading\", \" {0,3}#{1,6} \").replace(\"|lheading\", \"\").replace(\"table\", block.gfm.table).replace(\"blockquote\", \" {0,3}>\").replace(\"fences\", \" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\", \" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\", \"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\", block._tag).getRegex();\n  block.pedantic = {\n    ...block.normal,\n    html: edit(\n      `^ *(?:comment *(?:\\\\n|\\\\s*$)|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\\\s[^'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))`\n    ).replace(\"comment\", block._comment).replace(/tag/g, \"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b\").getRegex(),\n    def: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,\n    heading: /^(#{1,6})(.*)(?:\\n+|$)/,\n    fences: noopTest,\n    lheading: /^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n    paragraph: edit(block.normal._paragraph).replace(\"hr\", block.hr).replace(\"heading\", \" *#{1,6} *[^\\n]\").replace(\"lheading\", block.lheading).replace(\"blockquote\", \" {0,3}>\").replace(\"|fences\", \"\").replace(\"|list\", \"\").replace(\"|html\", \"\").getRegex()\n  };\n  const inline = {\n    escape: /^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/,\n    autolink: /^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/,\n    url: noopTest,\n    tag: \"^comment|^</[a-zA-Z][\\\\w:-]*\\\\s*>|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>|^<\\\\?[\\\\s\\\\S]*?\\\\?>|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>\",\n    link: /^!?\\[(label)\\]\\(\\s*(href)(?:\\s+(title))?\\s*\\)/,\n    reflink: /^!?\\[(label)\\]\\[(ref)\\]/,\n    nolink: /^!?\\[(ref)\\](?:\\[\\])?/,\n    reflinkSearch: \"reflink|nolink(?!\\\\()\",\n    emStrong: {\n      lDelim: /^(?:\\*+(?:([punct_])|[^\\s*]))|^_+(?:([punct*])|([^\\s_]))/,\n      rDelimAst: /^(?:[^_*\\\\]|\\\\.)*?\\_\\_(?:[^_*\\\\]|\\\\.)*?\\*(?:[^_*\\\\]|\\\\.)*?(?=\\_\\_)|(?:[^*\\\\]|\\\\.)+(?=[^*])|[punct_](\\*+)(?=[\\s]|$)|(?:[^punct*_\\s\\\\]|\\\\.)(\\*+)(?=[punct_\\s]|$)|[punct_\\s](\\*+)(?=[^punct*_\\s])|[\\s](\\*+)(?=[punct_])|[punct_](\\*+)(?=[punct_])|(?:[^punct*_\\s\\\\]|\\\\.)(\\*+)(?=[^punct*_\\s])/,\n      rDelimUnd: /^(?:[^_*\\\\]|\\\\.)*?\\*\\*(?:[^_*\\\\]|\\\\.)*?\\_(?:[^_*\\\\]|\\\\.)*?(?=\\*\\*)|(?:[^_\\\\]|\\\\.)+(?=[^_])|[punct*](\\_+)(?=[\\s]|$)|(?:[^punct*_\\s\\\\]|\\\\.)(\\_+)(?=[punct*\\s]|$)|[punct*\\s](\\_+)(?=[^punct*_\\s])|[\\s](\\_+)(?=[punct*])|[punct*](\\_+)(?=[punct*])/\n    },\n    code: /^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/,\n    br: /^( {2,}|\\\\)\\n(?!\\s*$)/,\n    del: noopTest,\n    text: /^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/,\n    punctuation: /^([\\spunctuation])/\n  };\n  inline._punctuation = \"!\\\"#$%&'()+\\\\-.,/:;<=>?@\\\\[\\\\]`^{|}~\";\n  inline.punctuation = edit(inline.punctuation).replace(/punctuation/g, inline._punctuation).getRegex();\n  inline.blockSkip = /\\[[^\\]]*?\\]\\([^\\)]*?\\)|`[^`]*?`|<[^>]*?>/g;\n  inline.escapedEmSt = /(?:^|[^\\\\])(?:\\\\\\\\)*\\\\[*_]/g;\n  inline._comment = edit(block._comment).replace(\"(?:-->|$)\", \"-->\").getRegex();\n  inline.emStrong.lDelim = edit(inline.emStrong.lDelim).replace(/punct/g, inline._punctuation).getRegex();\n  inline.emStrong.rDelimAst = edit(inline.emStrong.rDelimAst, \"g\").replace(/punct/g, inline._punctuation).getRegex();\n  inline.emStrong.rDelimUnd = edit(inline.emStrong.rDelimUnd, \"g\").replace(/punct/g, inline._punctuation).getRegex();\n  inline._escapes = /\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/g;\n  inline._scheme = /[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;\n  inline._email = /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;\n  inline.autolink = edit(inline.autolink).replace(\"scheme\", inline._scheme).replace(\"email\", inline._email).getRegex();\n  inline._attribute = /\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/;\n  inline.tag = edit(inline.tag).replace(\"comment\", inline._comment).replace(\"attribute\", inline._attribute).getRegex();\n  inline._label = /(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/;\n  inline._href = /<(?:\\\\.|[^\\n<>\\\\])+>|[^\\s\\x00-\\x1f]*/;\n  inline._title = /\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/;\n  inline.link = edit(inline.link).replace(\"label\", inline._label).replace(\"href\", inline._href).replace(\"title\", inline._title).getRegex();\n  inline.reflink = edit(inline.reflink).replace(\"label\", inline._label).replace(\"ref\", block._label).getRegex();\n  inline.nolink = edit(inline.nolink).replace(\"ref\", block._label).getRegex();\n  inline.reflinkSearch = edit(inline.reflinkSearch, \"g\").replace(\"reflink\", inline.reflink).replace(\"nolink\", inline.nolink).getRegex();\n  inline.normal = { ...inline };\n  inline.pedantic = {\n    ...inline.normal,\n    strong: {\n      start: /^__|\\*\\*/,\n      middle: /^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,\n      endAst: /\\*\\*(?!\\*)/g,\n      endUnd: /__(?!_)/g\n    },\n    em: {\n      start: /^_|\\*/,\n      middle: /^()\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)|^_(?=\\S)([\\s\\S]*?\\S)_(?!_)/,\n      endAst: /\\*(?!\\*)/g,\n      endUnd: /_(?!_)/g\n    },\n    link: edit(/^!?\\[(label)\\]\\((.*?)\\)/).replace(\"label\", inline._label).getRegex(),\n    reflink: edit(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/).replace(\"label\", inline._label).getRegex()\n  };\n  inline.gfm = {\n    ...inline.normal,\n    escape: edit(inline.escape).replace(\"])\", \"~|])\").getRegex(),\n    _extended_email: /[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,\n    url: /^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/,\n    _backpedal: /(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,\n    del: /^(~~?)(?=[^\\s~])([\\s\\S]*?[^\\s~])\\1(?=[^~]|$)/,\n    text: /^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/\n  };\n  inline.gfm.url = edit(inline.gfm.url, \"i\").replace(\"email\", inline.gfm._extended_email).getRegex();\n  inline.breaks = {\n    ...inline.gfm,\n    br: edit(inline.br).replace(\"{2,}\", \"*\").getRegex(),\n    text: edit(inline.gfm.text).replace(\"\\\\b_\", \"\\\\b_| {2,}\\\\n\").replace(/\\{2,\\}/g, \"*\").getRegex()\n  };\n  function smartypants(text) {\n    return text.replace(/---/g, \"—\").replace(/--/g, \"–\").replace(/(^|[-\\u2014/(\\[{\"\\s])'/g, \"$1‘\").replace(/'/g, \"’\").replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g, \"$1“\").replace(/\"/g, \"”\").replace(/\\.{3}/g, \"…\");\n  }\n  function mangle(text) {\n    let out = \"\", i, ch;\n    const l = text.length;\n    for (i = 0; i < l; i++) {\n      ch = text.charCodeAt(i);\n      if (Math.random() > 0.5) {\n        ch = \"x\" + ch.toString(16);\n      }\n      out += \"&#\" + ch + \";\";\n    }\n    return out;\n  }\n  class Lexer {\n    constructor(options) {\n      this.tokens = [];\n      this.tokens.links = /* @__PURE__ */ Object.create(null);\n      this.options = options || defaults;\n      this.options.tokenizer = this.options.tokenizer || new Tokenizer();\n      this.tokenizer = this.options.tokenizer;\n      this.tokenizer.options = this.options;\n      this.tokenizer.lexer = this;\n      this.inlineQueue = [];\n      this.state = {\n        inLink: false,\n        inRawBlock: false,\n        top: true\n      };\n      const rules = {\n        block: block.normal,\n        inline: inline.normal\n      };\n      if (this.options.pedantic) {\n        rules.block = block.pedantic;\n        rules.inline = inline.pedantic;\n      } else if (this.options.gfm) {\n        rules.block = block.gfm;\n        if (this.options.breaks) {\n          rules.inline = inline.breaks;\n        } else {\n          rules.inline = inline.gfm;\n        }\n      }\n      this.tokenizer.rules = rules;\n    }\n    static get rules() {\n      return {\n        block,\n        inline\n      };\n    }\n    static lex(src2, options) {\n      const lexer = new Lexer(options);\n      return lexer.lex(src2);\n    }\n    static lexInline(src2, options) {\n      const lexer = new Lexer(options);\n      return lexer.inlineTokens(src2);\n    }\n    lex(src2) {\n      src2 = src2.replace(/\\r\\n|\\r/g, \"\\n\");\n      this.blockTokens(src2, this.tokens);\n      let next2;\n      while (next2 = this.inlineQueue.shift()) {\n        this.inlineTokens(next2.src, next2.tokens);\n      }\n      return this.tokens;\n    }\n    blockTokens(src2, tokens = []) {\n      if (this.options.pedantic) {\n        src2 = src2.replace(/\\t/g, \"    \").replace(/^ +$/gm, \"\");\n      } else {\n        src2 = src2.replace(/^( *)(\\t+)/gm, (_, leading, tabs) => {\n          return leading + \"    \".repeat(tabs.length);\n        });\n      }\n      let token, lastToken, cutSrc, lastParagraphClipped;\n      while (src2) {\n        if (this.options.extensions && this.options.extensions.block && this.options.extensions.block.some((extTokenizer) => {\n          if (token = extTokenizer.call({ lexer: this }, src2, tokens)) {\n            src2 = src2.substring(token.raw.length);\n            tokens.push(token);\n            return true;\n          }\n          return false;\n        })) {\n          continue;\n        }\n        if (token = this.tokenizer.space(src2)) {\n          src2 = src2.substring(token.raw.length);\n          if (token.raw.length === 1 && tokens.length > 0) {\n            tokens[tokens.length - 1].raw += \"\\n\";\n          } else {\n            tokens.push(token);\n          }\n          continue;\n        }\n        if (token = this.tokenizer.code(src2)) {\n          src2 = src2.substring(token.raw.length);\n          lastToken = tokens[tokens.length - 1];\n          if (lastToken && (lastToken.type === \"paragraph\" || lastToken.type === \"text\")) {\n            lastToken.raw += \"\\n\" + token.raw;\n            lastToken.text += \"\\n\" + token.text;\n            this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n          } else {\n            tokens.push(token);\n          }\n          continue;\n        }\n        if (token = this.tokenizer.fences(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.heading(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.hr(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.blockquote(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.list(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.html(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.def(src2)) {\n          src2 = src2.substring(token.raw.length);\n          lastToken = tokens[tokens.length - 1];\n          if (lastToken && (lastToken.type === \"paragraph\" || lastToken.type === \"text\")) {\n            lastToken.raw += \"\\n\" + token.raw;\n            lastToken.text += \"\\n\" + token.raw;\n            this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n          } else if (!this.tokens.links[token.tag]) {\n            this.tokens.links[token.tag] = {\n              href: token.href,\n              title: token.title\n            };\n          }\n          continue;\n        }\n        if (token = this.tokenizer.table(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.lheading(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        cutSrc = src2;\n        if (this.options.extensions && this.options.extensions.startBlock) {\n          let startIndex = Infinity;\n          const tempSrc = src2.slice(1);\n          let tempStart;\n          this.options.extensions.startBlock.forEach(function(getStartIndex) {\n            tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n            if (typeof tempStart === \"number\" && tempStart >= 0) {\n              startIndex = Math.min(startIndex, tempStart);\n            }\n          });\n          if (startIndex < Infinity && startIndex >= 0) {\n            cutSrc = src2.substring(0, startIndex + 1);\n          }\n        }\n        if (this.state.top && (token = this.tokenizer.paragraph(cutSrc))) {\n          lastToken = tokens[tokens.length - 1];\n          if (lastParagraphClipped && lastToken.type === \"paragraph\") {\n            lastToken.raw += \"\\n\" + token.raw;\n            lastToken.text += \"\\n\" + token.text;\n            this.inlineQueue.pop();\n            this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n          } else {\n            tokens.push(token);\n          }\n          lastParagraphClipped = cutSrc.length !== src2.length;\n          src2 = src2.substring(token.raw.length);\n          continue;\n        }\n        if (token = this.tokenizer.text(src2)) {\n          src2 = src2.substring(token.raw.length);\n          lastToken = tokens[tokens.length - 1];\n          if (lastToken && lastToken.type === \"text\") {\n            lastToken.raw += \"\\n\" + token.raw;\n            lastToken.text += \"\\n\" + token.text;\n            this.inlineQueue.pop();\n            this.inlineQueue[this.inlineQueue.length - 1].src = lastToken.text;\n          } else {\n            tokens.push(token);\n          }\n          continue;\n        }\n        if (src2) {\n          const errMsg = \"Infinite loop on byte: \" + src2.charCodeAt(0);\n          if (this.options.silent) {\n            console.error(errMsg);\n            break;\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n      this.state.top = true;\n      return tokens;\n    }\n    inline(src2, tokens = []) {\n      this.inlineQueue.push({ src: src2, tokens });\n      return tokens;\n    }\n    inlineTokens(src2, tokens = []) {\n      let token, lastToken, cutSrc;\n      let maskedSrc = src2;\n      let match;\n      let keepPrevChar, prevChar;\n      if (this.tokens.links) {\n        const links = Object.keys(this.tokens.links);\n        if (links.length > 0) {\n          while ((match = this.tokenizer.rules.inline.reflinkSearch.exec(maskedSrc)) != null) {\n            if (links.includes(match[0].slice(match[0].lastIndexOf(\"[\") + 1, -1))) {\n              maskedSrc = maskedSrc.slice(0, match.index) + \"[\" + repeatString(\"a\", match[0].length - 2) + \"]\" + maskedSrc.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex);\n            }\n          }\n        }\n      }\n      while ((match = this.tokenizer.rules.inline.blockSkip.exec(maskedSrc)) != null) {\n        maskedSrc = maskedSrc.slice(0, match.index) + \"[\" + repeatString(\"a\", match[0].length - 2) + \"]\" + maskedSrc.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);\n      }\n      while ((match = this.tokenizer.rules.inline.escapedEmSt.exec(maskedSrc)) != null) {\n        maskedSrc = maskedSrc.slice(0, match.index + match[0].length - 2) + \"++\" + maskedSrc.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);\n        this.tokenizer.rules.inline.escapedEmSt.lastIndex--;\n      }\n      while (src2) {\n        if (!keepPrevChar) {\n          prevChar = \"\";\n        }\n        keepPrevChar = false;\n        if (this.options.extensions && this.options.extensions.inline && this.options.extensions.inline.some((extTokenizer) => {\n          if (token = extTokenizer.call({ lexer: this }, src2, tokens)) {\n            src2 = src2.substring(token.raw.length);\n            tokens.push(token);\n            return true;\n          }\n          return false;\n        })) {\n          continue;\n        }\n        if (token = this.tokenizer.escape(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.tag(src2)) {\n          src2 = src2.substring(token.raw.length);\n          lastToken = tokens[tokens.length - 1];\n          if (lastToken && token.type === \"text\" && lastToken.type === \"text\") {\n            lastToken.raw += token.raw;\n            lastToken.text += token.text;\n          } else {\n            tokens.push(token);\n          }\n          continue;\n        }\n        if (token = this.tokenizer.link(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.reflink(src2, this.tokens.links)) {\n          src2 = src2.substring(token.raw.length);\n          lastToken = tokens[tokens.length - 1];\n          if (lastToken && token.type === \"text\" && lastToken.type === \"text\") {\n            lastToken.raw += token.raw;\n            lastToken.text += token.text;\n          } else {\n            tokens.push(token);\n          }\n          continue;\n        }\n        if (token = this.tokenizer.emStrong(src2, maskedSrc, prevChar)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.codespan(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.br(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.del(src2)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (token = this.tokenizer.autolink(src2, mangle)) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        if (!this.state.inLink && (token = this.tokenizer.url(src2, mangle))) {\n          src2 = src2.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        }\n        cutSrc = src2;\n        if (this.options.extensions && this.options.extensions.startInline) {\n          let startIndex = Infinity;\n          const tempSrc = src2.slice(1);\n          let tempStart;\n          this.options.extensions.startInline.forEach(function(getStartIndex) {\n            tempStart = getStartIndex.call({ lexer: this }, tempSrc);\n            if (typeof tempStart === \"number\" && tempStart >= 0) {\n              startIndex = Math.min(startIndex, tempStart);\n            }\n          });\n          if (startIndex < Infinity && startIndex >= 0) {\n            cutSrc = src2.substring(0, startIndex + 1);\n          }\n        }\n        if (token = this.tokenizer.inlineText(cutSrc, smartypants)) {\n          src2 = src2.substring(token.raw.length);\n          if (token.raw.slice(-1) !== \"_\") {\n            prevChar = token.raw.slice(-1);\n          }\n          keepPrevChar = true;\n          lastToken = tokens[tokens.length - 1];\n          if (lastToken && lastToken.type === \"text\") {\n            lastToken.raw += token.raw;\n            lastToken.text += token.text;\n          } else {\n            tokens.push(token);\n          }\n          continue;\n        }\n        if (src2) {\n          const errMsg = \"Infinite loop on byte: \" + src2.charCodeAt(0);\n          if (this.options.silent) {\n            console.error(errMsg);\n            break;\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n      return tokens;\n    }\n  }\n  class Renderer {\n    constructor(options) {\n      this.options = options || defaults;\n    }\n    code(code, infostring, escaped) {\n      const lang = (infostring || \"\").match(/\\S*/)[0];\n      if (this.options.highlight) {\n        const out = this.options.highlight(code, lang);\n        if (out != null && out !== code) {\n          escaped = true;\n          code = out;\n        }\n      }\n      code = code.replace(/\\n$/, \"\") + \"\\n\";\n      if (!lang) {\n        return \"<pre><code>\" + (escaped ? code : escape$1(code, true)) + \"</code></pre>\\n\";\n      }\n      return '<pre><code class=\"' + this.options.langPrefix + escape$1(lang) + '\">' + (escaped ? code : escape$1(code, true)) + \"</code></pre>\\n\";\n    }\n    blockquote(quote) {\n      return `<blockquote>\n${quote}</blockquote>\n`;\n    }\n    html(html) {\n      return html;\n    }\n    heading(text, level, raw, slugger) {\n      if (this.options.headerIds) {\n        const id = this.options.headerPrefix + slugger.slug(raw);\n        return `<h${level} id=\"${id}\">${text}</h${level}>\n`;\n      }\n      return `<h${level}>${text}</h${level}>\n`;\n    }\n    hr() {\n      return this.options.xhtml ? \"<hr/>\\n\" : \"<hr>\\n\";\n    }\n    list(body, ordered, start2) {\n      const type = ordered ? \"ol\" : \"ul\", startatt = ordered && start2 !== 1 ? ' start=\"' + start2 + '\"' : \"\";\n      return \"<\" + type + startatt + \">\\n\" + body + \"</\" + type + \">\\n\";\n    }\n    listitem(text) {\n      return `<li>${text}</li>\n`;\n    }\n    checkbox(checked) {\n      return \"<input \" + (checked ? 'checked=\"\" ' : \"\") + 'disabled=\"\" type=\"checkbox\"' + (this.options.xhtml ? \" /\" : \"\") + \"> \";\n    }\n    paragraph(text) {\n      return `<p>${text}</p>\n`;\n    }\n    table(header2, body) {\n      if (body)\n        body = `<tbody>${body}</tbody>`;\n      return \"<table>\\n<thead>\\n\" + header2 + \"</thead>\\n\" + body + \"</table>\\n\";\n    }\n    tablerow(content) {\n      return `<tr>\n${content}</tr>\n`;\n    }\n    tablecell(content, flags) {\n      const type = flags.header ? \"th\" : \"td\";\n      const tag = flags.align ? `<${type} align=\"${flags.align}\">` : `<${type}>`;\n      return tag + content + `</${type}>\n`;\n    }\n    strong(text) {\n      return `<strong>${text}</strong>`;\n    }\n    em(text) {\n      return `<em>${text}</em>`;\n    }\n    codespan(text) {\n      return `<code>${text}</code>`;\n    }\n    br() {\n      return this.options.xhtml ? \"<br/>\" : \"<br>\";\n    }\n    del(text) {\n      return `<del>${text}</del>`;\n    }\n    link(href, title, text) {\n      href = cleanUrl(this.options.sanitize, this.options.baseUrl, href);\n      if (href === null) {\n        return text;\n      }\n      let out = '<a href=\"' + href + '\"';\n      if (title) {\n        out += ' title=\"' + title + '\"';\n      }\n      out += \">\" + text + \"</a>\";\n      return out;\n    }\n    image(href, title, text) {\n      href = cleanUrl(this.options.sanitize, this.options.baseUrl, href);\n      if (href === null) {\n        return text;\n      }\n      let out = `<img src=\"${href}\" alt=\"${text}\"`;\n      if (title) {\n        out += ` title=\"${title}\"`;\n      }\n      out += this.options.xhtml ? \"/>\" : \">\";\n      return out;\n    }\n    text(text) {\n      return text;\n    }\n  }\n  class TextRenderer {\n    strong(text) {\n      return text;\n    }\n    em(text) {\n      return text;\n    }\n    codespan(text) {\n      return text;\n    }\n    del(text) {\n      return text;\n    }\n    html(text) {\n      return text;\n    }\n    text(text) {\n      return text;\n    }\n    link(href, title, text) {\n      return \"\" + text;\n    }\n    image(href, title, text) {\n      return \"\" + text;\n    }\n    br() {\n      return \"\";\n    }\n  }\n  class Slugger {\n    constructor() {\n      this.seen = {};\n    }\n    serialize(value) {\n      return value.toLowerCase().trim().replace(/<[!\\/a-z].*?>/ig, \"\").replace(/[\\u2000-\\u206F\\u2E00-\\u2E7F\\\\'!\"#$%&()*+,./:;<=>?@[\\]^`{|}~]/g, \"\").replace(/\\s/g, \"-\");\n    }\n    getNextSafeSlug(originalSlug, isDryRun) {\n      let slug = originalSlug;\n      let occurenceAccumulator = 0;\n      if (this.seen.hasOwnProperty(slug)) {\n        occurenceAccumulator = this.seen[originalSlug];\n        do {\n          occurenceAccumulator++;\n          slug = originalSlug + \"-\" + occurenceAccumulator;\n        } while (this.seen.hasOwnProperty(slug));\n      }\n      if (!isDryRun) {\n        this.seen[originalSlug] = occurenceAccumulator;\n        this.seen[slug] = 0;\n      }\n      return slug;\n    }\n    slug(value, options = {}) {\n      const slug = this.serialize(value);\n      return this.getNextSafeSlug(slug, options.dryrun);\n    }\n  }\n  class Parser {\n    constructor(options) {\n      this.options = options || defaults;\n      this.options.renderer = this.options.renderer || new Renderer();\n      this.renderer = this.options.renderer;\n      this.renderer.options = this.options;\n      this.textRenderer = new TextRenderer();\n      this.slugger = new Slugger();\n    }\n    static parse(tokens, options) {\n      const parser = new Parser(options);\n      return parser.parse(tokens);\n    }\n    static parseInline(tokens, options) {\n      const parser = new Parser(options);\n      return parser.parseInline(tokens);\n    }\n    parse(tokens, top2 = true) {\n      let out = \"\", i, j, k, l2, l3, row, cell, header2, body, token, ordered, start2, loose, itemBody, item, checked, task, checkbox, ret;\n      const l = tokens.length;\n      for (i = 0; i < l; i++) {\n        token = tokens[i];\n        if (this.options.extensions && this.options.extensions.renderers && this.options.extensions.renderers[token.type]) {\n          ret = this.options.extensions.renderers[token.type].call({ parser: this }, token);\n          if (ret !== false || ![\"space\", \"hr\", \"heading\", \"code\", \"table\", \"blockquote\", \"list\", \"html\", \"paragraph\", \"text\"].includes(token.type)) {\n            out += ret || \"\";\n            continue;\n          }\n        }\n        switch (token.type) {\n          case \"space\": {\n            continue;\n          }\n          case \"hr\": {\n            out += this.renderer.hr();\n            continue;\n          }\n          case \"heading\": {\n            out += this.renderer.heading(\n              this.parseInline(token.tokens),\n              token.depth,\n              unescape$1(this.parseInline(token.tokens, this.textRenderer)),\n              this.slugger\n            );\n            continue;\n          }\n          case \"code\": {\n            out += this.renderer.code(\n              token.text,\n              token.lang,\n              token.escaped\n            );\n            continue;\n          }\n          case \"table\": {\n            header2 = \"\";\n            cell = \"\";\n            l2 = token.header.length;\n            for (j = 0; j < l2; j++) {\n              cell += this.renderer.tablecell(\n                this.parseInline(token.header[j].tokens),\n                { header: true, align: token.align[j] }\n              );\n            }\n            header2 += this.renderer.tablerow(cell);\n            body = \"\";\n            l2 = token.rows.length;\n            for (j = 0; j < l2; j++) {\n              row = token.rows[j];\n              cell = \"\";\n              l3 = row.length;\n              for (k = 0; k < l3; k++) {\n                cell += this.renderer.tablecell(\n                  this.parseInline(row[k].tokens),\n                  { header: false, align: token.align[k] }\n                );\n              }\n              body += this.renderer.tablerow(cell);\n            }\n            out += this.renderer.table(header2, body);\n            continue;\n          }\n          case \"blockquote\": {\n            body = this.parse(token.tokens);\n            out += this.renderer.blockquote(body);\n            continue;\n          }\n          case \"list\": {\n            ordered = token.ordered;\n            start2 = token.start;\n            loose = token.loose;\n            l2 = token.items.length;\n            body = \"\";\n            for (j = 0; j < l2; j++) {\n              item = token.items[j];\n              checked = item.checked;\n              task = item.task;\n              itemBody = \"\";\n              if (item.task) {\n                checkbox = this.renderer.checkbox(checked);\n                if (loose) {\n                  if (item.tokens.length > 0 && item.tokens[0].type === \"paragraph\") {\n                    item.tokens[0].text = checkbox + \" \" + item.tokens[0].text;\n                    if (item.tokens[0].tokens && item.tokens[0].tokens.length > 0 && item.tokens[0].tokens[0].type === \"text\") {\n                      item.tokens[0].tokens[0].text = checkbox + \" \" + item.tokens[0].tokens[0].text;\n                    }\n                  } else {\n                    item.tokens.unshift({\n                      type: \"text\",\n                      text: checkbox\n                    });\n                  }\n                } else {\n                  itemBody += checkbox;\n                }\n              }\n              itemBody += this.parse(item.tokens, loose);\n              body += this.renderer.listitem(itemBody, task, checked);\n            }\n            out += this.renderer.list(body, ordered, start2);\n            continue;\n          }\n          case \"html\": {\n            out += this.renderer.html(token.text);\n            continue;\n          }\n          case \"paragraph\": {\n            out += this.renderer.paragraph(this.parseInline(token.tokens));\n            continue;\n          }\n          case \"text\": {\n            body = token.tokens ? this.parseInline(token.tokens) : token.text;\n            while (i + 1 < l && tokens[i + 1].type === \"text\") {\n              token = tokens[++i];\n              body += \"\\n\" + (token.tokens ? this.parseInline(token.tokens) : token.text);\n            }\n            out += top2 ? this.renderer.paragraph(body) : body;\n            continue;\n          }\n          default: {\n            const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n            if (this.options.silent) {\n              console.error(errMsg);\n              return;\n            } else {\n              throw new Error(errMsg);\n            }\n          }\n        }\n      }\n      return out;\n    }\n    parseInline(tokens, renderer) {\n      renderer = renderer || this.renderer;\n      let out = \"\", i, token, ret;\n      const l = tokens.length;\n      for (i = 0; i < l; i++) {\n        token = tokens[i];\n        if (this.options.extensions && this.options.extensions.renderers && this.options.extensions.renderers[token.type]) {\n          ret = this.options.extensions.renderers[token.type].call({ parser: this }, token);\n          if (ret !== false || ![\"escape\", \"html\", \"link\", \"image\", \"strong\", \"em\", \"codespan\", \"br\", \"del\", \"text\"].includes(token.type)) {\n            out += ret || \"\";\n            continue;\n          }\n        }\n        switch (token.type) {\n          case \"escape\": {\n            out += renderer.text(token.text);\n            break;\n          }\n          case \"html\": {\n            out += renderer.html(token.text);\n            break;\n          }\n          case \"link\": {\n            out += renderer.link(token.href, token.title, this.parseInline(token.tokens, renderer));\n            break;\n          }\n          case \"image\": {\n            out += renderer.image(token.href, token.title, token.text);\n            break;\n          }\n          case \"strong\": {\n            out += renderer.strong(this.parseInline(token.tokens, renderer));\n            break;\n          }\n          case \"em\": {\n            out += renderer.em(this.parseInline(token.tokens, renderer));\n            break;\n          }\n          case \"codespan\": {\n            out += renderer.codespan(token.text);\n            break;\n          }\n          case \"br\": {\n            out += renderer.br();\n            break;\n          }\n          case \"del\": {\n            out += renderer.del(this.parseInline(token.tokens, renderer));\n            break;\n          }\n          case \"text\": {\n            out += renderer.text(token.text);\n            break;\n          }\n          default: {\n            const errMsg = 'Token with \"' + token.type + '\" type was not found.';\n            if (this.options.silent) {\n              console.error(errMsg);\n              return;\n            } else {\n              throw new Error(errMsg);\n            }\n          }\n        }\n      }\n      return out;\n    }\n  }\n  class Hooks {\n    constructor(options) {\n      this.options = options || defaults;\n    }\n    preprocess(markdown2) {\n      return markdown2;\n    }\n    postprocess(html) {\n      return html;\n    }\n  }\n  __publicField(Hooks, \"passThroughHooks\", /* @__PURE__ */ new Set([\n    \"preprocess\",\n    \"postprocess\"\n  ]));\n  function onError(silent, async, callback) {\n    return (e) => {\n      e.message += \"\\nPlease report this to https://github.com/markedjs/marked.\";\n      if (silent) {\n        const msg = \"<p>An error occurred:</p><pre>\" + escape$1(e.message + \"\", true) + \"</pre>\";\n        if (async) {\n          return Promise.resolve(msg);\n        }\n        if (callback) {\n          callback(null, msg);\n          return;\n        }\n        return msg;\n      }\n      if (async) {\n        return Promise.reject(e);\n      }\n      if (callback) {\n        callback(e);\n        return;\n      }\n      throw e;\n    };\n  }\n  function parseMarkdown(lexer, parser) {\n    return (src2, opt, callback) => {\n      if (typeof opt === \"function\") {\n        callback = opt;\n        opt = null;\n      }\n      const origOpt = { ...opt };\n      opt = { ...marked.defaults, ...origOpt };\n      const throwError = onError(opt.silent, opt.async, callback);\n      if (typeof src2 === \"undefined\" || src2 === null) {\n        return throwError(new Error(\"marked(): input parameter is undefined or null\"));\n      }\n      if (typeof src2 !== \"string\") {\n        return throwError(new Error(\"marked(): input parameter is of type \" + Object.prototype.toString.call(src2) + \", string expected\"));\n      }\n      checkSanitizeDeprecation(opt);\n      if (opt.hooks) {\n        opt.hooks.options = opt;\n      }\n      if (callback) {\n        const highlight = opt.highlight;\n        let tokens;\n        try {\n          if (opt.hooks) {\n            src2 = opt.hooks.preprocess(src2);\n          }\n          tokens = lexer(src2, opt);\n        } catch (e) {\n          return throwError(e);\n        }\n        const done = function(err) {\n          let out;\n          if (!err) {\n            try {\n              if (opt.walkTokens) {\n                marked.walkTokens(tokens, opt.walkTokens);\n              }\n              out = parser(tokens, opt);\n              if (opt.hooks) {\n                out = opt.hooks.postprocess(out);\n              }\n            } catch (e) {\n              err = e;\n            }\n          }\n          opt.highlight = highlight;\n          return err ? throwError(err) : callback(null, out);\n        };\n        if (!highlight || highlight.length < 3) {\n          return done();\n        }\n        delete opt.highlight;\n        if (!tokens.length)\n          return done();\n        let pending = 0;\n        marked.walkTokens(tokens, function(token) {\n          if (token.type === \"code\") {\n            pending++;\n            setTimeout(() => {\n              highlight(token.text, token.lang, function(err, code) {\n                if (err) {\n                  return done(err);\n                }\n                if (code != null && code !== token.text) {\n                  token.text = code;\n                  token.escaped = true;\n                }\n                pending--;\n                if (pending === 0) {\n                  done();\n                }\n              });\n            }, 0);\n          }\n        });\n        if (pending === 0) {\n          done();\n        }\n        return;\n      }\n      if (opt.async) {\n        return Promise.resolve(opt.hooks ? opt.hooks.preprocess(src2) : src2).then((src3) => lexer(src3, opt)).then((tokens) => opt.walkTokens ? Promise.all(marked.walkTokens(tokens, opt.walkTokens)).then(() => tokens) : tokens).then((tokens) => parser(tokens, opt)).then((html) => opt.hooks ? opt.hooks.postprocess(html) : html).catch(throwError);\n      }\n      try {\n        if (opt.hooks) {\n          src2 = opt.hooks.preprocess(src2);\n        }\n        const tokens = lexer(src2, opt);\n        if (opt.walkTokens) {\n          marked.walkTokens(tokens, opt.walkTokens);\n        }\n        let html = parser(tokens, opt);\n        if (opt.hooks) {\n          html = opt.hooks.postprocess(html);\n        }\n        return html;\n      } catch (e) {\n        return throwError(e);\n      }\n    };\n  }\n  function marked(src2, opt, callback) {\n    return parseMarkdown(Lexer.lex, Parser.parse)(src2, opt, callback);\n  }\n  marked.options = marked.setOptions = function(opt) {\n    marked.defaults = { ...marked.defaults, ...opt };\n    changeDefaults(marked.defaults);\n    return marked;\n  };\n  marked.getDefaults = getDefaults;\n  marked.defaults = defaults;\n  marked.use = function(...args) {\n    const extensions = marked.defaults.extensions || { renderers: {}, childTokens: {} };\n    args.forEach((pack) => {\n      const opts = { ...pack };\n      opts.async = marked.defaults.async || opts.async || false;\n      if (pack.extensions) {\n        pack.extensions.forEach((ext) => {\n          if (!ext.name) {\n            throw new Error(\"extension name required\");\n          }\n          if (ext.renderer) {\n            const prevRenderer = extensions.renderers[ext.name];\n            if (prevRenderer) {\n              extensions.renderers[ext.name] = function(...args2) {\n                let ret = ext.renderer.apply(this, args2);\n                if (ret === false) {\n                  ret = prevRenderer.apply(this, args2);\n                }\n                return ret;\n              };\n            } else {\n              extensions.renderers[ext.name] = ext.renderer;\n            }\n          }\n          if (ext.tokenizer) {\n            if (!ext.level || ext.level !== \"block\" && ext.level !== \"inline\") {\n              throw new Error(\"extension level must be 'block' or 'inline'\");\n            }\n            if (extensions[ext.level]) {\n              extensions[ext.level].unshift(ext.tokenizer);\n            } else {\n              extensions[ext.level] = [ext.tokenizer];\n            }\n            if (ext.start) {\n              if (ext.level === \"block\") {\n                if (extensions.startBlock) {\n                  extensions.startBlock.push(ext.start);\n                } else {\n                  extensions.startBlock = [ext.start];\n                }\n              } else if (ext.level === \"inline\") {\n                if (extensions.startInline) {\n                  extensions.startInline.push(ext.start);\n                } else {\n                  extensions.startInline = [ext.start];\n                }\n              }\n            }\n          }\n          if (ext.childTokens) {\n            extensions.childTokens[ext.name] = ext.childTokens;\n          }\n        });\n        opts.extensions = extensions;\n      }\n      if (pack.renderer) {\n        const renderer = marked.defaults.renderer || new Renderer();\n        for (const prop in pack.renderer) {\n          const prevRenderer = renderer[prop];\n          renderer[prop] = (...args2) => {\n            let ret = pack.renderer[prop].apply(renderer, args2);\n            if (ret === false) {\n              ret = prevRenderer.apply(renderer, args2);\n            }\n            return ret;\n          };\n        }\n        opts.renderer = renderer;\n      }\n      if (pack.tokenizer) {\n        const tokenizer = marked.defaults.tokenizer || new Tokenizer();\n        for (const prop in pack.tokenizer) {\n          const prevTokenizer = tokenizer[prop];\n          tokenizer[prop] = (...args2) => {\n            let ret = pack.tokenizer[prop].apply(tokenizer, args2);\n            if (ret === false) {\n              ret = prevTokenizer.apply(tokenizer, args2);\n            }\n            return ret;\n          };\n        }\n        opts.tokenizer = tokenizer;\n      }\n      if (pack.hooks) {\n        const hooks = marked.defaults.hooks || new Hooks();\n        for (const prop in pack.hooks) {\n          const prevHook = hooks[prop];\n          if (Hooks.passThroughHooks.has(prop)) {\n            hooks[prop] = (arg) => {\n              if (marked.defaults.async) {\n                return Promise.resolve(pack.hooks[prop].call(hooks, arg)).then((ret2) => {\n                  return prevHook.call(hooks, ret2);\n                });\n              }\n              const ret = pack.hooks[prop].call(hooks, arg);\n              return prevHook.call(hooks, ret);\n            };\n          } else {\n            hooks[prop] = (...args2) => {\n              let ret = pack.hooks[prop].apply(hooks, args2);\n              if (ret === false) {\n                ret = prevHook.apply(hooks, args2);\n              }\n              return ret;\n            };\n          }\n        }\n        opts.hooks = hooks;\n      }\n      if (pack.walkTokens) {\n        const walkTokens = marked.defaults.walkTokens;\n        opts.walkTokens = function(token) {\n          let values = [];\n          values.push(pack.walkTokens.call(this, token));\n          if (walkTokens) {\n            values = values.concat(walkTokens.call(this, token));\n          }\n          return values;\n        };\n      }\n      marked.setOptions(opts);\n    });\n  };\n  marked.walkTokens = function(tokens, callback) {\n    let values = [];\n    for (const token of tokens) {\n      values = values.concat(callback.call(marked, token));\n      switch (token.type) {\n        case \"table\": {\n          for (const cell of token.header) {\n            values = values.concat(marked.walkTokens(cell.tokens, callback));\n          }\n          for (const row of token.rows) {\n            for (const cell of row) {\n              values = values.concat(marked.walkTokens(cell.tokens, callback));\n            }\n          }\n          break;\n        }\n        case \"list\": {\n          values = values.concat(marked.walkTokens(token.items, callback));\n          break;\n        }\n        default: {\n          if (marked.defaults.extensions && marked.defaults.extensions.childTokens && marked.defaults.extensions.childTokens[token.type]) {\n            marked.defaults.extensions.childTokens[token.type].forEach(function(childTokens) {\n              values = values.concat(marked.walkTokens(token[childTokens], callback));\n            });\n          } else if (token.tokens) {\n            values = values.concat(marked.walkTokens(token.tokens, callback));\n          }\n        }\n      }\n    }\n    return values;\n  };\n  marked.parseInline = parseMarkdown(Lexer.lexInline, Parser.parseInline);\n  marked.Parser = Parser;\n  marked.parser = Parser.parse;\n  marked.Renderer = Renderer;\n  marked.TextRenderer = TextRenderer;\n  marked.Lexer = Lexer;\n  marked.lexer = Lexer.lex;\n  marked.Tokenizer = Tokenizer;\n  marked.Slugger = Slugger;\n  marked.Hooks = Hooks;\n  marked.parse = marked;\n  marked.options;\n  marked.setOptions;\n  marked.use;\n  marked.walkTokens;\n  marked.parseInline;\n  Parser.parse;\n  Lexer.lex;\n  function markdown(md) {\n    return marked.parse(md);\n  }\n  const debug$1 = typeof process === \"object\" && process.env && {}.NODE_DEBUG && /\\bsemver\\b/i.test({}.NODE_DEBUG) ? (...args) => console.error(\"SEMVER\", ...args) : () => {\n  };\n  var debug_1 = debug$1;\n  const SEMVER_SPEC_VERSION = \"2.0.0\";\n  const MAX_LENGTH$1 = 256;\n  const MAX_SAFE_INTEGER$1 = Number.MAX_SAFE_INTEGER || 9007199254740991;\n  const MAX_SAFE_COMPONENT_LENGTH = 16;\n  const MAX_SAFE_BUILD_LENGTH = MAX_LENGTH$1 - 6;\n  const RELEASE_TYPES = [\n    \"major\",\n    \"premajor\",\n    \"minor\",\n    \"preminor\",\n    \"patch\",\n    \"prepatch\",\n    \"prerelease\"\n  ];\n  var constants = {\n    MAX_LENGTH: MAX_LENGTH$1,\n    MAX_SAFE_COMPONENT_LENGTH,\n    MAX_SAFE_BUILD_LENGTH,\n    MAX_SAFE_INTEGER: MAX_SAFE_INTEGER$1,\n    RELEASE_TYPES,\n    SEMVER_SPEC_VERSION,\n    FLAG_INCLUDE_PRERELEASE: 1,\n    FLAG_LOOSE: 2\n  };\n  var re$1 = { exports: {} };\n  (function(module2, exports3) {\n    const {\n      MAX_SAFE_COMPONENT_LENGTH: MAX_SAFE_COMPONENT_LENGTH2,\n      MAX_SAFE_BUILD_LENGTH: MAX_SAFE_BUILD_LENGTH2,\n      MAX_LENGTH: MAX_LENGTH2\n    } = constants;\n    const debug2 = debug_1;\n    exports3 = module2.exports = {};\n    const re2 = exports3.re = [];\n    const safeRe = exports3.safeRe = [];\n    const src2 = exports3.src = [];\n    const safeSrc = exports3.safeSrc = [];\n    const t2 = exports3.t = {};\n    let R2 = 0;\n    const LETTERDASHNUMBER = \"[a-zA-Z0-9-]\";\n    const safeRegexReplacements = [\n      [\"\\\\s\", 1],\n      [\"\\\\d\", MAX_LENGTH2],\n      [LETTERDASHNUMBER, MAX_SAFE_BUILD_LENGTH2]\n    ];\n    const makeSafeRegex = (value) => {\n      for (const [token, max] of safeRegexReplacements) {\n        value = value.split(`${token}*`).join(`${token}{0,${max}}`).split(`${token}+`).join(`${token}{1,${max}}`);\n      }\n      return value;\n    };\n    const createToken = (name, value, isGlobal) => {\n      const safe = makeSafeRegex(value);\n      const index = R2++;\n      debug2(name, index, value);\n      t2[name] = index;\n      src2[index] = value;\n      safeSrc[index] = safe;\n      re2[index] = new RegExp(value, isGlobal ? \"g\" : void 0);\n      safeRe[index] = new RegExp(safe, isGlobal ? \"g\" : void 0);\n    };\n    createToken(\"NUMERICIDENTIFIER\", \"0|[1-9]\\\\d*\");\n    createToken(\"NUMERICIDENTIFIERLOOSE\", \"\\\\d+\");\n    createToken(\"NONNUMERICIDENTIFIER\", `\\\\d*[a-zA-Z-]${LETTERDASHNUMBER}*`);\n    createToken(\"MAINVERSION\", `(${src2[t2.NUMERICIDENTIFIER]})\\\\.(${src2[t2.NUMERICIDENTIFIER]})\\\\.(${src2[t2.NUMERICIDENTIFIER]})`);\n    createToken(\"MAINVERSIONLOOSE\", `(${src2[t2.NUMERICIDENTIFIERLOOSE]})\\\\.(${src2[t2.NUMERICIDENTIFIERLOOSE]})\\\\.(${src2[t2.NUMERICIDENTIFIERLOOSE]})`);\n    createToken(\"PRERELEASEIDENTIFIER\", `(?:${src2[t2.NONNUMERICIDENTIFIER]}|${src2[t2.NUMERICIDENTIFIER]})`);\n    createToken(\"PRERELEASEIDENTIFIERLOOSE\", `(?:${src2[t2.NONNUMERICIDENTIFIER]}|${src2[t2.NUMERICIDENTIFIERLOOSE]})`);\n    createToken(\"PRERELEASE\", `(?:-(${src2[t2.PRERELEASEIDENTIFIER]}(?:\\\\.${src2[t2.PRERELEASEIDENTIFIER]})*))`);\n    createToken(\"PRERELEASELOOSE\", `(?:-?(${src2[t2.PRERELEASEIDENTIFIERLOOSE]}(?:\\\\.${src2[t2.PRERELEASEIDENTIFIERLOOSE]})*))`);\n    createToken(\"BUILDIDENTIFIER\", `${LETTERDASHNUMBER}+`);\n    createToken(\"BUILD\", `(?:\\\\+(${src2[t2.BUILDIDENTIFIER]}(?:\\\\.${src2[t2.BUILDIDENTIFIER]})*))`);\n    createToken(\"FULLPLAIN\", `v?${src2[t2.MAINVERSION]}${src2[t2.PRERELEASE]}?${src2[t2.BUILD]}?`);\n    createToken(\"FULL\", `^${src2[t2.FULLPLAIN]}$`);\n    createToken(\"LOOSEPLAIN\", `[v=\\\\s]*${src2[t2.MAINVERSIONLOOSE]}${src2[t2.PRERELEASELOOSE]}?${src2[t2.BUILD]}?`);\n    createToken(\"LOOSE\", `^${src2[t2.LOOSEPLAIN]}$`);\n    createToken(\"GTLT\", \"((?:<|>)?=?)\");\n    createToken(\"XRANGEIDENTIFIERLOOSE\", `${src2[t2.NUMERICIDENTIFIERLOOSE]}|x|X|\\\\*`);\n    createToken(\"XRANGEIDENTIFIER\", `${src2[t2.NUMERICIDENTIFIER]}|x|X|\\\\*`);\n    createToken(\"XRANGEPLAIN\", `[v=\\\\s]*(${src2[t2.XRANGEIDENTIFIER]})(?:\\\\.(${src2[t2.XRANGEIDENTIFIER]})(?:\\\\.(${src2[t2.XRANGEIDENTIFIER]})(?:${src2[t2.PRERELEASE]})?${src2[t2.BUILD]}?)?)?`);\n    createToken(\"XRANGEPLAINLOOSE\", `[v=\\\\s]*(${src2[t2.XRANGEIDENTIFIERLOOSE]})(?:\\\\.(${src2[t2.XRANGEIDENTIFIERLOOSE]})(?:\\\\.(${src2[t2.XRANGEIDENTIFIERLOOSE]})(?:${src2[t2.PRERELEASELOOSE]})?${src2[t2.BUILD]}?)?)?`);\n    createToken(\"XRANGE\", `^${src2[t2.GTLT]}\\\\s*${src2[t2.XRANGEPLAIN]}$`);\n    createToken(\"XRANGELOOSE\", `^${src2[t2.GTLT]}\\\\s*${src2[t2.XRANGEPLAINLOOSE]}$`);\n    createToken(\"COERCEPLAIN\", `${\"(^|[^\\\\d])(\\\\d{1,\"}${MAX_SAFE_COMPONENT_LENGTH2}})(?:\\\\.(\\\\d{1,${MAX_SAFE_COMPONENT_LENGTH2}}))?(?:\\\\.(\\\\d{1,${MAX_SAFE_COMPONENT_LENGTH2}}))?`);\n    createToken(\"COERCE\", `${src2[t2.COERCEPLAIN]}(?:$|[^\\\\d])`);\n    createToken(\"COERCEFULL\", src2[t2.COERCEPLAIN] + `(?:${src2[t2.PRERELEASE]})?(?:${src2[t2.BUILD]})?(?:$|[^\\\\d])`);\n    createToken(\"COERCERTL\", src2[t2.COERCE], true);\n    createToken(\"COERCERTLFULL\", src2[t2.COERCEFULL], true);\n    createToken(\"LONETILDE\", \"(?:~>?)\");\n    createToken(\"TILDETRIM\", `(\\\\s*)${src2[t2.LONETILDE]}\\\\s+`, true);\n    exports3.tildeTrimReplace = \"$1~\";\n    createToken(\"TILDE\", `^${src2[t2.LONETILDE]}${src2[t2.XRANGEPLAIN]}$`);\n    createToken(\"TILDELOOSE\", `^${src2[t2.LONETILDE]}${src2[t2.XRANGEPLAINLOOSE]}$`);\n    createToken(\"LONECARET\", \"(?:\\\\^)\");\n    createToken(\"CARETTRIM\", `(\\\\s*)${src2[t2.LONECARET]}\\\\s+`, true);\n    exports3.caretTrimReplace = \"$1^\";\n    createToken(\"CARET\", `^${src2[t2.LONECARET]}${src2[t2.XRANGEPLAIN]}$`);\n    createToken(\"CARETLOOSE\", `^${src2[t2.LONECARET]}${src2[t2.XRANGEPLAINLOOSE]}$`);\n    createToken(\"COMPARATORLOOSE\", `^${src2[t2.GTLT]}\\\\s*(${src2[t2.LOOSEPLAIN]})$|^$`);\n    createToken(\"COMPARATOR\", `^${src2[t2.GTLT]}\\\\s*(${src2[t2.FULLPLAIN]})$|^$`);\n    createToken(\"COMPARATORTRIM\", `(\\\\s*)${src2[t2.GTLT]}\\\\s*(${src2[t2.LOOSEPLAIN]}|${src2[t2.XRANGEPLAIN]})`, true);\n    exports3.comparatorTrimReplace = \"$1$2$3\";\n    createToken(\"HYPHENRANGE\", `^\\\\s*(${src2[t2.XRANGEPLAIN]})\\\\s+-\\\\s+(${src2[t2.XRANGEPLAIN]})\\\\s*$`);\n    createToken(\"HYPHENRANGELOOSE\", `^\\\\s*(${src2[t2.XRANGEPLAINLOOSE]})\\\\s+-\\\\s+(${src2[t2.XRANGEPLAINLOOSE]})\\\\s*$`);\n    createToken(\"STAR\", \"(<|>)?=?\\\\s*\\\\*\");\n    createToken(\"GTE0\", \"^\\\\s*>=\\\\s*0\\\\.0\\\\.0\\\\s*$\");\n    createToken(\"GTE0PRE\", \"^\\\\s*>=\\\\s*0\\\\.0\\\\.0-0\\\\s*$\");\n  })(re$1, re$1.exports);\n  const looseOption = Object.freeze({ loose: true });\n  const emptyOpts = Object.freeze({});\n  const parseOptions$1 = (options) => {\n    if (!options) {\n      return emptyOpts;\n    }\n    if (typeof options !== \"object\") {\n      return looseOption;\n    }\n    return options;\n  };\n  var parseOptions_1 = parseOptions$1;\n  const numeric = /^[0-9]+$/;\n  const compareIdentifiers$1 = (a, b) => {\n    if (typeof a === \"number\" && typeof b === \"number\") {\n      return a === b ? 0 : a < b ? -1 : 1;\n    }\n    const anum = numeric.test(a);\n    const bnum = numeric.test(b);\n    if (anum && bnum) {\n      a = +a;\n      b = +b;\n    }\n    return a === b ? 0 : anum && !bnum ? -1 : bnum && !anum ? 1 : a < b ? -1 : 1;\n  };\n  const rcompareIdentifiers = (a, b) => compareIdentifiers$1(b, a);\n  var identifiers = {\n    compareIdentifiers: compareIdentifiers$1,\n    rcompareIdentifiers\n  };\n  const debug = debug_1;\n  const { MAX_LENGTH, MAX_SAFE_INTEGER } = constants;\n  const { safeRe: re, t } = re$1.exports;\n  const parseOptions = parseOptions_1;\n  const { compareIdentifiers } = identifiers;\n  class SemVer$2 {\n    constructor(version, options) {\n      options = parseOptions(options);\n      if (version instanceof SemVer$2) {\n        if (version.loose === !!options.loose && version.includePrerelease === !!options.includePrerelease) {\n          return version;\n        } else {\n          version = version.version;\n        }\n      } else if (typeof version !== \"string\") {\n        throw new TypeError(`Invalid version. Must be a string. Got type \"${typeof version}\".`);\n      }\n      if (version.length > MAX_LENGTH) {\n        throw new TypeError(\n          `version is longer than ${MAX_LENGTH} characters`\n        );\n      }\n      debug(\"SemVer\", version, options);\n      this.options = options;\n      this.loose = !!options.loose;\n      this.includePrerelease = !!options.includePrerelease;\n      const m = version.trim().match(options.loose ? re[t.LOOSE] : re[t.FULL]);\n      if (!m) {\n        throw new TypeError(`Invalid Version: ${version}`);\n      }\n      this.raw = version;\n      this.major = +m[1];\n      this.minor = +m[2];\n      this.patch = +m[3];\n      if (this.major > MAX_SAFE_INTEGER || this.major < 0) {\n        throw new TypeError(\"Invalid major version\");\n      }\n      if (this.minor > MAX_SAFE_INTEGER || this.minor < 0) {\n        throw new TypeError(\"Invalid minor version\");\n      }\n      if (this.patch > MAX_SAFE_INTEGER || this.patch < 0) {\n        throw new TypeError(\"Invalid patch version\");\n      }\n      if (!m[4]) {\n        this.prerelease = [];\n      } else {\n        this.prerelease = m[4].split(\".\").map((id) => {\n          if (/^[0-9]+$/.test(id)) {\n            const num = +id;\n            if (num >= 0 && num < MAX_SAFE_INTEGER) {\n              return num;\n            }\n          }\n          return id;\n        });\n      }\n      this.build = m[5] ? m[5].split(\".\") : [];\n      this.format();\n    }\n    format() {\n      this.version = `${this.major}.${this.minor}.${this.patch}`;\n      if (this.prerelease.length) {\n        this.version += `-${this.prerelease.join(\".\")}`;\n      }\n      return this.version;\n    }\n    toString() {\n      return this.version;\n    }\n    compare(other) {\n      debug(\"SemVer.compare\", this.version, this.options, other);\n      if (!(other instanceof SemVer$2)) {\n        if (typeof other === \"string\" && other === this.version) {\n          return 0;\n        }\n        other = new SemVer$2(other, this.options);\n      }\n      if (other.version === this.version) {\n        return 0;\n      }\n      return this.compareMain(other) || this.comparePre(other);\n    }\n    compareMain(other) {\n      if (!(other instanceof SemVer$2)) {\n        other = new SemVer$2(other, this.options);\n      }\n      if (this.major < other.major) {\n        return -1;\n      }\n      if (this.major > other.major) {\n        return 1;\n      }\n      if (this.minor < other.minor) {\n        return -1;\n      }\n      if (this.minor > other.minor) {\n        return 1;\n      }\n      if (this.patch < other.patch) {\n        return -1;\n      }\n      if (this.patch > other.patch) {\n        return 1;\n      }\n      return 0;\n    }\n    comparePre(other) {\n      if (!(other instanceof SemVer$2)) {\n        other = new SemVer$2(other, this.options);\n      }\n      if (this.prerelease.length && !other.prerelease.length) {\n        return -1;\n      } else if (!this.prerelease.length && other.prerelease.length) {\n        return 1;\n      } else if (!this.prerelease.length && !other.prerelease.length) {\n        return 0;\n      }\n      let i = 0;\n      do {\n        const a = this.prerelease[i];\n        const b = other.prerelease[i];\n        debug(\"prerelease compare\", i, a, b);\n        if (a === void 0 && b === void 0) {\n          return 0;\n        } else if (b === void 0) {\n          return 1;\n        } else if (a === void 0) {\n          return -1;\n        } else if (a === b) {\n          continue;\n        } else {\n          return compareIdentifiers(a, b);\n        }\n      } while (++i);\n    }\n    compareBuild(other) {\n      if (!(other instanceof SemVer$2)) {\n        other = new SemVer$2(other, this.options);\n      }\n      let i = 0;\n      do {\n        const a = this.build[i];\n        const b = other.build[i];\n        debug(\"build compare\", i, a, b);\n        if (a === void 0 && b === void 0) {\n          return 0;\n        } else if (b === void 0) {\n          return 1;\n        } else if (a === void 0) {\n          return -1;\n        } else if (a === b) {\n          continue;\n        } else {\n          return compareIdentifiers(a, b);\n        }\n      } while (++i);\n    }\n    inc(release, identifier, identifierBase) {\n      if (release.startsWith(\"pre\")) {\n        if (!identifier && identifierBase === false) {\n          throw new Error(\"invalid increment argument: identifier is empty\");\n        }\n        if (identifier) {\n          const match = `-${identifier}`.match(this.options.loose ? re[t.PRERELEASELOOSE] : re[t.PRERELEASE]);\n          if (!match || match[1] !== identifier) {\n            throw new Error(`invalid identifier: ${identifier}`);\n          }\n        }\n      }\n      switch (release) {\n        case \"premajor\":\n          this.prerelease.length = 0;\n          this.patch = 0;\n          this.minor = 0;\n          this.major++;\n          this.inc(\"pre\", identifier, identifierBase);\n          break;\n        case \"preminor\":\n          this.prerelease.length = 0;\n          this.patch = 0;\n          this.minor++;\n          this.inc(\"pre\", identifier, identifierBase);\n          break;\n        case \"prepatch\":\n          this.prerelease.length = 0;\n          this.inc(\"patch\", identifier, identifierBase);\n          this.inc(\"pre\", identifier, identifierBase);\n          break;\n        case \"prerelease\":\n          if (this.prerelease.length === 0) {\n            this.inc(\"patch\", identifier, identifierBase);\n          }\n          this.inc(\"pre\", identifier, identifierBase);\n          break;\n        case \"release\":\n          if (this.prerelease.length === 0) {\n            throw new Error(`version ${this.raw} is not a prerelease`);\n          }\n          this.prerelease.length = 0;\n          break;\n        case \"major\":\n          if (this.minor !== 0 || this.patch !== 0 || this.prerelease.length === 0) {\n            this.major++;\n          }\n          this.minor = 0;\n          this.patch = 0;\n          this.prerelease = [];\n          break;\n        case \"minor\":\n          if (this.patch !== 0 || this.prerelease.length === 0) {\n            this.minor++;\n          }\n          this.patch = 0;\n          this.prerelease = [];\n          break;\n        case \"patch\":\n          if (this.prerelease.length === 0) {\n            this.patch++;\n          }\n          this.prerelease = [];\n          break;\n        case \"pre\": {\n          const base = Number(identifierBase) ? 1 : 0;\n          if (this.prerelease.length === 0) {\n            this.prerelease = [base];\n          } else {\n            let i = this.prerelease.length;\n            while (--i >= 0) {\n              if (typeof this.prerelease[i] === \"number\") {\n                this.prerelease[i]++;\n                i = -2;\n              }\n            }\n            if (i === -1) {\n              if (identifier === this.prerelease.join(\".\") && identifierBase === false) {\n                throw new Error(\"invalid increment argument: identifier already exists\");\n              }\n              this.prerelease.push(base);\n            }\n          }\n          if (identifier) {\n            let prerelease = [identifier, base];\n            if (identifierBase === false) {\n              prerelease = [identifier];\n            }\n            if (compareIdentifiers(this.prerelease[0], identifier) === 0) {\n              if (isNaN(this.prerelease[1])) {\n                this.prerelease = prerelease;\n              }\n            } else {\n              this.prerelease = prerelease;\n            }\n          }\n          break;\n        }\n        default:\n          throw new Error(`invalid increment argument: ${release}`);\n      }\n      this.raw = this.format();\n      if (this.build.length) {\n        this.raw += `+${this.build.join(\".\")}`;\n      }\n      return this;\n    }\n  }\n  var semver = SemVer$2;\n  const SemVer$1 = semver;\n  const compare$1 = (a, b, loose) => new SemVer$1(a, loose).compare(new SemVer$1(b, loose));\n  var compare_1 = compare$1;\n  const compare = compare_1;\n  const gt = (a, b, loose) => compare(a, b, loose) > 0;\n  var gt_1 = gt;\n  const SemVer = semver;\n  const parse$1 = (version, options, throwErrors = false) => {\n    if (version instanceof SemVer) {\n      return version;\n    }\n    try {\n      return new SemVer(version, options);\n    } catch (er) {\n      if (!throwErrors) {\n        return null;\n      }\n      throw er;\n    }\n  };\n  var parse_1 = parse$1;\n  const parse = parse_1;\n  const valid = (version, options) => {\n    const v = parse(version, options);\n    return v ? v.version : null;\n  };\n  var valid_1 = valid;\n  const RenderScript = lib.createRenderScript({\n    name: \"🖼️ 窗口设置\"\n  });\n  const transformImgLinkOfQuestion = (question) => {\n    const dom2 = new DOMParser().parseFromString(question, \"text/html\");\n    for (const img of Array.from(dom2.querySelectorAll(\"img\"))) {\n      img.replaceWith(img.src);\n    }\n    return dom2.documentElement.innerHTML.replace(/https?:\\/\\/.+?\\.(png|jpg|jpeg|gif)/g, (img) => {\n      return `<img src=\"${img}\" />`;\n    });\n  };\n  class SearchInfosElement extends HTMLElement {\n    constructor() {\n      super(...arguments);\n      this.infos = [];\n      this.question = \"\";\n    }\n    connectedCallback() {\n      const question = transformImgLinkOfQuestion(this.question || \"无\");\n      const type_text = {\n        single: \"单选题\",\n        multiple: \"多选题\",\n        judgement: \"判断题\",\n        completion: \"填空题\"\n      };\n      const type_label = this.type ? Reflect.get(type_text, this.type) : \"\";\n      this.append(\n        lib.h(\n          \"div\",\n          [\n            ...type_label ? [lib.h(\"span\", { className: \"search-result-question-type\" }, type_label)] : [],\n            lib.h(\"span\", { innerHTML: question }),\n            createQuestionTitleExtra(this.question)\n          ],\n          (div) => {\n            div.className = \"search-info-title\";\n          }\n        )\n      );\n      this.append(\n        ...this.infos.map((info) => {\n          return lib.h(\"details\", { open: true, className: \"search-info-details\" }, [\n            lib.h(\"summary\", [lib.h(\"a\", { href: info.homepage, innerText: info.name, target: \"_blank\" })]),\n            ...(info.error ? [lib.h(\"span\", { className: \"error\" }, [info.error || \"网络错误或者未知错误\"])] : []).concat([\n              ...info.results.map((ans) => {\n                const title = transformImgLinkOfQuestion(ans[0] || this.question || \"无\");\n                const answer = transformImgLinkOfQuestion(ans[1] || \"无\");\n                const extra_data = JSON.parse(JSON.stringify(ans[2] || {}));\n                if (extra_data.ai) {\n                  extra_data.tags = extra_data.tags || [];\n                  extra_data.tags.push({\n                    text: \"AI\",\n                    title: \"此答案由 AI 生成，仅供参考\",\n                    color: \"blue\"\n                  });\n                }\n                if (extra_data.cache) {\n                  extra_data.tags = extra_data.tags || [];\n                  extra_data.tags.push({\n                    text: \"题库缓存\",\n                    title: \"此答案来自本地缓存，由在线题库搜索后保存在本地。\\n- 清空缓存：请前往通用-拓展应用-题库缓存\\n- 关闭缓存：请前往通用-全局设置-题库缓存\",\n                    color: \"gray\"\n                  });\n                }\n                return lib.h(\"div\", { className: \"search-result\" }, [\n                  lib.h(\"div\", { className: \"question\" }, [lib.h(\"span\", { innerHTML: title })]),\n                  lib.h(\"div\", { className: \"answer\" }, [\n                    lib.h(\"span\", \"答案：\"),\n                    ...extra_data.tags ? extra_data.tags.map(\n                      (tag) => lib.$ui.tooltip(\n                        lib.h(\"span\", {\n                          className: \"search-result-answer-tag \" + tag.color,\n                          innerHTML: tag.text,\n                          title: tag.title,\n                          dataset: { title: tag.title }\n                        })\n                      )\n                    ) : [],\n                    ...splitAnswer(answer).map((a) => lib.h(\"code\", { innerHTML: a }))\n                  ])\n                ]);\n              })\n            ])\n          ]);\n        })\n      );\n      $.onresize(this, (sr) => {\n        sr.style.maxHeight = window.innerHeight / 2 + \"px\";\n      });\n    }\n  }\n  const $render = {\n    moveToEdge(x = 80, y = 100) {\n      CommonProject.scripts.render.methods.minimize();\n      CommonProject.scripts.render.methods.setPosition(x, y);\n    }\n  };\n  const state$6 = {\n    console: {\n      listenerIds: {\n        logs: 0\n      }\n    },\n    app: {\n      listenerIds: {\n        sync: 0,\n        connected: 0,\n        closeSync: 0\n      }\n    }\n  };\n  const BackgroundProject = lib.Project.create({\n    name: \"后台\",\n    domains: [],\n    scripts: {\n      elementRegister: new lib.Script({\n        name: \"🔗 元素注册\",\n        hideInPanel: true,\n        matches: [[\"所有页面\", /.*/]],\n        onstart() {\n          lib.$.loadCustomElements([SearchInfosElement]);\n        }\n      }),\n      console: new lib.Script({\n        name: \"📄 日志输出\",\n        matches: [[\"所有\", /.*/]],\n        namespace: \"render.console\",\n        configs: {\n          logs: {\n            defaultValue: []\n          }\n        },\n        onrender({ panel }) {\n          const getTypeDesc = (type) => type === \"info\" ? \"信息\" : type === \"error\" ? \"错误\" : type === \"warn\" ? \"警告\" : type === \"debug\" ? \"调试\" : \"日志\";\n          const createLog = (log) => {\n            const date = new Date(log.time);\n            const item = lib.h(\n              \"div\",\n              {\n                title: \"双击复制日志信息\",\n                className: \"item\"\n              },\n              [\n                lib.h(\n                  \"span\",\n                  { className: \"time\" },\n                  `${date.getHours().toFixed(0).padStart(2, \"0\")}:${date.getMinutes().toFixed(0).padStart(2, \"0\")} `\n                ),\n                lib.h(\"span\", { className: log.type }, `[${getTypeDesc(log.type)}]`),\n                lib.h(\"span\", \":\" + log.content)\n              ]\n            );\n            item.addEventListener(\"dblclick\", () => {\n              navigator.clipboard.writeText(\n                Object.keys(log).map((k) => `${k}: ${log[k]}`).join(\"\\n\")\n              );\n            });\n            return item;\n          };\n          const showLogs = () => {\n            const div2 = lib.h(\"div\", { className: \"card console\" });\n            const logs2 = this.cfg.logs.map((log) => createLog(log));\n            if (logs2.length) {\n              div2.replaceChildren(...logs2);\n            } else {\n              div2.replaceChildren(\n                lib.h(\"div\", \"暂无任何日志\", (div3) => {\n                  div3.style.textAlign = \"center\";\n                })\n              );\n            }\n            return { div: div2, logs: logs2 };\n          };\n          const isScrollBottom = (div2) => {\n            const { scrollHeight, scrollTop, clientHeight } = div2;\n            return scrollTop + clientHeight + 50 > scrollHeight;\n          };\n          const { div, logs } = showLogs();\n          this.offConfigChange(state$6.console.listenerIds.logs);\n          state$6.console.listenerIds.logs = this.onConfigChange(\"logs\", (logs2) => {\n            const log = createLog(logs2[logs2.length - 1]);\n            div.append(log);\n            setTimeout(() => {\n              if (isScrollBottom(div)) {\n                log.scrollIntoView();\n              }\n            }, 10);\n          });\n          const show = () => {\n            panel.body.replaceChildren(div);\n            setTimeout(() => {\n              var _a;\n              (_a = logs[logs.length - 1]) == null ? void 0 : _a.scrollIntoView();\n            }, 10);\n          };\n          show();\n        }\n      }),\n      appConfigSync: new lib.Script({\n        name: \"🔄️ 软件配置同步\",\n        namespace: \"background.app\",\n        matches: [[\"所有页面\", /./]],\n        hideInPanel: lib.$gm.getInfos() === void 0,\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              [\n                lib.h(\"span\", [\n                  \"如果您使用\",\n                  lib.h(\"a\", { href: \"https://docs.ocsjs.com/docs/app\", target: \"_blank\" }, \"OCS桌面软件\"),\n                  \"启动浏览器，并使用此脚本，\"\n                ]),\n                \"我们会同步软件中的配置到此脚本上，方便多个浏览器的管理。\",\n                \"窗口设置以及后台面板所有设置不会进行同步。\"\n              ],\n              \"如果不是，您可以忽略此脚本。\"\n            ]).outerHTML\n          },\n          sync_status: {\n            defaultValue: \"unconnect\"\n          },\n          closeSync: {\n            defaultValue: false,\n            label: \"关闭同步\",\n            attrs: {\n              type: \"checkbox\"\n            }\n          }\n        },\n        onrender({ panel }) {\n          panel.lockWrapper.remove();\n          panel.configsContainer.classList.remove(\"lock\");\n          const update = () => {\n            if (this.cfg.closeSync) {\n              const tip = lib.h(\"div\", { className: \"notes card\" }, [\"已关闭同步。\"]);\n              panel.body.replaceChildren(lib.h(\"hr\"), tip);\n            } else if (this.cfg.sync_status === \"synced\") {\n              const tip = lib.h(\"div\", { className: \"notes card\" }, [`已成功同步软件中的配置.`]);\n              panel.body.replaceChildren(lib.h(\"hr\"), tip);\n            } else if (this.cfg.sync_status === \"unconnect\") {\n              const tip = lib.h(\"div\", { className: \"notes card\" }, [\"未同步软件配置，可能是桌面软件未启动。\"]);\n              panel.body.replaceChildren(lib.h(\"hr\"), tip);\n            } else if (this.cfg.sync_status === \"not_playwright_environment\") {\n              const tip = lib.h(\"div\", { className: \"notes card\" }, [\"当前浏览器不是由桌面端软件启动，无法同步配置。\"]);\n              panel.body.replaceChildren(lib.h(\"hr\"), tip);\n            } else if (this.cfg.sync_status === \"not_open_sync\") {\n              const tip = lib.h(\"div\", { className: \"notes card\" }, [\"桌面端软件未开启配置同步功能\"]);\n              panel.body.replaceChildren(lib.h(\"hr\"), tip);\n            } else if (this.cfg.sync_status === \"empty_config\") {\n              const tip = lib.h(\"div\", { className: \"notes card\" }, [\"已成功连接到软件，但配置为空。\"]);\n              panel.body.replaceChildren(lib.h(\"hr\"), tip);\n            } else {\n              const tip = lib.h(\"div\", { className: \"notes card\" }, [\"同步状态未知，请稍后重试。\"]);\n              panel.body.replaceChildren(lib.h(\"hr\"), tip);\n            }\n          };\n          update();\n          this.offConfigChange(state$6.app.listenerIds.sync);\n          this.offConfigChange(state$6.app.listenerIds.connected);\n          this.offConfigChange(state$6.app.listenerIds.closeSync);\n          state$6.app.listenerIds.connected = this.onConfigChange(\"sync_status\", update);\n          state$6.app.listenerIds.closeSync = this.onConfigChange(\"closeSync\", (closeSync) => {\n            if (closeSync) {\n              this.cfg.sync_status = \"not_open_sync\";\n              lib.$message.success({ content: \"已关闭同步，刷新页面后生效\" });\n            }\n          });\n        },\n        async onactive() {\n          var _a;\n          if (lib.$.isInTopWindow()) {\n            if (this.cfg.closeSync) {\n              $console.log(\"配置同步已关闭\");\n              return;\n            }\n            this.cfg.sync_status = \"unconnect\";\n            try {\n              const res = await request(\"http://localhost:15319/browser\", {\n                type: \"GM_xmlhttpRequest\",\n                method: \"get\",\n                responseType: \"json\"\n              });\n              if (!res) {\n                this.cfg.sync_status = \"unconnect\";\n                return;\n              }\n              const open_sync = await request(\"http://localhost:15319/is-browser-config-sync\", {\n                type: \"GM_xmlhttpRequest\",\n                method: \"get\",\n                responseType: \"text\"\n              });\n              if (open_sync !== \"true\") {\n                this.cfg.sync_status = \"not_open_sync\";\n                return;\n              }\n              if (Object.keys(res).length === 0) {\n                this.cfg.sync_status = \"not_open_sync\";\n                return;\n              }\n              const environment_res = await request(\"/ocs-environment\", {\n                type: \"fetch\",\n                method: \"get\"\n              });\n              const environment = environment_res == null ? void 0 : environment_res.environment;\n              if (!environment || environment !== \"playwright\") {\n                this.cfg.sync_status = \"not_playwright_environment\";\n                return;\n              }\n              for (const key in res) {\n                if (Object.prototype.hasOwnProperty.call(res, key)) {\n                  if (RenderScript.namespace && key.startsWith(RenderScript.namespace)) {\n                    Reflect.deleteProperty(res, key);\n                  }\n                  for (const scriptKey in BackgroundProject.scripts) {\n                    if (Object.prototype.hasOwnProperty.call(BackgroundProject.scripts, scriptKey)) {\n                      const script2 = Reflect.get(BackgroundProject.scripts, scriptKey);\n                      if (script2.namespace && key.startsWith(script2.namespace)) {\n                        Reflect.deleteProperty(res, key);\n                      }\n                    }\n                  }\n                }\n              }\n              for (const project2 of definedProjects()) {\n                for (const key in project2.scripts) {\n                  if (Object.prototype.hasOwnProperty.call(project2.scripts, key)) {\n                    const script2 = project2.scripts[key];\n                    for (const ck in script2.configs) {\n                      if (Object.prototype.hasOwnProperty.call(script2.configs, ck)) {\n                        if (((_a = script2.configs[ck].extra) == null ? void 0 : _a.appConfigSync) === false) {\n                          Reflect.deleteProperty(res, lib.$.namespaceKey(script2.namespace, ck));\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n              for (const key in res) {\n                if (Object.prototype.hasOwnProperty.call(res, key)) {\n                  lib.$store.set(key, res[key]);\n                }\n              }\n              for (const project2 of definedProjects()) {\n                if (project2.name === BackgroundProject.name) {\n                  continue;\n                }\n                for (const key in project2.scripts) {\n                  if (Object.prototype.hasOwnProperty.call(project2.scripts, key)) {\n                    const script2 = project2.scripts[key];\n                    const originalRender = script2.onrender;\n                    script2.onrender = ({ panel, header: header2 }) => {\n                      var _a2, _b;\n                      originalRender == null ? void 0 : originalRender({ panel, header: header2 });\n                      if (panel.configsContainer.children.length) {\n                        panel.configsContainer.classList.add(\"lock\");\n                        panel.lockWrapper.style.width = ((_a2 = panel.configsContainer.clientWidth) != null ? _a2 : panel.clientWidth) + \"px\";\n                        panel.lockWrapper.style.height = ((_b = panel.configsContainer.clientHeight) != null ? _b : panel.clientHeight) + \"px\";\n                        panel.configsContainer.prepend(panel.lockWrapper);\n                        panel.lockWrapper.title = \"🚫已同步OCS桌面版软件配置，如需修改请在桌面版软件的左侧栏设置-通用设置-OCS配置，中进行修改。\\n\\n或者前往脚本悬浮窗:后台-软件配置同步 关闭配置同步功能。\\n\\n可双击强制修改，并关闭同步配置\";\n                        panel.lockWrapper = lib.$ui.tooltip(panel.lockWrapper);\n                        panel.lockWrapper.addEventListener(\"dblclick\", () => {\n                          var _a3;\n                          panel.configsContainer.classList.remove(\"lock\");\n                          panel.lockWrapper.remove();\n                          script2.onrender = originalRender;\n                          lib.$message.warn({\n                            content: \"已解除配置同步，可正常修改配置。想开启同步请前往：后台-软件配置同步\",\n                            duration: 10\n                          });\n                          this.cfg.closeSync = true;\n                          if (script2.panel && script2.header) {\n                            (_a3 = script2.onrender) == null ? void 0 : _a3.call(script2, { panel: script2.panel, header: script2.header });\n                          }\n                        });\n                      }\n                    };\n                    if (script2.panel && script2.header) {\n                      script2.onrender({ panel: script2.panel, header: script2.header });\n                    }\n                  }\n                }\n              }\n              this.cfg.sync_status = \"synced\";\n            } catch (e) {\n              console.error(e);\n              this.cfg.sync_status = \"unconnect\";\n            }\n          }\n        }\n      }),\n      update: new lib.Script({\n        name: \"📥 更新模块\",\n        matches: [[\"所有页面\", /.*/]],\n        namespace: \"background.update\",\n        configs: {\n          notes: {\n            defaultValue: \"脚本自动更新模块，如果有新的版本会自动通知。\"\n          },\n          autoNotify: {\n            defaultValue: true,\n            label: \"开启更新通知\",\n            attrs: { type: \"checkbox\", title: \"当有最新的版本时自动弹窗通知，默认开启\" }\n          },\n          notToday: {\n            defaultValue: -1\n          },\n          ignoreVersions: {\n            defaultValue: []\n          }\n        },\n        methods() {\n          return {\n            getLastVersion: async () => {\n              return await request(\"https://cdn.ocsjs.com/ocs-version.json?t=\" + Date.now(), {\n                method: \"get\",\n                type: \"GM_xmlhttpRequest\"\n              });\n            }\n          };\n        },\n        async onrender({ panel }) {\n          var _a;\n          const version = await this.methods.getLastVersion();\n          const infos = lib.$gm.getInfos();\n          if (!infos) {\n            return;\n          }\n          const changeLog = lib.h(\"button\", { className: \"base-style-button-secondary\" }, \"📄查看更新日志\");\n          changeLog.onclick = () => CommonProject.scripts.apps.methods.showChangelog();\n          const updatePage = ((_a = this.startConfig) == null ? void 0 : _a.updatePage) || \"\";\n          panel.body.replaceChildren(\n            lib.h(\"div\", { className: \"card\" }, [\n              lib.h(\"hr\"),\n              lib.h(\"div\", [\"最新版本：\" + version[\"last-version\"] + \" - \", changeLog]),\n              lib.h(\"hr\"),\n              lib.h(\"div\", \"当前版本：\" + infos.script.version),\n              lib.h(\"div\", \"脚本管理器：\" + infos.scriptHandler),\n              lib.h(\"div\", [\"脚本更新链接：\", lib.h(\"a\", { target: \"_blank\", href: updatePage }, [updatePage || \"无\"])])\n            ])\n          );\n          console.log(\"versions\", {\n            notToday: this.cfg.notToday,\n            ignoreVersions: this.cfg.ignoreVersions,\n            version\n          });\n        },\n        oncomplete() {\n          if (this.cfg.autoNotify && lib.$.isInTopWindow()) {\n            if (this.cfg.notToday === -1 || this.cfg.notToday !== new Date().getDate()) {\n              const infos = lib.$gm.getInfos();\n              if (infos) {\n                if (!!valid_1(infos.script.version) === false) {\n                  lib.$message.error(`当前版本号 (${infos.script.version}) 不符合semver版本书写规范，请重新修改版本。`);\n                  return;\n                }\n                setTimeout(async () => {\n                  var _a;\n                  const version = await this.methods.getLastVersion();\n                  const last = version[\"last-version\"];\n                  if (this.cfg.ignoreVersions.includes(last) === false && gt_1(last, infos.script.version)) {\n                    const updatePage = ((_a = this.startConfig) == null ? void 0 : _a.updatePage) || \"\";\n                    const modal2 = lib.$modal.confirm({\n                      maskCloseable: false,\n                      width: 600,\n                      content: lib.$ui.notes([`检测到新版本发布 ${last} ：`, [...version.notes || []]]),\n                      footer: lib.h(\"div\", [\n                        lib.h(\"button\", { className: \"base-style-button-secondary\", innerText: \"跳过此版本\" }, (btn) => {\n                          btn.onclick = () => {\n                            this.cfg.ignoreVersions = [...this.cfg.ignoreVersions, last];\n                            modal2 == null ? void 0 : modal2.remove();\n                          };\n                        }),\n                        lib.h(\"button\", { className: \"base-style-button-secondary\", innerText: \"今日不再提示\" }, (btn) => {\n                          btn.onclick = () => {\n                            this.cfg.notToday = new Date().getDate();\n                            modal2 == null ? void 0 : modal2.remove();\n                          };\n                        }),\n                        lib.h(\"button\", { className: \"base-style-button\", innerText: \"前往更新\" }, (btn) => {\n                          btn.onclick = () => {\n                            if (updatePage) {\n                              window.open(updatePage, \"_blank\");\n                              modal2 == null ? void 0 : modal2.remove();\n                            } else {\n                              lib.$message.error({ content: \"无法前往更新页面，更新链接为空\" });\n                            }\n                          };\n                        })\n                      ])\n                    });\n                  }\n                }, 5 * 1e3);\n              }\n            }\n          }\n        }\n      }),\n      dev: new lib.Script({\n        name: \"🛠️ 开发者调试\",\n        namespace: \"background.dev\",\n        matches: [[\"所有页面\", /./]],\n        configs: {\n          notes: {\n            defaultValue: \"开发人员调试用。<br>注入OCS_CONTEXT全局变量。用户可忽略此页面。\"\n          },\n          show_debug_cursor: {\n            defaultValue: true,\n            label: \"软件辅助点击时显示鼠标位置\",\n            attrs: { type: \"checkbox\" }\n          }\n        },\n        methods() {\n          return {\n            getRemotePlaywrightCurrentPage: () => {\n              return RemotePlaywright.getRemotePage(this.cfg.show_debug_cursor, console.debug);\n            }\n          };\n        },\n        onrender({ panel }) {\n          const injectBtn = lib.h(\"button\", { className: \"base-style-button\" }, \"点击注入全局变量\");\n          injectBtn.addEventListener(\"click\", () => {\n            lib.$gm.unsafeWindow.OCS_CONTEXT = self;\n          });\n          const showTabDataBtn = lib.h(\"button\", { className: \"base-style-button\" }, \"显示Tab存储\");\n          lib.$gm.getTab((tab) => {\n            const els = [];\n            for (const key in tab) {\n              if (Object.prototype.hasOwnProperty.call(tab, key)) {\n                els.push(lib.h(\"div\", [lib.h(\"b\", key + \" : \"), lib.h(\"code\", JSON.stringify(tab[key]))]));\n              }\n            }\n            showTabDataBtn.addEventListener(\"click\", () => {\n              lib.$modal.simple({\n                content: lib.h(\"div\", els),\n                width: window.document.documentElement.clientWidth / 2\n              });\n            });\n          });\n          panel.body.replaceChildren(lib.h(\"div\", { className: \"card\" }, [lib.h(\"hr\"), injectBtn, showTabDataBtn]));\n        }\n      }),\n      appLoginHelper: new lib.Script({\n        name: \"软件登录辅助\",\n        matches: [\n          [\"超星登录\", \"passport2.chaoxing.com/login\"],\n          [\"智慧树登录\", \"passport.zhihuishu.com/login\"],\n          [\"职教云登录\", \"zjy2.icve.com.cn/portal/login.html\"],\n          [\"智慧职教登录\", \"sso.icve.com.cn/sso/auth\"]\n        ],\n        hideInPanel: true,\n        oncomplete() {\n          if (lib.$.isInTopWindow()) {\n            $render.moveToEdge();\n          }\n        }\n      }),\n      errorHandle: new lib.Script({\n        name: \"全局错误捕获\",\n        matches: [[\"\", /.*/]],\n        hideInPanel: true,\n        onstart() {\n          const projects = definedProjects();\n          for (const project2 of projects) {\n            for (const key in project2.scripts) {\n              if (Object.prototype.hasOwnProperty.call(project2.scripts, key)) {\n                const script2 = project2.scripts[key];\n                script2.on(\"scripterror\", (err) => {\n                  const msg = `[${project2.name} - ${script2.name}] : ${err}`;\n                  console.error(msg);\n                  $console.error(msg);\n                });\n              }\n            }\n          }\n        }\n      }),\n      requestList: new lib.Script({\n        name: \"📄 请求记录\",\n        matches: [[\"\", /.*/]],\n        priority: 99,\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"开发人员请求调试记录页面，小白勿入，最多只记录最近的100个请求数据\",\n              \"可打开F12控制台查看请求日志，或者下方的请求列表\"\n            ]).outerHTML\n          },\n          enable: {\n            label: \"开启请求记录\",\n            attrs: { type: \"checkbox\" },\n            defaultValue: false\n          },\n          methodFilter: {\n            label: \"方法过滤\",\n            tag: \"select\",\n            attrs: { placeholder: \"选择选项\" },\n            options: [[\"none\", \"无\"], [\"GET\"], [\"POST\"], [\"OPTIONS\"], [\"HEAD\"]],\n            defaultValue: \"none\"\n          },\n          typeFilter: {\n            label: \"类型过滤\",\n            tag: \"select\",\n            attrs: { placeholder: \"选择选项\" },\n            options: [\n              [\"none\", \"无\"],\n              [\"gmxhr\", \"油猴API请求（gmxhr）\"],\n              [\"fetch\", \"普通请求（fetch）\"]\n            ],\n            defaultValue: \"none\"\n          },\n          searchValue: {\n            label: \"内容搜索\",\n            attrs: { placeholder: \"搜索 URL/请求体/响应\" },\n            defaultValue: \"\"\n          },\n          list: {\n            defaultValue: []\n          }\n        },\n        methods() {\n          const render2 = (list) => {\n            var _a, _b;\n            (_a = this.panel) == null ? void 0 : _a.body.replaceChildren();\n            (_b = this.panel) == null ? void 0 : _b.body.append(\n              lib.h(\"div\", { className: \"card\" }, [\n                lib.h(\"div\", { style: { padding: \"8px 0px\", textAlign: \"end\" } }, [\n                  lib.h(\n                    \"button\",\n                    {\n                      className: \"base-style-button-secondary\",\n                      style: { marginRight: \"12px\" },\n                      innerText: \"🗑️清空记录\"\n                    },\n                    (btn) => {\n                      btn.onclick = () => {\n                        this.cfg.list = [];\n                        render2(this.cfg.list);\n                      };\n                    }\n                  ),\n                  lib.h(\"button\", { className: \"base-style-button\", innerText: \"🔍执行搜索\" }, (btn) => {\n                    btn.onclick = () => {\n                      if (this.cfg.methodFilter === \"none\" && this.cfg.typeFilter === \"none\" && this.cfg.searchValue === \"\") {\n                        render2(this.cfg.list);\n                      } else {\n                        const list2 = this.cfg.list.filter((item) => {\n                          if (this.cfg.methodFilter !== \"none\" && item.method.toLowerCase() !== this.cfg.methodFilter.toLowerCase()) {\n                            return false;\n                          }\n                          return true;\n                        }).filter((item) => {\n                          if (this.cfg.typeFilter !== \"none\" && item.type !== this.cfg.typeFilter) {\n                            return false;\n                          }\n                          return true;\n                        }).filter((item) => {\n                          var _a2, _b2;\n                          if (this.cfg.searchValue && item.url.includes(this.cfg.searchValue) || ((_a2 = item.data) == null ? void 0 : _a2.includes(this.cfg.searchValue)) || ((_b2 = item.response) == null ? void 0 : _b2.includes(this.cfg.searchValue))) {\n                            return true;\n                          }\n                          return false;\n                        });\n                        render2(list2);\n                      }\n                    };\n                  })\n                ]),\n                lib.h(\n                  \"div\",\n                  { style: { backgroundColor: \"#292929\", overflow: \"auto\", maxHeight: window.innerHeight / 2 + \"px\" } },\n                  [\n                    ...list.length === 0 ? [lib.h(\"div\", { style: { color: \"white\", textAlign: \"center\" } }, \"暂无数据\")] : [],\n                    ...list.map(\n                      (item) => lib.h(\n                        \"div\",\n                        {\n                          title: Object.entries(item).map(\n                            ([key, val]) => key === \"time\" ? `${key} : ${new Date(val).toLocaleString().replace(/\\//g, \"-\")}` : `${key} : ${val}`\n                          ).join(\"\\n\"),\n                          style: {\n                            maxWidth: \"800px\",\n                            padding: \"4px 0px\",\n                            margin: \"4px 0px\",\n                            textWrap: \"nowrap\"\n                          }\n                        },\n                        [\n                          lib.h(\"div\", [\n                            lib.h(\"span\", { style: { marginRight: \"8px\" } }, new Date(item.time).toLocaleTimeString()),\n                            lib.h(\n                              \"span\",\n                              {\n                                style: {\n                                  backgroundColor: \"#2196f3a3\",\n                                  color: \"#ececec\",\n                                  marginRight: \"8px\",\n                                  padding: \"0px 2px\"\n                                }\n                              },\n                              item.method\n                            ),\n                            lib.h(\n                              \"span\",\n                              { style: { color: item.response ? \"#4eb74e\" : \"#eb6262\", marginRight: \"8px\" } },\n                              \"●\"\n                            ),\n                            lib.h(\n                              \"div\",\n                              { style: { display: \"inline-block\", color: \"#ececec\" } },\n                              item.url ? item.url.length > 100 ? item.url.slice(0, 100) + \"...\" : item.url : \"-\"\n                            )\n                          ]),\n                          lib.h(\n                            \"div\",\n                            { style: { overflow: \"hidden\", fontSize: \"12px\", color: \"#8f8f8f\" } },\n                            item.data ? \"data: \" + item.data : \"\"\n                          ),\n                          lib.h(\n                            \"div\",\n                            { style: { overflow: \"hidden\", fontSize: \"12px\", color: \"#8f8f8f\" } },\n                            item.response ? \"resp: \" + item.response : item.error ? \"err : \" + item.error : \"\"\n                          )\n                        ]\n                      )\n                    )\n                  ]\n                )\n              ])\n            );\n          };\n          return {\n            render: render2\n          };\n        },\n        onrender() {\n          this.methods.render(this.cfg.list);\n        },\n        onstart() {\n          if (lib.$gm.isInGMContext() === false) {\n            return;\n          }\n          const gmRequest = GM_xmlhttpRequest;\n          const originalFetch = fetch;\n          const getId = () => Math.random().toString(16).slice(2);\n          const addRecord = (item) => {\n            this.cfg.list = [item, ...this.cfg.list];\n            if (this.cfg.list.length > 100) {\n              this.cfg.list = this.cfg.list.slice(0, 100);\n            }\n          };\n          const setItem = (id, response, error) => {\n            const list = JSON.parse(JSON.stringify(this.cfg.list));\n            const index = list.findIndex((item) => item.id === id);\n            if (index !== -1) {\n              list[index].response = response;\n              list[index].error = error;\n            }\n            this.cfg.list = list;\n          };\n          GM_xmlhttpRequest = (details) => {\n            if (this.cfg.enable) {\n              const id = getId();\n              const data = {\n                id,\n                url: details.url,\n                method: details.method || \"unknown\",\n                type: \"gmxhr\",\n                data: details.data,\n                headers: details.headers,\n                response: \"\",\n                error: \"\",\n                time: Date.now()\n              };\n              addRecord(data);\n              const onload = details.onload;\n              const onerror = details.onerror;\n              details.onload = function(response) {\n                setItem(id, response.responseText, \"\");\n                data.response = details.responseType === \"json\" ? response.response : response.responseText;\n                console.log(\"%c [请求成功]\", \"color: green; font-weight: bold\", data.url, data);\n                onload == null ? void 0 : onload.apply(this, [response]);\n              };\n              details.onerror = function(response) {\n                setItem(id, \"\", response.error);\n                data.error = response.error;\n                console.log(\"%c [请求失败]\", \"color: red; font-weight: bold\", data.url, data);\n                onerror == null ? void 0 : onerror.apply(this, [response]);\n              };\n            }\n            return gmRequest.apply(this, [details]);\n          };\n          fetch = (input, init) => {\n            if (this.cfg.enable) {\n              const id = getId();\n              const data = {\n                id,\n                url: typeof input === \"string\" ? input : input instanceof URL ? input.href : input.url,\n                method: (init == null ? void 0 : init.method) || \"unknown\",\n                type: \"fetch\",\n                data: init == null ? void 0 : init.body,\n                headers: init == null ? void 0 : init.headers,\n                response: \"\",\n                error: \"\",\n                time: Date.now()\n              };\n              addRecord(data);\n              const res = originalFetch.apply(this, [input, init]);\n              res.then((result) => {\n                return result.clone().text();\n              }).then((result) => {\n                setItem(id, result, \"\");\n                data.response = result;\n                console.log(\"%c [请求成功]\", \"color: green; font-weight: bold\", data.url, data);\n              });\n              res.catch((err) => {\n                setItem(id, \"\", String(err));\n                data.error = String(err);\n                console.log(\"%c [请求失败]\", \"color: red; font-weight: bold\", data.url, data);\n              });\n              return res;\n            } else {\n              return originalFetch.apply(this, [input, init]);\n            }\n          };\n        }\n      }),\n      environmentDetect: new lib.Script({\n        name: \"🤖 环境检测\",\n        matches: [[\"所有页面\", /.*/]],\n        hideInPanel: true,\n        oncomplete() {\n          if (self !== top)\n            return;\n          const matches = [\n            CXProject.scripts.studyDispatcher.matches,\n            ZHSProject.scripts[\"gxk-study\"].matches,\n            ZHSProject.scripts.hike.matches,\n            ZHSProject.scripts[\"smart-study\"].matches,\n            ZHSProject.scripts[\"wisdom-study\"].matches,\n            ZHSProject.scripts[\"xnk-study\"].matches,\n            ICourseProject.scripts.study.matches,\n            IcveMoocProject.scripts.study.matches,\n            ZJYProject.scripts.study.matches\n          ].flat().map((m) => Array.isArray(m) ? m[1] : m);\n          const url = window.location.href;\n          const match = matches.some((regex) => {\n            return typeof regex === \"string\" ? url.includes(regex) : regex.test(url);\n          });\n          if (!match) {\n            return;\n          }\n          let messageElement;\n          visibleDetect();\n          function visibleDetect() {\n            setTimeout(() => {\n              if (!(messageElement == null ? void 0 : messageElement.isConnected))\n                messageElement = void 0;\n              if (document.visibilityState === \"hidden\" && !messageElement) {\n                messageElement = lib.$message.warn({\n                  content: \"⚠️检测到浏览器最小化/切屏，脚本可能无法正常运行，请保持网课页面在前台！（如果您正在全屏游戏中可以忽略此警告）\",\n                  duration: 0\n                });\n              }\n              visibleDetect();\n            }, 1e3);\n          }\n        }\n      }),\n      menus: new lib.Script({\n        name: \"📁 菜单管理\",\n        hideInPanel: true,\n        matches: [[\"所有页面\", /.*/]],\n        async onactive() {\n          const currentStudyScript = [\n            [CXProject.scripts.studyDispatcher, CXProject.scripts.study],\n            CXProject.scripts.work,\n            ZHSProject.scripts[\"gxk-study\"],\n            ZHSProject.scripts[\"xnk-study\"],\n            ZHSProject.scripts.hike,\n            ZHSProject.scripts[\"smart-study\"],\n            ZHSProject.scripts[\"wisdom-study\"],\n            ZHSProject.scripts[\"xnk-study\"],\n            ZHSProject.scripts[\"gxk-work\"],\n            ZHSProject.scripts[\"xnk-work\"],\n            ZHSProject.scripts[\"hike-work\"],\n            ZHSProject.scripts[\"smart-work\"],\n            ZHSProject.scripts[\"xnk-work\"],\n            [ICourseProject.scripts.dispatcher, ICourseProject.scripts.study],\n            ICourseProject.scripts.work,\n            [ZJYProject.scripts.dispatcher, ZJYProject.scripts.study],\n            ZJYProject.scripts.work,\n            IcveMoocProject.scripts.study,\n            IcveMoocProject.scripts.work\n          ].map((m) => {\n            const url = window.location.href;\n            const data = {\n              matches: Array.isArray(m) ? m[0].matches : m.matches,\n              target: Array.isArray(m) ? m[1] : m\n            };\n            if (data.matches.some((regexp) => {\n              const r = Array.isArray(regexp) ? regexp[1] : regexp;\n              return typeof r === \"string\" ? url.includes(r) : r.test(url);\n            })) {\n              return data.target;\n            }\n            return void 0;\n          }).find((m) => m !== void 0);\n          await lib.$menu(\"🏠\", { scriptPanelLink: CommonProject.scripts.guide });\n          if (currentStudyScript)\n            await lib.$menu(\"🖥️\", { scriptPanelLink: currentStudyScript });\n          await lib.$menu(\"🔎\", { scriptPanelLink: CommonProject.scripts.workResults });\n          await lib.$menu(\"⚙️\", { scriptPanelLink: CommonProject.scripts.settings });\n          await lib.$menu(\"📥\", { scriptPanelLink: BackgroundProject.scripts.update });\n          await lib.$menu(\"📄\", { scriptPanelLink: BackgroundProject.scripts.console });\n        }\n      })\n    }\n  });\n  const $console = new Proxy({}, {\n    get(target, key) {\n      return (...msg) => {\n        var _a;\n        let logs = BackgroundProject.scripts.console.cfg.logs;\n        if (logs.length > 50) {\n          logs = logs.slice(-50);\n        }\n        const stack_str = Error().stack || \"\";\n        const stacks = (_a = stack_str.replace(\"Error\", \"\").match(/at (.*) \\(.+:\\/\\/.+:(.+):(.+)\\)/g)) == null ? void 0 : _a.map((s) => {\n          const match = s.match(/at (.*) \\(.+:\\/\\/.+:(.+):(.+)\\)/) || [];\n          return [match[1], match[2], match[3]];\n        });\n        logs = logs.concat({\n          type: key.toString(),\n          content: msg.join(\" \"),\n          time: Date.now(),\n          stack: JSON.stringify([stack_str.split(\"\\n\")[0], ...stacks || []])\n        });\n        BackgroundProject.scripts.console.cfg.logs = logs;\n      };\n    }\n  });\n  let globalControlPanel = null;\n  function commonWork(script2, options) {\n    CommonProject.scripts.render.methods.pin(script2);\n    let worker;\n    let startBtnPressed = false;\n    let checkFailed = false;\n    let running = false;\n    const createWorkControlPanel = () => {\n      const { controlBtn, restartBtn, startBtn } = createWorkerControl({\n        workerProvider: () => worker,\n        onStart: async () => {\n          startBtnPressed = true;\n          if (checkMessage instanceof lib.MessageElement) {\n            checkMessage.remove();\n          }\n          closeAnswerWrapperEmptyWarning();\n          start2();\n        },\n        onRestart: async () => {\n          var _a;\n          worker == null ? void 0 : worker.emit(\"close\");\n          await ((_a = options.onRestart) == null ? void 0 : _a.call(options));\n          start2();\n        }\n      });\n      startBtn.style.flex = \"1\";\n      startBtn.style.padding = \"4px\";\n      restartBtn.style.flex = \"1\";\n      restartBtn.style.padding = \"4px\";\n      controlBtn.style.flex = \"1\";\n      controlBtn.style.padding = \"4px\";\n      const container2 = lib.h(\n        \"div\",\n        { style: { marginTop: \"12px\", display: \"flex\" } },\n        running ? [controlBtn, restartBtn] : [startBtn]\n      );\n      globalControlPanel = container2;\n      return { container: container2, startBtn, restartBtn, controlBtn };\n    };\n    const workResultPanel = () => CommonProject.scripts.workResults.methods.createWorkResultsPanel();\n    const sync_script = [script2];\n    if (options.enable_control_panel) {\n      sync_script.push(CommonProject.scripts.workResults);\n    }\n    for (const script22 of sync_script) {\n      script22.on(\"render\", () => {\n        var _a, _b;\n        let gotoSettingsBtnContainer = \"\";\n        if (checkFailed) {\n          const gotoSettingsBtn = lib.$ui.button(\"👉 前往设置题库配置\", {\n            className: \"base-style-button\",\n            style: { flex: \"1\", padding: \"4px\" }\n          });\n          gotoSettingsBtn.style.flex = \"1\";\n          gotoSettingsBtn.style.padding = \"4px\";\n          gotoSettingsBtn.onclick = () => {\n            CommonProject.scripts.render.methods.pin(CommonProject.scripts.settings);\n          };\n          gotoSettingsBtnContainer = lib.h(\"div\", { style: { display: \"flex\" } }, [gotoSettingsBtn]);\n        }\n        (_b = (_a = script22.panel) == null ? void 0 : _a.body) == null ? void 0 : _b.replaceChildren(\n          lib.h(\"div\", { style: { marginTop: \"12px\" } }, [\n            gotoSettingsBtnContainer,\n            ...options.enable_control_panel ? [globalControlPanel || createWorkControlPanel().container] : [],\n            workResultPanel()\n          ])\n        );\n      });\n    }\n    const workOptions = CommonProject.scripts.settings.methods.getWorkOptions();\n    let checkMessage = workPreCheckMessage({\n      onrun: () => startBtnPressed === false && start2(),\n      onclose: (_, closedMsg) => checkMessage = closedMsg,\n      onNoAnswererWrappers: () => {\n        checkFailed = true;\n      },\n      ...workOptions,\n      start_delay_seconds: options.start_delay_seconds\n    });\n    const start2 = async () => {\n      var _a, _b, _c, _d;\n      await ((_a = options.beforeRunning) == null ? void 0 : _a.call(options));\n      running = true;\n      worker = options.workerProvider(workOptions);\n      if (worker) {\n        (_b = options.onWorkerCreated) == null ? void 0 : _b.call(options, worker);\n      }\n      const { container: container2, controlBtn } = createWorkControlPanel();\n      (_d = (_c = script2.panel) == null ? void 0 : _c.body) == null ? void 0 : _d.replaceChildren(container2, workResultPanel());\n      worker == null ? void 0 : worker.once(\"done\", () => {\n        running = false;\n        globalControlPanel = null;\n        controlBtn.disabled = true;\n      });\n    };\n  }\n  function createWorkerControl(options) {\n    let stop = false;\n    let stopMessage;\n    const startBtn = lib.$ui.button(\"▶️开始答题\");\n    const restartBtn = lib.$ui.button(\"🔃重新答题\");\n    const controlBtn = lib.$ui.button(\"⏸暂停\");\n    startBtn.onclick = () => {\n      startBtn.remove();\n      options.onStart();\n    };\n    restartBtn.onclick = () => {\n      stopMessage == null ? void 0 : stopMessage.remove();\n      options.onRestart();\n    };\n    controlBtn.onclick = () => {\n      var _a;\n      stop = !stop;\n      const worker = options.workerProvider();\n      (_a = worker == null ? void 0 : worker.emit) == null ? void 0 : _a.call(worker, stop ? \"stop\" : \"continuate\");\n      controlBtn.value = stop ? \"▶️继续\" : \"⏸️暂停\";\n      if (stop) {\n        stopMessage = lib.$message.warn({ duration: 0, content: \"暂停中...\" });\n      } else {\n        stopMessage == null ? void 0 : stopMessage.remove();\n      }\n    };\n    return { startBtn, restartBtn, controlBtn };\n  }\n  function optimizationElementWithImage(root2, clone_node = false) {\n    const clone = clone_node ? root2.cloneNode(true) : root2;\n    for (const img of Array.from(clone.querySelectorAll(\"img\"))) {\n      const src2 = document.createElement(\"span\");\n      src2.innerText = img.src;\n      src2.style.fontSize = \"0px\";\n      img.after(src2);\n    }\n    return clone;\n  }\n  function createUnVisibleTextOfImage(img) {\n    const src2 = document.createElement(\"span\");\n    src2.innerText = img.src;\n    src2.style.fontSize = \"0px\";\n    img.after(src2);\n  }\n  function simplifyWorkResult(results, titleTransform) {\n    var _a, _b, _c, _d, _e, _f;\n    const res = [];\n    let i = 0;\n    for (const wr of results) {\n      const ques = (titleTransform == null ? void 0 : titleTransform(((_a = wr.ctx) == null ? void 0 : _a.elements.title) || [], i)) || ((_c = (_b = wr.ctx) == null ? void 0 : _b.elements.title) == null ? void 0 : _c.map((e) => e == null ? void 0 : e.innerText.trim()).filter(Boolean).join(\"<br>\")) || \"\";\n      res.push({\n        requested: wr.requested,\n        resolved: wr.resolved,\n        error: wr.error,\n        type: (_d = wr.ctx) == null ? void 0 : _d.type,\n        question: ques,\n        finish: (_e = wr.result) == null ? void 0 : _e.finish,\n        searchInfos: ((_f = wr.ctx) == null ? void 0 : _f.searchInfos.map((sr) => ({\n          error: sr.error,\n          name: sr.name,\n          homepage: sr.homepage,\n          results: sr.results.map((ans) => [ans.question, ans.answer, ans.extra_data || {}])\n        }))) || []\n      });\n      i++;\n    }\n    return res;\n  }\n  function removeRedundantWords(str, words) {\n    for (const word of words.map((w) => w.trim())) {\n      str = str.replace(word, \"\");\n    }\n    return str;\n  }\n  let answererWrapperUnsetMessage;\n  const answerWrapperEmptyWarning = lib.cors.defineTopFunction((duration) => {\n    const setting = lib.h(\"button\", { className: \"base-style-button-secondary\" }, \"通用-全局设置\");\n    setting.onclick = () => {\n      CommonProject.scripts.render.methods.pin(CommonProject.scripts.settings);\n      setTimeout(() => {\n        var _a, _b;\n        (_b = (_a = lib.$elements.root) == null ? void 0 : _a.querySelector('[value=\"点击配置\"]')) == null ? void 0 : _b.click();\n      }, 500);\n    };\n    answererWrapperUnsetMessage == null ? void 0 : answererWrapperUnsetMessage.remove();\n    answererWrapperUnsetMessage = lib.$message.warn({\n      content: lib.h(\"span\", {}, [\"你还没设置题库，无法自动答题，请切换到 \", setting, \" 页面进行配置。\"]),\n      duration\n    });\n  });\n  const closeAnswerWrapperEmptyWarning = lib.cors.defineTopFunction(() => {\n    answererWrapperUnsetMessage == null ? void 0 : answererWrapperUnsetMessage.remove();\n    answererWrapperUnsetMessage = void 0;\n  });\n  function workPreCheckMessage(options) {\n    var _a;\n    const { onrun, onNoAnswererWrappers, onclose, ...opts } = options;\n    if (opts.answererWrappers.length === 0) {\n      onNoAnswererWrappers == null ? void 0 : onNoAnswererWrappers(opts);\n      return answerWrapperEmptyWarning(0);\n    } else {\n      options.start_delay_seconds = (_a = options.start_delay_seconds) != null ? _a : 5;\n      return lib.$message.info({\n        duration: options.start_delay_seconds,\n        content: lib.h(\"span\", [\n          `${options.start_delay_seconds}秒后自动答题，`,\n          lib.$ui.preventText({\n            name: \"点击取消\",\n            delay: options.start_delay_seconds,\n            ondefault: (span) => {\n              onrun(opts);\n            },\n            onprevent(span) {\n              const closedMessage = lib.$message.warn({\n                content: \"已关闭此次的自动答题，请手动开启或者忽略此警告。\",\n                duration: 0\n              });\n              if (closedMessage) {\n                onclose == null ? void 0 : onclose(opts, closedMessage);\n              }\n            }\n          })\n        ])\n      });\n    }\n  }\n  function createRangeTooltip(input, defaultValue, transform) {\n    input.addEventListener(\"change\", () => {\n      input.setAttribute(\"data-title\", transform(input.value || input.getAttribute(\"value\") || defaultValue));\n    });\n    input.setAttribute(\"data-title\", transform(input.value || input.getAttribute(\"value\") || defaultValue));\n  }\n  async function playMedia(playFunction) {\n    const tryPlayMedia = () => {\n      return new Promise((resolve, reject) => {\n        try {\n          const playRes = playFunction();\n          if (playRes) {\n            playRes.then(resolve).catch(reject);\n          } else {\n            resolve();\n          }\n        } catch (err) {\n          reject(err);\n        }\n      });\n    };\n    try {\n      await tryPlayMedia();\n      return true;\n    } catch (err) {\n      console.error(err);\n      if (String(err).includes(`failed because the user didn't interact with the document first`)) {\n        lib.$modal.alert({\n          content: \"播放音视频失败，由于浏览器的用户隐私保护措施，如果要播放带有音量的视频，或者某些无法自动播放音视频的网站，您必须先点击一次页面上的任意位置脚本才能进行音视频的播放，后续无需重新点击。\",\n          onClose: async () => {\n            await tryPlayMedia();\n          }\n        });\n        return true;\n      } else if (String(err).includes(\"The element has no supported sources\")) {\n        $console.error(\"当前视频无法播放。\");\n      } else {\n        $console.error(\"播放视频时发生未知错误：\" + String(err));\n      }\n      return false;\n    }\n  }\n  function enableCopy(elements2) {\n    function hackSelect(target) {\n      if (target) {\n        const _original_select = target.onselectstart;\n        const _original_oncopy = target.oncopy;\n        const _original_onpaste = target.onpaste;\n        const _original_onkeydown = target.onkeydown;\n        target.onselectstart = (e) => {\n          _original_select == null ? void 0 : _original_select.apply(target, [e]);\n          e.stopPropagation();\n          e.returnValue = true;\n          return true;\n        };\n        target.oncopy = (e) => {\n          _original_oncopy == null ? void 0 : _original_oncopy.apply(target, [e]);\n          e.stopPropagation();\n          e.returnValue = true;\n          return true;\n        };\n        target.onpaste = (e) => {\n          _original_onpaste == null ? void 0 : _original_onpaste.apply(target, [e]);\n          e.stopPropagation();\n          e.returnValue = true;\n          return true;\n        };\n        target.onkeydown = (e) => {\n          _original_onkeydown == null ? void 0 : _original_onkeydown.apply(target, [e]);\n          e.stopPropagation();\n          e.returnValue = true;\n          return true;\n        };\n      }\n    }\n    for (const el of elements2) {\n      hackSelect(el);\n    }\n  }\n  let popupWin;\n  window.addEventListener(\"beforeunload\", () => {\n    popupWin == null ? void 0 : popupWin.close();\n  });\n  function createQuestionTitleExtra(question) {\n    const space = lib.$ui.space(\n      [\n        lib.$ui.copy(\"复制\", question),\n        lib.h(\"span\", { className: \"question-title-extra-btn\", innerText: \"🌏百度一下\" }, (btn) => {\n          btn.onclick = () => {\n            popupWin == null ? void 0 : popupWin.close();\n            popupWin = $.createCenteredPopupWindow(`https://www.baidu.com/s?wd=${question}`, \"百度搜索\", {\n              width: 1e3,\n              height: 800,\n              resizable: true,\n              scrollbars: true\n            });\n          };\n        })\n      ],\n      { x: 4 }\n    );\n    space.style.marginTop = \"6px\";\n    space.style.textAlign = \"right\";\n    return lib.h(\"div\", { style: { textAlign: \"right\" } }, [space]);\n  }\n  const playbackRate = {\n    label: \"视频倍速\",\n    tag: \"select\",\n    options: [1, 1.25, 1.5, 1.75, 2, 2.25, 2.5, 2.75, 3, 3.5, 4, 6, 8, 16].map((rate) => [rate.toString(), rate + \" x\"]),\n    defaultValue: \"1\"\n  };\n  const volume = {\n    label: \"音量调节\",\n    attrs: { type: \"range\", step: \"0.05\", min: \"0\", max: \"1\" },\n    defaultValue: 0,\n    onload() {\n      createRangeTooltip(this, \"0\", (val) => `${parseFloat(val) * 100}%`);\n    }\n  };\n  const restudy = {\n    label: \"复习模式\",\n    attrs: { title: \"已经完成的视频继续学习\", type: \"checkbox\" },\n    defaultValue: false\n  };\n  const definition = {\n    label: \"清晰度\",\n    tag: \"select\",\n    defaultValue: \"line1bq\",\n    options: [\n      [\"line1bq\", \"流畅\"],\n      [\"line1gq\", \"高清\"]\n    ]\n  };\n  const workNotes = {\n    defaultValue: lib.$ui.notes([\n      \"自动答题前请在 “通用-全局设置” 中设置题库配置。\",\n      \"可以搭配 “通用-在线搜题” 一起使用。\",\n      \"⚠️禁止同时开多个作业/考试页面。\"\n    ]).outerHTML\n  };\n  const dropdownStyle = {\n    labelClassName: \"checkbox-label\",\n    providerClassName: \"checkbox-input\",\n    enableForAttribute: true,\n    onload(el) {\n      const checked = this.checked;\n      el.classList.toggle(\"checked\", checked);\n      this.addEventListener(\"change\", () => {\n        el.classList.toggle(\"checked\", this.checked);\n      });\n    }\n  };\n  const TAB_WORK_RESULTS_KEY = \"common.work-results.results\";\n  const state$5 = {\n    workResult: {\n      questionPositionSyncHandler: {\n        cx: (index) => {\n          var _a;\n          const el = (_a = document.querySelectorAll('[id*=\"sigleQuestionDiv\"], .questionLi')) == null ? void 0 : _a.item(index);\n          if (el) {\n            window.scrollTo({\n              top: el.getBoundingClientRect().top + window.pageYOffset - 50,\n              behavior: \"smooth\"\n            });\n          }\n        },\n        \"zhs-gxk\": (index) => {\n          var _a;\n          (_a = document.querySelectorAll(\".answerCard_list ul li\").item(index)) == null ? void 0 : _a.click();\n        },\n        \"zhs-xnk\": (index) => {\n          var _a;\n          (_a = document.querySelectorAll(\".jobclassallnumber-div li[questionid]\").item(index)) == null ? void 0 : _a.click();\n        },\n        \"zhs-smart\": (index) => {\n          var _a;\n          (_a = document.querySelectorAll('[role=\"treeitem\"] .font-sec-style-node').item(index)) == null ? void 0 : _a.click();\n        },\n        \"zhs-fusion\": (index) => {\n          var _a;\n          (_a = document.querySelectorAll(\".right-box .list .item\").item(index)) == null ? void 0 : _a.click();\n        },\n        \"zhs-hike\": (index) => {\n          var _a;\n          (_a = document.querySelectorAll(\".q_main_right .card_ul .card_li\").item(index)) == null ? void 0 : _a.click();\n        },\n        icve: (index) => {\n          var _a;\n          (_a = document.querySelectorAll(`.sheet_nums [id*=\"sheetSeq\"]`).item(index)) == null ? void 0 : _a.click();\n        },\n        zjy: (index) => {\n          var _a;\n          (_a = document.querySelectorAll(\".subjectDet\").item(index)) == null ? void 0 : _a.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n        },\n        icourse: (index) => {\n          var _a;\n          (_a = document.querySelectorAll(\".u-questionItem,[class*=questionBody]\").item(index)) == null ? void 0 : _a.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n        }\n      }\n    },\n    setting: {\n      listenerIds: {\n        aw: 0\n      }\n    }\n  };\n  const CommonProject = lib.Project.create({\n    name: \"通用\",\n    domains: [],\n    scripts: {\n      guide: new lib.Script({\n        name: \"🏠 使用教程\",\n        matches: [[\"所有页面\", /.*/]],\n        namespace: \"common.guide\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"打开任意网课平台，进入视频、作业页面等待脚本运行，\",\n              \"任何疑问请查看上方交流群，进群后带截图进行反馈。\",\n              \"温馨提示: \",\n              \"⚠️ 禁止与其他脚本一起使用，否则会不兼容导致无法运行！\",\n              \"⚠️ 禁止最小化浏览器、切屏，否则可能导致脚本无法运行！\"\n            ]).outerHTML\n          }\n        },\n        onrender({ panel }) {\n          const guide = createGuide();\n          guide.style.width = \"480px\";\n          panel.body.replaceChildren(guide);\n        }\n      }),\n      settings: new lib.Script({\n        name: \"⚙️ 全局设置\",\n        matches: [[\"所有页面\", /.*/]],\n        namespace: \"common.settings\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"✨鼠标移动到按钮或者输入框，可以看到提示！\",\n              \"想要自动答题必须设置 “题库配置” \",\n              \"设置后进入章节测试，作业，考试页面即可自动答题。\"\n            ]).outerHTML\n          },\n          answererWrappers: {\n            separator: \"自动答题设置\",\n            defaultValue: []\n          },\n          disabledAnswererWrapperNames: {\n            defaultValue: []\n          },\n          answererWrappersButton: {\n            label: \"题库配置\",\n            defaultValue: \"点击配置\",\n            attrs: {\n              type: \"button\"\n            },\n            onload() {\n              const aws = CommonProject.scripts.settings.cfg.answererWrappers || [];\n              this.value = aws.length ? \"当前有\" + aws.length + \"个可用题库，点击重新配置\" : \"点击配置\";\n              this.onclick = () => {\n                const aw = CommonProject.scripts.settings.cfg.answererWrappers || [];\n                const copy = lib.$ui.copy(\"复制题库配置\", JSON.stringify(aw, null, 4));\n                const list = lib.h(\"div\", [\n                  lib.h(\"div\", aw.length ? [\"以下是已经解析过的题库配置：\", copy] : \"\"),\n                  ...createAnswererWrapperList(aw)\n                ]);\n                const textarea = lib.h(\n                  \"textarea\",\n                  {\n                    className: \"modal-input\",\n                    style: { minHeight: \"250px\", width: \"calc(100% - 20px)\", maxWidth: \"100%\" },\n                    placeholder: aw.length ? \"重新输入题库配置\" : \"输入你的题库配置...，不会请看上方填写教程\"\n                  },\n                  aw.length === 0 ? \"\" : JSON.stringify(aw, null, 4)\n                );\n                const select = lib.$ui.tooltip(\n                  lib.h(\n                    \"select\",\n                    {\n                      className: \"base-style-active-form-control\",\n                      style: { backgroundColor: \"#eef2f7\", borderRadius: \"2px\", padding: \"2px 8px\" }\n                    },\n                    [\n                      lib.h(\"option\", \"默认\"),\n                      lib.h(\n                        \"option\",\n                        {\n                          title: \"大学生网课题库接口适配器: 将不同的题库整合为一个API接口。详细查看 https://github.com/DokiDoki1103/tikuAdapter\"\n                        },\n                        \"TikuAdapter\"\n                      )\n                    ]\n                  )\n                );\n                const modal2 = lib.$modal.prompt({\n                  width: 600,\n                  maskCloseable: false,\n                  content: lib.$ui.notes([\n                    [\n                      lib.h(\"div\", [\n                        \"题库配置填写教程：\",\n                        lib.h(\"a\", { href: \"https://docs.ocsjs.com/docs/work\" }, \"https://docs.ocsjs.com/docs/work\")\n                      ])\n                    ],\n                    [\n                      lib.h(\"div\", [\n                        \"⚠️ 如果无法粘贴，请点->：\",\n                        lib.h(\"button\", \"读取剪贴板\", (btn) => {\n                          btn.classList.add(\"base-style-button\");\n                          btn.onclick = () => {\n                            navigator.clipboard.readText().then((result) => {\n                              textarea.value = result;\n                            });\n                          };\n                        }),\n                        \"，并同意浏览器上方的剪贴板读取申请。\"\n                      ])\n                    ],\n                    [\"⚠️ 如果想添加多个不同的题库配置，请在每个配置之间使用三个井号隔开: ###。\"],\n                    [\"⚠️ 配置第三方题库出现网页弹窗的，点击永久允许连接。\"],\n                    ...aw.length ? [list] : []\n                  ]),\n                  footer: lib.h(\"div\", { style: { width: \"100%\" } }, [\n                    textarea,\n                    lib.h(\"div\", { style: { display: \"flex\", flexWrap: \"wrap\", marginTop: \"12px\", fontSize: \"12px\" } }, [\n                      lib.h(\"div\", [\"解析器：\", select], (div) => {\n                        div.style.marginRight = \"12px\";\n                        div.style.flex = \"1\";\n                      }),\n                      lib.h(\"div\", { style: { flex: \"1\", display: \"flex\", flexWrap: \"wrap\", justifyContent: \"end\" } }, [\n                        lib.h(\"button\", \"清空题库配置\", (btn) => {\n                          btn.className = \"modal-cancel-button\";\n                          btn.style.marginRight = \"48px\";\n                          btn.onclick = () => {\n                            lib.$modal.confirm({\n                              content: \"确定要清空题库配置吗？\",\n                              onConfirm: () => {\n                                lib.$message.success({ content: \"已清空，在答题前请记得重新配置。\" });\n                                modal2 == null ? void 0 : modal2.remove();\n                                CommonProject.scripts.settings.cfg.answererWrappers = [];\n                                this.value = \"点击配置\";\n                              }\n                            });\n                          };\n                        }),\n                        lib.h(\"button\", \"关闭\", (btn) => {\n                          btn.className = \"modal-cancel-button\";\n                          btn.style.marginRight = \"12px\";\n                          btn.onclick = () => modal2 == null ? void 0 : modal2.remove();\n                        }),\n                        lib.h(\"button\", \"保存配置\", (btn) => {\n                          btn.className = \"modal-confirm-button\";\n                          btn.onclick = async () => {\n                            const connects = lib.$gm.getMetadataFromScriptHead(\"connect\");\n                            const value = textarea.value;\n                            if (!value) {\n                              lib.$modal.alert({\n                                content: lib.h(\"div\", \"不能为空！\")\n                              });\n                              return;\n                            }\n                            if (value.includes(\"adapter-service/search\") && select.value === \"TikuAdapter\" === false) {\n                              lib.$modal.alert({\n                                content: lib.h(\"div\", [\n                                  \"检测到您可能正在使用 \",\n                                  lib.h(\n                                    \"a\",\n                                    { href: \"https://github.com/DokiDoki1103/tikuAdapter#readme\" },\n                                    \"TikuAdapter 题库\"\n                                  ),\n                                  \"，但是您选择的解析器不是 TikuAdapter，请选择 TikuAdapter 解析器，并填写接口地址即可，例如：http://localhost:8060/adapter-service/search，或者忽略此警告。\"\n                                ]),\n                                confirmButtonText: \"切换至 TikuAdapter 解析器，并识别接口地址\",\n                                onConfirm() {\n                                  var _a;\n                                  const origin = ((_a = textarea.value.match(/http:\\/\\/(.+)\\/adapter-service\\/search/)) == null ? void 0 : _a[1]) || \"\";\n                                  textarea.value = `http://${origin}/adapter-service/search`;\n                                  select.value = \"TikuAdapter\";\n                                }\n                              });\n                              return;\n                            }\n                            try {\n                              let awsResult = [];\n                              if (select.value === \"TikuAdapter\") {\n                                if (value.startsWith(\"http\") === false) {\n                                  lib.$modal.alert({\n                                    content: lib.h(\"div\", [\n                                      \"格式错误，TikuAdapter解析器只能解析 url 链接，请重新输入！或者查看：\",\n                                      lib.h(\n                                        \"a\",\n                                        { href: \"https://github.com/DokiDoki1103/tikuAdapter#readme\" },\n                                        \"https://github.com/DokiDoki1103/tikuAdapter#readme\"\n                                      )\n                                    ])\n                                  });\n                                  return;\n                                }\n                                select.value = \"默认\";\n                                awsResult.push({\n                                  name: \"TikuAdapter题库\",\n                                  url: value,\n                                  homepage: \"https://github.com/DokiDoki1103/tikuAdapter\",\n                                  method: \"post\",\n                                  type: \"GM_xmlhttpRequest\",\n                                  contentType: \"json\",\n                                  headers: {},\n                                  data: {\n                                    question: \"${title}\",\n                                    options: {\n                                      handler: \"return (env)=>env.options?.split('\\\\n')\"\n                                    },\n                                    type: {\n                                      handler: \" return (env)=> env.type === 'single' ? 0 : env.type === 'multiple' ? 1 : env.type === 'completion' ? 3 : env.type === 'judgement' ? 4 : undefined\"\n                                    }\n                                  },\n                                  handler: \"return (res)=>res.answer.allAnswer.map(i=>([res.question,i.join('#')]))\"\n                                });\n                              } else {\n                                const contents = value.split(\"###\").map((i) => i.trim()).filter(Boolean);\n                                for (const content of contents) {\n                                  awsResult.push(...await AnswerWrapperParser.from(content));\n                                }\n                              }\n                              if (awsResult.length === 0) {\n                                lib.$modal.alert({ content: \"题库配置不能为空，请重新配置。\" });\n                                return;\n                              }\n                              const result_set = [];\n                              for (const res of awsResult) {\n                                if (result_set.find((i) => JSON.stringify(i) === JSON.stringify(res))) {\n                                  continue;\n                                }\n                                result_set.push(res);\n                              }\n                              awsResult = result_set;\n                              if (JSON.stringify(CommonProject.scripts.settings.cfg.answererWrappers) === JSON.stringify(awsResult)) {\n                                lib.$modal.alert({ content: lib.h(\"div\", [\"题库配置没有变化，请重新配置！\"]) });\n                                return;\n                              }\n                              CommonProject.scripts.settings.cfg.answererWrappers = awsResult;\n                              this.value = \"当前有\" + awsResult.length + \"个可用题库\";\n                              lib.$modal.confirm({\n                                width: 600,\n                                content: lib.h(\"div\", [\n                                  lib.h(\"div\", [\n                                    \"🎉 配置成功，\",\n                                    lib.h(\"b\", \" 刷新网页后 \"),\n                                    \"重新进入\",\n                                    lib.h(\"b\", \" 答题页面 \"),\n                                    \"即可。\",\n                                    \"解析到的题库如下所示:\"\n                                  ]),\n                                  ...createAnswererWrapperList(awsResult)\n                                ]),\n                                onConfirm: () => {\n                                  if (lib.$gm.isInGMContext()) {\n                                    top == null ? void 0 : top.document.location.reload();\n                                  }\n                                },\n                                ...lib.$gm.isInGMContext() ? {\n                                  confirmButtonText: \"立即刷新\",\n                                  cancelButtonText: \"稍后刷新\"\n                                } : {}\n                              });\n                              textarea.value = JSON.stringify(awsResult, null, 4);\n                              if (connects.length) {\n                                const notAllowed = [];\n                                if (connects.includes(\"*\")) {\n                                  return;\n                                }\n                                for (const aw2 of awsResult) {\n                                  if (connects.some((connect) => new URL(aw2.url).hostname.includes(connect)) === false) {\n                                    notAllowed.push(aw2.url);\n                                  }\n                                }\n                                if (notAllowed.length) {\n                                  lib.$modal.alert({\n                                    width: 600,\n                                    maskCloseable: false,\n                                    title: \"⚠️警告\",\n                                    content: lib.h(\"div\", [\n                                      lib.h(\"div\", [\n                                        \"配置成功，但检测到以下 域名/ip 不在脚本的白名单中，请安装 : \",\n                                        lib.h(\n                                          \"a\",\n                                          {\n                                            href: \"https://docs.ocsjs.com/docs/other/api#全域名通用版本\"\n                                          },\n                                          \"OCS全域名通用版本\"\n                                        ),\n                                        \"，或者手动添加 @connect ，否则无法进行请求。\",\n                                        lib.h(\n                                          \"ul\",\n                                          notAllowed.map((url) => lib.h(\"li\", new URL(url).hostname))\n                                        )\n                                      ])\n                                    ])\n                                  });\n                                }\n                              }\n                            } catch (e) {\n                              lib.$modal.alert({\n                                content: lib.h(\"div\", [lib.h(\"div\", \"解析失败，原因如下 :\"), lib.h(\"div\", e.message)])\n                              });\n                            }\n                          };\n                        })\n                      ])\n                    ])\n                  ])\n                });\n              };\n            }\n          },\n          upload: {\n            label: \"答题完成后\",\n            tag: \"select\",\n            defaultValue: 80,\n            options: [\n              [\"save\", \"自动保存\", \"完成后自动保存答案, 注意如果你开启了随机作答, 有可能分辨不出答案是否正确。\"],\n              [\"nomove\", \"不保存也不提交\", \"等待时间过后将会自动下一节, 适合在测试脚本时使用。\"],\n              ...[10, 20, 30, 40, 50, 60, 70, 80, 90].map((rate) => [\n                rate,\n                `搜到${rate}%的题目则自动提交`,\n                `例如: 100题中查询到 ${rate} 题的答案,（答案不一定正确）, 则会自动提交。`\n              ]),\n              [\"100\", \"每个题目都查到答案才自动提交\", \"答案不一定正确\"],\n              [\"force\", \"强制自动提交\", \"不管答案是否正确直接强制自动提交，如需开启，请配合随机作答谨慎使用。\"]\n            ],\n            attrs: {\n              title: \"自动答题完成后的设置，目前仅在 超星学习通的章节测试 中生效, 鼠标悬浮在选项上可以查看每个选项的具体解释。\"\n            }\n          },\n          thread: {\n            label: \"线程数量（个）\",\n            attrs: {\n              type: \"number\",\n              min: 1,\n              step: 1,\n              max: 3,\n              title: \"同一时间内答题线程工作的数量（例子：三个线程则代表一秒内同时搜索三道题），过多可能导致题库服务器压力过大，请适当调低。\"\n            },\n            defaultValue: 1\n          },\n          \"work-when-no-job\": {\n            defaultValue: false,\n            label: \"(仅超星)强制答题\",\n            attrs: {\n              type: \"checkbox\",\n              title: \"当章节测试左上角并没有黄色任务点的时候依然进行答题（没有任务点说明此作业可能不计入总成绩，如果老师要求则可以开启）\"\n            }\n          },\n          \"randomWork-choice\": {\n            defaultValue: false,\n            label: \"(仅超星)随机选择\",\n            attrs: { type: \"checkbox\", title: \"题库搜索不到答案时，随机选择任意一个选项\" }\n          },\n          \"randomWork-complete\": {\n            defaultValue: false,\n            label: \"(仅超星)随机填空\",\n            attrs: { type: \"checkbox\", title: \"题库搜索不到答案时，随机填写以下任意一个文案\" }\n          },\n          \"randomWork-completeTexts-textarea\": {\n            defaultValue: [\"不会\", \"不知道\", \"不清楚\", \"不懂\", \"不会写\"].join(\"\\n\"),\n            label: \"(仅超星)随机填空文案\",\n            tag: \"textarea\",\n            showIf: \"common.settings.randomWork-complete\",\n            attrs: { title: \"每行一个，随机填入\", style: { minWidth: \"200px\", minHeight: \"50px\" } },\n            onload(el) {\n              el.addEventListener(\"change\", () => {\n                if (String(el.value).trim() === \"\") {\n                  el.value = el.defaultValue;\n                }\n              });\n            }\n          },\n          advancedSettings: {\n            ...dropdownStyle,\n            defaultValue: false,\n            label: \"高级设置\",\n            attrs: { type: \"checkbox\", title: \"请谨慎使用高级设置，可能会影响答题效果，小白在未理解的情况下谨慎调整。\" }\n          },\n          answerWrapperHandlerTimeout: {\n            showIf: \"common.settings.advancedSettings\",\n            elementClassName: \"config-details\",\n            label: \"搜题最大耗时（秒）\",\n            attrs: {\n              type: \"number\",\n              min: 10,\n              step: 1,\n              max: 3 * 60,\n              title: \"搜题超时时间，单位为秒，超过这个时间直接放弃，进行下一题搜索。\"\n            },\n            defaultValue: 120\n          },\n          stopSecondWhenFinish: {\n            showIf: \"common.settings.advancedSettings\",\n            elementClassName: \"config-details\",\n            label: \"答题结束后暂停（秒）\",\n            attrs: {\n              type: \"number\",\n              min: 3,\n              step: 1,\n              max: 9999,\n              title: \"自动答题脚本结束后暂停的时间（方便查看和检查）。\"\n            },\n            defaultValue: 3\n          },\n          period: {\n            showIf: \"common.settings.advancedSettings\",\n            elementClassName: \"config-details\",\n            label: \"搜题间隔（秒）\",\n            attrs: {\n              type: \"number\",\n              min: 1,\n              step: 1,\n              max: 60,\n              title: \"每道题的搜题间隔时间，不建议太低，避免增加服务器压力。\"\n            },\n            defaultValue: 3\n          },\n          answerSeparators: {\n            showIf: \"common.settings.advancedSettings\",\n            elementClassName: \"config-details\",\n            label: \"答案分隔符\",\n            attrs: {\n              title: \"分隔答案的符号，例如：答案1#答案2#答案3，分隔符为 #， 使用英文逗号进行隔开 : ',' \"\n            },\n            defaultValue: [\"===\", \"#\", \"---\", \"###\", \"|\", \";\", \"；\"].join(\",\"),\n            onload(el) {\n              el.addEventListener(\"change\", () => {\n                if (String(el.value).trim() === \"\") {\n                  el.value = el.defaultValue;\n                }\n              });\n            }\n          },\n          answerMatchMode: {\n            showIf: \"common.settings.advancedSettings\",\n            elementClassName: \"config-details\",\n            label: \"答案匹配模式\",\n            tag: \"select\",\n            defaultValue: \"similar\",\n            options: [\n              [\"similar\", \"相似匹配\", \"答案相似度达到60%以上就匹配\"],\n              [\"exact\", \"精确匹配\", \"答案必须完全一致才匹配\"]\n            ]\n          },\n          redundanceWordsText: {\n            showIf: \"common.settings.advancedSettings\",\n            elementClassName: \"config-details\",\n            defaultValue: [\n              \"单选题(必考)\",\n              \"填空题(必考)\",\n              \"多选题(必考)\",\n              \"(单选题)\",\n              \"(多选题)\",\n              \"(判断题)\",\n              \"(填空题)\",\n              \"【单选题】\",\n              \"【多选题】\",\n              \"【填空题】\",\n              \"【判断题】\",\n              \"【單選题】\",\n              \"【多選题】\",\n              \"【判斷题】\",\n              \"【Single Choice】\",\n              \"【Multiple Choice】\",\n              \"【single choice】\",\n              \"【multiple choice】\",\n              \"【True or False】\"\n            ].join(\"\\n\"),\n            label: \"题目冗余字段自动删除\",\n            tag: \"textarea\",\n            attrs: {\n              title: \"在搜题的时候自动删除多余的文字，以便提高搜题的准确度，每行一个。\",\n              style: { minWidth: \"200px\", minHeight: \"50px\" }\n            },\n            onload(el) {\n              el.addEventListener(\"change\", () => {\n                if (String(el.value).trim() === \"\") {\n                  el.value = el.defaultValue;\n                }\n              });\n            }\n          },\n          notification: {\n            separator: \"其他设置\",\n            label: \"系统通知\",\n            attrs: {\n              title: \"允许脚本发送系统通知，只有重要事情发生时会发送系统通知，尽量避免用户受到骚扰（在电脑屏幕右侧显示通知弹窗，例如脚本执行完毕，图形验证码，版本更新等通知）。\"\n            },\n            tag: \"select\",\n            defaultValue: \"only-notify\",\n            options: [\n              [\"only-notify\", \"只显示右下角通知\"],\n              [\"notify-and-voice\", \"通知以及提示音（叮的一声）\"],\n              [\"all\", \"通知，提示音，以及任务栏闪烁提示\"],\n              [\"no-notify\", \"关闭系统通知\"]\n            ]\n          },\n          notificationWebhooks: {\n            label: \"通知回调\",\n            attrs: {\n              title: \"发送系统通知时发送回调请求，用于专业开发人员对接其他通知系统。（每行填写一个URL，顺序发送GET请求，${message} 为消息占位符，可用于消息变量替换）\"\n            },\n            tag: \"textarea\",\n            defaultValue: \"\"\n          },\n          enableQuestionCaches: {\n            label: \"题库缓存功能\",\n            defaultValue: true,\n            attrs: { type: \"checkbox\", title: \"详情请前往 通用-其他应用-题库拓展查看。\" }\n          }\n        },\n        methods() {\n          return {\n            getWorkOptions: () => {\n              const workOptions = JSON.parse(JSON.stringify(this.cfg));\n              workOptions.answererWrappers = workOptions.answererWrappers.filter(\n                (aw) => this.cfg.disabledAnswererWrapperNames.find((daw) => daw === aw.name) === void 0\n              );\n              return workOptions;\n            },\n            notificationBySetting: (content, opts) => {\n              var _a;\n              if (this.cfg.notification !== \"no-notify\") {\n                lib.$gm.notification(content, {\n                  extraTitle: opts == null ? void 0 : opts.extraTitle,\n                  duration: (_a = opts == null ? void 0 : opts.duration) != null ? _a : 30,\n                  important: this.cfg.notification === \"all\",\n                  silent: this.cfg.notification === \"only-notify\"\n                });\n                const message2 = ((opts == null ? void 0 : opts.extraTitle) ? (opts == null ? void 0 : opts.extraTitle) + \"：\" : \"\") + content;\n                const webhooks = this.cfg.notificationWebhooks.split(\"\\n\").map((i) => i.trim()).filter(Boolean);\n                for (const webhook of webhooks) {\n                  let resolved_webhook = webhook;\n                  resolved_webhook = webhook.replace(\"${message}\", encodeURIComponent(message2));\n                  request(resolved_webhook, {\n                    method: \"get\",\n                    type: \"GM_xmlhttpRequest\"\n                  }).then((result) => {\n                    console.debug(\"通知回调成功\", { webhook: resolved_webhook, result });\n                  }).catch((err) => {\n                    console.debug(\"通知回调失败\", { webhook: resolved_webhook, err });\n                  });\n                }\n              }\n            }\n          };\n        },\n        oncomplete() {\n          AnswerWrapperHandlerConfig.timeout_seconds = this.cfg.answerWrapperHandlerTimeout;\n          this.onConfigChange(\"answerWrapperHandlerTimeout\", (sec) => {\n            AnswerWrapperHandlerConfig.timeout_seconds = sec;\n          });\n        },\n        onrender({ panel }) {\n          if (lib.$gm.isInGMContext()) {\n            panel.body.replaceChildren(...this.cfg.answererWrappers.length ? [lib.h(\"hr\")] : []);\n            const testNotification = lib.h(\n              \"button\",\n              { className: \"base-style-button\", disabled: this.cfg.answererWrappers.length === 0 },\n              \"📢测试系统通知\"\n            );\n            testNotification.onclick = () => {\n              this.methods.notificationBySetting(\"这是一条测试通知\");\n            };\n            const refresh = lib.h(\n              \"button\",\n              { className: \"base-style-button\", disabled: this.cfg.answererWrappers.length === 0 },\n              \"🔄️刷新题库状态\"\n            );\n            refresh.onclick = () => {\n              updateState();\n            };\n            const tableContainer = lib.h(\"div\");\n            refresh.style.display = \"none\";\n            tableContainer.style.display = \"none\";\n            panel.body.append(lib.h(\"div\", { style: { display: \"flex\" } }, [testNotification, refresh]), tableContainer);\n            const updateState = async () => {\n              tableContainer.replaceChildren();\n              let loadedCount = 0;\n              if (this.cfg.answererWrappers.length) {\n                refresh.style.display = \"block\";\n                tableContainer.style.display = \"block\";\n                refresh.textContent = \"🚫正在加载题库状态...\";\n                refresh.setAttribute(\"disabled\", \"true\");\n                const table = lib.h(\"table\");\n                table.style.width = \"100%\";\n                this.cfg.answererWrappers.forEach(async (item) => {\n                  const t2 = Date.now();\n                  let success = false;\n                  let error;\n                  const isDisabled = this.cfg.disabledAnswererWrapperNames.find((name) => name === item.name);\n                  const res = isDisabled ? false : await Promise.race([\n                    (async () => {\n                      try {\n                        return await request(new URL(item.url).origin + \"/?t=\" + t2, {\n                          type: \"GM_xmlhttpRequest\",\n                          method: \"head\",\n                          responseType: \"text\"\n                        });\n                      } catch (err) {\n                        error = err;\n                        return false;\n                      }\n                    })(),\n                    (async () => {\n                      await $.sleep(10 * 1e3);\n                      return false;\n                    })()\n                  ]);\n                  if (typeof res === \"string\") {\n                    success = true;\n                  } else {\n                    success = false;\n                  }\n                  const body = lib.h(\"tbody\");\n                  body.append(lib.h(\"td\", item.name));\n                  body.append(\n                    lib.h(\"td\", [\n                      lib.$ui.tooltip(\n                        lib.h(\n                          \"span\",\n                          { title: isDisabled ? \"题目已经被停用，请在上方题库配置中点击开启。\" : \"\" },\n                          success ? \"连接成功🟢\" : isDisabled ? \"已停用⚪\" : error ? \"连接失败🔴\" : \"连接超时🟡\"\n                        )\n                      )\n                    ])\n                  );\n                  body.append(lib.h(\"td\", `延迟 : ${success ? Date.now() - t2 : \"---\"}/ms`));\n                  table.append(body);\n                  loadedCount++;\n                  if (loadedCount === this.cfg.answererWrappers.length) {\n                    setTimeout(() => {\n                      refresh.textContent = \"🔄️刷新题库状态\";\n                      refresh.removeAttribute(\"disabled\");\n                    }, 2e3);\n                  }\n                });\n                tableContainer.append(table);\n              } else {\n                refresh.style.display = \"none\";\n                tableContainer.style.display = \"none\";\n              }\n            };\n            updateState();\n            this.offConfigChange(state$5.setting.listenerIds.aw);\n            state$5.setting.listenerIds.aw = this.onConfigChange(\"answererWrappers\", (_, __, remote) => {\n              if (remote === false) {\n                updateState();\n              }\n            });\n          }\n        }\n      }),\n      workResults: new lib.Script({\n        name: \"🔎 搜索结果\",\n        matches: [[\"所有页面\", /.*/]],\n        namespace: \"common.work-results\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\"点击题目序号，查看搜索结果\", \"如果没有搜到，可能是题库没有收录该题目答案\"]).outerHTML\n          },\n          type: {\n            label: \"显示类型\",\n            tag: \"select\",\n            options: [\n              [\"numbers\", \"序号列表\"],\n              [\"questions\", \"题目列表\"]\n            ],\n            attrs: {\n              title: \"使用题目列表可能会造成页面卡顿。\"\n            },\n            defaultValue: \"numbers\"\n          },\n          totalQuestionCount: {\n            defaultValue: 0\n          },\n          requestedCount: {\n            defaultValue: 0\n          },\n          resolvedCount: {\n            defaultValue: 0\n          },\n          currentResultIndex: {\n            defaultValue: 0\n          },\n          questionPositionSyncHandlerType: {\n            defaultValue: void 0\n          }\n        },\n        methods() {\n          return {\n            updateWorkStateByResults: (results) => {\n              this.cfg.totalQuestionCount = results.length;\n              this.cfg.requestedCount = results.filter((result) => result.requested).length;\n              this.cfg.resolvedCount = results.filter((result) => result.resolved).length;\n            },\n            updateWorkState: (state2) => {\n              this.cfg.totalQuestionCount = state2.totalQuestionCount;\n              this.cfg.requestedCount = state2.requestedCount;\n              this.cfg.resolvedCount = state2.resolvedCount;\n            },\n            refreshState: () => {\n              this.cfg.totalQuestionCount = 0;\n              this.cfg.requestedCount = 0;\n              this.cfg.resolvedCount = 0;\n            },\n            clearResults: () => {\n              return lib.$store.setTab(TAB_WORK_RESULTS_KEY, []);\n            },\n            getResults() {\n              return lib.$store.getTab(TAB_WORK_RESULTS_KEY) || void 0;\n            },\n            setResults(results) {\n              return lib.$store.setTab(TAB_WORK_RESULTS_KEY, results);\n            },\n            async appendResults(results) {\n              const data = await lib.$store.getTab(TAB_WORK_RESULTS_KEY) || [];\n              data.push(...results);\n              return lib.$store.setTab(TAB_WORK_RESULTS_KEY, data);\n            },\n            init(opts) {\n              CommonProject.scripts.workResults.cfg.questionPositionSyncHandlerType = opts == null ? void 0 : opts.questionPositionSyncHandlerType;\n              CommonProject.scripts.workResults.methods.refreshState();\n              CommonProject.scripts.workResults.methods.clearResults();\n            },\n            createWorkResultsPanel: (mount2) => {\n              const container2 = mount2 || lib.h(\"div\");\n              container2.style.width = \"400px\";\n              let scrollPercent = 0;\n              const list = lib.h(\"div\", { className: \"work-result-list\" });\n              let mouseoverIndex = -1;\n              list.onscroll = () => {\n                scrollPercent = list.scrollTop / list.scrollHeight;\n              };\n              const setNumStyle = (result, num, index) => {\n                var _a;\n                if (result.requested) {\n                  num.classList.add(\"requested\");\n                }\n                if (index === this.cfg.currentResultIndex) {\n                  num.classList.add(\"active\");\n                }\n                if (result.finish) {\n                  num.classList.add(\"finish\");\n                } else {\n                  if (result.requested && result.resolved && (((_a = result.error) == null ? void 0 : _a.trim().length) !== 0 || result.searchInfos.length === 0 || result.finish === false)) {\n                    num.classList.add(\"error\");\n                  }\n                }\n              };\n              const render2 = debounce_1$1(async () => {\n                const results = await CommonProject.scripts.workResults.methods.getResults();\n                if (results == null ? void 0 : results.length) {\n                  if (results[this.cfg.currentResultIndex] === void 0) {\n                    this.cfg.currentResultIndex = 0;\n                  }\n                  if (this.cfg.type === \"numbers\") {\n                    const resultContainer = lib.h(\"div\", { className: \"work-result-container\" });\n                    list.style.marginBottom = \"12px\";\n                    list.style.overflow = \"auto\";\n                    list.style.maxHeight = \"300px\";\n                    const nums = results.map((result, index) => {\n                      return lib.h(\"span\", { className: \"search-infos-num\", innerText: (index + 1).toString() }, (num) => {\n                        setNumStyle(result, num, index);\n                        num.onclick = () => {\n                          var _a, _b;\n                          for (const n of nums) {\n                            n.classList.remove(\"active\");\n                          }\n                          num.classList.add(\"active\");\n                          this.cfg.currentResultIndex = index;\n                          resultContainer.replaceChildren(createResult(result));\n                          if (this.cfg.questionPositionSyncHandlerType) {\n                            (_b = (_a = state$5.workResult.questionPositionSyncHandler)[this.cfg.questionPositionSyncHandlerType]) == null ? void 0 : _b.call(\n                              _a,\n                              index\n                            );\n                          }\n                        };\n                      });\n                    });\n                    list.replaceChildren(...nums);\n                    resultContainer.replaceChildren(createResult(results[this.cfg.currentResultIndex]));\n                    container2.replaceChildren(list, resultContainer);\n                  } else {\n                    list.style.overflow = \"auto\";\n                    list.style.maxHeight = window.innerHeight / 2 + \"px\";\n                    const resultContainer = lib.h(\"div\", { className: \"work-result-question-container\" });\n                    const nums = [];\n                    const questions = results.map((result, index) => {\n                      const num = lib.h(\n                        \"span\",\n                        {\n                          className: \"search-infos-num\",\n                          innerHTML: (index + 1).toString()\n                        },\n                        (num2) => {\n                          num2.style.marginRight = \"12px\";\n                          num2.style.display = \"inline-block\";\n                          setNumStyle(result, num2, index);\n                        }\n                      );\n                      nums.push(num);\n                      return lib.h(\n                        \"div\",\n                        [num, result.question],\n                        (question) => {\n                          question.onmouseover = () => {\n                            mouseoverIndex = index;\n                            resultContainer.replaceChildren(createResult(result));\n                          };\n                          question.onmouseleave = () => {\n                            mouseoverIndex = -1;\n                            resultContainer.replaceChildren(createResult(results[this.cfg.currentResultIndex]));\n                          };\n                          question.onclick = () => {\n                            var _a, _b;\n                            for (const n of nums) {\n                              n.classList.remove(\"active\");\n                            }\n                            for (const q of questions) {\n                              q.classList.remove(\"active\");\n                            }\n                            nums[index].classList.add(\"active\");\n                            question.classList.add(\"active\");\n                            this.cfg.currentResultIndex = index;\n                            resultContainer.replaceChildren(createResult(result));\n                            if (this.cfg.questionPositionSyncHandlerType) {\n                              (_b = (_a = state$5.workResult.questionPositionSyncHandler)[this.cfg.questionPositionSyncHandlerType]) == null ? void 0 : _b.call(\n                                _a,\n                                index\n                              );\n                            }\n                          };\n                        }\n                      );\n                    });\n                    list.replaceChildren(...questions);\n                    if (mouseoverIndex === -1) {\n                      resultContainer.replaceChildren(createResult(results[this.cfg.currentResultIndex]));\n                    } else {\n                      resultContainer.replaceChildren(createResult(results[mouseoverIndex]));\n                    }\n                    container2.replaceChildren(\n                      lib.h(\"div\", [list, lib.h(\"div\", {}, [resultContainer])], (div) => {\n                        div.style.display = \"flex\";\n                      })\n                    );\n                  }\n                } else {\n                  container2.replaceChildren(\n                    lib.h(\"div\", { className: \"alert-info-wrapper\" }, [\n                      lib.h(\"div\", \"暂无任何搜索结果~\", (div) => {\n                        div.style.marginTop = \"12px\";\n                        div.className = \"result-info no-answer\";\n                      })\n                    ])\n                  );\n                }\n                list.scrollTo({\n                  top: scrollPercent * list.scrollHeight,\n                  behavior: \"auto\"\n                });\n                const tip = lib.h(\"div\", [\n                  lib.h(\"div\", { className: \"search-infos-num\" }, \"1\"),\n                  \" 表示等待处理中\",\n                  lib.h(\"br\"),\n                  lib.h(\"div\", { className: \"search-infos-num requested\" }, \"1\"),\n                  \" 表示已完成搜索 \",\n                  lib.h(\"br\"),\n                  lib.h(\"div\", { className: \"search-infos-num finish\" }, \"1\"),\n                  \" 表示已搜索已答题 \"\n                ]);\n                container2.prepend(\n                  lib.h(\"hr\"),\n                  lib.h(\n                    \"div\",\n                    [\n                      lib.$ui.space(\n                        [\n                          lib.h(\"span\", `已搜题: ${this.cfg.requestedCount}/${this.cfg.totalQuestionCount}`),\n                          lib.h(\"span\", `已答题: ${this.cfg.resolvedCount}/${this.cfg.totalQuestionCount}`),\n                          lib.h(\"a\", \"提示\", (btn) => {\n                            btn.style.cursor = \"pointer\";\n                            btn.onclick = () => {\n                              lib.$modal.confirm({ content: tip, footer: void 0 });\n                            };\n                          }),\n                          lib.$ui.tooltip(\n                            lib.h(\"a\", \"清空结果\", (btn) => {\n                              btn.title = \"仅用于不会自动清空搜索结果的场景，例如超星非整卷预览模式\";\n                              btn.style.cursor = \"pointer\";\n                              btn.onclick = () => {\n                                var _a, _b, _c, _d;\n                                this.methods.clearResults();\n                                const { panel, header: header2 } = CXProject.scripts.work;\n                                if (panel && header2) {\n                                  (_b = (_a = CXProject.scripts.work).onrender) == null ? void 0 : _b.call(_a, { panel, header: header2 });\n                                  (_d = (_c = CommonProject.scripts.workResults).onrender) == null ? void 0 : _d.call(_c, { panel, header: header2 });\n                                }\n                              };\n                            })\n                          )\n                        ],\n                        { separator: \"|\" }\n                      )\n                    ],\n                    (div) => {\n                      div.style.textAlign = \"center\";\n                      div.style.fontSize = \"12px\";\n                    }\n                  )\n                );\n              }, 100);\n              const createResult = (result) => {\n                if (result) {\n                  let info = null;\n                  if (result.requested === false && result.resolved === false) {\n                    info = lib.h(\"div\", { className: \"result-info unresolved\" }, \"等待搜索中... 🔍\");\n                  } else if (result.error) {\n                    info = lib.h(\"div\", { className: \"result-info error\" }, \"❌ \" + result.error);\n                  } else if (result.searchInfos.length === 0) {\n                    info = lib.h(\"div\", { className: \"result-info no-answer\" }, \"❌ 题库没搜索到答案\");\n                  } else {\n                    info = result.finish ? null : result.resolved === false ? lib.h(\"div\", { className: \"result-info unresolved\" }, \"等待顺序答题中... ⏱️\") : lib.h(\"div\", { className: \"result-info error\" }, \"❌ 此题未完成, 可能是没有匹配的选项。\");\n                  }\n                  return lib.h(\"div\", [\n                    lib.h(\"div\", { className: \"alert-info-wrapper\" }, [info != null ? info : lib.h(\"div\")]),\n                    lib.h(SearchInfosElement, {\n                      infos: result.searchInfos,\n                      question: result.question,\n                      type: result.type\n                    })\n                  ]);\n                } else {\n                  return lib.h(\"div\", \"undefined\");\n                }\n              };\n              render2();\n              this.onConfigChange(\"type\", render2);\n              this.onConfigChange(\"requestedCount\", render2);\n              this.onConfigChange(\"resolvedCount\", render2);\n              lib.$store.addChangeListener(TAB_WORK_RESULTS_KEY, render2);\n              return container2;\n            }\n          };\n        },\n        onrender({ panel }) {\n          panel.body.replaceChildren(this.methods.createWorkResultsPanel());\n        }\n      }),\n      onlineSearch: new lib.Script({\n        name: \"🔎 在线搜题\",\n        matches: [[\"所有页面\", /.*/]],\n        namespace: \"common.online-search\",\n        configs: {\n          notes: {\n            defaultValue: \"查题前请在 “通用-全局设置” 中设置题库配置，才能进行在线搜题。\"\n          },\n          selectSearch: {\n            label: \"划词搜索\",\n            defaultValue: true,\n            attrs: { type: \"checkbox\", title: \"使用鼠标滑动选择页面中的题目进行搜索。\" }\n          },\n          searchValue: {\n            sync: true,\n            label: \"搜索题目\",\n            tag: \"textarea\",\n            attrs: {\n              placeholder: \"输入题目，请尽量保证题目完整，不要漏字\",\n              style: {\n                minWidth: \"300px\",\n                minHeight: \"64px\"\n              }\n            },\n            defaultValue: \"\"\n          }\n        },\n        oncomplete() {\n          document.addEventListener(\n            \"selectionchange\",\n            debounce_1$1(() => {\n              var _a;\n              if (this.cfg.selectSearch) {\n                const val = ((_a = document.getSelection()) == null ? void 0 : _a.toString()) || \"\";\n                if (val) {\n                  this.cfg.searchValue = val;\n                }\n              }\n            }, 500)\n          );\n        },\n        onrender({ panel }) {\n          const content = lib.h(\"div\", \"\", (content2) => {\n            content2.style.marginBottom = \"12px\";\n          });\n          const search = async (value) => {\n            if (CommonProject.scripts.settings.cfg.answererWrappers.length === 0) {\n              lib.$modal.alert({ content: \"请先在 通用-全局设置 配置题库，才能进行在线搜题。\" });\n              return;\n            }\n            content.replaceChildren(lib.h(\"span\", \"搜索中...\"));\n            if (value) {\n              const t2 = Date.now();\n              const infos = await defaultAnswerWrapperHandler(CommonProject.scripts.settings.cfg.answererWrappers, {\n                title: value\n              });\n              const resume = ((Date.now() - t2) / 1e3).toFixed(2);\n              content.replaceChildren(\n                lib.h(\n                  \"div\",\n                  [\n                    lib.h(\"hr\"),\n                    lib.h(\n                      \"div\",\n                      { style: { color: \"#a1a1a1\" } },\n                      `搜索到 ${infos.map((i) => i.results).flat().length} 个结果，共耗时 ${resume} 秒`\n                    ),\n                    lib.h(SearchInfosElement, {\n                      infos: infos.map((info) => ({\n                        results: info.results.map(\n                          (res) => [res.question, res.answer, res.extra_data]\n                        ),\n                        homepage: info.homepage,\n                        name: info.name\n                      })),\n                      question: value\n                    })\n                  ],\n                  (div) => {\n                    div.classList.add(\"card\");\n                    div.style.width = \"480px\";\n                  }\n                )\n              );\n            } else {\n              content.replaceChildren(lib.h(\"span\", \"题目不能为空！\"));\n            }\n          };\n          const button = lib.h(\"button\", \"搜索\", (button2) => {\n            button2.className = \"base-style-button\";\n            button2.style.width = \"120px\";\n            button2.onclick = () => {\n              search(this.cfg.searchValue);\n            };\n          });\n          const searchContainer = lib.h(\"div\", { style: { textAlign: \"end\" } }, [button]);\n          panel.body.append(lib.h(\"div\", [content, searchContainer]));\n        }\n      }),\n      render: RenderScript,\n      hack: new lib.Script({\n        name: \"页面复制粘贴限制解除\",\n        matches: [[\"所有页面\", /.*/]],\n        hideInPanel: true,\n        onactive() {\n          enableCopy([document, document.body]);\n        },\n        oncomplete() {\n          enableCopy([document, document.body]);\n          insertCopyableStyle();\n          setTimeout(() => {\n            enableCopy([document, document.body]);\n            insertCopyableStyle();\n          }, 3e3);\n        }\n      }),\n      disableDialog: new lib.Script({\n        name: \"禁止弹窗\",\n        matches: [[\"所有页面\", /.*/]],\n        hideInPanel: true,\n        priority: 1,\n        onstart() {\n          function disableDialog(msg) {\n            lib.$modal.alert({\n              profile: \"弹窗来自：\" + location.origin,\n              content: msg\n            });\n          }\n          try {\n            lib.$gm.unsafeWindow.alert = disableDialog;\n            window.alert = disableDialog;\n          } catch (e) {\n            console.error(e);\n          }\n        }\n      }),\n      apps: new lib.Script({\n        name: \"📱 拓展应用\",\n        matches: [[\"\", /.*/]],\n        namespace: \"common.apps\",\n        configs: {\n          notes: {\n            defaultValue: \"这里是一些其他的应用或者拓展功能。\"\n          },\n          localQuestionCaches: {\n            defaultValue: [],\n            extra: {\n              appConfigSync: false\n            }\n          }\n        },\n        methods() {\n          return {\n            addQuestionCache: async (...questionCacheItems) => {\n              const questionCaches = this.cfg.localQuestionCaches;\n              for (const item of questionCacheItems) {\n                if (questionCaches.find((c) => c.title === item.title && c.answer === item.answer) === void 0) {\n                  questionCaches.unshift(item);\n                }\n              }\n              questionCaches.splice(200);\n              this.cfg.localQuestionCaches = questionCaches;\n            },\n            addQuestionCacheFromWorkResult(swr) {\n              CommonProject.scripts.apps.methods.addQuestionCache(\n                ...swr.map(\n                  (r) => r.searchInfos.map(\n                    (i) => i.results.filter((res) => res[1]).map((res) => ({\n                      title: r.question,\n                      answer: res[1],\n                      from: i.name.replace(/【题库缓存】/g, \"\"),\n                      homepage: i.homepage || \"\"\n                    })).flat()\n                  ).flat()\n                ).flat()\n              );\n            },\n            searchAnswerInCaches: async (title, whenSearchEmpty) => {\n              if (CommonProject.scripts.settings.cfg.enableQuestionCaches === false) {\n                return await whenSearchEmpty();\n              }\n              let results = [];\n              const caches = this.cfg.localQuestionCaches;\n              for (const cache of caches) {\n                if (cache.title.trim() === title.trim()) {\n                  results.push({\n                    name: cache.from,\n                    homepage: cache.homepage,\n                    results: [{ answer: cache.answer, question: cache.title, extra_data: { ai: cache.ai, cache: true } }]\n                  });\n                }\n              }\n              if (results.length === 0) {\n                results = await whenSearchEmpty();\n              }\n              return results;\n            },\n            async showChangelog() {\n              const changelog = lib.h(\"div\", {\n                className: \"markdown card\",\n                innerHTML: \"加载中...\",\n                style: { maxWidth: \"600px\" }\n              });\n              lib.$modal.simple({\n                width: 600,\n                content: lib.h(\"div\", [\n                  lib.h(\"div\", { className: \"notes card\" }, [\n                    lib.$ui.notes([\"此页面实时更新，遇到问题可以查看最新版本是否修复。\"])\n                  ]),\n                  changelog\n                ])\n              });\n              const md = await request(\"https://cdn.ocsjs.com/articles/ocs/changelog.md?t=\" + Date.now(), {\n                type: \"GM_xmlhttpRequest\",\n                responseType: \"text\",\n                method: \"get\"\n              });\n              changelog.innerHTML = markdown(md);\n            }\n          };\n        },\n        onrender({ panel }) {\n          const btnStyle = {\n            padding: \"6px 12px\",\n            margin: \"4px\",\n            marginBottom: \"8px\",\n            boxShadow: \"0px 0px 4px #bebebe\",\n            borderRadius: \"8px\",\n            cursor: \"pointer\"\n          };\n          const cachesBtn = lib.h(\"div\", { innerText: \"💾 题库缓存\", style: btnStyle }, (btn) => {\n            btn.onclick = () => {\n              const questionCaches = this.cfg.localQuestionCaches;\n              const list = questionCaches.map(\n                (c) => lib.h(\n                  \"div\",\n                  {\n                    className: \"question-cache\",\n                    style: {\n                      margin: \"8px\",\n                      border: \"1px solid lightgray\",\n                      borderRadius: \"4px\",\n                      padding: \"8px\"\n                    }\n                  },\n                  [\n                    lib.h(\"div\", { className: \"title\" }, [\n                      lib.$ui.tooltip(\n                        lib.h(\n                          \"span\",\n                          {\n                            title: `来自：${c.from || \"未知题库\"}\n主页：${c.homepage || \"未知主页\"}`,\n                            style: { fontWeight: \"bold\" }\n                          },\n                          c.title\n                        )\n                      )\n                    ]),\n                    lib.h(\"div\", { className: \"answer\", style: { marginTop: \"6px\" } }, c.answer)\n                  ]\n                )\n              );\n              const countEl = lib.h(\"span\", [\"当前缓存数量：\" + questionCaches.length]);\n              lib.$modal.simple({\n                width: 800,\n                content: lib.h(\"div\", [\n                  lib.h(\"div\", { className: \"notes card\" }, [\n                    lib.$ui.notes([\n                      \"题库缓存是将题库的题目和答案保存在内存，在重复使用时可以直接从内存获取，不需要再次请求题库。\",\n                      \"以下是当前存储的题库，默认存储200题，当前页面关闭后会自动清除。\"\n                    ])\n                  ]),\n                  lib.h(\"div\", { className: \"card\" }, [\n                    lib.$ui.space(\n                      [\n                        countEl,\n                        lib.$ui.button(\"清空题库缓存\", {}, (btn2) => {\n                          btn2.onclick = () => {\n                            this.cfg.localQuestionCaches = [];\n                            countEl.innerText = \"当前缓存数量：0\";\n                            list.forEach((el) => el.remove());\n                          };\n                        })\n                      ],\n                      { separator: \"|\" }\n                    )\n                  ]),\n                  lib.h(\n                    \"div\",\n                    questionCaches.length === 0 ? [lib.h(\"div\", { style: { textAlign: \"center\" } }, \"暂无题库缓存\")] : list\n                  )\n                ])\n              });\n            };\n          });\n          const exportSetting = lib.$ui.tooltip(\n            lib.h(\n              \"div\",\n              {\n                innerText: \"📤 导出全部设置\",\n                style: btnStyle,\n                title: \"导出全部页面的设置，包括全局设置，题库配置，学习设置等等。（文件后缀名为：.ocssetting）\"\n              },\n              (btn) => {\n                btn.onclick = () => {\n                  const setting = /* @__PURE__ */ Object.create({});\n                  for (const key of lib.$store.list()) {\n                    const val = lib.$store.get(key);\n                    if (val) {\n                      Reflect.set(setting, key, val);\n                    }\n                  }\n                  const blob = new Blob([JSON.stringify(setting, null, 2)], { type: \"text/plain\" });\n                  const url = URL.createObjectURL(blob);\n                  const a = lib.h(\"a\", { href: url, download: \"ocs-setting-export.ocssetting\" });\n                  a.click();\n                  URL.revokeObjectURL(url);\n                };\n              }\n            )\n          );\n          const importSetting = lib.$ui.tooltip(\n            lib.h(\n              \"div\",\n              {\n                innerText: \"📥 导入全部设置\",\n                style: btnStyle,\n                title: \"导入并且覆盖当前的全部设置。（文件后缀名为：.ocssetting）\"\n              },\n              (btn) => {\n                btn.onclick = () => {\n                  const input = lib.h(\"input\", { type: \"file\", accept: \".ocssetting\" });\n                  input.onchange = async () => {\n                    var _a;\n                    const file = (_a = input.files) == null ? void 0 : _a[0];\n                    if (file) {\n                      const setting = await file.text();\n                      const obj = JSON.parse(setting);\n                      for (const key of Object.keys(obj)) {\n                        lib.$store.set(key, obj[key]);\n                      }\n                      lib.$message.success({ content: \"设置导入成功，页面即将刷新。\", duration: 3 });\n                      setTimeout(() => {\n                        location.reload();\n                      }, 3e3);\n                    }\n                  };\n                  input.click();\n                };\n              }\n            )\n          );\n          [cachesBtn, exportSetting, importSetting].forEach((btn) => {\n            btn.onmouseover = () => {\n              btn.style.boxShadow = \"0px 0px 4px #0099ff9c\";\n            };\n            btn.onmouseout = () => {\n              btn.style.boxShadow = \"0px 0px 4px #bebebe\";\n            };\n          });\n          const sep = (text) => lib.h(\"div\", { className: \"separator\", style: { padding: \"4px 0px\" } }, text);\n          panel.body.replaceChildren(\n            lib.h(\"div\", [sep(\"题库拓展\"), cachesBtn, sep(\"其他功能\"), exportSetting, importSetting])\n          );\n        }\n      })\n    }\n  });\n  function insertCopyableStyle() {\n    const style = document.createElement(\"style\");\n    style.innerHTML = `\n\t\thtml * {\n\t\t  -webkit-user-select: text !important;\n\t\t  -khtml-user-select: text !important;\n\t\t  -moz-user-select: text !important;\n\t\t  -ms-user-select: text !important;\n\t\t  user-select: text !important;\n\t\t}`;\n    document.head.append(style);\n  }\n  function createAnswererWrapperList(aw) {\n    return aw.map(\n      (item) => lib.h(\n        \"details\",\n        [\n          lib.h(\"summary\", [\n            lib.$ui.space([\n              (() => {\n                let isDisabled = CommonProject.scripts.settings.cfg.disabledAnswererWrapperNames.includes(item.name);\n                const checkbox = lib.h(\"input\", { type: \"checkbox\", checked: !isDisabled, className: \"base-style-switch\" });\n                checkbox.onclick = () => {\n                  isDisabled = !isDisabled;\n                  if (isDisabled) {\n                    CommonProject.scripts.settings.cfg.disabledAnswererWrapperNames = [\n                      ...CommonProject.scripts.settings.cfg.disabledAnswererWrapperNames,\n                      item.name\n                    ];\n                    lib.$message.warn({\n                      content: \"题库：\" + item.name + \" 已被停用，如需开启请在：通用-全局设置-题库配置中开启。\",\n                      duration: 30\n                    });\n                  } else {\n                    CommonProject.scripts.settings.cfg.disabledAnswererWrapperNames = CommonProject.scripts.settings.cfg.disabledAnswererWrapperNames.filter(\n                      (name) => name !== item.name\n                    );\n                    lib.$message.success({\n                      content: \"题库：\" + item.name + \" 已启用。\",\n                      duration: 3\n                    });\n                  }\n                };\n                checkbox.title = \"点击停用或者启用题库，停用题库后将无法在自动答题中查询题目\";\n                return lib.$ui.tooltip(checkbox);\n              })(),\n              lib.h(\"span\", item.name)\n            ])\n          ]),\n          lib.h(\"ul\", [\n            lib.h(\"li\", [\"名字\t\", item.name]),\n            lib.h(\"li\", { innerHTML: `官网\t<a target=\"_blank\" href=${item.homepage}>${item.homepage || \"无\"}</a>` }),\n            lib.h(\"li\", [\"接口\t\", item.url]),\n            lib.h(\"li\", [\"请求方法\t\", item.method]),\n            lib.h(\"li\", [\"请求类型\t\", item.type]),\n            lib.h(\"li\", [\"请求头\t\", JSON.stringify(item.headers, null, 4) || \"无\"]),\n            lib.h(\"li\", [\"请求体\t\", JSON.stringify(item.data, null, 4) || \"无\"])\n          ])\n        ],\n        (details) => {\n          details.style.paddingLeft = \"12px\";\n        }\n      )\n    );\n  }\n  const createGuide = () => {\n    const showProjectDetails = (project2) => {\n      lib.$modal.simple({\n        title: project2.name,\n        width: 800,\n        content: lib.h(\"div\", [\n          lib.h(\"div\", [\n            \"运行域名：\",\n            ...(project2.domains || []).map(\n              (d) => lib.h(\n                \"a\",\n                { href: d.startsWith(\"http\") ? d : \"https://\" + d, target: \"_blank\", style: { margin: \"0px 4px\" } },\n                d\n              )\n            )\n          ]),\n          lib.h(\"div\", \"脚本列表：\"),\n          lib.h(\n            \"ul\",\n            Object.keys(project2.scripts).sort((a, b) => project2.scripts[b].hideInPanel ? -1 : 1).map((key) => {\n              const script2 = project2.scripts[key];\n              return lib.h(\n                \"li\",\n                [\n                  lib.h(\"b\", script2.name),\n                  lib.$ui.notes([\n                    lib.h(\"span\", [\"操作面板：\", script2.hideInPanel ? \"隐藏\" : \"显示\"]),\n                    [\n                      \"运行页面：\",\n                      lib.h(\n                        \"ul\",\n                        script2.matches.map((m) => Array.isArray(m) ? m : [\"无描述\", m]).map(\n                          (i) => lib.h(\"li\", [\n                            i[0],\n                            \"：\",\n                            i[1] instanceof RegExp ? i[1].toString().replace(/\\\\/g, \"\").slice(1, -1) : lib.h(\"span\", i[1])\n                          ])\n                        )\n                      )\n                    ]\n                  ])\n                ],\n                (li) => {\n                  li.style.marginBottom = \"12px\";\n                }\n              );\n            }),\n            (ul) => {\n              ul.style.padding = \"12px 24px\";\n              ul.style.border = \"1px solid #e1e1e1\";\n              ul.style.borderRadius = \"4px\";\n              ul.style.maxHeight = \"400px\";\n              ul.style.overflow = \"auto\";\n              ul.style.paddingLeft = \"42px\";\n            }\n          )\n        ])\n      });\n    };\n    const gotoHome = lib.h(\"button\", { className: \"base-style-button-secondary\" }, \"🏡官网教程\");\n    gotoHome.onclick = () => window.open(\"https://docs.ocsjs.com\", \"_blank\");\n    const contactUs = lib.h(\"button\", { className: \"base-style-button-secondary\" }, \"🗨️交流群\");\n    contactUs.onclick = () => window.open(\"https://docs.ocsjs.com/docs/about#交流方式\", \"_blank\");\n    const changeLog = lib.h(\"button\", { className: \"base-style-button-secondary\" }, \"📄更新日志\");\n    changeLog.onclick = () => CommonProject.scripts.apps.methods.showChangelog();\n    const cardStyle = {\n      border: \"1px solid #eee\",\n      borderRadius: \"4px\",\n      padding: \"8px\",\n      paddingTop: \"4px\"\n    };\n    return lib.h(\"div\", { className: \"user-guide\" }, [\n      lib.h(\"div\", { style: cardStyle }, [\n        lib.h(\"div\", { style: { marginBottom: \"4px\", fontWeight: \"bold\" } }, [\n          \"✨兼容的网课平台：\",\n          lib.h(\"span\", { className: \"secondary\", style: { fontWeight: \"normal\" } }, \"（未适配的平台将无法运行，请等待适配）\")\n        ]),\n        lib.h(\"div\", [\n          ...[CXProject, ZHSProject, ZJYProject, IcveMoocProject, ICourseProject].map((project2) => {\n            const btn = lib.h(\"button\", { className: \"base-style-button-secondary\", style: { margin: \"4px\" } }, [\n              project2.name\n            ]);\n            btn.onclick = () => {\n              showProjectDetails(project2);\n            };\n            return btn;\n          })\n        ])\n      ]),\n      lib.h(\"div\", { style: { ...cardStyle, marginTop: \"12px\" } }, [\n        lib.h(\"div\", { style: { marginBottom: \"8px\", fontWeight: \"bold\" } }, \"🌐快捷访问：\"),\n        gotoHome,\n        contactUs,\n        changeLog\n      ])\n    ]);\n  };\n  async function waitForMedia(options) {\n    var _a;\n    const res = await Promise.race([\n      new Promise((resolve, reject) => {\n        const interval = setInterval(() => {\n          const video = ((options == null ? void 0 : options.root) || document).querySelector(\n            `${(options == null ? void 0 : options.videoSelector) || \"video\"},${(options == null ? void 0 : options.audioSelector) || \"audio\"}`\n          );\n          if (video && (!(options == null ? void 0 : options.filter) || options.filter(video))) {\n            clearInterval(interval);\n            resolve(video);\n          }\n        }, 200);\n      }),\n      $.sleep((_a = options == null ? void 0 : options.timeout) != null ? _a : 3 * 60 * 1e3)\n    ]);\n    if (res) {\n      return res;\n    } else {\n      throw new Error(\"视频/音频未找到，或者加载超时。\");\n    }\n  }\n  function waitForElement(selector, opts) {\n    return new Promise((resolve, reject) => {\n      let timeout;\n      const interval = setInterval(() => {\n        const el = typeof selector === \"function\" ? selector() : document.querySelector(selector);\n        if (el) {\n          clearInterval(interval);\n          timeout && clearTimeout(timeout);\n          resolve(el);\n        }\n      }, (opts == null ? void 0 : opts.check_period_ms) || 1e3);\n      if (opts == null ? void 0 : opts.timeout_seconds) {\n        timeout = setTimeout(() => {\n          clearInterval(interval);\n          resolve(void 0);\n        }, ((opts == null ? void 0 : opts.timeout_seconds) || 10) * 1e3);\n      }\n    });\n  }\n  const $playwright = {\n    showError: () => {\n      const href = \"https://docs.ocsjs.com/docs/script-helper\";\n      const errorEl = lib.h(\"div\", [\n        \"当前页面需要下载OCS桌面端，并在桌面端中新建浏览器，在新建的浏览器中才能进行正常刷课，点击链接查看详情 => \",\n        lib.h(\"a\", { href, target: \"_blank\" }, href)\n      ]);\n      lib.$modal.alert({\n        maskCloseable: false,\n        title: \"⛔ 错误\",\n        confirmButtonText: \"查看详情\",\n        content: errorEl.cloneNode(true),\n        onConfirm() {\n          window.open(href, \"_blank\");\n        }\n      });\n      lib.$message.error({ content: errorEl.cloneNode(true), duration: 0 });\n    }\n  };\n  const state$4 = {\n    study: {\n      stop: false,\n      currentMedia: void 0,\n      stopInterval: 0,\n      stopMessage: void 0\n    }\n  };\n  const remote_required_pages = [\"fusioncourseh5.zhihuishu.com\", \"studywisdomh5.zhihuishu.com\"];\n  const gxk_read_notes = [\n    \"⚠️ 如果未开始答题，请尝试刷新页面。\",\n    \"⚠️ 禁止同时打开多个作业/考试页面。\",\n    [\"⚠️ 答题中请勿进行任何操作，如需暂停答题\", \"请等待全部题目搜索完成并执行自动保存功能后才能操作。\"],\n    [\"⚠️ 暂停后手动操作请确保每个题目都点击下一题\", \"进行答案保存（不然不会保存，提交没分）\"]\n  ];\n  class StudyVideoH5 {\n    constructor() {\n      this.remotePage = void 0;\n    }\n    async init() {\n      this.remotePage = await BackgroundProject.scripts.dev.methods.getRemotePlaywrightCurrentPage();\n      if (!this.remotePage) {\n        throw $playwright.showError();\n      }\n    }\n    getCourseName() {\n      var _a;\n      return ((_a = lib.$el(\".source-name\")) == null ? void 0 : _a.textContent) || \"无名称\";\n    }\n    getChapterName(root2) {\n      var _a;\n      return ((_a = root2.querySelector(\".catalogue_title\")) == null ? void 0 : _a.textContent) || \"未知章节\";\n    }\n    getNext(opts) {\n      let videoItems = Array.from(document.querySelectorAll(\".clearfix.video\"));\n      if (!opts.restudy) {\n        videoItems = videoItems.filter((el) => el.querySelector(\".time_icofinish\") === null);\n      }\n      for (let i = 0; i < videoItems.length; i++) {\n        const item = videoItems[i];\n        if (item.classList.contains(\"current_play\")) {\n          return videoItems[i + (opts.next ? 1 : 0)];\n        }\n      }\n      return videoItems[0];\n    }\n    async switchPlaybackRate(rate) {\n      var _a;\n      const controlsBar = lib.$el(\".controlsBar\");\n      const sl = lib.$el(\".speedList\");\n      if (controlsBar && sl) {\n        controlsBar.style.display = \"block\";\n        sl.style.display = \"block\";\n        const rate_parsed = parseFloat(String(rate));\n        const selector = `.speedList [rate=\"${rate_parsed === 1 ? \"1.0\" : rate}\"],.speedList [rate=\"${rate_parsed === 1 ? \"1\" : rate}\"]`;\n        if (this.remotePage) {\n          await this.remotePage.click(selector);\n        } else {\n          (_a = document.querySelector(selector)) == null ? void 0 : _a.click();\n        }\n      }\n    }\n    async switchLine(definition2) {\n      const controlsBar = lib.$el(\".controlsBar\");\n      const dl = lib.$el(\".definiLines\");\n      if (controlsBar && dl) {\n        controlsBar.style.display = \"block\";\n        dl.style.display = \"block\";\n        const selector = `.definiLines .${definition2}:not(.active)`;\n        const el = document.querySelector(selector);\n        if (el) {\n          if (this.remotePage) {\n            await this.remotePage.click(selector);\n          } else {\n            el.click();\n          }\n        }\n      }\n    }\n    hasJob() {\n      var _a;\n      return ((_a = lib.$$el(\".clearfix.video\")) == null ? void 0 : _a.length) > 0;\n    }\n    hideDialog() {\n      lib.$$el(\".el-dialog__wrapper\").forEach((dialog) => {\n        dialog.remove();\n      });\n    }\n    async handleTestDialog() {\n      var _a, _b;\n      const items = lib.$$el(\"#playTopic-dialog .el-pager .number\");\n      if (items.length) {\n        for (const item of items) {\n          if (item.classList.contains(\"active\") === false) {\n            item.click();\n            await lib.$.sleep(500);\n          }\n          const options = lib.$$el(\"#playTopic-dialog ul .topic-item\");\n          if (options.length !== 0) {\n            await waitForCaptcha();\n            $render.moveToEdge();\n            const random = Math.floor(Math.random() * options.length);\n            await lib.$.sleep(1e3);\n            const btn_selector = `#playTopic-dialog .topic .radio ul > li:nth-child(${random + 1})`;\n            if (this.remotePage) {\n              await this.remotePage.click(btn_selector);\n            } else {\n              (_a = lib.$el(btn_selector)) == null ? void 0 : _a.click();\n            }\n            await lib.$.sleep(1e3);\n          }\n        }\n        await lib.$.sleep(1e3);\n        const close_btn_selector = \"#playTopic-dialog .close-btn,#playTopic-dialog .btn\";\n        if (this.remotePage) {\n          await this.remotePage.click(close_btn_selector);\n        } else {\n          (_b = lib.$el(close_btn_selector)) == null ? void 0 : _b.click();\n        }\n      }\n      await lib.$.sleep(3e3);\n      await this.handleTestDialog();\n    }\n  }\n  class FusionCourseH5 extends StudyVideoH5 {\n    getCourseName() {\n      return \"智慧课程-AI\";\n    }\n    getChapterName(root2) {\n      const is_resource_box_mode = !!document.querySelector(\".resource-box\");\n      if (is_resource_box_mode) {\n        const card_name = root2.querySelector(\".file-name\");\n        if (card_name) {\n          return card_name.textContent || \"未知章节\";\n        }\n      }\n      return super.getChapterName(root2);\n    }\n    getNext(opts) {\n      const is_resource_box_mode = !!document.querySelector(\".resource-box\");\n      if (is_resource_box_mode) {\n        const getNextCard = () => {\n          const cards = Array.from(document.querySelectorAll(\".resources-item\"));\n          let target_el;\n          let start2 = false;\n          for (let index = 0; index < cards.length; index++) {\n            const card = cards[index];\n            if (start2) {\n              if (opts.restudy) {\n                target_el = card;\n                break;\n              } else {\n                if (card.querySelector(\".isFinish\")) {\n                  continue;\n                }\n                target_el = card;\n                break;\n              }\n            }\n            if (card.className.includes(\"active\")) {\n              start2 = true;\n            }\n          }\n          return target_el;\n        };\n        const next_card = getNextCard();\n        if (next_card) {\n          return next_card;\n        }\n      }\n      let videoItems = Array.from(document.querySelectorAll(\".clearfix.video\")).filter((el) => {\n        if (is_resource_box_mode) {\n          return !!el.querySelector(\".resource-box\");\n        }\n        return true;\n      });\n      console.log(videoItems);\n      if (!opts.restudy) {\n        if (is_resource_box_mode) {\n          videoItems = videoItems.filter((el) => {\n            var _a;\n            const text = ((_a = el.querySelector(\".resource-text\")) == null ? void 0 : _a.textContent) || \"\";\n            const [progress, total] = text.replace(\"必学\", \"\").trim().split(\"/\").map((s) => parseInt(s));\n            return progress < total;\n          });\n        } else {\n          videoItems = videoItems.filter((el) => {\n            const num_el = el.querySelector(\".progress-num\");\n            return num_el === null || num_el.textContent !== \"100%\";\n          });\n        }\n      }\n      for (let i = 0; i < videoItems.length; i++) {\n        const item = videoItems[i];\n        if (is_resource_box_mode) {\n          if (item.classList.contains(\"activeNode\")) {\n            return videoItems[i + (opts.next ? 1 : 0)];\n          }\n        } else {\n          if (item.classList.contains(\"current_play\")) {\n            return videoItems[i + (opts.next ? 1 : 0)];\n          }\n        }\n      }\n      return videoItems[0];\n    }\n  }\n  class StudyPlusH5 extends StudyVideoH5 {\n    getCourseName() {\n      var _a, _b, _c;\n      return ((_c = (_b = (_a = lib.$el(\".top-back-box > span:nth-child(2)\")) == null ? void 0 : _a.textContent) == null ? void 0 : _b.match(/课程名称：(.+)/)) == null ? void 0 : _c[1]) || \"无名称\";\n    }\n    getChapterName(item) {\n      var _a;\n      return ((_a = item.parentElement) == null ? void 0 : _a.textContent) || \"未知章节\";\n    }\n    hasJob() {\n      var _a;\n      return ((_a = lib.$$el(\".child-main\")) == null ? void 0 : _a.length) > 0;\n    }\n    getNext(opts) {\n      let videoItems = Array.from(document.querySelectorAll(\".child-main\")).filter(\n        (el) => el.querySelector(\".child-time\")\n      );\n      console.log(videoItems);\n      if (!opts.restudy) {\n        videoItems = videoItems.filter((el) => {\n          if (el.querySelector(\".child-check\")) {\n            return false;\n          }\n          return true;\n        });\n      }\n      for (let i = 0; i < videoItems.length; i++) {\n        const item = videoItems[i];\n        if (item.classList.contains(\"current\")) {\n          return videoItems[i + (opts.next ? 1 : 0)];\n        }\n      }\n      return videoItems[0];\n    }\n    hideDialog() {\n      lib.$$el(\".el-overlay,.el-dialog\").forEach((dialog) => {\n        dialog.style.display = \"none\";\n      });\n    }\n    async handleTestDialog(remotePage) {\n      const question_box = lib.$el(\".class-question-box\");\n      if (question_box) {\n        const options = lib.$$el(\".options option\");\n        if (options.length !== 0) {\n          await waitForCaptcha();\n          $render.moveToEdge();\n          const random = Math.floor(Math.random() * options.length);\n          await lib.$.sleep(1e3);\n          if (remotePage) {\n            await remotePage.click(options[random]);\n          } else {\n            options[random].click();\n          }\n          await lib.$.sleep(1e3);\n        }\n        await lib.$.sleep(1e3);\n        const close_btn = lib.$el(\".close_btn\");\n        if (close_btn) {\n          if (remotePage) {\n            await remotePage.click(close_btn);\n          } else {\n            close_btn.click();\n          }\n        }\n        const submit_btn = lib.$el(\".submit-btn\");\n        if (submit_btn) {\n          if (remotePage) {\n            await remotePage.click(submit_btn);\n          } else {\n            submit_btn.click();\n          }\n        }\n      }\n      await lib.$.sleep(3e3);\n      await this.handleTestDialog(remotePage);\n    }\n  }\n  class WishdomH5 extends StudyVideoH5 {\n    getCourseName() {\n      var _a, _b, _c;\n      return ((_c = (_b = (_a = lib.$el(\".course-name\")) == null ? void 0 : _a.textContent) == null ? void 0 : _b.match(/课程名称：(.+)/)) == null ? void 0 : _c[1]) || \"无名称\";\n    }\n    getChapterName(item) {\n      var _a;\n      return ((_a = item.parentElement) == null ? void 0 : _a.textContent) || \"未知章节\";\n    }\n    hasJob() {\n      var _a;\n      return ((_a = lib.$$el(\".category-wrapper .child\")) == null ? void 0 : _a.length) > 0;\n    }\n    getNext(opts) {\n      let jobs = Array.from(document.querySelectorAll(\".category-wrapper .child-info.hasvideo\"));\n      console.log(jobs);\n      if (!opts.restudy) {\n        jobs = jobs.filter((el) => {\n          if (el.querySelector(\".finish-icon\")) {\n            return false;\n          }\n          return true;\n        });\n      }\n      for (let i = 0; i < jobs.length; i++) {\n        const item = jobs[i];\n        if (item.classList.contains(\"current\")) {\n          return jobs[i + (opts.next ? 1 : 0)];\n        }\n      }\n      return jobs[0];\n    }\n    hideDialog() {\n      lib.$$el(\".el-overlay,.el-dialog\").forEach((dialog) => {\n        dialog.style.display = \"none\";\n      });\n    }\n    async handleTestDialog(remotePage) {\n      const question_box = lib.$el(\".question-body\");\n      if (question_box) {\n        const options = lib.$$el(\".question-body .options .option\");\n        lib.$message.info(\"正在关闭弹窗测验...\");\n        if (options.length !== 0) {\n          await waitForCaptcha();\n          CommonProject.scripts.render.methods.minimize();\n          CommonProject.scripts.render.methods.setPosition(100, 200);\n          const random = Math.floor(Math.random() * options.length);\n          await lib.$.sleep(1e3);\n          if (remotePage) {\n            await remotePage.click(options[random]);\n          } else {\n            options[random].click();\n          }\n          await lib.$.sleep(1e3);\n        }\n        await lib.$.sleep(1e3);\n        const submit_btn = lib.$el(\".submit-btn .submits\");\n        if (submit_btn) {\n          if (remotePage) {\n            await remotePage.hover(\".submit-btn .submits\");\n            await remotePage.click(\".submit-btn .submits\");\n          } else {\n            submit_btn.click();\n          }\n        }\n        const close_btn = lib.$el(\".header-box .close-box\");\n        if (close_btn) {\n          if (remotePage) {\n            await remotePage.hover(\".header-box .close-box\");\n            await remotePage.click(\".header-box .close-box\");\n          } else {\n            close_btn.click();\n          }\n        }\n        lib.$message.info(\"弹窗测验已关闭\");\n      }\n      await lib.$.sleep(3e3);\n      await this.handleTestDialog(remotePage);\n    }\n  }\n  class Hike extends StudyVideoH5 {\n    getCourseName() {\n      return \"无名称\";\n    }\n    getChapterName(item) {\n      return item.textContent || \"未知章节\";\n    }\n    hasJob() {\n      var _a;\n      return ((_a = document.querySelectorAll(\".source-icon\")) == null ? void 0 : _a.length) > 0;\n    }\n    getNext(opts) {\n      let jobs = Array.from(document.querySelectorAll(\".source-icon\")).map(\n        (el) => {\n          var _a;\n          return (_a = el.parentElement) == null ? void 0 : _a.parentElement;\n        }\n      );\n      console.log(jobs);\n      if (!opts.restudy) {\n        jobs = jobs.filter((el) => {\n          if (el.querySelector(\"i.select\")) {\n            return false;\n          }\n          return true;\n        });\n      }\n      for (let i = 0; i < jobs.length; i++) {\n        const item = jobs[i];\n        if (item.querySelector(\".active-file\")) {\n          return jobs[i + (opts.next ? 1 : 0)];\n        }\n      }\n      return jobs[0];\n    }\n    hideDialog() {\n      lib.$$el(\".el-overlay,.el-dialog\").forEach((dialog) => {\n        dialog.style.display = \"none\";\n      });\n    }\n  }\n  const ZHSProject = lib.Project.create({\n    name: \"知到智慧树\",\n    domains: [\n      \"zhihuishu.com\",\n      \"hike-teaching-center.polymas.com\"\n    ],\n    scripts: {\n      guide: new lib.Script({\n        name: \"💡 使用提示\",\n        matches: [\n          [\"学习首页\", \"https://onlineweb.zhihuishu.com/onlinestuh5\"],\n          [\"首页\", \"https://www.zhihuishu.com/\"]\n        ],\n        namespace: \"zhs.guide\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"请手动进入视频、作业、考试页面，脚本会自动运行。\",\n              \"兴趣课会自动下一个，所以不提供脚本。\"\n            ]).outerHTML\n          }\n        },\n        oncomplete() {\n          CommonProject.scripts.render.methods.pin(this);\n        }\n      }),\n      \"gxk-study\": new lib.Script({\n        name: \"🖥️ 共享课-学习脚本\",\n        matches: [\n          [\"共享课学习页面\", \"studyvideoh5.zhihuishu.com\"],\n          [\"新共享课学习页面\", \"studyplush5.zhihuishu.com\"],\n          [\"新版AI课页面\", \"fusioncourseh5.zhihuishu.com/stuStudy\"]\n        ],\n        namespace: \"zhs.gxk.study\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"章节测试请大家观看完视频后手动打开。\",\n              [\n                \"请大家仔细打开视频上方的”学前必读“，查看成绩分布。\",\n                \"如果 “平时成绩-学习习惯成绩” 占比多的话，就需要规律学习。\",\n                \"每天定时半小时可获得一分习惯分。\",\n                \"如果不想要习惯分可忽略。\"\n              ],\n              \"请使用时关闭卡巴斯基软件，否则会被检测出异常脚本。\",\n              \"不要最小化浏览器，可能导致脚本暂停。\",\n              \"运行中请将浏览器缩放调整至适合的大小，避免元素遮挡，无法点击\",\n              \"例如：调整缩放到 50%，然后刷新页面即可\"\n            ]).outerHTML\n          },\n          studyRecord: {\n            defaultValue: [],\n            extra: {\n              appConfigSync: false\n            }\n          },\n          stopTime: {\n            label: \"定时停止\",\n            tag: \"select\",\n            attrs: { title: \"到时间后自动暂停脚本\" },\n            defaultValue: \"0\",\n            options: [\n              [\"0\", \"关闭\"],\n              [\"0.5\", \"半小时后\"],\n              [\"1\", \"一小时后\"],\n              [\"2\", \"两小时后\"]\n            ]\n          },\n          restudy,\n          reloadWhenError: {\n            label: \"黑屏自动刷新\",\n            attrs: { title: \"视频黑屏或者检测不到视频时自动刷新页面\", type: \"checkbox\" },\n            defaultValue: true\n          },\n          volume,\n          definition,\n          playbackRate: {\n            label: \"视频倍速\",\n            tag: \"select\",\n            attrs: { title: \"目前智慧树倍速最高只能1.5x，超出有封号风险\" },\n            defaultValue: 1,\n            options: [\n              [\"1\", \"1 x\"],\n              [\"1.25\", \"1.25 x\"],\n              [\"1.5\", \"1.5 x\"]\n            ]\n          }\n        },\n        methods() {\n          return {\n            increaseStudyTime: (courseName, val) => {\n              const records = this.cfg.studyRecord;\n              const record = records.find(\n                (r) => new Date(r.date).toLocaleDateString() === new Date().toLocaleDateString()\n              );\n              let courses = [];\n              if (record) {\n                courses = record.courses;\n              } else {\n                records.push({ date: Date.now(), courses });\n              }\n              const course = courses.find((c) => c.name === courseName);\n              if (course) {\n                course.time = course.time + val;\n                if (typeof course.time === \"string\") {\n                  course.time = parseFloat(course.time);\n                }\n              } else {\n                courses.push({ name: courseName, time: 0 });\n              }\n              this.cfg.studyRecord = records;\n            }\n          };\n        },\n        onrender({ panel }) {\n          panel.body.replaceChildren(\n            lib.h(\"hr\"),\n            lib.$ui.button(\"⏰检测是否需要规律学习\", {}, (btn) => {\n              btn.style.marginRight = \"12px\";\n              btn.onclick = () => {\n                var _a;\n                const href = ((_a = document.querySelector(\"[href*=stuLearnReportNew]\")) == null ? void 0 : _a.getAttribute(\"href\")) || \"\";\n                if (href) {\n                  lib.$modal.alert({\n                    title: \"规律学习检测\",\n                    content: `自动检测功能已失效，<a href=\"${href}\"> -> 点击此处 <- </a> 前往成绩分析页面，点击 <b>“学习习惯”</b> 即可查看习惯分详情。`\n                  });\n                } else {\n                  lib.$modal.alert({\n                    title: \"提示\",\n                    content: \"自动检测功能已失效，请自行前往成绩分析页面，点击学习习惯即可查看习惯分详情。\"\n                  });\n                }\n              };\n            }),\n            lib.$ui.button(\"📘查看学习记录\", {}, (btn) => {\n              btn.onclick = () => {\n                lib.$modal.alert({\n                  title: \"学习记录\",\n                  content: lib.$ui.notes(\n                    this.cfg.studyRecord.map((r) => {\n                      const date = new Date(r.date);\n                      return [\n                        `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, \"0\")}-${date.getDate().toString().padStart(2, \"0\")}`,\n                        lib.$ui.notes(r.courses.map((course) => `${course.name} - ${optimizeSecond(course.time)}`))\n                      ];\n                    })\n                  )\n                });\n              };\n            })\n          );\n        },\n        onactive() {\n          this.cfg.stopTime = \"0\";\n          if (this.cfg.playbackRate) {\n            this.cfg.playbackRate = parseFloat(this.cfg.playbackRate.toString());\n          }\n        },\n        async oncomplete() {\n          CommonProject.scripts.render.methods.pin(this);\n          const type = location.href.includes(\"fusioncourseh5\") ? \"AI课程\" : location.href.includes(\"studyplush5\") ? \"新共享课\" : \"共享课\";\n          const ProcessorConstructor = location.href.includes(\"fusioncourseh5\") ? FusionCourseH5 : location.href.includes(\"studyplush5\") ? StudyPlusH5 : StudyVideoH5;\n          const processor = new ProcessorConstructor();\n          setTimeout(() => {\n            if (processor.hasJob() === false) {\n              finishAlert();\n            }\n          }, 10 * 1e3);\n          const waitForVideoJob = () => {\n            return new Promise((resolve, reject) => {\n              if (processor.hasJob()) {\n                resolve();\n              } else {\n                setTimeout(() => {\n                  resolve(waitForVideoJob());\n                }, 1e3);\n              }\n            });\n          };\n          await waitForVideoJob();\n          await processor.init();\n          this.onConfigChange(\"stopTime\", (stopTime) => {\n            if (stopTime === \"0\") {\n              lib.$message.info({ content: \"定时停止已关闭\" });\n            } else {\n              autoStop(stopTime);\n            }\n          });\n          this.onConfigChange(\"volume\", (curr) => {\n            state$4.study.currentMedia && (state$4.study.currentMedia.volume = curr);\n          });\n          this.onConfigChange(\"playbackRate\", (curr) => {\n            if (typeof curr === \"string\") {\n              this.cfg.playbackRate = parseFloat(curr);\n            }\n            processor.switchPlaybackRate(curr);\n          });\n          this.onConfigChange(\"definition\", (curr) => {\n            processor.switchLine(curr);\n          });\n          const recordStudyTimeLoop = () => {\n            this.methods.increaseStudyTime(processor.getCourseName(), this.cfg.playbackRate);\n            setTimeout(recordStudyTimeLoop, 1e3);\n          };\n          closeDialogRead();\n          recordStudyTimeLoop();\n          autoStop(this.cfg.stopTime);\n          processor.hideDialog();\n          processor.handleTestDialog();\n          setInterval(async () => {\n            lib.$$el(\".v-modal,.mask\").forEach((modal2) => {\n              modal2.remove();\n            });\n            fixProcessBar();\n          }, 3e3);\n          lib.$message.info({ content: \"3秒后开始学习\", duration: 3 });\n          const remotePage = processor.remotePage;\n          const study2 = async (opts) => {\n            if (state$4.study.stop === false) {\n              const item = processor.getNext({ next: opts.next, restudy: this.cfg.restudy });\n              if (item) {\n                const msg = \"即将学习：\" + processor.getChapterName(item);\n                lib.$message.info({ content: msg });\n                $console.log(msg);\n                await lib.$.sleep(3e3);\n                $render.moveToEdge();\n                if (remotePage) {\n                  if (type === \"新共享课\") {\n                    await remotePage.click(\".title-box\");\n                    await lib.$.sleep(200);\n                  }\n                  await remotePage.click(item);\n                  await lib.$.sleep(1e3);\n                  await remotePage.click(item);\n                  await lib.$.sleep(1e3);\n                } else {\n                  item.click();\n                }\n                if (type === \"AI课程\" && document.querySelector(\".preview-warp .doc-box,.preview-warp .ppt-box\")) {\n                  lib.$message.info({ content: \"检测到PPT资源，即将跳过...\" });\n                  await lib.$.sleep(2e3);\n                  study2({ next: true });\n                  return;\n                }\n                watch(\n                  processor,\n                  {\n                    reloadWhenError: this.cfg.reloadWhenError,\n                    volume: this.cfg.volume,\n                    playbackRate: this.cfg.playbackRate,\n                    definition: this.cfg.definition\n                  },\n                  {\n                    reload() {\n                      if (type === \"共享课\") {\n                        study2({ next: false });\n                      } else {\n                        location.reload();\n                      }\n                    },\n                    onended({ next: next2 }) {\n                      study2({ next: next2 });\n                    }\n                  }\n                );\n              } else {\n                finishAlert();\n              }\n            } else {\n              const msg = \"检测到当前视频全部播放完毕，如果还有未完成的视频请刷新重试，或者打开复习模式。\";\n              lib.$message.warn({ content: msg });\n              CommonProject.scripts.settings.methods.notificationBySetting(msg, {\n                duration: 0,\n                extraTitle: \"知道智慧树学习脚本\"\n              });\n            }\n          };\n          study2({ next: false });\n        }\n      }),\n      \"gxk-work\": new lib.Script({\n        name: \"✍️ 共享课-作业考试脚本\",\n        matches: [\n          [\"共享课作业页面\", \"zhihuishu.com/stuExamWeb.html#/webExamList/dohomework\"],\n          [\"共享课考试页面\", \"zhihuishu.com/stuExamWeb.html#/webExamList/doexamination\"],\n          [\"作业考试列表\", \"zhihuishu.com/stuExamWeb.html#/webExamList\\\\?\"]\n        ],\n        namespace: \"zhs.gxk.work\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"自动答题前请在 “通用-全局设置” 中设置题库配置。\",\n              \"可以搭配 “通用-在线搜题” 一起使用。\",\n              ...gxk_read_notes\n            ]).outerHTML\n          },\n          workDelay: {\n            label: \"作业答题开始时间延迟（秒）\",\n            defaultValue: 3,\n            attrs: { type: \"number\", min: 1, step: 1, max: 10 }\n          },\n          readNotes: {\n            defaultValue: false\n          }\n        },\n        methods() {\n          async function getWorkInfo(remotePage) {\n            const isExam2 = location.href.includes(\"doexamination\");\n            let url = \"\";\n            if (isExam2) {\n              url = \"/taurusExam/gateway/t/v1/student/doExam\";\n            } else {\n              url = \"/studentExam/gateway/t/v1/student/doHomework\";\n            }\n            return JSON.parse((await remotePage.waitForResponse(url)).body);\n          }\n          return {\n            getWorkInfo,\n            work: async () => {\n              const remotePage = await BackgroundProject.scripts.dev.methods.getRemotePlaywrightCurrentPage();\n              if (!remotePage) {\n                return $playwright.showError();\n              }\n              const isExam2 = location.href.includes(\"doexamination\");\n              const isWork2 = location.href.includes(\"dohomework\");\n              if (isExam2 || isWork2) {\n                const workInfo = await getWorkInfo(remotePage);\n                $render.moveToEdge();\n                CommonProject.scripts.render.methods.normal();\n                CommonProject.scripts.render.methods.pin(this);\n                if (this.cfg.readNotes === false) {\n                  const notes = lib.$ui.notes(gxk_read_notes).outerHTML;\n                  const start2 = await new Promise((resolve, reject) => {\n                    lib.$modal.confirm({\n                      title: isExam2 ? \"脚本考前须知\" : \"脚本作业须知\",\n                      content: notes,\n                      confirmButtonText: \"我已知晓，开始自动答题\",\n                      cancelButtonText: \"取消答题\",\n                      maskCloseable: false,\n                      onConfirm: () => {\n                        this.cfg.readNotes = true;\n                        resolve(true);\n                      },\n                      onCancel() {\n                        resolve(false);\n                      }\n                    });\n                  });\n                  if (!start2) {\n                    lib.$message.info({ content: \"已取消答题，如需答题请刷新页面重新开始。\" });\n                    return;\n                  }\n                }\n                setTimeout(() => {\n                  var _a;\n                  lib.$message.info({ content: `开始${isExam2 ? \"考试\" : \"作业\"}` });\n                  commonWork(this, {\n                    workerProvider: (opts) => gxkWorkAndExam(workInfo, opts),\n                    start_delay_seconds: (_a = this.cfg.workDelay) != null ? _a : 3\n                  });\n                }, 1e3);\n              } else {\n                lib.$message.info({ content: \"📢 请手动进入作业/考试，如果未开始答题，请尝试刷新页面。\", duration: 0 });\n                CommonProject.scripts.render.methods.pin(this);\n              }\n            }\n          };\n        },\n        async onactive() {\n          this.methods.work();\n          this.on(\"historychange\", () => {\n            this.methods.work();\n          });\n        }\n      }),\n      \"smart-study\": new lib.Script({\n        name: \"🖥️ 智慧课程-学习脚本\",\n        matches: [\n          [\"智慧课程学习页面\", \"smartcoursestudent.zhihuishu.com/learnPage\"],\n          [\"智慧课程新域名学习页面\", \"ai-smart-course-student-pro.zhihuishu.com/learnPage\"],\n          [\"智慧课程首页\", \"smartcoursestudent.zhihuishu.com/singleCourse\"],\n          [\"智慧课程新域名课程首页\", \"ai-smart-course-student-pro.zhihuishu.com/singleCourse\"]\n        ],\n        namespace: \"zhs.smart.study\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"掌握度和作业请视频看完后自行手动进入\",\n              \"不要最小化浏览器/关闭电脑屏幕，可能导致脚本暂停。\",\n              \"任意选择一个章节，脚本会自动往下学“必学”课程。\",\n              \"运行中请将浏览器缩放调整至适合的大小，避免元素遮挡，无法点击\",\n              \"例如：调整缩放到 50%，然后刷新页面即可\"\n            ]).outerHTML\n          },\n          switchMode: {\n            label: \"跳转模式\",\n            tag: \"select\",\n            defaultValue: \"job\",\n            options: [\n              [\"job\", \"只跳转必学章节\", \"章节后面有必学，并且必学数量未完成的章节，如果全部完成将停止学习\"],\n              [\"all\", \"顺序跳转\"]\n            ]\n          },\n          restudy,\n          volume,\n          definition,\n          playbackRate: {\n            label: \"视频倍速\",\n            tag: \"select\",\n            defaultValue: 1,\n            attrs: { title: \"目前智慧树倍速最高只能1.5x，超出有封号风险\" },\n            options: [\n              [\"1\", \"1 x\"],\n              [\"1.25\", \"1.25 x\"],\n              [\"1.5\", \"1.5 x\"]\n            ]\n          }\n        },\n        oncomplete() {\n          this.methods.start();\n        },\n        onhistorychange(type, ...args) {\n          if (type === \"push\") {\n            this.methods.start();\n          }\n        },\n        methods() {\n          return {\n            start: async () => {\n              if (location.href.includes(\"singleCourse\")) {\n                lib.$message.info({ content: \"请点击任意章节开始进行自动学习\", duration: 60 });\n                return;\n              }\n              CommonProject.scripts.render.methods.pin(this);\n              const processor = new StudyVideoH5();\n              const getInfos = () => Array.from(document.querySelectorAll(\".section-item-collapse-info\"));\n              const getChapterName = () => {\n                var _a, _b;\n                return (((_a = document.querySelector(\".point-title-text\")) == null ? void 0 : _a.textContent) || \"未知章节\") + \"-\" + (((_b = document.querySelector(\".resources-item .active .video-title\")) == null ? void 0 : _b.textContent) || \"未知小节\");\n              };\n              const include_jobs = [\"video\", \"book\", \"other\", \"text\"];\n              const getNextJob = () => {\n                const cards = Array.from(document.querySelectorAll(\".resources-item\"));\n                if (cards.some((card) => card.querySelector(\".active\")) === false) {\n                  return cards[0];\n                }\n                let target_el;\n                let start2 = false;\n                for (let index = 0; index < cards.length; index++) {\n                  const card = cards[index];\n                  if (start2) {\n                    if (this.cfg.restudy) {\n                      target_el = card;\n                      break;\n                    } else {\n                      if (card.querySelector(\".finished-icon\")) {\n                        continue;\n                      }\n                      target_el = card;\n                      break;\n                    }\n                  }\n                  if (card.querySelector(\".active\")) {\n                    start2 = true;\n                  }\n                }\n                return target_el;\n              };\n              const getNext = () => {\n                var _a, _b;\n                const infos = getInfos();\n                const works = [];\n                for (let index = 0; index < infos.length; index++) {\n                  const info = infos[index];\n                  const text = ((_a = info.querySelector(\".collapse-info-progress .progress-text\")) == null ? void 0 : _a.textContent) || \"\";\n                  if (this.cfg.switchMode === \"all\") {\n                    works.push({\n                      info,\n                      progress: 0,\n                      total: 1\n                    });\n                  } else {\n                    const [progress, total] = text.replace(\"必学\", \"\").trim().split(\"/\").map((s) => parseInt(s));\n                    if (progress < total) {\n                      works.push({ progress, total, info });\n                    }\n                  }\n                }\n                let start2 = false;\n                for (let index = 0; index < works.length; index++) {\n                  const work2 = works[index];\n                  if (start2) {\n                    if (work2.progress < work2.total) {\n                      return works[index].info;\n                    }\n                  }\n                  if (work2.info.classList.contains(\"active\")) {\n                    if (this.cfg.switchMode === \"all\") {\n                      return works[index + 1].info;\n                    } else {\n                      start2 = true;\n                    }\n                  }\n                }\n                return (_b = works[0]) == null ? void 0 : _b.info;\n              };\n              this.onConfigChange(\"volume\", (curr) => {\n                state$4.study.currentMedia && (state$4.study.currentMedia.volume = curr);\n              });\n              this.onConfigChange(\"playbackRate\", (curr) => {\n                if (typeof curr === \"string\") {\n                  this.cfg.playbackRate = parseFloat(curr);\n                }\n                processor.switchPlaybackRate(curr);\n              });\n              this.onConfigChange(\"definition\", (curr) => {\n                processor.switchLine(curr);\n              });\n              const doWork = async () => {\n                await lib.$.sleep(5 * 1e3);\n                const next2 = async () => {\n                  var _a;\n                  const nextJob = getNextJob();\n                  if (nextJob) {\n                    const nextJobTitle = nextJob.querySelector(\".common-text\");\n                    document.querySelectorAll(\".resources-item .active\").forEach((el) => el.classList.remove(\"active\"));\n                    if (include_jobs.some((job) => {\n                      var _a2;\n                      return (_a2 = nextJob.querySelector(\".icon-box\")) == null ? void 0 : _a2.classList.contains(job);\n                    })) {\n                      nextJobTitle.click();\n                      await doWork();\n                    } else {\n                      const _open = lib.$gm.unsafeWindow.open;\n                      lib.$gm.unsafeWindow.open = () => null;\n                      nextJobTitle.click();\n                      (_a = nextJob.querySelector(\".basic-info-video-card-container\")) == null ? void 0 : _a.classList.add(\"active\");\n                      const msg = \"链接任务完成，即将自动下一节！\";\n                      lib.$message.info(msg);\n                      setTimeout(async () => {\n                        lib.$gm.unsafeWindow.open = _open;\n                        await next2();\n                      }, 3e3);\n                    }\n                    return;\n                  }\n                  const nextEl = getNext();\n                  if (nextEl) {\n                    nextEl.click();\n                  } else {\n                    finishAlert();\n                  }\n                };\n                try {\n                  const wrapper = document.querySelector(\".video-player-wrapper\");\n                  if (!wrapper || wrapper.style.display === \"none\") {\n                    throw new Error(\"视频加载失败\");\n                  }\n                  await waitForMedia({\n                    timeout: 5 * 1e3,\n                    filter: (m) => m.src.length !== 0\n                  });\n                } catch {\n                  const msg = \"未找到学习视频，即将自动下一节！\";\n                  lib.$message.error(msg);\n                  $console.error(msg);\n                  await lib.$.sleep(3e3);\n                  await next2();\n                  return;\n                }\n                const set = async () => {\n                  try {\n                    await processor.switchLine(this.cfg.definition || \"line1bq\");\n                    await lib.$.sleep(1e3);\n                    await processor.switchPlaybackRate(this.cfg.playbackRate);\n                    await lib.$.sleep(1e3);\n                    const media = await waitForMedia({ timeout: 5 * 1e3, filter: (m) => m.src.length !== 0 });\n                    await lib.$.sleep(1e3);\n                    state$4.study.currentMedia = media;\n                    if (media) {\n                      media.currentTime = 1;\n                      media.volume = this.cfg.volume;\n                    }\n                    return state$4.study.currentMedia;\n                  } catch (e) {\n                    $console.log(\"视频加载失败，请尝试刷新页面！：\" + e);\n                    lib.$message.error({ content: \"视频加载失败，请尝试刷新页面！：\" + e, duration: 0 });\n                  }\n                };\n                const video = await set();\n                if (!video) {\n                  return;\n                }\n                playMedia(() => video == null ? void 0 : video.play()).then(() => {\n                  const cn = getChapterName();\n                  lib.$message.info({ content: \"正在学习：\" + cn });\n                  $console.log(\"正在学习：\" + cn);\n                });\n                video.onpause = async () => {\n                  if (!(video == null ? void 0 : video.ended) && state$4.study.stop === false) {\n                    await lib.$.sleep(1e3);\n                    video == null ? void 0 : video.play();\n                  }\n                };\n                video.onended = async () => {\n                  lib.$message.info({ content: \"即将自动跳转下一节\" });\n                  await lib.$.sleep(3e3);\n                  await next2();\n                };\n              };\n              doWork();\n            }\n          };\n        }\n      }),\n      \"smart-work\": new lib.Script({\n        name: \"✍️ 智慧课程-作业/掌握度脚本\",\n        matches: [\n          [\"智慧课程作业页面\", \"smartcourseexam.zhihuishu.com/ReviewExam\"],\n          [\"智慧课程-掌握提升页面\", \"studentexamcomh5.zhihuishu.com/studentReviewTestOrExam\"],\n          [\"智慧课程-AI助教掌握度\", \"fusioncourseh5.zhihuishu.com/exam\"],\n          [\"智慧课程-新AI助教掌握度\", \"studywisdomh5.zhihuishu.com/exam\"]\n        ],\n        namespace: \"zhs.smart.work\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"自动答题前请在 “通用-全局设置” 中设置题库配置。\",\n              \"可以搭配 “通用-在线搜题” 一起使用。\",\n              \"⚠️ 如果没开始答题，请尝试刷新页面。\",\n              \"⚠️ 禁止一次性打开多个作业/考试页面。\",\n              ...remote_required_pages.some((domain2) => location.href.includes(domain2)) ? [] : [\"⚠️ 答题中请勿进行任何操作，如需暂停答题\", \"请等待全部题目搜索完成并执行自动保存功能后才能操作。\"]\n            ]).outerHTML\n          },\n          workDelay: {\n            label: \"作业答题开始时间延迟（秒）\",\n            defaultValue: 3,\n            attrs: { type: \"number\", min: 1, step: 1, max: 10 }\n          }\n        },\n        methods() {\n          return {\n            start: async () => {\n              var _a;\n              CommonProject.scripts.render.methods.pin(this);\n              let remotePage;\n              const remote_required = remote_required_pages.some((domain2) => location.href.includes(domain2));\n              remote_required ? await waitForElement(\".exam-item\") : await waitForElement(\".questionContent\");\n              if (remote_required)\n                ;\n              else {\n                remotePage = await BackgroundProject.scripts.dev.methods.getRemotePlaywrightCurrentPage();\n                if (!remotePage) {\n                  return $playwright.showError();\n                }\n                $render.moveToEdge();\n                lib.$message.warn({ content: \"答题完毕之前请勿操作页面！\", duration: 0 });\n              }\n              commonWork(this, {\n                workerProvider: (opts) => {\n                  if (remote_required) {\n                    return fusioncourseWork(remotePage, opts);\n                  } else {\n                    return smartWork(remotePage, opts);\n                  }\n                },\n                start_delay_seconds: (_a = this.cfg.workDelay) != null ? _a : 3\n              });\n            }\n          };\n        },\n        oncomplete() {\n          this.methods.start();\n        },\n        onhistorychange(type, ...args) {\n          if (type === \"push\") {\n            this.methods.start();\n          }\n        }\n      }),\n      \"xnk-study\": new lib.Script({\n        name: \"🖥️ 校内课（翻转课）-学习脚本\",\n        matches: [[\"校内课学习页面\", \"zhihuishu.com/aidedteaching/sourceLearning\"]],\n        namespace: \"zhs.xnk.study\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\"章节测试请大家观看完视频后手动打开。\", \"此课程不能使用倍速。\"]).outerHTML\n          },\n          restudy,\n          volume\n        },\n        oncomplete() {\n          CommonProject.scripts.render.methods.pin(this);\n          const finish = () => {\n            lib.$modal.alert({\n              content: \"检测到当前视频全部播放完毕，如果还有未完成的视频请刷新重试，或者打开复习模式。\"\n            });\n            CommonProject.scripts.settings.methods.notificationBySetting(\n              \"检测到当前视频全部播放完毕，如果还有未完成的视频请刷新重试，或者打开复习模式。\",\n              { duration: 0, extraTitle: \"知道智慧树学习脚本\" }\n            );\n          };\n          this.onConfigChange(\"volume\", (curr) => {\n            state$4.study.currentMedia && (state$4.study.currentMedia.volume = curr);\n          });\n          const nextElement = () => {\n            const list = document.querySelectorAll(\".file-item\");\n            let passActive = false;\n            for (let index = 0; index < list.length; index++) {\n              const item = list[index];\n              const finish2 = !!item.querySelector(\".icon-finish\");\n              const needsStudy = !finish2 || finish2 && this.cfg.restudy;\n              if (item.classList.contains(\"active\")) {\n                if (needsStudy) {\n                  return list[index + 1];\n                } else {\n                  passActive = true;\n                }\n              }\n              if (passActive && needsStudy) {\n                return item;\n              }\n            }\n          };\n          const interval = setInterval(async () => {\n            var _a, _b;\n            const next2 = nextElement();\n            if (next2) {\n              clearInterval(interval);\n              if (document.querySelector(\"#mediaPlayer\")) {\n                (_a = document.querySelector(\".file-item.active\")) == null ? void 0 : _a.scrollIntoView();\n                const name = ((_b = next2.querySelector(\"#sourceTit\")) == null ? void 0 : _b.textContent) || \"未知视频\";\n                lib.$message.info(\"正在学习：\" + name);\n                watchXnk({ volume: this.cfg.volume }, () => {\n                  lib.$message.info(\"视频完成播放，正在自动跳转下一节！\");\n                  setTimeout(() => {\n                    const next22 = nextElement();\n                    if (next22)\n                      next22.click();\n                  }, 3e3);\n                });\n              } else {\n                setTimeout(() => {\n                  const msg = \"未找到学习视频，即将自动下一节！\";\n                  lib.$message.warn(msg);\n                  $console.warn(msg);\n                  const next22 = nextElement();\n                  if (next22)\n                    next22.click();\n                }, 3e3);\n              }\n            }\n          }, 1e3);\n          setTimeout(() => {\n            if (!nextElement()) {\n              finish();\n              clearInterval(interval);\n            }\n          }, 10 * 1e3);\n        }\n      }),\n      \"xnk-work\": new lib.Script({\n        name: \"✍️ 校内课-作业考试脚本\",\n        matches: [\n          [\"校内课作业页面\", \"zhihuishu.com/atHomeworkExam/stu/homeworkQ/exerciseList\"],\n          [\"校内课考试页面\", \"zhihuishu.com/atHomeworkExam/stu/examQ/examexercise\"]\n        ],\n        namespace: \"zhs.xnk.work\",\n        configs: { notes: workNotes },\n        async oncomplete() {\n          commonWork(this, {\n            workerProvider: xnkWork\n          });\n        }\n      }),\n      \"wisdom-study\": new lib.Script({\n        name: \"🖥️ 新智慧学习-学习脚本\",\n        matches: [[\"2025-9月新智慧学习页面\", \"studywisdomh5.zhihuishu.com/study/index\"]],\n        namespace: \"zhs.wisdom.study\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"掌握度和作业请视频看完后自行手动进入\",\n              \"不要最小化浏览器/关闭电脑屏幕，可能导致脚本暂停。\",\n              \"请使用时关闭卡巴斯基软件，否则会被检测出异常脚本。\",\n              \"运行中请将浏览器缩放调整至适合的大小，避免元素遮挡，无法点击\",\n              \"例如：调整缩放到 50%，然后刷新页面即可\"\n            ]).outerHTML\n          },\n          restudy,\n          skipStudyTimeWarnDialog: {\n            label: \"忽略习惯分弹窗\",\n            attrs: {\n              title: \"如果课程有习惯分需要自行控制学习时长，如果忽略习惯分提示，则可能没有习惯分。\",\n              type: \"checkbox\"\n            },\n            defaultValue: false\n          },\n          reloadWhenError: {\n            label: \"视频黑屏时自动刷新\",\n            attrs: { type: \"checkbox\", title: \"当视频出现加载失败，或者黑屏等异常时，自动刷新页面3次尝试修复\" },\n            defaultValue: true\n          },\n          volume,\n          definition,\n          playbackRate: {\n            label: \"视频倍速\",\n            tag: \"select\",\n            defaultValue: 1,\n            attrs: { title: \"目前智慧树倍速最高只能1.5x，超出有封号风险\" },\n            options: [\n              [\"1\", \"1 x\"],\n              [\"1.25\", \"1.25 x\"],\n              [\"1.5\", \"1.5 x\"]\n            ]\n          }\n        },\n        async oncomplete() {\n          CommonProject.scripts.render.methods.pin(this);\n          const processor = new WishdomH5();\n          const getChapterName = () => {\n            var _a;\n            return ((_a = document.querySelector(\".video-study-wrapper-title\")) == null ? void 0 : _a.textContent) || \"未知章节\";\n          };\n          this.onConfigChange(\"volume\", (curr) => {\n            state$4.study.currentMedia && (state$4.study.currentMedia.volume = curr);\n          });\n          this.onConfigChange(\"playbackRate\", async (curr) => {\n            if (typeof curr === \"string\") {\n              this.cfg.playbackRate = parseFloat(curr);\n            }\n            fixProcessBar2();\n            processor.switchPlaybackRate(curr);\n          });\n          this.onConfigChange(\"definition\", async (curr) => {\n            fixProcessBar2();\n            processor.switchLine(curr);\n          });\n          const next2 = async () => {\n            var _a;\n            const show = lib.$el(\".side-expand-box.animated-box.show\");\n            if (show) {\n              if (processor.remotePage) {\n                await processor.remotePage.click(show);\n              } else {\n                show.click();\n              }\n            }\n            const nextJob = processor.getNext({ next: true, restudy: this.cfg.restudy });\n            if (nextJob) {\n              if (!this.cfg.skipStudyTimeWarnDialog && hasStudyTimeWarnDialog()) {\n                lib.$message.warn({\n                  content: \"检测到习惯分弹窗，当天学习时间已满，如需继续学习，请手动关闭后，刷新页面重新运行脚本！（如想强制学习请前往脚本设置忽略弹窗）\",\n                  duration: 0\n                });\n                return;\n              } else {\n                await closeStudyTimeWarnDialog();\n              }\n              await waitForMasteryLevelDialogClose();\n              await ((_a = processor.remotePage) == null ? void 0 : _a.click(nextJob));\n              doWork();\n            } else {\n              finishAlert();\n            }\n          };\n          const closeMasteryLevelDialog = () => {\n            return new Promise((resolve, reject) => {\n              const check = () => {\n                var _a;\n                if (document.querySelector(\".masterylevel-body\")) {\n                  (_a = processor.remotePage) == null ? void 0 : _a.click(\".header-box .close-box\");\n                  lib.$message.info(\"掌握度页面已关闭，即将继续学习！\");\n                }\n                setTimeout(check, 3e3);\n              };\n              check();\n            });\n          };\n          const hasStudyTimeWarnDialog = () => {\n            return !!Array.from(document.querySelectorAll(\".el-overlay .content\")).find(\n              (el) => {\n                var _a;\n                return (_a = el.textContent) == null ? void 0 : _a.includes(\"保持良好的学习习惯\");\n              }\n            );\n          };\n          const closeStudyTimeWarnDialog = () => {\n            return new Promise((resolve, reject) => {\n              const interval = setInterval(() => {\n                var _a;\n                const dialog = Array.from(document.querySelectorAll(\".el-overlay\")).find(\n                  (el) => {\n                    var _a2;\n                    return (_a2 = el.textContent) == null ? void 0 : _a2.includes(\"保持良好的学习习惯\");\n                  }\n                );\n                if (dialog) {\n                  const btn = dialog.querySelector(\".el-dialog__header img\");\n                  if (btn)\n                    (_a = processor.remotePage) == null ? void 0 : _a.click(btn);\n                  clearInterval(interval);\n                  resolve();\n                }\n              }, 1e3);\n              setTimeout(() => {\n                clearInterval(interval);\n                resolve();\n              }, 3 * 1e3);\n            });\n          };\n          const waitForMasteryLevelDialogClose = async () => {\n            return new Promise((resolve, reject) => {\n              const check = () => {\n                if (!document.querySelector(\".masterylevel-body\")) {\n                  resolve();\n                } else {\n                  setTimeout(check, 200);\n                }\n              };\n              check();\n            });\n          };\n          const waitForLoad2 = () => {\n            return new Promise((resolve, reject) => {\n              const check = () => {\n                if (document.querySelector(\".main-container\")) {\n                  resolve();\n                } else {\n                  setTimeout(check, 1e3);\n                }\n              };\n              check();\n            });\n          };\n          const fixProcessBar2 = () => {\n            const bar = document.querySelector(\".controlsBar\");\n            if (bar) {\n              bar.style.cssText = \"z-index: 2; overflow: inherit; display: block;\";\n            }\n          };\n          await waitForLoad2();\n          await lib.$.sleep(3e3);\n          closeMasteryLevelDialog();\n          processor.hideDialog();\n          await processor.init();\n          processor.handleTestDialog(processor.remotePage);\n          setInterval(() => {\n            fixProcessBar2();\n          }, 1e3);\n          lib.$message.success({ content: \"即将开始自动学习！\" });\n          const reload = async (e) => {\n            $console.error(e);\n            if (this.cfg.reloadWhenError) {\n              const msg = \"视频加载失败，即将刷新页面。\";\n              const reload_count = await lib.$store.getTab(\"reload-count\");\n              if (reload_count && reload_count > 3) {\n                const msg2 = \"视频加载失败/黑屏导致重新加载页面次数超过3次，请尝试关闭页面重新打开，或者检查网络连接！\";\n                await lib.$store.setTab(\"reload-count\", 0);\n                lib.$message.error({ content: msg2, duration: 0 });\n                $console.log(msg2);\n                CommonProject.scripts.settings.methods.notificationBySetting(msg2, {\n                  duration: 0,\n                  extraTitle: \"知道智慧树学习脚本\"\n                });\n                return;\n              }\n              await lib.$store.setTab(\"reload-count\", (reload_count != null ? reload_count : 0) + 1);\n              lib.$message.error(msg);\n              $console.log(msg);\n              setTimeout(() => {\n                location.reload();\n              }, 3e3);\n            } else {\n              const msg = \"视频加载失败，即将跳过。\";\n              lib.$message.error(msg);\n              $console.log(msg);\n              next2();\n            }\n          };\n          const doWork = async () => {\n            await waitForCaptcha();\n            const set = async () => {\n              try {\n                await processor.switchLine(this.cfg.definition || \"line1bq\");\n                await lib.$.sleep(1e3);\n                await processor.switchPlaybackRate(this.cfg.playbackRate);\n                await lib.$.sleep(1e3);\n                const media = await waitForMedia({ timeout: 5 * 1e3, filter: (m) => m.src.length !== 0 });\n                await lib.$.sleep(1e3);\n                state$4.study.currentMedia = media;\n                if (media) {\n                  media.currentTime = 1;\n                  media.volume = this.cfg.volume;\n                }\n                return state$4.study.currentMedia;\n              } catch (e) {\n                reload(e);\n              }\n            };\n            lib.$message.info(\"开始播放\");\n            try {\n              const media = await waitForMedia({\n                timeout: 10 * 1e3,\n                filter: (m) => m.src.length !== 0\n              });\n              media.pause();\n              fixProcessBar2();\n            } catch (e) {\n              reload(e);\n              return;\n            }\n            await waitForCaptcha();\n            const video = await set();\n            if (!video) {\n              return;\n            }\n            const videoCheckInterval = setInterval(async () => {\n              if (!(video == null ? void 0 : video.isConnected)) {\n                clearInterval(videoCheckInterval);\n                lib.$message.info({ content: \"检测到视频切换中...\" });\n                doWork();\n              }\n            }, 3e3);\n            playMedia(() => video == null ? void 0 : video.play()).then(() => {\n              const cn = getChapterName();\n              lib.$message.info({ content: \"正在学习：\" + cn });\n              $console.log(\"正在学习：\" + cn);\n            });\n            video.onpause = async () => {\n              if (!(video == null ? void 0 : video.isConnected))\n                return;\n              if (!(video == null ? void 0 : video.ended) && state$4.study.stop === false) {\n                await lib.$.sleep(1e3);\n                video == null ? void 0 : video.play();\n              }\n            };\n            video.onended = async () => {\n              if (!(video == null ? void 0 : video.isConnected))\n                return;\n              lib.$message.info(\"即将自动跳转下一节\");\n              $console.info(\"即将自动跳转下一节\");\n              clearInterval(videoCheckInterval);\n              await lib.$.sleep(3e3);\n              await next2();\n            };\n          };\n          doWork();\n        }\n      }),\n      hike: new lib.Script({\n        name: \"🖥️ 教学空间-AI智慧课程-学习脚本\",\n        matches: [\n          [\"学习首页\", \"hike-teaching-center.polymas.com/stu-hike/agent-course-hike/ai-course-center\"],\n          [\"学习页面\", \"tools-hike/studentStudyResource\"]\n        ],\n        namespace: \"zhs.hike.study\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\"请手动进入视频、作业、考试页面，脚本会自动运行。\"]).outerHTML\n          },\n          restudy,\n          reloadWhenError: {\n            label: \"视频黑屏时自动刷新\",\n            attrs: { type: \"checkbox\", title: \"当视频出现加载失败，或者黑屏等异常时，自动刷新页面3次尝试修复\" },\n            defaultValue: true\n          },\n          volume,\n          definition,\n          playbackRate: {\n            label: \"视频倍速\",\n            tag: \"select\",\n            defaultValue: 1,\n            attrs: { title: \"目前智慧树倍速最高只能1.5x，超出有封号风险\" },\n            options: [\n              [\"1\", \"1 x\"],\n              [\"1.25\", \"1.25 x\"],\n              [\"1.5\", \"1.5 x\"]\n            ]\n          }\n        },\n        async oncomplete(...args) {\n          CommonProject.scripts.render.methods.pin(this);\n          if (location.href.includes(\"stu-hike/agent-course-hike/ai-course-center\")) {\n            lib.$message.info({ content: \"请手动进入视频、作业、考试页面，脚本会自动运行。\", duration: 60 });\n            return;\n          }\n          const processor = new Hike();\n          this.onConfigChange(\"volume\", (curr) => {\n            state$4.study.currentMedia && (state$4.study.currentMedia.volume = curr);\n          });\n          this.onConfigChange(\"playbackRate\", async (curr) => {\n            if (typeof curr === \"string\") {\n              this.cfg.playbackRate = parseFloat(curr);\n            }\n            fixProcessBar();\n            processor.switchPlaybackRate(curr);\n          });\n          this.onConfigChange(\"definition\", async (curr) => {\n            fixProcessBar();\n            processor.switchLine(curr);\n          });\n          const getChapterName = () => {\n            var _a, _b;\n            return ((_b = (_a = document.querySelector(\".active-file\")) == null ? void 0 : _a.textContent) == null ? void 0 : _b.trim()) || \"未知章节\";\n          };\n          const next2 = async () => {\n            const nextJob = processor.getNext({ next: true, restudy: this.cfg.restudy });\n            if (nextJob) {\n              nextJob.click();\n              await lib.$.sleep(3e3);\n              doWork();\n            } else {\n              finishAlert();\n            }\n          };\n          const waitForLoad2 = () => {\n            return new Promise((resolve, reject) => {\n              const check = () => {\n                if (processor.hasJob()) {\n                  resolve();\n                } else {\n                  setTimeout(check, 1e3);\n                }\n              };\n              check();\n            });\n          };\n          await waitForLoad2();\n          await lib.$.sleep(3e3);\n          setInterval(() => {\n            fixProcessBar();\n          }, 1e3);\n          lib.$message.success({ content: \"即将开始自动学习！\" });\n          const reload = async (e) => {\n            $console.error(e);\n            if (this.cfg.reloadWhenError) {\n              const msg = \"视频加载失败，即将刷新页面。\";\n              const reload_count = await lib.$store.getTab(\"reload-count\");\n              if (reload_count && reload_count > 3) {\n                const msg2 = \"视频加载失败/黑屏导致重新加载页面次数超过3次，请尝试关闭页面重新打开，或者检查网络连接！\";\n                await lib.$store.setTab(\"reload-count\", 0);\n                lib.$message.error({ content: msg2, duration: 0 });\n                $console.log(msg2);\n                CommonProject.scripts.settings.methods.notificationBySetting(msg2, {\n                  duration: 0,\n                  extraTitle: \"知道智慧树学习脚本\"\n                });\n                return;\n              }\n              await lib.$store.setTab(\"reload-count\", (reload_count != null ? reload_count : 0) + 1);\n              lib.$message.error(msg);\n              $console.log(msg);\n              setTimeout(() => {\n                location.reload();\n              }, 3e3);\n            } else {\n              const msg = \"视频加载失败，即将跳过。\";\n              lib.$message.error(msg);\n              $console.log(msg);\n              next2();\n            }\n          };\n          const doWork = async () => {\n            var _a, _b, _c;\n            await waitForCaptcha();\n            if (!((_c = (_b = (_a = document.querySelector(\".active-file\")) == null ? void 0 : _a.parentElement) == null ? void 0 : _b.parentElement) == null ? void 0 : _c.querySelector(\".icon-movie\"))) {\n              lib.$message.warn(\"当前章节不支持学习，即将跳转下一节\");\n              await lib.$.sleep(3e3);\n              await next2();\n              return;\n            }\n            const set = async () => {\n              try {\n                await processor.switchLine(this.cfg.definition || \"line1bq\");\n                await lib.$.sleep(1e3);\n                await processor.switchPlaybackRate(this.cfg.playbackRate);\n                await lib.$.sleep(1e3);\n                const media = await waitForMedia({ timeout: 5 * 1e3, filter: (m) => m.src.length !== 0 });\n                await lib.$.sleep(1e3);\n                state$4.study.currentMedia = media;\n                if (media) {\n                  media.currentTime = 1;\n                  media.volume = this.cfg.volume;\n                }\n                return state$4.study.currentMedia;\n              } catch (e) {\n                reload(e);\n              }\n            };\n            lib.$message.info(\"开始播放\");\n            try {\n              const media = await waitForMedia({\n                timeout: 10 * 1e3,\n                filter: (m) => m.src.length !== 0\n              });\n              media.pause();\n              fixProcessBar();\n            } catch (e) {\n              reload(e);\n              return;\n            }\n            await waitForCaptcha();\n            const video = await set();\n            if (!video) {\n              return;\n            }\n            const videoCheckInterval = setInterval(async () => {\n              if (!(video == null ? void 0 : video.isConnected)) {\n                clearInterval(videoCheckInterval);\n                lib.$message.info({ content: \"检测到视频切换中...\" });\n                doWork();\n              }\n            }, 3e3);\n            playMedia(() => video == null ? void 0 : video.play()).then(() => {\n              const cn = getChapterName();\n              lib.$message.info({ content: \"正在学习：\" + cn });\n              $console.log(\"正在学习：\" + cn);\n            });\n            video.onpause = async () => {\n              if (!(video == null ? void 0 : video.isConnected))\n                return;\n              if (!(video == null ? void 0 : video.ended) && state$4.study.stop === false) {\n                await lib.$.sleep(1e3);\n                video == null ? void 0 : video.play();\n              }\n            };\n            video.onended = async () => {\n              if (!(video == null ? void 0 : video.isConnected))\n                return;\n              lib.$message.info(\"即将自动跳转下一节\");\n              $console.info(\"即将自动跳转下一节\");\n              clearInterval(videoCheckInterval);\n              await lib.$.sleep(3e3);\n              await next2();\n            };\n          };\n          doWork();\n        }\n      }),\n      \"hike-work\": new lib.Script({\n        matches: [[\"AI教学中心-作业任务页面\", \"/stu-hike/stuHomeworkDo\"]],\n        name: \"✍️ 教学空间-AI智慧课程-作业考试脚本\",\n        namespace: \"zhs.hike.work\",\n        configs: {\n          notes: workNotes,\n          workDelay: {\n            label: \"作业答题开始时间延迟（秒）\",\n            defaultValue: 3,\n            attrs: { type: \"number\", min: 1, step: 1, max: 10 }\n          }\n        },\n        async oncomplete() {\n          var _a;\n          CommonProject.scripts.render.methods.pin(this);\n          await waitForElement(\".q_main\");\n          commonWork(this, {\n            workerProvider: (opts) => {\n              return hikeWork(void 0, opts);\n            },\n            start_delay_seconds: (_a = this.cfg.workDelay) != null ? _a : 3\n          });\n        }\n      })\n    }\n  });\n  async function watch(processor, options, actions) {\n    const reload = async (e) => {\n      $console.error(e);\n      if (options.reloadWhenError) {\n        const msg = \"视频加载失败，即将刷新页面。\";\n        const reload_count = await lib.$store.getTab(\"reload-count\");\n        if (reload_count && reload_count > 3) {\n          const msg2 = \"视频加载失败导致重新加载页面次数超过3次，请尝试关闭页面重新打开，或者检查网络连接！\";\n          await lib.$store.setTab(\"reload-count\", 0);\n          lib.$message.error({ content: msg2, duration: 0 });\n          $console.log(msg2);\n          CommonProject.scripts.settings.methods.notificationBySetting(msg2, {\n            duration: 0,\n            extraTitle: \"知道智慧树学习脚本\"\n          });\n          return;\n        }\n        await lib.$store.setTab(\"reload-count\", (reload_count != null ? reload_count : 0) + 1);\n        lib.$message.error(msg);\n        $console.log(msg);\n        setTimeout(() => {\n          actions.reload();\n        }, 5e3);\n      } else {\n        const msg = \"视频加载失败，即将跳过。\";\n        lib.$message.error(msg);\n        $console.log(msg);\n        actions.onended({ next: true });\n      }\n    };\n    const set = async () => {\n      try {\n        await lib.$.sleep(1e3);\n        await processor.switchLine(options.definition || \"line1bq\");\n        await lib.$.sleep(1e3);\n        await processor.switchPlaybackRate(options.playbackRate);\n        await lib.$.sleep(1e3);\n        const media = await waitForMedia({ timeout: 10 * 1e3 });\n        await lib.$.sleep(1e3);\n        state$4.study.currentMedia = media;\n        if (media) {\n          media.currentTime = 1;\n          media.volume = options.volume;\n        }\n        return state$4.study.currentMedia;\n      } catch (e) {\n        return await reload(e);\n      }\n    };\n    lib.$message.info(\"开始播放\");\n    try {\n      const media = await waitForMedia({ timeout: 10 * 1e3 });\n      media.volume = options.volume;\n      media.pause();\n      fixProcessBar();\n    } catch (e) {\n      return await reload(e);\n    }\n    await lib.$.sleep(1e3);\n    const video = await set();\n    if (!video) {\n      return await reload(\"视频加载失败\");\n    }\n    const videoCheckInterval = setInterval(async () => {\n      if ((video == null ? void 0 : video.isConnected) === false) {\n        clearInterval(videoCheckInterval);\n        lib.$message.info({ content: \"检测到视频切换中...\" });\n        actions.onended({ next: false });\n      }\n    }, 3e3);\n    playMedia(() => video == null ? void 0 : video.play());\n    video.onpause = async () => {\n      if (!(video == null ? void 0 : video.ended) && state$4.study.stop === false) {\n        await waitForCaptcha();\n        await lib.$.sleep(1e3);\n        video == null ? void 0 : video.play();\n      }\n    };\n    video.onended = () => {\n      clearInterval(videoCheckInterval);\n      actions.onended({ next: true });\n    };\n  }\n  async function watchXnk(options, onended) {\n    const media = await waitForMedia();\n    media.volume = options.volume;\n    media.currentTime = 1;\n    state$4.study.currentMedia = media;\n    playMedia(() => media == null ? void 0 : media.play());\n    media.onpause = async () => {\n      if (!(media == null ? void 0 : media.ended)) {\n        await lib.$.sleep(1e3);\n        media == null ? void 0 : media.play();\n      }\n    };\n    media.onended = () => {\n      onended();\n    };\n  }\n  function checkForCaptcha(update) {\n    let modal2;\n    let notified = false;\n    return setInterval(() => {\n      if (lib.$el(\".yidun_popup\")) {\n        update(true);\n        if (modal2 === void 0) {\n          modal2 = lib.$modal.alert({ content: \"当前检测到验证码，请输入后方可继续运行。\" });\n        }\n        if (!notified) {\n          notified = true;\n          CommonProject.scripts.settings.methods.notificationBySetting(\n            \"智慧树脚本：当前检测到验证码，请输入后方可继续运行。\",\n            { duration: 0 }\n          );\n        }\n      } else {\n        if (modal2) {\n          update(false);\n          modal2.remove();\n          modal2 = void 0;\n        }\n      }\n    }, 1e3);\n  }\n  function waitForCaptcha() {\n    const popup = getPopupCaptcha();\n    if (popup) {\n      const message2 = lib.$message.warn({ content: \"当前检测到验证码，请输入后方可继续运行。\", duration: 0 });\n      CommonProject.scripts.settings.methods.notificationBySetting(\n        \"智慧树脚本：当前检测到验证码，请输入后方可继续运行。\",\n        { duration: 0 }\n      );\n      return new Promise((resolve, reject) => {\n        const interval = setInterval(() => {\n          const popup2 = getPopupCaptcha();\n          if (popup2 === null) {\n            message2 == null ? void 0 : message2.remove();\n            clearInterval(interval);\n            resolve();\n          }\n        }, 1e3);\n      });\n    }\n  }\n  function getPopupCaptcha() {\n    return document.querySelector(\".yidun_popup\");\n  }\n  function gxkWorkAndExam(workInfo, {\n    answererWrappers,\n    period,\n    thread,\n    stopSecondWhenFinish,\n    redundanceWordsText,\n    answerSeparators,\n    answerMatchMode\n  }) {\n    var _a, _b, _c;\n    CommonProject.scripts.workResults.methods.init({\n      questionPositionSyncHandlerType: \"zhs-gxk\"\n    });\n    const allExamParts = ((_c = ((_b = (_a = workInfo == null ? void 0 : workInfo.rt) == null ? void 0 : _a.examBase) == null ? void 0 : _b.workExamParts) || []) == null ? void 0 : _c.map((p) => p.questionDtos).flat()) || [];\n    const titleTransform = (_, index) => {\n      var _a2;\n      const div = lib.h(\"div\");\n      div.innerHTML = ((_a2 = allExamParts[index]) == null ? void 0 : _a2.name) || \"题目读取失败\";\n      return removeRedundantWords(\n        optimizationElementWithImage(div, true).innerText || \"\",\n        redundanceWordsText.split(\"\\n\")\n      );\n    };\n    let request_index = 0;\n    const worker = new OCSWorker({\n      root: \".examPaper_subject\",\n      elements: {\n        title: \".subject_describe > div,.smallStem_describe > div:nth-child(2)\",\n        options: (root2) => lib.$$el(\".subject_node .nodeLab\", root2).map((t2) => {\n          for (const img of Array.from(t2.querySelectorAll(\".node_detail img\"))) {\n            if (img.dataset.src) {\n              img.src = img.dataset.src;\n            }\n            createUnVisibleTextOfImage(img);\n          }\n          return t2;\n        })\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        const title = titleTransform(void 0, request_index++);\n        if (title) {\n          return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n            await lib.$.sleep((period != null ? period : 3) * 1e3);\n            return defaultAnswerWrapperHandler(answererWrappers, {\n              type: ctx.type || \"unknown\",\n              title,\n              options: ctx.elements.options.map((o) => o.innerText).join(\"\\n\")\n            });\n          });\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      work: {\n        type(ctx) {\n          var _a2, _b2, _c2, _d;\n          const type = (_d = (_c2 = (_b2 = (_a2 = ctx.elements.title[0].parentElement) == null ? void 0 : _a2.parentElement) == null ? void 0 : _b2.querySelector(\".subject_type\")) == null ? void 0 : _c2.textContent) == null ? void 0 : _d.trim();\n          if (type == null ? void 0 : type.includes(\"单选题\")) {\n            return \"single\";\n          } else if (type == null ? void 0 : type.includes(\"多选题\")) {\n            return \"multiple\";\n          } else if (type == null ? void 0 : type.includes(\"判断题\")) {\n            return \"judgement\";\n          } else if (type == null ? void 0 : type.includes(\"填空题\")) {\n            return \"completion\";\n          } else {\n            return void 0;\n          }\n        },\n        async handler(type, answer, option) {\n          var _a2;\n          if (type === \"judgement\" || type === \"single\" || type === \"multiple\") {\n            if (!((_a2 = option.querySelector(\"input\")) == null ? void 0 : _a2.checked)) {\n              option.click();\n              await lib.$.sleep(200);\n            }\n          } else if (type === \"completion\" && answer.trim()) {\n            const text = option.querySelector(\"textarea\");\n            if (text) {\n              text.value = answer;\n              await lib.$.sleep(200);\n            }\n          }\n        }\n      },\n      onResultsUpdate(curr, index, res) {\n        var _a2, _b2;\n        CommonProject.scripts.workResults.methods.setResults(simplifyWorkResult(res, titleTransform));\n        if ((_a2 = curr.result) == null ? void 0 : _a2.finish) {\n          const title = (_b2 = allExamParts[index]) == null ? void 0 : _b2.name;\n          if (title) {\n            CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n              simplifyWorkResult([curr], (_, __) => title)\n            );\n          }\n        }\n        CommonProject.scripts.workResults.methods.updateWorkStateByResults(res);\n      }\n    });\n    checkForCaptcha((hasCaptcha) => {\n      if (hasCaptcha) {\n        worker.emit(\"stop\");\n      } else {\n        worker.emit(\"continuate\");\n      }\n    });\n    worker.doWork().then(async (res) => {\n      var _a2;\n      if (worker.isClose === true) {\n        return;\n      }\n      lib.$message.success({ content: `答题完成，将等待 ${stopSecondWhenFinish} 秒后进行保存或提交。` });\n      await lib.$.sleep(stopSecondWhenFinish * 1e3);\n      if (worker.isClose === true) {\n        return;\n      }\n      for (let index = 0; index < worker.totalQuestionCount; index++) {\n        if (worker.isClose === true) {\n          return;\n        }\n        const modal2 = lib.$modal.alert({\n          title: \"⚠️提示\",\n          content: `正在自动保存题目中，不然填写的答案将无效，<br>当前进度 ${index}/${worker.totalQuestionCount}<br>保存完毕前请勿操作...`,\n          confirmButton: null,\n          maskCloseable: false\n        });\n        await waitForCaptcha();\n        await lib.$.sleep(2e3);\n        (_a2 = document.querySelectorAll(\".answerCard_list ul li\").item(index)) == null ? void 0 : _a2.click();\n        await lib.$.sleep(200);\n        const next2 = lib.$el(\"div.examPaper_box > div.switch-btn-box > button:nth-child(2)\");\n        if (next2) {\n          next2.click();\n        } else {\n          $console.error(\"未找到下一页按钮。\");\n        }\n        modal2 == null ? void 0 : modal2.remove();\n      }\n      lib.$message.info({ content: \"作业/考试完成，请自行检查后保存或提交。\", duration: 0 });\n      worker.emit(\"done\");\n    }).catch((err) => {\n      lib.$message.error({ content: \"答题程序发生错误 : \" + err.message, duration: 0 });\n    });\n    return worker;\n  }\n  function xnkWork({ answererWrappers, period, thread, answerSeparators, answerMatchMode }) {\n    lib.$message.info({ content: \"开始作业\" });\n    CommonProject.scripts.workResults.methods.init();\n    const titleTransform = (titles) => {\n      return titles.filter((t2) => t2 == null ? void 0 : t2.innerText).map((t2) => t2 ? optimizationElementWithImage(t2).innerText : \"\").join(\",\");\n    };\n    const workResults = [];\n    let totalQuestionCount = 0;\n    let requestedCount = 0;\n    let resolvedCount = 0;\n    const worker = new OCSWorker({\n      root: \".questionBox\",\n      elements: {\n        title: \".questionContent\",\n        options: \".optionUl label\",\n        questionTit: \".questionTit\"\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        const title = titleTransform(elements2.title);\n        if (title) {\n          return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n            await lib.$.sleep((period != null ? period : 3) * 1e3);\n            return defaultAnswerWrapperHandler(answererWrappers, {\n              type: ctx.type || \"unknown\",\n              title,\n              options: ctx.elements.options.map((o) => o.innerText).join(\"\\n\")\n            });\n          });\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      work: {\n        async handler(type, answer, option, ctx) {\n          var _a;\n          if (type === \"judgement\" || type === \"single\" || type === \"multiple\") {\n            if (((_a = option.querySelector(\"input\")) == null ? void 0 : _a.checked) === false) {\n              option.click();\n              await lib.$.sleep(200);\n            }\n          } else if (type === \"completion\" && answer.trim()) {\n            const text = option.querySelector(\"textarea\");\n            if (text) {\n              text.value = answer;\n              await lib.$.sleep(200);\n            }\n          }\n        }\n      },\n      onResultsUpdate(current, _, res) {\n        var _a;\n        if (current.result) {\n          workResults.push(...simplifyWorkResult([current], titleTransform));\n          CommonProject.scripts.workResults.methods.setResults(workResults);\n          totalQuestionCount++;\n          requestedCount++;\n          resolvedCount++;\n        }\n        if ((_a = current.result) == null ? void 0 : _a.finish) {\n          CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n            simplifyWorkResult([current], titleTransform)\n          );\n        }\n        CommonProject.scripts.workResults.methods.updateWorkState({\n          totalQuestionCount,\n          requestedCount,\n          resolvedCount\n        });\n      }\n    });\n    const getBtn = () => document.querySelector(\"span.Topicswitchingbtn:nth-child(2)\");\n    let next2 = getBtn();\n    (async () => {\n      while (next2 && worker.isClose === false) {\n        await worker.doWork();\n        await lib.$.sleep(1e3);\n        next2 = getBtn();\n        next2 == null ? void 0 : next2.click();\n        await lib.$.sleep(1e3);\n      }\n      lib.$message.info({ content: \"作业/考试完成，请自行检查后保存或提交。\", duration: 0 });\n      worker.emit(\"done\");\n      CommonProject.scripts.workResults.cfg.questionPositionSyncHandlerType = \"zhs-xnk\";\n    })();\n    return worker;\n  }\n  function smartWork(remotePage, { answererWrappers, period, thread, answerSeparators, answerMatchMode }) {\n    lib.$message.info({ content: \"开始作业\" });\n    CommonProject.scripts.workResults.methods.init();\n    const titleTransform = (titles) => {\n      return titles.filter((t2) => t2 == null ? void 0 : t2.innerText).map((t2) => t2 ? optimizationElementWithImage(t2).innerText : \"\").join(\",\");\n    };\n    const workResults = [];\n    let totalQuestionCount = 0;\n    let requestedCount = 0;\n    let resolvedCount = 0;\n    const worker = new OCSWorker({\n      root: \".questionContent\",\n      elements: {\n        title: \".questionName .centent-pre\",\n        options: \".radio-view li.clearfix, .checkbox-views label.el-checkbox, .fillAnswer\"\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        const title = titleTransform(elements2.title);\n        if (title) {\n          return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n            await lib.$.sleep((period != null ? period : 3) * 1e3);\n            return defaultAnswerWrapperHandler(answererWrappers, {\n              type: ctx.type || \"unknown\",\n              title,\n              options: ctx.elements.options.map((o) => o.innerText).join(\"\\n\")\n            });\n          });\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      work: {\n        type(ctx) {\n          var _a, _b, _c;\n          const type = (_c = (_b = (_a = ctx.elements.title[0]) == null ? void 0 : _a.parentElement) == null ? void 0 : _b.querySelector(\".letterSortNum\")) == null ? void 0 : _c.textContent;\n          if (type == null ? void 0 : type.includes(\"单选题\")) {\n            return \"single\";\n          } else if (type == null ? void 0 : type.includes(\"多选题\")) {\n            return \"multiple\";\n          } else if (type == null ? void 0 : type.includes(\"判断题\")) {\n            return \"judgement\";\n          } else if (type == null ? void 0 : type.includes(\"填空\")) {\n            return \"completion\";\n          } else {\n            return void 0;\n          }\n        },\n        async handler(type, answer, option, ctx) {\n          if (type === \"judgement\" || type === \"single\" || type === \"multiple\") {\n            const opt = option.querySelector(\n              \".el-checkbox__input:not(.is-checked),i.iconfont:not(.checkedIcon)\"\n            );\n            if (opt) {\n              if (remotePage) {\n                await remotePage.click(opt);\n              } else {\n                opt.click();\n              }\n              await lib.$.sleep(200);\n            }\n          } else if (type === \"completion\") {\n            const opt = option.querySelector(\"input\");\n            if (opt && answer.trim()) {\n              if (remotePage) {\n                await remotePage.click(opt);\n                opt.value = \"\";\n                await remotePage[\"keyboard.type\"](answer, { delay: Math.floor(Math.random() * 100) });\n              } else {\n                opt.value = answer;\n              }\n              await lib.$.sleep(200);\n            }\n          }\n        }\n      },\n      onResultsUpdate(current, _, res) {\n        var _a;\n        if (current.result) {\n          workResults.push(...simplifyWorkResult([current], titleTransform));\n          CommonProject.scripts.workResults.methods.setResults(workResults);\n          totalQuestionCount++;\n          requestedCount++;\n          resolvedCount++;\n        }\n        if ((_a = current.result) == null ? void 0 : _a.finish) {\n          CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n            simplifyWorkResult([current], titleTransform)\n          );\n        }\n        CommonProject.scripts.workResults.methods.updateWorkState({\n          totalQuestionCount,\n          requestedCount,\n          resolvedCount\n        });\n      }\n    });\n    const getNextBtn = () => document.querySelector(\".next-topic.next-t\");\n    let next2 = getNextBtn();\n    (async () => {\n      const first = document.querySelector('[role=\"treeitem\"] .font-sec-style-node');\n      if (first) {\n        if (remotePage)\n          await remotePage.click(first);\n        else\n          first.click();\n        await lib.$.sleep(3e3);\n      }\n      let count = 0;\n      while (next2 && worker.isClose === false) {\n        await worker.doWork({ enable_debug: true });\n        next2 = getNextBtn();\n        if (next2) {\n          await lib.$.sleep(1e3);\n          if (remotePage)\n            await remotePage.click(next2);\n          else\n            next2.click();\n          await lib.$.sleep(1e3);\n          count++;\n        }\n      }\n      lib.$message.info({\n        content: \"作业/考试完成，请自行检查后保存或提交。\",\n        duration: count > 10 ? 0 : 30\n      });\n      worker.emit(\"done\");\n      CommonProject.scripts.workResults.cfg.questionPositionSyncHandlerType = \"zhs-smart\";\n    })();\n    return worker;\n  }\n  function fusioncourseWork(remotePage, { answererWrappers, period, thread, answerSeparators, answerMatchMode }) {\n    lib.$message.info({ content: \"开始作业\" });\n    CommonProject.scripts.workResults.methods.init({\n      questionPositionSyncHandlerType: \"zhs-fusion\"\n    });\n    const titleTransform = (titles) => {\n      return titles.filter((t2) => t2 == null ? void 0 : t2.innerText).map((t2) => t2 ? optimizationElementWithImage(t2).innerText : \"\").join(\",\");\n    };\n    const worker = new OCSWorker({\n      root: \".exam-item\",\n      elements: {\n        type: \".quest-type\",\n        title: \".quest-title .option-name\",\n        options: \"label\"\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        const title = titleTransform(elements2.title);\n        if (title) {\n          return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n            await lib.$.sleep((period != null ? period : 3) * 1e3);\n            return defaultAnswerWrapperHandler(answererWrappers, {\n              type: ctx.type || \"unknown\",\n              title,\n              options: ctx.elements.options.map((o) => o.innerText).join(\"\\n\")\n            });\n          });\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      work: {\n        type(ctx) {\n          const type = ctx.elements.type[0].textContent;\n          if (type == null ? void 0 : type.includes(\"单选题\")) {\n            return \"single\";\n          } else if (type == null ? void 0 : type.includes(\"多选题\")) {\n            return \"multiple\";\n          } else if (type == null ? void 0 : type.includes(\"判断题\")) {\n            return \"judgement\";\n          } else if (type == null ? void 0 : type.includes(\"填空题\")) {\n            return \"completion\";\n          } else {\n            return void 0;\n          }\n        },\n        async handler(type, answer, option, ctx) {\n          if (type === \"judgement\" || type === \"single\" || type === \"multiple\") {\n            const opt = option.querySelector(\n              \".el-checkbox__input:not(.is-checked),.el-radio__input:not(.is-checked)\"\n            );\n            if (opt) {\n              if (remotePage) {\n                await remotePage.click(opt);\n              } else {\n                opt.click();\n              }\n              await lib.$.sleep(200);\n            }\n          }\n        }\n      },\n      onResultsUpdate(current, _, res) {\n        var _a;\n        if (current.result) {\n          CommonProject.scripts.workResults.methods.setResults(simplifyWorkResult(res, titleTransform));\n        }\n        if ((_a = current.result) == null ? void 0 : _a.finish) {\n          CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n            simplifyWorkResult([current], titleTransform)\n          );\n        }\n        CommonProject.scripts.workResults.methods.updateWorkStateByResults(res);\n      }\n    });\n    worker.doWork().then(async (res) => {\n      if (worker.isClose === true) {\n        return;\n      }\n      if (worker.isClose === true) {\n        return;\n      }\n      lib.$message.info({\n        content: \"作业/考试完成，请自行检查后保存或提交。\",\n        duration: res.length > 10 ? 0 : 30\n      });\n      worker.emit(\"done\");\n    }).catch((err) => {\n      lib.$message.error({ content: \"答题程序发生错误 : \" + err.message, duration: 0 });\n    });\n    return worker;\n  }\n  function hikeWork(remotePage, { answererWrappers, period, thread, answerSeparators, answerMatchMode }) {\n    lib.$message.info({ content: \"开始作业\" });\n    CommonProject.scripts.workResults.methods.init({\n      questionPositionSyncHandlerType: \"zhs-hike\"\n    });\n    const titleTransform = (titles) => {\n      return titles.filter((t2) => t2 == null ? void 0 : t2.innerText).map((t2) => t2 ? optimizationElementWithImage(t2).innerText : \"\").join(\",\");\n    };\n    const worker = new OCSWorker({\n      root: \".q_main\",\n      elements: {\n        type: \".question_score\",\n        title: \".question-topic\",\n        options: \"label\"\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        const title = titleTransform(elements2.title);\n        if (title) {\n          return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n            await lib.$.sleep((period != null ? period : 3) * 1e3);\n            return defaultAnswerWrapperHandler(answererWrappers, {\n              type: ctx.type || \"unknown\",\n              title,\n              options: ctx.elements.options.map((o) => o.innerText).join(\"\\n\")\n            });\n          });\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      work: {\n        type(ctx) {\n          const type = ctx.elements.type[0].textContent;\n          if (type == null ? void 0 : type.includes(\"单选题\")) {\n            return \"single\";\n          } else if (type == null ? void 0 : type.includes(\"多选题\")) {\n            return \"multiple\";\n          } else if (type == null ? void 0 : type.includes(\"判断题\")) {\n            return \"judgement\";\n          } else if (type == null ? void 0 : type.includes(\"填空题\")) {\n            return \"completion\";\n          } else {\n            return void 0;\n          }\n        },\n        async handler(type, answer, option, ctx) {\n          if (type === \"judgement\" || type === \"single\" || type === \"multiple\") {\n            const opt = option.querySelector(\n              \".el-checkbox__input:not(.is-checked),.el-radio__input:not(.is-checked)\"\n            );\n            if (opt) {\n              if (remotePage) {\n                await remotePage.click(opt);\n              } else {\n                opt.click();\n              }\n              await lib.$.sleep(200);\n            }\n          }\n        }\n      },\n      onResultsUpdate(current, _, res) {\n        var _a;\n        if (current.result) {\n          CommonProject.scripts.workResults.methods.setResults(simplifyWorkResult(res, titleTransform));\n        }\n        if ((_a = current.result) == null ? void 0 : _a.finish) {\n          CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n            simplifyWorkResult([current], titleTransform)\n          );\n        }\n        CommonProject.scripts.workResults.methods.updateWorkStateByResults(res);\n      }\n    });\n    const getNextBtn = () => document.querySelector(\".check_btn:not(.is-disabled)\");\n    let next2 = getNextBtn();\n    let count = 0;\n    (async () => {\n      const first = document.querySelector(\".card_ul .card_li\");\n      if (first) {\n        if (remotePage)\n          await remotePage.click(first);\n        else\n          first.click();\n        await lib.$.sleep(3e3);\n      }\n      while (next2 && worker.isClose === false) {\n        await worker.doWork({ enable_debug: true });\n        next2 = getNextBtn();\n        if (next2) {\n          await lib.$.sleep(1e3);\n          if (remotePage)\n            await remotePage.click(next2);\n          else\n            next2.click();\n          await lib.$.sleep(1e3);\n          count++;\n        }\n      }\n      lib.$message.info({ content: \"作业/考试完成，请自行检查后保存或提交。\", duration: count > 10 ? 0 : 30 });\n      worker.emit(\"done\");\n      CommonProject.scripts.workResults.cfg.questionPositionSyncHandlerType = \"zhs-hike\";\n    })();\n    return worker;\n  }\n  function optimizeSecond(second) {\n    if (second > 3600) {\n      return `${Math.floor(second / 3600)}小时${Math.floor(second % 3600 / 60)}分钟`;\n    } else if (second > 60) {\n      return `${Math.floor(second / 60)}分钟${second % 60}秒`;\n    } else {\n      return `${second}秒`;\n    }\n  }\n  function autoStop(stopTime) {\n    var _a, _b;\n    clearInterval(state$4.study.stopInterval);\n    (_a = state$4.study.stopMessage) == null ? void 0 : _a.remove();\n    if (stopTime !== \"0\") {\n      let stopCount = parseFloat(stopTime) * 60 * 60;\n      state$4.study.stopInterval = setInterval(() => {\n        var _a2;\n        if (stopCount > 0) {\n          if (getPopupCaptcha() === null) {\n            stopCount--;\n          }\n        } else {\n          clearInterval(state$4.study.stopInterval);\n          state$4.study.stop = true;\n          (_a2 = lib.$el(\"video\")) == null ? void 0 : _a2.pause();\n          lib.$modal.alert({ content: \"脚本暂停，已获得今日平时分，如需继续观看，请刷新页面。\" });\n        }\n      }, 1e3);\n      const val = ((_b = ZHSProject.scripts[\"gxk-study\"].configs.stopTime.options.find((t2) => t2[0] === stopTime)) == null ? void 0 : _b[0]) || \"0\";\n      const date = new Date();\n      date.setMinutes(date.getMinutes() + parseFloat(val) * 60);\n      state$4.study.stopMessage = lib.$message.info({\n        duration: 0,\n        content: `在 ${date.toLocaleTimeString()} 脚本将自动暂停`\n      });\n    }\n  }\n  function fixProcessBar() {\n    const bar = document.querySelector(\".controlsBar\");\n    if (bar) {\n      bar.style.display = \"block\";\n    }\n  }\n  function closeDialogRead() {\n    const div = document.querySelector(\".dialog-read\");\n    if (div) {\n      div.style.display = \"none\";\n    }\n  }\n  function finishAlert() {\n    lib.$modal.alert({\n      content: \"检测到当前视频全部播放完毕，如果还有未完成的视频请刷新重试，或者打开复习模式。\"\n    });\n  }\n  var md5$1 = { exports: {} };\n  var crypt = { exports: {} };\n  (function() {\n    var base64map = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\", crypt$1 = {\n      rotl: function(n, b) {\n        return n << b | n >>> 32 - b;\n      },\n      rotr: function(n, b) {\n        return n << 32 - b | n >>> b;\n      },\n      endian: function(n) {\n        if (n.constructor == Number) {\n          return crypt$1.rotl(n, 8) & 16711935 | crypt$1.rotl(n, 24) & 4278255360;\n        }\n        for (var i = 0; i < n.length; i++)\n          n[i] = crypt$1.endian(n[i]);\n        return n;\n      },\n      randomBytes: function(n) {\n        for (var bytes = []; n > 0; n--)\n          bytes.push(Math.floor(Math.random() * 256));\n        return bytes;\n      },\n      bytesToWords: function(bytes) {\n        for (var words = [], i = 0, b = 0; i < bytes.length; i++, b += 8)\n          words[b >>> 5] |= bytes[i] << 24 - b % 32;\n        return words;\n      },\n      wordsToBytes: function(words) {\n        for (var bytes = [], b = 0; b < words.length * 32; b += 8)\n          bytes.push(words[b >>> 5] >>> 24 - b % 32 & 255);\n        return bytes;\n      },\n      bytesToHex: function(bytes) {\n        for (var hex = [], i = 0; i < bytes.length; i++) {\n          hex.push((bytes[i] >>> 4).toString(16));\n          hex.push((bytes[i] & 15).toString(16));\n        }\n        return hex.join(\"\");\n      },\n      hexToBytes: function(hex) {\n        for (var bytes = [], c = 0; c < hex.length; c += 2)\n          bytes.push(parseInt(hex.substr(c, 2), 16));\n        return bytes;\n      },\n      bytesToBase64: function(bytes) {\n        for (var base64 = [], i = 0; i < bytes.length; i += 3) {\n          var triplet = bytes[i] << 16 | bytes[i + 1] << 8 | bytes[i + 2];\n          for (var j = 0; j < 4; j++)\n            if (i * 8 + j * 6 <= bytes.length * 8)\n              base64.push(base64map.charAt(triplet >>> 6 * (3 - j) & 63));\n            else\n              base64.push(\"=\");\n        }\n        return base64.join(\"\");\n      },\n      base64ToBytes: function(base64) {\n        base64 = base64.replace(/[^A-Z0-9+\\/]/ig, \"\");\n        for (var bytes = [], i = 0, imod4 = 0; i < base64.length; imod4 = ++i % 4) {\n          if (imod4 == 0)\n            continue;\n          bytes.push((base64map.indexOf(base64.charAt(i - 1)) & Math.pow(2, -2 * imod4 + 8) - 1) << imod4 * 2 | base64map.indexOf(base64.charAt(i)) >>> 6 - imod4 * 2);\n        }\n        return bytes;\n      }\n    };\n    crypt.exports = crypt$1;\n  })();\n  var charenc = {\n    utf8: {\n      stringToBytes: function(str) {\n        return charenc.bin.stringToBytes(unescape(encodeURIComponent(str)));\n      },\n      bytesToString: function(bytes) {\n        return decodeURIComponent(escape(charenc.bin.bytesToString(bytes)));\n      }\n    },\n    bin: {\n      stringToBytes: function(str) {\n        for (var bytes = [], i = 0; i < str.length; i++)\n          bytes.push(str.charCodeAt(i) & 255);\n        return bytes;\n      },\n      bytesToString: function(bytes) {\n        for (var str = [], i = 0; i < bytes.length; i++)\n          str.push(String.fromCharCode(bytes[i]));\n        return str.join(\"\");\n      }\n    }\n  };\n  var charenc_1 = charenc;\n  /*!\n   * Determine if an object is a Buffer\n   *\n   * @author   Feross Aboukhadijeh <https://feross.org>\n   * @license  MIT\n   */\n  var isBuffer_1 = function(obj) {\n    return obj != null && (isBuffer(obj) || isSlowBuffer(obj) || !!obj._isBuffer);\n  };\n  function isBuffer(obj) {\n    return !!obj.constructor && typeof obj.constructor.isBuffer === \"function\" && obj.constructor.isBuffer(obj);\n  }\n  function isSlowBuffer(obj) {\n    return typeof obj.readFloatLE === \"function\" && typeof obj.slice === \"function\" && isBuffer(obj.slice(0, 0));\n  }\n  (function() {\n    var crypt$1 = crypt.exports, utf8 = charenc_1.utf8, isBuffer2 = isBuffer_1, bin = charenc_1.bin, md52 = function(message2, options) {\n      if (message2.constructor == String)\n        if (options && options.encoding === \"binary\")\n          message2 = bin.stringToBytes(message2);\n        else\n          message2 = utf8.stringToBytes(message2);\n      else if (isBuffer2(message2))\n        message2 = Array.prototype.slice.call(message2, 0);\n      else if (!Array.isArray(message2) && message2.constructor !== Uint8Array)\n        message2 = message2.toString();\n      var m = crypt$1.bytesToWords(message2), l = message2.length * 8, a = 1732584193, b = -271733879, c = -1732584194, d = 271733878;\n      for (var i = 0; i < m.length; i++) {\n        m[i] = (m[i] << 8 | m[i] >>> 24) & 16711935 | (m[i] << 24 | m[i] >>> 8) & 4278255360;\n      }\n      m[l >>> 5] |= 128 << l % 32;\n      m[(l + 64 >>> 9 << 4) + 14] = l;\n      var FF = md52._ff, GG = md52._gg, HH = md52._hh, II = md52._ii;\n      for (var i = 0; i < m.length; i += 16) {\n        var aa = a, bb = b, cc = c, dd = d;\n        a = FF(a, b, c, d, m[i + 0], 7, -680876936);\n        d = FF(d, a, b, c, m[i + 1], 12, -389564586);\n        c = FF(c, d, a, b, m[i + 2], 17, 606105819);\n        b = FF(b, c, d, a, m[i + 3], 22, -1044525330);\n        a = FF(a, b, c, d, m[i + 4], 7, -176418897);\n        d = FF(d, a, b, c, m[i + 5], 12, 1200080426);\n        c = FF(c, d, a, b, m[i + 6], 17, -1473231341);\n        b = FF(b, c, d, a, m[i + 7], 22, -45705983);\n        a = FF(a, b, c, d, m[i + 8], 7, 1770035416);\n        d = FF(d, a, b, c, m[i + 9], 12, -1958414417);\n        c = FF(c, d, a, b, m[i + 10], 17, -42063);\n        b = FF(b, c, d, a, m[i + 11], 22, -1990404162);\n        a = FF(a, b, c, d, m[i + 12], 7, 1804603682);\n        d = FF(d, a, b, c, m[i + 13], 12, -40341101);\n        c = FF(c, d, a, b, m[i + 14], 17, -1502002290);\n        b = FF(b, c, d, a, m[i + 15], 22, 1236535329);\n        a = GG(a, b, c, d, m[i + 1], 5, -165796510);\n        d = GG(d, a, b, c, m[i + 6], 9, -1069501632);\n        c = GG(c, d, a, b, m[i + 11], 14, 643717713);\n        b = GG(b, c, d, a, m[i + 0], 20, -373897302);\n        a = GG(a, b, c, d, m[i + 5], 5, -701558691);\n        d = GG(d, a, b, c, m[i + 10], 9, 38016083);\n        c = GG(c, d, a, b, m[i + 15], 14, -660478335);\n        b = GG(b, c, d, a, m[i + 4], 20, -405537848);\n        a = GG(a, b, c, d, m[i + 9], 5, 568446438);\n        d = GG(d, a, b, c, m[i + 14], 9, -1019803690);\n        c = GG(c, d, a, b, m[i + 3], 14, -187363961);\n        b = GG(b, c, d, a, m[i + 8], 20, 1163531501);\n        a = GG(a, b, c, d, m[i + 13], 5, -1444681467);\n        d = GG(d, a, b, c, m[i + 2], 9, -51403784);\n        c = GG(c, d, a, b, m[i + 7], 14, 1735328473);\n        b = GG(b, c, d, a, m[i + 12], 20, -1926607734);\n        a = HH(a, b, c, d, m[i + 5], 4, -378558);\n        d = HH(d, a, b, c, m[i + 8], 11, -2022574463);\n        c = HH(c, d, a, b, m[i + 11], 16, 1839030562);\n        b = HH(b, c, d, a, m[i + 14], 23, -35309556);\n        a = HH(a, b, c, d, m[i + 1], 4, -1530992060);\n        d = HH(d, a, b, c, m[i + 4], 11, 1272893353);\n        c = HH(c, d, a, b, m[i + 7], 16, -155497632);\n        b = HH(b, c, d, a, m[i + 10], 23, -1094730640);\n        a = HH(a, b, c, d, m[i + 13], 4, 681279174);\n        d = HH(d, a, b, c, m[i + 0], 11, -358537222);\n        c = HH(c, d, a, b, m[i + 3], 16, -722521979);\n        b = HH(b, c, d, a, m[i + 6], 23, 76029189);\n        a = HH(a, b, c, d, m[i + 9], 4, -640364487);\n        d = HH(d, a, b, c, m[i + 12], 11, -421815835);\n        c = HH(c, d, a, b, m[i + 15], 16, 530742520);\n        b = HH(b, c, d, a, m[i + 2], 23, -995338651);\n        a = II(a, b, c, d, m[i + 0], 6, -198630844);\n        d = II(d, a, b, c, m[i + 7], 10, 1126891415);\n        c = II(c, d, a, b, m[i + 14], 15, -1416354905);\n        b = II(b, c, d, a, m[i + 5], 21, -57434055);\n        a = II(a, b, c, d, m[i + 12], 6, 1700485571);\n        d = II(d, a, b, c, m[i + 3], 10, -1894986606);\n        c = II(c, d, a, b, m[i + 10], 15, -1051523);\n        b = II(b, c, d, a, m[i + 1], 21, -2054922799);\n        a = II(a, b, c, d, m[i + 8], 6, 1873313359);\n        d = II(d, a, b, c, m[i + 15], 10, -30611744);\n        c = II(c, d, a, b, m[i + 6], 15, -1560198380);\n        b = II(b, c, d, a, m[i + 13], 21, 1309151649);\n        a = II(a, b, c, d, m[i + 4], 6, -145523070);\n        d = II(d, a, b, c, m[i + 11], 10, -1120210379);\n        c = II(c, d, a, b, m[i + 2], 15, 718787259);\n        b = II(b, c, d, a, m[i + 9], 21, -343485551);\n        a = a + aa >>> 0;\n        b = b + bb >>> 0;\n        c = c + cc >>> 0;\n        d = d + dd >>> 0;\n      }\n      return crypt$1.endian([a, b, c, d]);\n    };\n    md52._ff = function(a, b, c, d, x, s, t2) {\n      var n = a + (b & c | ~b & d) + (x >>> 0) + t2;\n      return (n << s | n >>> 32 - s) + b;\n    };\n    md52._gg = function(a, b, c, d, x, s, t2) {\n      var n = a + (b & d | c & ~d) + (x >>> 0) + t2;\n      return (n << s | n >>> 32 - s) + b;\n    };\n    md52._hh = function(a, b, c, d, x, s, t2) {\n      var n = a + (b ^ c ^ d) + (x >>> 0) + t2;\n      return (n << s | n >>> 32 - s) + b;\n    };\n    md52._ii = function(a, b, c, d, x, s, t2) {\n      var n = a + (c ^ (b | ~d)) + (x >>> 0) + t2;\n      return (n << s | n >>> 32 - s) + b;\n    };\n    md52._blocksize = 16;\n    md52._digestsize = 16;\n    md5$1.exports = function(message2, options) {\n      if (message2 === void 0 || message2 === null)\n        throw new Error(\"Illegal argument \" + message2);\n      var digestbytes = crypt$1.wordsToBytes(md52(message2, options));\n      return options && options.asBytes ? digestbytes : options && options.asString ? bin.bytesToString(digestbytes) : crypt$1.bytesToHex(digestbytes);\n    };\n  })();\n  var md5 = md5$1.exports;\n  var Typr = {};\n  Typr.parse = function(buff) {\n    var bin = Typr._bin;\n    var data = new Uint8Array(buff);\n    var offset = 0;\n    bin.readFixed(data, offset);\n    offset += 4;\n    var numTables = bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    var tags = [\"cmap\", \"head\", \"hhea\", \"maxp\", \"hmtx\", \"name\", \"OS/2\", \"post\", \"loca\", \"glyf\", \"kern\", \"CFF \", \"GPOS\", \"GSUB\", \"SVG \"];\n    var obj = { _data: data };\n    var tabs = {};\n    for (var i = 0; i < numTables; i++) {\n      var tag = bin.readASCII(data, offset, 4);\n      offset += 4;\n      bin.readUint(data, offset);\n      offset += 4;\n      var toffset = bin.readUint(data, offset);\n      offset += 4;\n      var length = bin.readUint(data, offset);\n      offset += 4;\n      tabs[tag] = { offset: toffset, length };\n    }\n    for (var i = 0; i < tags.length; i++) {\n      var t2 = tags[i];\n      if (tabs[t2])\n        obj[t2.trim()] = Typr[t2.trim()].parse(data, tabs[t2].offset, tabs[t2].length, obj);\n    }\n    return obj;\n  };\n  Typr._tabOffset = function(data, tab) {\n    var bin = Typr._bin;\n    var numTables = bin.readUshort(data, 4);\n    var offset = 12;\n    for (var i = 0; i < numTables; i++) {\n      var tag = bin.readASCII(data, offset, 4);\n      offset += 4;\n      bin.readUint(data, offset);\n      offset += 4;\n      var toffset = bin.readUint(data, offset);\n      offset += 4;\n      bin.readUint(data, offset);\n      offset += 4;\n      if (tag == tab)\n        return toffset;\n    }\n    return 0;\n  };\n  Typr._bin = { readFixed: function(data, o) {\n    return (data[o] << 8 | data[o + 1]) + (data[o + 2] << 8 | data[o + 3]) / (256 * 256 + 4);\n  }, readF2dot14: function(data, o) {\n    var num = Typr._bin.readShort(data, o);\n    return num / 16384;\n  }, readInt: function(buff, p) {\n    var a = Typr._bin.t.uint8;\n    a[0] = buff[p + 3];\n    a[1] = buff[p + 2];\n    a[2] = buff[p + 1];\n    a[3] = buff[p];\n    return Typr._bin.t.int32[0];\n  }, readInt8: function(buff, p) {\n    var a = Typr._bin.t.uint8;\n    a[0] = buff[p];\n    return Typr._bin.t.int8[0];\n  }, readShort: function(buff, p) {\n    var a = Typr._bin.t.uint8;\n    a[1] = buff[p];\n    a[0] = buff[p + 1];\n    return Typr._bin.t.int16[0];\n  }, readUshort: function(buff, p) {\n    return buff[p] << 8 | buff[p + 1];\n  }, readUshorts: function(buff, p, len) {\n    var arr = [];\n    for (var i = 0; i < len; i++)\n      arr.push(Typr._bin.readUshort(buff, p + i * 2));\n    return arr;\n  }, readUint: function(buff, p) {\n    var a = Typr._bin.t.uint8;\n    a[3] = buff[p];\n    a[2] = buff[p + 1];\n    a[1] = buff[p + 2];\n    a[0] = buff[p + 3];\n    return Typr._bin.t.uint32[0];\n  }, readUint64: function(buff, p) {\n    return Typr._bin.readUint(buff, p) * (4294967295 + 1) + Typr._bin.readUint(buff, p + 4);\n  }, readASCII: function(buff, p, l) {\n    var s = \"\";\n    for (var i = 0; i < l; i++)\n      s += String.fromCharCode(buff[p + i]);\n    return s;\n  }, readUnicode: function(buff, p, l) {\n    var s = \"\";\n    for (var i = 0; i < l; i++) {\n      var c = buff[p++] << 8 | buff[p++];\n      s += String.fromCharCode(c);\n    }\n    return s;\n  }, _tdec: window[\"TextDecoder\"] ? new window[\"TextDecoder\"]() : null, readUTF8: function(buff, p, l) {\n    var tdec = Typr._bin._tdec;\n    if (tdec && p == 0 && l == buff.length)\n      return tdec[\"decode\"](buff);\n    return Typr._bin.readASCII(buff, p, l);\n  }, readBytes: function(buff, p, l) {\n    var arr = [];\n    for (var i = 0; i < l; i++)\n      arr.push(buff[p + i]);\n    return arr;\n  }, readASCIIArray: function(buff, p, l) {\n    var s = [];\n    for (var i = 0; i < l; i++)\n      s.push(String.fromCharCode(buff[p + i]));\n    return s;\n  } };\n  Typr._bin.t = { buff: new ArrayBuffer(8) };\n  Typr._bin.t.int8 = new Int8Array(Typr._bin.t.buff);\n  Typr._bin.t.uint8 = new Uint8Array(Typr._bin.t.buff);\n  Typr._bin.t.int16 = new Int16Array(Typr._bin.t.buff);\n  Typr._bin.t.uint16 = new Uint16Array(Typr._bin.t.buff);\n  Typr._bin.t.int32 = new Int32Array(Typr._bin.t.buff);\n  Typr._bin.t.uint32 = new Uint32Array(Typr._bin.t.buff);\n  Typr._lctf = {};\n  Typr._lctf.parse = function(data, offset, length, font, subt) {\n    var bin = Typr._bin;\n    var obj = {};\n    var offset0 = offset;\n    bin.readFixed(data, offset);\n    offset += 4;\n    var offScriptList = bin.readUshort(data, offset);\n    offset += 2;\n    var offFeatureList = bin.readUshort(data, offset);\n    offset += 2;\n    var offLookupList = bin.readUshort(data, offset);\n    offset += 2;\n    obj.scriptList = Typr._lctf.readScriptList(data, offset0 + offScriptList);\n    obj.featureList = Typr._lctf.readFeatureList(data, offset0 + offFeatureList);\n    obj.lookupList = Typr._lctf.readLookupList(data, offset0 + offLookupList, subt);\n    return obj;\n  };\n  Typr._lctf.readLookupList = function(data, offset, subt) {\n    var bin = Typr._bin;\n    var offset0 = offset;\n    var obj = [];\n    var count = bin.readUshort(data, offset);\n    offset += 2;\n    for (var i = 0; i < count; i++) {\n      var noff = bin.readUshort(data, offset);\n      offset += 2;\n      var lut = Typr._lctf.readLookupTable(data, offset0 + noff, subt);\n      obj.push(lut);\n    }\n    return obj;\n  };\n  Typr._lctf.readLookupTable = function(data, offset, subt) {\n    var bin = Typr._bin;\n    var offset0 = offset;\n    var obj = { tabs: [] };\n    obj.ltype = bin.readUshort(data, offset);\n    offset += 2;\n    obj.flag = bin.readUshort(data, offset);\n    offset += 2;\n    var cnt = bin.readUshort(data, offset);\n    offset += 2;\n    for (var i = 0; i < cnt; i++) {\n      var noff = bin.readUshort(data, offset);\n      offset += 2;\n      var tab = subt(data, obj.ltype, offset0 + noff);\n      obj.tabs.push(tab);\n    }\n    return obj;\n  };\n  Typr._lctf.numOfOnes = function(n) {\n    var num = 0;\n    for (var i = 0; i < 32; i++)\n      if ((n >>> i & 1) != 0)\n        num++;\n    return num;\n  };\n  Typr._lctf.readClassDef = function(data, offset) {\n    var bin = Typr._bin;\n    var obj = [];\n    var format = bin.readUshort(data, offset);\n    offset += 2;\n    if (format == 1) {\n      var startGlyph = bin.readUshort(data, offset);\n      offset += 2;\n      var glyphCount = bin.readUshort(data, offset);\n      offset += 2;\n      for (var i = 0; i < glyphCount; i++) {\n        obj.push(startGlyph + i);\n        obj.push(startGlyph + i);\n        obj.push(bin.readUshort(data, offset));\n        offset += 2;\n      }\n    }\n    if (format == 2) {\n      var count = bin.readUshort(data, offset);\n      offset += 2;\n      for (var i = 0; i < count; i++) {\n        obj.push(bin.readUshort(data, offset));\n        offset += 2;\n        obj.push(bin.readUshort(data, offset));\n        offset += 2;\n        obj.push(bin.readUshort(data, offset));\n        offset += 2;\n      }\n    }\n    return obj;\n  };\n  Typr._lctf.getInterval = function(tab, val) {\n    for (var i = 0; i < tab.length; i += 3) {\n      var start2 = tab[i], end = tab[i + 1];\n      tab[i + 2];\n      if (start2 <= val && val <= end)\n        return i;\n    }\n    return -1;\n  };\n  Typr._lctf.readValueRecord = function(data, offset, valFmt) {\n    var bin = Typr._bin;\n    var arr = [];\n    arr.push(valFmt & 1 ? bin.readShort(data, offset) : 0);\n    offset += valFmt & 1 ? 2 : 0;\n    arr.push(valFmt & 2 ? bin.readShort(data, offset) : 0);\n    offset += valFmt & 2 ? 2 : 0;\n    arr.push(valFmt & 4 ? bin.readShort(data, offset) : 0);\n    offset += valFmt & 4 ? 2 : 0;\n    arr.push(valFmt & 8 ? bin.readShort(data, offset) : 0);\n    offset += valFmt & 8 ? 2 : 0;\n    return arr;\n  };\n  Typr._lctf.readCoverage = function(data, offset) {\n    var bin = Typr._bin;\n    var cvg = {};\n    cvg.fmt = bin.readUshort(data, offset);\n    offset += 2;\n    var count = bin.readUshort(data, offset);\n    offset += 2;\n    if (cvg.fmt == 1)\n      cvg.tab = bin.readUshorts(data, offset, count);\n    if (cvg.fmt == 2)\n      cvg.tab = bin.readUshorts(data, offset, count * 3);\n    return cvg;\n  };\n  Typr._lctf.coverageIndex = function(cvg, val) {\n    var tab = cvg.tab;\n    if (cvg.fmt == 1)\n      return tab.indexOf(val);\n    if (cvg.fmt == 2) {\n      var ind = Typr._lctf.getInterval(tab, val);\n      if (ind != -1)\n        return tab[ind + 2] + (val - tab[ind]);\n    }\n    return -1;\n  };\n  Typr._lctf.readFeatureList = function(data, offset) {\n    var bin = Typr._bin;\n    var offset0 = offset;\n    var obj = [];\n    var count = bin.readUshort(data, offset);\n    offset += 2;\n    for (var i = 0; i < count; i++) {\n      var tag = bin.readASCII(data, offset, 4);\n      offset += 4;\n      var noff = bin.readUshort(data, offset);\n      offset += 2;\n      obj.push({ tag: tag.trim(), tab: Typr._lctf.readFeatureTable(data, offset0 + noff) });\n    }\n    return obj;\n  };\n  Typr._lctf.readFeatureTable = function(data, offset) {\n    var bin = Typr._bin;\n    bin.readUshort(data, offset);\n    offset += 2;\n    var lookupCount = bin.readUshort(data, offset);\n    offset += 2;\n    var indices = [];\n    for (var i = 0; i < lookupCount; i++)\n      indices.push(bin.readUshort(data, offset + 2 * i));\n    return indices;\n  };\n  Typr._lctf.readScriptList = function(data, offset) {\n    var bin = Typr._bin;\n    var offset0 = offset;\n    var obj = {};\n    var count = bin.readUshort(data, offset);\n    offset += 2;\n    for (var i = 0; i < count; i++) {\n      var tag = bin.readASCII(data, offset, 4);\n      offset += 4;\n      var noff = bin.readUshort(data, offset);\n      offset += 2;\n      obj[tag.trim()] = Typr._lctf.readScriptTable(data, offset0 + noff);\n    }\n    return obj;\n  };\n  Typr._lctf.readScriptTable = function(data, offset) {\n    var bin = Typr._bin;\n    var offset0 = offset;\n    var obj = {};\n    var defLangSysOff = bin.readUshort(data, offset);\n    offset += 2;\n    obj.default = Typr._lctf.readLangSysTable(data, offset0 + defLangSysOff);\n    var langSysCount = bin.readUshort(data, offset);\n    offset += 2;\n    for (var i = 0; i < langSysCount; i++) {\n      var tag = bin.readASCII(data, offset, 4);\n      offset += 4;\n      var langSysOff = bin.readUshort(data, offset);\n      offset += 2;\n      obj[tag.trim()] = Typr._lctf.readLangSysTable(data, offset0 + langSysOff);\n    }\n    return obj;\n  };\n  Typr._lctf.readLangSysTable = function(data, offset) {\n    var bin = Typr._bin;\n    var obj = {};\n    bin.readUshort(data, offset);\n    offset += 2;\n    obj.reqFeature = bin.readUshort(data, offset);\n    offset += 2;\n    var featureCount = bin.readUshort(data, offset);\n    offset += 2;\n    obj.features = bin.readUshorts(data, offset, featureCount);\n    return obj;\n  };\n  Typr.CFF = {};\n  Typr.CFF.parse = function(data, offset, length) {\n    var bin = Typr._bin;\n    data = new Uint8Array(data.buffer, offset, length);\n    offset = 0;\n    data[offset];\n    offset++;\n    data[offset];\n    offset++;\n    data[offset];\n    offset++;\n    data[offset];\n    offset++;\n    var ninds = [];\n    offset = Typr.CFF.readIndex(data, offset, ninds);\n    var names = [];\n    for (var i = 0; i < ninds.length - 1; i++)\n      names.push(bin.readASCII(data, offset + ninds[i], ninds[i + 1] - ninds[i]));\n    offset += ninds[ninds.length - 1];\n    var tdinds = [];\n    offset = Typr.CFF.readIndex(data, offset, tdinds);\n    var topDicts = [];\n    for (var i = 0; i < tdinds.length - 1; i++)\n      topDicts.push(Typr.CFF.readDict(data, offset + tdinds[i], offset + tdinds[i + 1]));\n    offset += tdinds[tdinds.length - 1];\n    var topdict = topDicts[0];\n    var sinds = [];\n    offset = Typr.CFF.readIndex(data, offset, sinds);\n    var strings = [];\n    for (var i = 0; i < sinds.length - 1; i++)\n      strings.push(bin.readASCII(data, offset + sinds[i], sinds[i + 1] - sinds[i]));\n    offset += sinds[sinds.length - 1];\n    Typr.CFF.readSubrs(data, offset, topdict);\n    if (topdict.CharStrings) {\n      offset = topdict.CharStrings;\n      var sinds = [];\n      offset = Typr.CFF.readIndex(data, offset, sinds);\n      var cstr = [];\n      for (var i = 0; i < sinds.length - 1; i++)\n        cstr.push(bin.readBytes(data, offset + sinds[i], sinds[i + 1] - sinds[i]));\n      topdict.CharStrings = cstr;\n    }\n    if (topdict.Encoding)\n      topdict.Encoding = Typr.CFF.readEncoding(data, topdict.Encoding, topdict.CharStrings.length);\n    if (topdict.charset)\n      topdict.charset = Typr.CFF.readCharset(data, topdict.charset, topdict.CharStrings.length);\n    if (topdict.Private) {\n      offset = topdict.Private[1];\n      topdict.Private = Typr.CFF.readDict(data, offset, offset + topdict.Private[0]);\n      if (topdict.Private.Subrs)\n        Typr.CFF.readSubrs(data, offset + topdict.Private.Subrs, topdict.Private);\n    }\n    var obj = {};\n    for (var p in topdict) {\n      if ([\"FamilyName\", \"FullName\", \"Notice\", \"version\", \"Copyright\"].indexOf(p) != -1)\n        obj[p] = strings[topdict[p] - 426 + 35];\n      else\n        obj[p] = topdict[p];\n    }\n    return obj;\n  };\n  Typr.CFF.readSubrs = function(data, offset, obj) {\n    var bin = Typr._bin;\n    var gsubinds = [];\n    offset = Typr.CFF.readIndex(data, offset, gsubinds);\n    var bias, nSubrs = gsubinds.length;\n    if (nSubrs < 1240)\n      bias = 107;\n    else if (nSubrs < 33900)\n      bias = 1131;\n    else\n      bias = 32768;\n    obj.Bias = bias;\n    obj.Subrs = [];\n    for (var i = 0; i < gsubinds.length - 1; i++)\n      obj.Subrs.push(bin.readBytes(data, offset + gsubinds[i], gsubinds[i + 1] - gsubinds[i]));\n  };\n  Typr.CFF.tableSE = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 0, 111, 112, 113, 114, 0, 115, 116, 117, 118, 119, 120, 121, 122, 0, 123, 0, 124, 125, 126, 127, 128, 129, 130, 131, 0, 132, 133, 0, 134, 135, 136, 137, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 138, 0, 139, 0, 0, 0, 0, 140, 141, 142, 143, 0, 0, 0, 0, 0, 144, 0, 0, 0, 145, 0, 0, 146, 147, 148, 149, 0, 0, 0, 0];\n  Typr.CFF.glyphByUnicode = function(cff, code) {\n    for (var i = 0; i < cff.charset.length; i++)\n      if (cff.charset[i] == code)\n        return i;\n    return -1;\n  };\n  Typr.CFF.glyphBySE = function(cff, charcode) {\n    if (charcode < 0 || charcode > 255)\n      return -1;\n    return Typr.CFF.glyphByUnicode(cff, Typr.CFF.tableSE[charcode]);\n  };\n  Typr.CFF.readEncoding = function(data, offset, num) {\n    Typr._bin;\n    var array = [\".notdef\"];\n    var format = data[offset];\n    offset++;\n    if (format == 0) {\n      var nCodes = data[offset];\n      offset++;\n      for (var i = 0; i < nCodes; i++)\n        array.push(data[offset + i]);\n    } else\n      throw \"error: unknown encoding format: \" + format;\n    return array;\n  };\n  Typr.CFF.readCharset = function(data, offset, num) {\n    var bin = Typr._bin;\n    var charset = [\".notdef\"];\n    var format = data[offset];\n    offset++;\n    if (format == 0) {\n      for (var i = 0; i < num; i++) {\n        var first = bin.readUshort(data, offset);\n        offset += 2;\n        charset.push(first);\n      }\n    } else if (format == 1 || format == 2) {\n      while (charset.length < num) {\n        var first = bin.readUshort(data, offset);\n        offset += 2;\n        var nLeft = 0;\n        if (format == 1) {\n          nLeft = data[offset];\n          offset++;\n        } else {\n          nLeft = bin.readUshort(data, offset);\n          offset += 2;\n        }\n        for (var i = 0; i <= nLeft; i++) {\n          charset.push(first);\n          first++;\n        }\n      }\n    } else\n      throw \"error: format: \" + format;\n    return charset;\n  };\n  Typr.CFF.readIndex = function(data, offset, inds) {\n    var bin = Typr._bin;\n    var count = bin.readUshort(data, offset);\n    offset += 2;\n    var offsize = data[offset];\n    offset++;\n    if (offsize == 1)\n      for (var i = 0; i < count + 1; i++)\n        inds.push(data[offset + i]);\n    else if (offsize == 2)\n      for (var i = 0; i < count + 1; i++)\n        inds.push(bin.readUshort(data, offset + i * 2));\n    else if (offsize == 3)\n      for (var i = 0; i < count + 1; i++)\n        inds.push(bin.readUint(data, offset + i * 3 - 1) & 16777215);\n    else if (count != 0)\n      throw \"unsupported offset size: \" + offsize + \", count: \" + count;\n    offset += (count + 1) * offsize;\n    return offset - 1;\n  };\n  Typr.CFF.getCharString = function(data, offset, o) {\n    var bin = Typr._bin;\n    var b0 = data[offset], b1 = data[offset + 1];\n    data[offset + 2];\n    data[offset + 3];\n    data[offset + 4];\n    var vs = 1;\n    var op = null, val = null;\n    if (b0 <= 20) {\n      op = b0;\n      vs = 1;\n    }\n    if (b0 == 12) {\n      op = b0 * 100 + b1;\n      vs = 2;\n    }\n    if (21 <= b0 && b0 <= 27) {\n      op = b0;\n      vs = 1;\n    }\n    if (b0 == 28) {\n      val = bin.readShort(data, offset + 1);\n      vs = 3;\n    }\n    if (29 <= b0 && b0 <= 31) {\n      op = b0;\n      vs = 1;\n    }\n    if (32 <= b0 && b0 <= 246) {\n      val = b0 - 139;\n      vs = 1;\n    }\n    if (247 <= b0 && b0 <= 250) {\n      val = (b0 - 247) * 256 + b1 + 108;\n      vs = 2;\n    }\n    if (251 <= b0 && b0 <= 254) {\n      val = -(b0 - 251) * 256 - b1 - 108;\n      vs = 2;\n    }\n    if (b0 == 255) {\n      val = bin.readInt(data, offset + 1) / 65535;\n      vs = 5;\n    }\n    o.val = val != null ? val : \"o\" + op;\n    o.size = vs;\n  };\n  Typr.CFF.readCharString = function(data, offset, length) {\n    var end = offset + length;\n    var bin = Typr._bin;\n    var arr = [];\n    while (offset < end) {\n      var b0 = data[offset], b1 = data[offset + 1];\n      data[offset + 2];\n      data[offset + 3];\n      data[offset + 4];\n      var vs = 1;\n      var op = null, val = null;\n      if (b0 <= 20) {\n        op = b0;\n        vs = 1;\n      }\n      if (b0 == 12) {\n        op = b0 * 100 + b1;\n        vs = 2;\n      }\n      if (b0 == 19 || b0 == 20) {\n        op = b0;\n        vs = 2;\n      }\n      if (21 <= b0 && b0 <= 27) {\n        op = b0;\n        vs = 1;\n      }\n      if (b0 == 28) {\n        val = bin.readShort(data, offset + 1);\n        vs = 3;\n      }\n      if (29 <= b0 && b0 <= 31) {\n        op = b0;\n        vs = 1;\n      }\n      if (32 <= b0 && b0 <= 246) {\n        val = b0 - 139;\n        vs = 1;\n      }\n      if (247 <= b0 && b0 <= 250) {\n        val = (b0 - 247) * 256 + b1 + 108;\n        vs = 2;\n      }\n      if (251 <= b0 && b0 <= 254) {\n        val = -(b0 - 251) * 256 - b1 - 108;\n        vs = 2;\n      }\n      if (b0 == 255) {\n        val = bin.readInt(data, offset + 1) / 65535;\n        vs = 5;\n      }\n      arr.push(val != null ? val : \"o\" + op);\n      offset += vs;\n    }\n    return arr;\n  };\n  Typr.CFF.readDict = function(data, offset, end) {\n    var bin = Typr._bin;\n    var dict = {};\n    var carr = [];\n    while (offset < end) {\n      var b0 = data[offset], b1 = data[offset + 1];\n      data[offset + 2];\n      data[offset + 3];\n      data[offset + 4];\n      var vs = 1;\n      var key = null, val = null;\n      if (b0 == 28) {\n        val = bin.readShort(data, offset + 1);\n        vs = 3;\n      }\n      if (b0 == 29) {\n        val = bin.readInt(data, offset + 1);\n        vs = 5;\n      }\n      if (32 <= b0 && b0 <= 246) {\n        val = b0 - 139;\n        vs = 1;\n      }\n      if (247 <= b0 && b0 <= 250) {\n        val = (b0 - 247) * 256 + b1 + 108;\n        vs = 2;\n      }\n      if (251 <= b0 && b0 <= 254) {\n        val = -(b0 - 251) * 256 - b1 - 108;\n        vs = 2;\n      }\n      if (b0 == 255) {\n        val = bin.readInt(data, offset + 1) / 65535;\n        vs = 5;\n        throw \"unknown number\";\n      }\n      if (b0 == 30) {\n        var nibs = [];\n        vs = 1;\n        while (true) {\n          var b = data[offset + vs];\n          vs++;\n          var nib0 = b >> 4, nib1 = b & 15;\n          if (nib0 != 15)\n            nibs.push(nib0);\n          if (nib1 != 15)\n            nibs.push(nib1);\n          if (nib1 == 15)\n            break;\n        }\n        var s = \"\";\n        var chars = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, \".\", \"e\", \"e-\", \"reserved\", \"-\", \"endOfNumber\"];\n        for (var i = 0; i < nibs.length; i++)\n          s += chars[nibs[i]];\n        val = parseFloat(s);\n      }\n      if (b0 <= 21) {\n        var keys = [\"version\", \"Notice\", \"FullName\", \"FamilyName\", \"Weight\", \"FontBBox\", \"BlueValues\", \"OtherBlues\", \"FamilyBlues\", \"FamilyOtherBlues\", \"StdHW\", \"StdVW\", \"escape\", \"UniqueID\", \"XUID\", \"charset\", \"Encoding\", \"CharStrings\", \"Private\", \"Subrs\", \"defaultWidthX\", \"nominalWidthX\"];\n        key = keys[b0];\n        vs = 1;\n        if (b0 == 12) {\n          var keys = [\"Copyright\", \"isFixedPitch\", \"ItalicAngle\", \"UnderlinePosition\", \"UnderlineThickness\", \"PaintType\", \"CharstringType\", \"FontMatrix\", \"StrokeWidth\", \"BlueScale\", \"BlueShift\", \"BlueFuzz\", \"StemSnapH\", \"StemSnapV\", \"ForceBold\", 0, 0, \"LanguageGroup\", \"ExpansionFactor\", \"initialRandomSeed\", \"SyntheticBase\", \"PostScript\", \"BaseFontName\", \"BaseFontBlend\", 0, 0, 0, 0, 0, 0, \"ROS\", \"CIDFontVersion\", \"CIDFontRevision\", \"CIDFontType\", \"CIDCount\", \"UIDBase\", \"FDArray\", \"FDSelect\", \"FontName\"];\n          key = keys[b1];\n          vs = 2;\n        }\n      }\n      if (key != null) {\n        dict[key] = carr.length == 1 ? carr[0] : carr;\n        carr = [];\n      } else\n        carr.push(val);\n      offset += vs;\n    }\n    return dict;\n  };\n  Typr.cmap = {};\n  Typr.cmap.parse = function(data, offset, length) {\n    data = new Uint8Array(data.buffer, offset, length);\n    offset = 0;\n    var bin = Typr._bin;\n    var obj = {};\n    bin.readUshort(data, offset);\n    offset += 2;\n    var numTables = bin.readUshort(data, offset);\n    offset += 2;\n    var offs = [];\n    obj.tables = [];\n    for (var i = 0; i < numTables; i++) {\n      var platformID = bin.readUshort(data, offset);\n      offset += 2;\n      var encodingID = bin.readUshort(data, offset);\n      offset += 2;\n      var noffset = bin.readUint(data, offset);\n      offset += 4;\n      var id = \"p\" + platformID + \"e\" + encodingID;\n      var tind = offs.indexOf(noffset);\n      if (tind == -1) {\n        tind = obj.tables.length;\n        var subt;\n        offs.push(noffset);\n        var format = bin.readUshort(data, noffset);\n        if (format == 0)\n          subt = Typr.cmap.parse0(data, noffset);\n        else if (format == 4)\n          subt = Typr.cmap.parse4(data, noffset);\n        else if (format == 6)\n          subt = Typr.cmap.parse6(data, noffset);\n        else if (format == 12)\n          subt = Typr.cmap.parse12(data, noffset);\n        else\n          console.log(\"unknown format: \" + format, platformID, encodingID, noffset);\n        obj.tables.push(subt);\n      }\n      if (obj[id] != null)\n        throw \"multiple tables for one platform+encoding\";\n      obj[id] = tind;\n    }\n    return obj;\n  };\n  Typr.cmap.parse0 = function(data, offset) {\n    var bin = Typr._bin;\n    var obj = {};\n    obj.format = bin.readUshort(data, offset);\n    offset += 2;\n    var len = bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    obj.map = [];\n    for (var i = 0; i < len - 6; i++)\n      obj.map.push(data[offset + i]);\n    return obj;\n  };\n  Typr.cmap.parse4 = function(data, offset) {\n    var bin = Typr._bin;\n    var offset0 = offset;\n    var obj = {};\n    obj.format = bin.readUshort(data, offset);\n    offset += 2;\n    var length = bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    var segCountX2 = bin.readUshort(data, offset);\n    offset += 2;\n    var segCount = segCountX2 / 2;\n    obj.searchRange = bin.readUshort(data, offset);\n    offset += 2;\n    obj.entrySelector = bin.readUshort(data, offset);\n    offset += 2;\n    obj.rangeShift = bin.readUshort(data, offset);\n    offset += 2;\n    obj.endCount = bin.readUshorts(data, offset, segCount);\n    offset += segCount * 2;\n    offset += 2;\n    obj.startCount = bin.readUshorts(data, offset, segCount);\n    offset += segCount * 2;\n    obj.idDelta = [];\n    for (var i = 0; i < segCount; i++) {\n      obj.idDelta.push(bin.readShort(data, offset));\n      offset += 2;\n    }\n    obj.idRangeOffset = bin.readUshorts(data, offset, segCount);\n    offset += segCount * 2;\n    obj.glyphIdArray = [];\n    while (offset < offset0 + length) {\n      obj.glyphIdArray.push(bin.readUshort(data, offset));\n      offset += 2;\n    }\n    return obj;\n  };\n  Typr.cmap.parse6 = function(data, offset) {\n    var bin = Typr._bin;\n    var obj = {};\n    obj.format = bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    obj.firstCode = bin.readUshort(data, offset);\n    offset += 2;\n    var entryCount = bin.readUshort(data, offset);\n    offset += 2;\n    obj.glyphIdArray = [];\n    for (var i = 0; i < entryCount; i++) {\n      obj.glyphIdArray.push(bin.readUshort(data, offset));\n      offset += 2;\n    }\n    return obj;\n  };\n  Typr.cmap.parse12 = function(data, offset) {\n    var bin = Typr._bin;\n    var obj = {};\n    obj.format = bin.readUshort(data, offset);\n    offset += 2;\n    offset += 2;\n    bin.readUint(data, offset);\n    offset += 4;\n    bin.readUint(data, offset);\n    offset += 4;\n    var nGroups = bin.readUint(data, offset);\n    offset += 4;\n    obj.groups = [];\n    for (var i = 0; i < nGroups; i++) {\n      var off = offset + i * 12;\n      var startCharCode = bin.readUint(data, off + 0);\n      var endCharCode = bin.readUint(data, off + 4);\n      var startGlyphID = bin.readUint(data, off + 8);\n      obj.groups.push([startCharCode, endCharCode, startGlyphID]);\n    }\n    return obj;\n  };\n  Typr.glyf = {};\n  Typr.glyf.parse = function(data, offset, length, font) {\n    var obj = [];\n    for (var g = 0; g < font.maxp.numGlyphs; g++)\n      obj.push(null);\n    return obj;\n  };\n  Typr.glyf._parseGlyf = function(font, g) {\n    var bin = Typr._bin;\n    var data = font._data;\n    var offset = Typr._tabOffset(data, \"glyf\") + font.loca[g];\n    if (font.loca[g] == font.loca[g + 1])\n      return null;\n    var gl = {};\n    gl.noc = bin.readShort(data, offset);\n    offset += 2;\n    gl.xMin = bin.readShort(data, offset);\n    offset += 2;\n    gl.yMin = bin.readShort(data, offset);\n    offset += 2;\n    gl.xMax = bin.readShort(data, offset);\n    offset += 2;\n    gl.yMax = bin.readShort(data, offset);\n    offset += 2;\n    if (gl.xMin >= gl.xMax || gl.yMin >= gl.yMax)\n      return null;\n    if (gl.noc > 0) {\n      gl.endPts = [];\n      for (var i = 0; i < gl.noc; i++) {\n        gl.endPts.push(bin.readUshort(data, offset));\n        offset += 2;\n      }\n      var instructionLength = bin.readUshort(data, offset);\n      offset += 2;\n      if (data.length - offset < instructionLength)\n        return null;\n      gl.instructions = bin.readBytes(data, offset, instructionLength);\n      offset += instructionLength;\n      var crdnum = gl.endPts[gl.noc - 1] + 1;\n      gl.flags = [];\n      for (var i = 0; i < crdnum; i++) {\n        var flag = data[offset];\n        offset++;\n        gl.flags.push(flag);\n        if ((flag & 8) != 0) {\n          var rep = data[offset];\n          offset++;\n          for (var j = 0; j < rep; j++) {\n            gl.flags.push(flag);\n            i++;\n          }\n        }\n      }\n      gl.xs = [];\n      for (var i = 0; i < crdnum; i++) {\n        var i8 = (gl.flags[i] & 2) != 0, same = (gl.flags[i] & 16) != 0;\n        if (i8) {\n          gl.xs.push(same ? data[offset] : -data[offset]);\n          offset++;\n        } else {\n          if (same)\n            gl.xs.push(0);\n          else {\n            gl.xs.push(bin.readShort(data, offset));\n            offset += 2;\n          }\n        }\n      }\n      gl.ys = [];\n      for (var i = 0; i < crdnum; i++) {\n        var i8 = (gl.flags[i] & 4) != 0, same = (gl.flags[i] & 32) != 0;\n        if (i8) {\n          gl.ys.push(same ? data[offset] : -data[offset]);\n          offset++;\n        } else {\n          if (same)\n            gl.ys.push(0);\n          else {\n            gl.ys.push(bin.readShort(data, offset));\n            offset += 2;\n          }\n        }\n      }\n      var x = 0, y = 0;\n      for (var i = 0; i < crdnum; i++) {\n        x += gl.xs[i];\n        y += gl.ys[i];\n        gl.xs[i] = x;\n        gl.ys[i] = y;\n      }\n    } else {\n      var ARG_1_AND_2_ARE_WORDS = 1 << 0;\n      var ARGS_ARE_XY_VALUES = 1 << 1;\n      var WE_HAVE_A_SCALE = 1 << 3;\n      var MORE_COMPONENTS = 1 << 5;\n      var WE_HAVE_AN_X_AND_Y_SCALE = 1 << 6;\n      var WE_HAVE_A_TWO_BY_TWO = 1 << 7;\n      var WE_HAVE_INSTRUCTIONS = 1 << 8;\n      gl.parts = [];\n      var flags;\n      do {\n        flags = bin.readUshort(data, offset);\n        offset += 2;\n        var part = { m: { a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0 }, p1: -1, p2: -1 };\n        gl.parts.push(part);\n        part.glyphIndex = bin.readUshort(data, offset);\n        offset += 2;\n        if (flags & ARG_1_AND_2_ARE_WORDS) {\n          var arg1 = bin.readShort(data, offset);\n          offset += 2;\n          var arg2 = bin.readShort(data, offset);\n          offset += 2;\n        } else {\n          var arg1 = bin.readInt8(data, offset);\n          offset++;\n          var arg2 = bin.readInt8(data, offset);\n          offset++;\n        }\n        if (flags & ARGS_ARE_XY_VALUES) {\n          part.m.tx = arg1;\n          part.m.ty = arg2;\n        } else {\n          part.p1 = arg1;\n          part.p2 = arg2;\n        }\n        if (flags & WE_HAVE_A_SCALE) {\n          part.m.a = part.m.d = bin.readF2dot14(data, offset);\n          offset += 2;\n        } else if (flags & WE_HAVE_AN_X_AND_Y_SCALE) {\n          part.m.a = bin.readF2dot14(data, offset);\n          offset += 2;\n          part.m.d = bin.readF2dot14(data, offset);\n          offset += 2;\n        } else if (flags & WE_HAVE_A_TWO_BY_TWO) {\n          part.m.a = bin.readF2dot14(data, offset);\n          offset += 2;\n          part.m.b = bin.readF2dot14(data, offset);\n          offset += 2;\n          part.m.c = bin.readF2dot14(data, offset);\n          offset += 2;\n          part.m.d = bin.readF2dot14(data, offset);\n          offset += 2;\n        }\n      } while (flags & MORE_COMPONENTS);\n      if (flags & WE_HAVE_INSTRUCTIONS) {\n        var numInstr = bin.readUshort(data, offset);\n        offset += 2;\n        gl.instr = [];\n        for (var i = 0; i < numInstr; i++) {\n          gl.instr.push(data[offset]);\n          offset++;\n        }\n      }\n    }\n    return gl;\n  };\n  Typr.GPOS = {};\n  Typr.GPOS.parse = function(data, offset, length, font) {\n    return Typr._lctf.parse(data, offset, length, font, Typr.GPOS.subt);\n  };\n  Typr.GPOS.subt = function(data, ltype, offset) {\n    if (ltype != 2)\n      return null;\n    var bin = Typr._bin, offset0 = offset, tab = {};\n    tab.format = bin.readUshort(data, offset);\n    offset += 2;\n    var covOff = bin.readUshort(data, offset);\n    offset += 2;\n    tab.coverage = Typr._lctf.readCoverage(data, covOff + offset0);\n    tab.valFmt1 = bin.readUshort(data, offset);\n    offset += 2;\n    tab.valFmt2 = bin.readUshort(data, offset);\n    offset += 2;\n    var ones1 = Typr._lctf.numOfOnes(tab.valFmt1);\n    var ones2 = Typr._lctf.numOfOnes(tab.valFmt2);\n    if (tab.format == 1) {\n      tab.pairsets = [];\n      var count = bin.readUshort(data, offset);\n      offset += 2;\n      for (var i = 0; i < count; i++) {\n        var psoff = bin.readUshort(data, offset);\n        offset += 2;\n        psoff += offset0;\n        var pvcount = bin.readUshort(data, psoff);\n        psoff += 2;\n        var arr = [];\n        for (var j = 0; j < pvcount; j++) {\n          var gid2 = bin.readUshort(data, psoff);\n          psoff += 2;\n          var value1, value2;\n          if (tab.valFmt1 != 0) {\n            value1 = Typr._lctf.readValueRecord(data, psoff, tab.valFmt1);\n            psoff += ones1 * 2;\n          }\n          if (tab.valFmt2 != 0) {\n            value2 = Typr._lctf.readValueRecord(data, psoff, tab.valFmt2);\n            psoff += ones2 * 2;\n          }\n          arr.push({ gid2, val1: value1, val2: value2 });\n        }\n        tab.pairsets.push(arr);\n      }\n    }\n    if (tab.format == 2) {\n      var classDef1 = bin.readUshort(data, offset);\n      offset += 2;\n      var classDef2 = bin.readUshort(data, offset);\n      offset += 2;\n      var class1Count = bin.readUshort(data, offset);\n      offset += 2;\n      var class2Count = bin.readUshort(data, offset);\n      offset += 2;\n      tab.classDef1 = Typr._lctf.readClassDef(data, offset0 + classDef1);\n      tab.classDef2 = Typr._lctf.readClassDef(data, offset0 + classDef2);\n      tab.matrix = [];\n      for (var i = 0; i < class1Count; i++) {\n        var row = [];\n        for (var j = 0; j < class2Count; j++) {\n          var value1 = null, value2 = null;\n          if (tab.valFmt1 != 0) {\n            value1 = Typr._lctf.readValueRecord(data, offset, tab.valFmt1);\n            offset += ones1 * 2;\n          }\n          if (tab.valFmt2 != 0) {\n            value2 = Typr._lctf.readValueRecord(data, offset, tab.valFmt2);\n            offset += ones2 * 2;\n          }\n          row.push({ val1: value1, val2: value2 });\n        }\n        tab.matrix.push(row);\n      }\n    }\n    return tab;\n  };\n  Typr.GSUB = {};\n  Typr.GSUB.parse = function(data, offset, length, font) {\n    return Typr._lctf.parse(data, offset, length, font, Typr.GSUB.subt);\n  };\n  Typr.GSUB.subt = function(data, ltype, offset) {\n    var bin = Typr._bin, offset0 = offset, tab = {};\n    if (ltype != 1 && ltype != 4 && ltype != 5)\n      return null;\n    tab.fmt = bin.readUshort(data, offset);\n    offset += 2;\n    var covOff = bin.readUshort(data, offset);\n    offset += 2;\n    tab.coverage = Typr._lctf.readCoverage(data, covOff + offset0);\n    if (ltype == 1) {\n      if (tab.fmt == 1) {\n        tab.delta = bin.readShort(data, offset);\n        offset += 2;\n      } else if (tab.fmt == 2) {\n        var cnt = bin.readUshort(data, offset);\n        offset += 2;\n        tab.newg = bin.readUshorts(data, offset, cnt);\n        offset += tab.newg.length * 2;\n      }\n    } else if (ltype == 4) {\n      tab.vals = [];\n      var cnt = bin.readUshort(data, offset);\n      offset += 2;\n      for (var i = 0; i < cnt; i++) {\n        var loff = bin.readUshort(data, offset);\n        offset += 2;\n        tab.vals.push(Typr.GSUB.readLigatureSet(data, offset0 + loff));\n      }\n    } else if (ltype == 5) {\n      if (tab.fmt == 2) {\n        var cDefOffset = bin.readUshort(data, offset);\n        offset += 2;\n        tab.cDef = Typr._lctf.readClassDef(data, offset0 + cDefOffset);\n        tab.scset = [];\n        var subClassSetCount = bin.readUshort(data, offset);\n        offset += 2;\n        for (var i = 0; i < subClassSetCount; i++) {\n          var scsOff = bin.readUshort(data, offset);\n          offset += 2;\n          tab.scset.push(scsOff == 0 ? null : Typr.GSUB.readSubClassSet(data, offset0 + scsOff));\n        }\n      } else\n        console.log(\"unknown table format\", tab.fmt);\n    }\n    return tab;\n  };\n  Typr.GSUB.readSubClassSet = function(data, offset) {\n    var rUs = Typr._bin.readUshort, offset0 = offset, lset = [];\n    var cnt = rUs(data, offset);\n    offset += 2;\n    for (var i = 0; i < cnt; i++) {\n      var loff = rUs(data, offset);\n      offset += 2;\n      lset.push(Typr.GSUB.readSubClassRule(data, offset0 + loff));\n    }\n    return lset;\n  };\n  Typr.GSUB.readSubClassRule = function(data, offset) {\n    var rUs = Typr._bin.readUshort, rule = {};\n    var gcount = rUs(data, offset);\n    offset += 2;\n    var scount = rUs(data, offset);\n    offset += 2;\n    rule.input = [];\n    for (var i = 0; i < gcount - 1; i++) {\n      rule.input.push(rUs(data, offset));\n      offset += 2;\n    }\n    rule.substLookupRecords = Typr.GSUB.readSubstLookupRecords(data, offset, scount);\n    return rule;\n  };\n  Typr.GSUB.readSubstLookupRecords = function(data, offset, cnt) {\n    var rUs = Typr._bin.readUshort;\n    var out = [];\n    for (var i = 0; i < cnt; i++) {\n      out.push(rUs(data, offset), rUs(data, offset + 2));\n      offset += 4;\n    }\n    return out;\n  };\n  Typr.GSUB.readChainSubClassSet = function(data, offset) {\n    var bin = Typr._bin, offset0 = offset, lset = [];\n    var cnt = bin.readUshort(data, offset);\n    offset += 2;\n    for (var i = 0; i < cnt; i++) {\n      var loff = bin.readUshort(data, offset);\n      offset += 2;\n      lset.push(Typr.GSUB.readChainSubClassRule(data, offset0 + loff));\n    }\n    return lset;\n  };\n  Typr.GSUB.readChainSubClassRule = function(data, offset) {\n    var bin = Typr._bin, rule = {};\n    var pps = [\"backtrack\", \"input\", \"lookahead\"];\n    for (var pi = 0; pi < pps.length; pi++) {\n      var cnt = bin.readUshort(data, offset);\n      offset += 2;\n      if (pi == 1)\n        cnt--;\n      rule[pps[pi]] = bin.readUshorts(data, offset, cnt);\n      offset += rule[pps[pi]].length * 2;\n    }\n    var cnt = bin.readUshort(data, offset);\n    offset += 2;\n    rule.subst = bin.readUshorts(data, offset, cnt * 2);\n    offset += rule.subst.length * 2;\n    return rule;\n  };\n  Typr.GSUB.readLigatureSet = function(data, offset) {\n    var bin = Typr._bin, offset0 = offset, lset = [];\n    var lcnt = bin.readUshort(data, offset);\n    offset += 2;\n    for (var j = 0; j < lcnt; j++) {\n      var loff = bin.readUshort(data, offset);\n      offset += 2;\n      lset.push(Typr.GSUB.readLigature(data, offset0 + loff));\n    }\n    return lset;\n  };\n  Typr.GSUB.readLigature = function(data, offset) {\n    var bin = Typr._bin, lig = { chain: [] };\n    lig.nglyph = bin.readUshort(data, offset);\n    offset += 2;\n    var ccnt = bin.readUshort(data, offset);\n    offset += 2;\n    for (var k = 0; k < ccnt - 1; k++) {\n      lig.chain.push(bin.readUshort(data, offset));\n      offset += 2;\n    }\n    return lig;\n  };\n  Typr.head = {};\n  Typr.head.parse = function(data, offset, length) {\n    var bin = Typr._bin;\n    var obj = {};\n    bin.readFixed(data, offset);\n    offset += 4;\n    obj.fontRevision = bin.readFixed(data, offset);\n    offset += 4;\n    bin.readUint(data, offset);\n    offset += 4;\n    bin.readUint(data, offset);\n    offset += 4;\n    obj.flags = bin.readUshort(data, offset);\n    offset += 2;\n    obj.unitsPerEm = bin.readUshort(data, offset);\n    offset += 2;\n    obj.created = bin.readUint64(data, offset);\n    offset += 8;\n    obj.modified = bin.readUint64(data, offset);\n    offset += 8;\n    obj.xMin = bin.readShort(data, offset);\n    offset += 2;\n    obj.yMin = bin.readShort(data, offset);\n    offset += 2;\n    obj.xMax = bin.readShort(data, offset);\n    offset += 2;\n    obj.yMax = bin.readShort(data, offset);\n    offset += 2;\n    obj.macStyle = bin.readUshort(data, offset);\n    offset += 2;\n    obj.lowestRecPPEM = bin.readUshort(data, offset);\n    offset += 2;\n    obj.fontDirectionHint = bin.readShort(data, offset);\n    offset += 2;\n    obj.indexToLocFormat = bin.readShort(data, offset);\n    offset += 2;\n    obj.glyphDataFormat = bin.readShort(data, offset);\n    offset += 2;\n    return obj;\n  };\n  Typr.hhea = {};\n  Typr.hhea.parse = function(data, offset, length) {\n    var bin = Typr._bin;\n    var obj = {};\n    bin.readFixed(data, offset);\n    offset += 4;\n    obj.ascender = bin.readShort(data, offset);\n    offset += 2;\n    obj.descender = bin.readShort(data, offset);\n    offset += 2;\n    obj.lineGap = bin.readShort(data, offset);\n    offset += 2;\n    obj.advanceWidthMax = bin.readUshort(data, offset);\n    offset += 2;\n    obj.minLeftSideBearing = bin.readShort(data, offset);\n    offset += 2;\n    obj.minRightSideBearing = bin.readShort(data, offset);\n    offset += 2;\n    obj.xMaxExtent = bin.readShort(data, offset);\n    offset += 2;\n    obj.caretSlopeRise = bin.readShort(data, offset);\n    offset += 2;\n    obj.caretSlopeRun = bin.readShort(data, offset);\n    offset += 2;\n    obj.caretOffset = bin.readShort(data, offset);\n    offset += 2;\n    offset += 4 * 2;\n    obj.metricDataFormat = bin.readShort(data, offset);\n    offset += 2;\n    obj.numberOfHMetrics = bin.readUshort(data, offset);\n    offset += 2;\n    return obj;\n  };\n  Typr.hmtx = {};\n  Typr.hmtx.parse = function(data, offset, length, font) {\n    var bin = Typr._bin;\n    var obj = {};\n    obj.aWidth = [];\n    obj.lsBearing = [];\n    var aw = 0, lsb = 0;\n    for (var i = 0; i < font.maxp.numGlyphs; i++) {\n      if (i < font.hhea.numberOfHMetrics) {\n        aw = bin.readUshort(data, offset);\n        offset += 2;\n        lsb = bin.readShort(data, offset);\n        offset += 2;\n      }\n      obj.aWidth.push(aw);\n      obj.lsBearing.push(lsb);\n    }\n    return obj;\n  };\n  Typr.kern = {};\n  Typr.kern.parse = function(data, offset, length, font) {\n    var bin = Typr._bin;\n    var version = bin.readUshort(data, offset);\n    offset += 2;\n    if (version == 1)\n      return Typr.kern.parseV1(data, offset - 2, length, font);\n    var nTables = bin.readUshort(data, offset);\n    offset += 2;\n    var map = { glyph1: [], rval: [] };\n    for (var i = 0; i < nTables; i++) {\n      offset += 2;\n      var length = bin.readUshort(data, offset);\n      offset += 2;\n      var coverage = bin.readUshort(data, offset);\n      offset += 2;\n      var format = coverage >>> 8;\n      format &= 15;\n      if (format == 0)\n        offset = Typr.kern.readFormat0(data, offset, map);\n      else\n        throw \"unknown kern table format: \" + format;\n    }\n    return map;\n  };\n  Typr.kern.parseV1 = function(data, offset, length, font) {\n    var bin = Typr._bin;\n    bin.readFixed(data, offset);\n    offset += 4;\n    var nTables = bin.readUint(data, offset);\n    offset += 4;\n    var map = { glyph1: [], rval: [] };\n    for (var i = 0; i < nTables; i++) {\n      bin.readUint(data, offset);\n      offset += 4;\n      var coverage = bin.readUshort(data, offset);\n      offset += 2;\n      bin.readUshort(data, offset);\n      offset += 2;\n      var format = coverage >>> 8;\n      format &= 15;\n      if (format == 0)\n        offset = Typr.kern.readFormat0(data, offset, map);\n      else\n        throw \"unknown kern table format: \" + format;\n    }\n    return map;\n  };\n  Typr.kern.readFormat0 = function(data, offset, map) {\n    var bin = Typr._bin;\n    var pleft = -1;\n    var nPairs = bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    for (var j = 0; j < nPairs; j++) {\n      var left = bin.readUshort(data, offset);\n      offset += 2;\n      var right = bin.readUshort(data, offset);\n      offset += 2;\n      var value = bin.readShort(data, offset);\n      offset += 2;\n      if (left != pleft) {\n        map.glyph1.push(left);\n        map.rval.push({ glyph2: [], vals: [] });\n      }\n      var rval = map.rval[map.rval.length - 1];\n      rval.glyph2.push(right);\n      rval.vals.push(value);\n      pleft = left;\n    }\n    return offset;\n  };\n  Typr.loca = {};\n  Typr.loca.parse = function(data, offset, length, font) {\n    var bin = Typr._bin;\n    var obj = [];\n    var ver = font.head.indexToLocFormat;\n    var len = font.maxp.numGlyphs + 1;\n    if (ver == 0)\n      for (var i = 0; i < len; i++)\n        obj.push(bin.readUshort(data, offset + (i << 1)) << 1);\n    if (ver == 1)\n      for (var i = 0; i < len; i++)\n        obj.push(bin.readUint(data, offset + (i << 2)));\n    return obj;\n  };\n  Typr.maxp = {};\n  Typr.maxp.parse = function(data, offset, length) {\n    var bin = Typr._bin;\n    var obj = {};\n    var ver = bin.readUint(data, offset);\n    offset += 4;\n    obj.numGlyphs = bin.readUshort(data, offset);\n    offset += 2;\n    if (ver == 65536) {\n      obj.maxPoints = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxContours = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxCompositePoints = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxCompositeContours = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxZones = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxTwilightPoints = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxStorage = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxFunctionDefs = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxInstructionDefs = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxStackElements = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxSizeOfInstructions = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxComponentElements = bin.readUshort(data, offset);\n      offset += 2;\n      obj.maxComponentDepth = bin.readUshort(data, offset);\n      offset += 2;\n    }\n    return obj;\n  };\n  Typr.name = {};\n  Typr.name.parse = function(data, offset, length) {\n    var bin = Typr._bin;\n    var obj = {};\n    bin.readUshort(data, offset);\n    offset += 2;\n    var count = bin.readUshort(data, offset);\n    offset += 2;\n    bin.readUshort(data, offset);\n    offset += 2;\n    var offset0 = offset;\n    for (var i = 0; i < count; i++) {\n      var platformID = bin.readUshort(data, offset);\n      offset += 2;\n      var encodingID = bin.readUshort(data, offset);\n      offset += 2;\n      var languageID = bin.readUshort(data, offset);\n      offset += 2;\n      var nameID = bin.readUshort(data, offset);\n      offset += 2;\n      var length = bin.readUshort(data, offset);\n      offset += 2;\n      var noffset = bin.readUshort(data, offset);\n      offset += 2;\n      var plat = \"p\" + platformID;\n      if (obj[plat] == null)\n        obj[plat] = {};\n      var names = [\"copyright\", \"fontFamily\", \"fontSubfamily\", \"ID\", \"fullName\", \"version\", \"postScriptName\", \"trademark\", \"manufacturer\", \"designer\", \"description\", \"urlVendor\", \"urlDesigner\", \"licence\", \"licenceURL\", \"---\", \"typoFamilyName\", \"typoSubfamilyName\", \"compatibleFull\", \"sampleText\", \"postScriptCID\", \"wwsFamilyName\", \"wwsSubfamilyName\", \"lightPalette\", \"darkPalette\"];\n      var cname = names[nameID];\n      var soff = offset0 + count * 12 + noffset;\n      var str;\n      if (platformID == 0)\n        str = bin.readUnicode(data, soff, length / 2);\n      else if (platformID == 3 && encodingID == 0)\n        str = bin.readUnicode(data, soff, length / 2);\n      else if (encodingID == 0)\n        str = bin.readASCII(data, soff, length);\n      else if (encodingID == 1)\n        str = bin.readUnicode(data, soff, length / 2);\n      else if (encodingID == 3)\n        str = bin.readUnicode(data, soff, length / 2);\n      else if (platformID == 1) {\n        str = bin.readASCII(data, soff, length);\n        console.log(\"reading unknown MAC encoding \" + encodingID + \" as ASCII\");\n      } else\n        throw \"unknown encoding \" + encodingID + \", platformID: \" + platformID;\n      obj[plat][cname] = str;\n      obj[plat]._lang = languageID;\n    }\n    for (var p in obj)\n      if (obj[p].postScriptName != null && obj[p]._lang == 1033)\n        return obj[p];\n    for (var p in obj)\n      if (obj[p].postScriptName != null && obj[p]._lang == 3084)\n        return obj[p];\n    for (var p in obj)\n      if (obj[p].postScriptName != null)\n        return obj[p];\n    var tname;\n    for (var p in obj) {\n      tname = p;\n      break;\n    }\n    console.log(\"returning name table with languageID \" + obj[tname]._lang);\n    return obj[tname];\n  };\n  Typr[\"OS/2\"] = {};\n  Typr[\"OS/2\"].parse = function(data, offset, length) {\n    var bin = Typr._bin;\n    var ver = bin.readUshort(data, offset);\n    offset += 2;\n    var obj = {};\n    if (ver == 0)\n      Typr[\"OS/2\"].version0(data, offset, obj);\n    else if (ver == 1)\n      Typr[\"OS/2\"].version1(data, offset, obj);\n    else if (ver == 2 || ver == 3 || ver == 4)\n      Typr[\"OS/2\"].version2(data, offset, obj);\n    else if (ver == 5)\n      Typr[\"OS/2\"].version5(data, offset, obj);\n    else\n      throw \"unknown OS/2 table version: \" + ver;\n    return obj;\n  };\n  Typr[\"OS/2\"].version0 = function(data, offset, obj) {\n    var bin = Typr._bin;\n    obj.xAvgCharWidth = bin.readShort(data, offset);\n    offset += 2;\n    obj.usWeightClass = bin.readUshort(data, offset);\n    offset += 2;\n    obj.usWidthClass = bin.readUshort(data, offset);\n    offset += 2;\n    obj.fsType = bin.readUshort(data, offset);\n    offset += 2;\n    obj.ySubscriptXSize = bin.readShort(data, offset);\n    offset += 2;\n    obj.ySubscriptYSize = bin.readShort(data, offset);\n    offset += 2;\n    obj.ySubscriptXOffset = bin.readShort(data, offset);\n    offset += 2;\n    obj.ySubscriptYOffset = bin.readShort(data, offset);\n    offset += 2;\n    obj.ySuperscriptXSize = bin.readShort(data, offset);\n    offset += 2;\n    obj.ySuperscriptYSize = bin.readShort(data, offset);\n    offset += 2;\n    obj.ySuperscriptXOffset = bin.readShort(data, offset);\n    offset += 2;\n    obj.ySuperscriptYOffset = bin.readShort(data, offset);\n    offset += 2;\n    obj.yStrikeoutSize = bin.readShort(data, offset);\n    offset += 2;\n    obj.yStrikeoutPosition = bin.readShort(data, offset);\n    offset += 2;\n    obj.sFamilyClass = bin.readShort(data, offset);\n    offset += 2;\n    obj.panose = bin.readBytes(data, offset, 10);\n    offset += 10;\n    obj.ulUnicodeRange1 = bin.readUint(data, offset);\n    offset += 4;\n    obj.ulUnicodeRange2 = bin.readUint(data, offset);\n    offset += 4;\n    obj.ulUnicodeRange3 = bin.readUint(data, offset);\n    offset += 4;\n    obj.ulUnicodeRange4 = bin.readUint(data, offset);\n    offset += 4;\n    obj.achVendID = [bin.readInt8(data, offset), bin.readInt8(data, offset + 1), bin.readInt8(data, offset + 2), bin.readInt8(data, offset + 3)];\n    offset += 4;\n    obj.fsSelection = bin.readUshort(data, offset);\n    offset += 2;\n    obj.usFirstCharIndex = bin.readUshort(data, offset);\n    offset += 2;\n    obj.usLastCharIndex = bin.readUshort(data, offset);\n    offset += 2;\n    obj.sTypoAscender = bin.readShort(data, offset);\n    offset += 2;\n    obj.sTypoDescender = bin.readShort(data, offset);\n    offset += 2;\n    obj.sTypoLineGap = bin.readShort(data, offset);\n    offset += 2;\n    obj.usWinAscent = bin.readUshort(data, offset);\n    offset += 2;\n    obj.usWinDescent = bin.readUshort(data, offset);\n    offset += 2;\n    return offset;\n  };\n  Typr[\"OS/2\"].version1 = function(data, offset, obj) {\n    var bin = Typr._bin;\n    offset = Typr[\"OS/2\"].version0(data, offset, obj);\n    obj.ulCodePageRange1 = bin.readUint(data, offset);\n    offset += 4;\n    obj.ulCodePageRange2 = bin.readUint(data, offset);\n    offset += 4;\n    return offset;\n  };\n  Typr[\"OS/2\"].version2 = function(data, offset, obj) {\n    var bin = Typr._bin;\n    offset = Typr[\"OS/2\"].version1(data, offset, obj);\n    obj.sxHeight = bin.readShort(data, offset);\n    offset += 2;\n    obj.sCapHeight = bin.readShort(data, offset);\n    offset += 2;\n    obj.usDefault = bin.readUshort(data, offset);\n    offset += 2;\n    obj.usBreak = bin.readUshort(data, offset);\n    offset += 2;\n    obj.usMaxContext = bin.readUshort(data, offset);\n    offset += 2;\n    return offset;\n  };\n  Typr[\"OS/2\"].version5 = function(data, offset, obj) {\n    var bin = Typr._bin;\n    offset = Typr[\"OS/2\"].version2(data, offset, obj);\n    obj.usLowerOpticalPointSize = bin.readUshort(data, offset);\n    offset += 2;\n    obj.usUpperOpticalPointSize = bin.readUshort(data, offset);\n    offset += 2;\n    return offset;\n  };\n  Typr.post = {};\n  Typr.post.parse = function(data, offset, length) {\n    var bin = Typr._bin;\n    var obj = {};\n    obj.version = bin.readFixed(data, offset);\n    offset += 4;\n    obj.italicAngle = bin.readFixed(data, offset);\n    offset += 4;\n    obj.underlinePosition = bin.readShort(data, offset);\n    offset += 2;\n    obj.underlineThickness = bin.readShort(data, offset);\n    offset += 2;\n    return obj;\n  };\n  Typr.SVG = {};\n  Typr.SVG.parse = function(data, offset, length) {\n    var bin = Typr._bin;\n    var obj = { entries: [] };\n    var offset0 = offset;\n    bin.readUshort(data, offset);\n    offset += 2;\n    var svgDocIndexOffset = bin.readUint(data, offset);\n    offset += 4;\n    bin.readUint(data, offset);\n    offset += 4;\n    offset = svgDocIndexOffset + offset0;\n    var numEntries = bin.readUshort(data, offset);\n    offset += 2;\n    for (var i = 0; i < numEntries; i++) {\n      var startGlyphID = bin.readUshort(data, offset);\n      offset += 2;\n      var endGlyphID = bin.readUshort(data, offset);\n      offset += 2;\n      var svgDocOffset = bin.readUint(data, offset);\n      offset += 4;\n      var svgDocLength = bin.readUint(data, offset);\n      offset += 4;\n      var sbuf = new Uint8Array(data.buffer, offset0 + svgDocOffset + svgDocIndexOffset, svgDocLength);\n      var svg = bin.readUTF8(sbuf, 0, sbuf.length);\n      for (var f = startGlyphID; f <= endGlyphID; f++) {\n        obj.entries[f] = svg;\n      }\n    }\n    return obj;\n  };\n  Typr.SVG.toPath = function(str) {\n    var pth = { cmds: [], crds: [] };\n    if (str == null)\n      return pth;\n    var prsr = new DOMParser();\n    var doc = prsr[\"parseFromString\"](str, \"image/svg+xml\");\n    var svg = doc.firstChild;\n    while (svg.tagName != \"svg\")\n      svg = svg.nextSibling;\n    var vb = svg.getAttribute(\"viewBox\");\n    if (vb)\n      vb = vb.trim().split(\" \").map(parseFloat);\n    else\n      vb = [0, 0, 1e3, 1e3];\n    Typr.SVG._toPath(svg.children, pth);\n    for (var i = 0; i < pth.crds.length; i += 2) {\n      var x = pth.crds[i], y = pth.crds[i + 1];\n      x -= vb[0];\n      y -= vb[1];\n      y = -y;\n      pth.crds[i] = x;\n      pth.crds[i + 1] = y;\n    }\n    return pth;\n  };\n  Typr.SVG._toPath = function(nds, pth, fill) {\n    for (var ni = 0; ni < nds.length; ni++) {\n      var nd = nds[ni], tn = nd.tagName;\n      var cfl = nd.getAttribute(\"fill\");\n      if (cfl == null)\n        cfl = fill;\n      if (tn == \"g\")\n        Typr.SVG._toPath(nd.children, pth, cfl);\n      else if (tn == \"path\") {\n        pth.cmds.push(cfl ? cfl : \"#000000\");\n        var d = nd.getAttribute(\"d\");\n        var toks = Typr.SVG._tokens(d);\n        Typr.SVG._toksToPath(toks, pth);\n        pth.cmds.push(\"X\");\n      } else if (tn == \"defs\")\n        ;\n      else\n        console.log(tn, nd);\n    }\n  };\n  Typr.SVG._tokens = function(d) {\n    var ts = [], off = 0, rn = false, cn = \"\";\n    while (off < d.length) {\n      var cc = d.charCodeAt(off), ch = d.charAt(off);\n      off++;\n      var isNum = 48 <= cc && cc <= 57 || ch == \".\" || ch == \"-\";\n      if (rn) {\n        if (ch == \"-\") {\n          ts.push(parseFloat(cn));\n          cn = ch;\n        } else if (isNum)\n          cn += ch;\n        else {\n          ts.push(parseFloat(cn));\n          if (ch != \",\" && ch != \" \")\n            ts.push(ch);\n          rn = false;\n        }\n      } else {\n        if (isNum) {\n          cn = ch;\n          rn = true;\n        } else if (ch != \",\" && ch != \" \")\n          ts.push(ch);\n      }\n    }\n    if (rn)\n      ts.push(parseFloat(cn));\n    return ts;\n  };\n  Typr.SVG._toksToPath = function(ts, pth) {\n    var i = 0, x = 0, y = 0, ox = 0, oy = 0;\n    var pc = { M: 2, L: 2, H: 1, V: 1, S: 4, C: 6 };\n    var cmds = pth.cmds, crds = pth.crds;\n    while (i < ts.length) {\n      var cmd = ts[i];\n      i++;\n      if (cmd == \"z\") {\n        cmds.push(\"Z\");\n        x = ox;\n        y = oy;\n      } else {\n        var cmu = cmd.toUpperCase();\n        var ps = pc[cmu], reps = Typr.SVG._reps(ts, i, ps);\n        for (var j = 0; j < reps; j++) {\n          var xi = 0, yi = 0;\n          if (cmd != cmu) {\n            xi = x;\n            yi = y;\n          }\n          if (cmu == \"M\") {\n            x = xi + ts[i++];\n            y = yi + ts[i++];\n            cmds.push(\"M\");\n            crds.push(x, y);\n            ox = x;\n            oy = y;\n          } else if (cmu == \"L\") {\n            x = xi + ts[i++];\n            y = yi + ts[i++];\n            cmds.push(\"L\");\n            crds.push(x, y);\n          } else if (cmu == \"H\") {\n            x = xi + ts[i++];\n            cmds.push(\"L\");\n            crds.push(x, y);\n          } else if (cmu == \"V\") {\n            y = yi + ts[i++];\n            cmds.push(\"L\");\n            crds.push(x, y);\n          } else if (cmu == \"C\") {\n            var x1 = xi + ts[i++], y1 = yi + ts[i++], x2 = xi + ts[i++], y2 = yi + ts[i++], x3 = xi + ts[i++], y3 = yi + ts[i++];\n            cmds.push(\"C\");\n            crds.push(x1, y1, x2, y2, x3, y3);\n            x = x3;\n            y = y3;\n          } else if (cmu == \"S\") {\n            var co = Math.max(crds.length - 4, 0);\n            var x1 = x + x - crds[co], y1 = y + y - crds[co + 1];\n            var x2 = xi + ts[i++], y2 = yi + ts[i++], x3 = xi + ts[i++], y3 = yi + ts[i++];\n            cmds.push(\"C\");\n            crds.push(x1, y1, x2, y2, x3, y3);\n            x = x3;\n            y = y3;\n          } else\n            console.log(\"Unknown SVG command \" + cmd);\n        }\n      }\n    }\n  };\n  Typr.SVG._reps = function(ts, off, ps) {\n    var i = off;\n    while (i < ts.length) {\n      if (typeof ts[i] == \"string\")\n        break;\n      i += ps;\n    }\n    return (i - off) / ps;\n  };\n  if (Typr == null)\n    Typr = {};\n  if (Typr.U == null)\n    Typr.U = {};\n  Typr.U.codeToGlyph = function(font, code) {\n    var cmap = font.cmap;\n    var tind = -1;\n    if (cmap.p0e4 != null)\n      tind = cmap.p0e4;\n    else if (cmap.p3e1 != null)\n      tind = cmap.p3e1;\n    else if (cmap.p1e0 != null)\n      tind = cmap.p1e0;\n    if (tind == -1)\n      throw \"no familiar platform and encoding!\";\n    var tab = cmap.tables[tind];\n    if (tab.format == 0) {\n      if (code >= tab.map.length)\n        return 0;\n      return tab.map[code];\n    } else if (tab.format == 4) {\n      var sind = -1;\n      for (var i = 0; i < tab.endCount.length; i++)\n        if (code <= tab.endCount[i]) {\n          sind = i;\n          break;\n        }\n      if (sind == -1)\n        return 0;\n      if (tab.startCount[sind] > code)\n        return 0;\n      var gli = 0;\n      if (tab.idRangeOffset[sind] != 0)\n        gli = tab.glyphIdArray[code - tab.startCount[sind] + (tab.idRangeOffset[sind] >> 1) - (tab.idRangeOffset.length - sind)];\n      else\n        gli = code + tab.idDelta[sind];\n      return gli & 65535;\n    } else if (tab.format == 12) {\n      if (code > tab.groups[tab.groups.length - 1][1])\n        return 0;\n      for (var i = 0; i < tab.groups.length; i++) {\n        var grp = tab.groups[i];\n        if (grp[0] <= code && code <= grp[1])\n          return grp[2] + (code - grp[0]);\n      }\n      return 0;\n    } else\n      throw \"unknown cmap table format \" + tab.format;\n  };\n  Typr.U.glyphToPath = function(font, gid) {\n    var path = { cmds: [], crds: [] };\n    if (font.SVG && font.SVG.entries[gid]) {\n      var p = font.SVG.entries[gid];\n      if (p == null)\n        return path;\n      if (typeof p == \"string\") {\n        p = Typr.SVG.toPath(p);\n        font.SVG.entries[gid] = p;\n      }\n      return p;\n    } else if (font.CFF) {\n      var state2 = { x: 0, y: 0, stack: [], nStems: 0, haveWidth: false, width: font.CFF.Private ? font.CFF.Private.defaultWidthX : 0, open: false };\n      Typr.U._drawCFF(font.CFF.CharStrings[gid], state2, font.CFF, path);\n    } else if (font.glyf) {\n      Typr.U._drawGlyf(gid, font, path);\n    }\n    return path;\n  };\n  Typr.U._drawGlyf = function(gid, font, path) {\n    var gl = font.glyf[gid];\n    if (gl == null)\n      gl = font.glyf[gid] = Typr.glyf._parseGlyf(font, gid);\n    if (gl != null) {\n      if (gl.noc > -1)\n        Typr.U._simpleGlyph(gl, path);\n      else\n        Typr.U._compoGlyph(gl, font, path);\n    }\n  };\n  Typr.U._simpleGlyph = function(gl, p) {\n    for (var c = 0; c < gl.noc; c++) {\n      var i0 = c == 0 ? 0 : gl.endPts[c - 1] + 1;\n      var il = gl.endPts[c];\n      for (var i = i0; i <= il; i++) {\n        var pr = i == i0 ? il : i - 1;\n        var nx = i == il ? i0 : i + 1;\n        var onCurve = gl.flags[i] & 1;\n        var prOnCurve = gl.flags[pr] & 1;\n        var nxOnCurve = gl.flags[nx] & 1;\n        var x = gl.xs[i], y = gl.ys[i];\n        if (i == i0) {\n          if (onCurve) {\n            if (prOnCurve)\n              Typr.U.P.moveTo(p, gl.xs[pr], gl.ys[pr]);\n            else {\n              Typr.U.P.moveTo(p, x, y);\n              continue;\n            }\n          } else {\n            if (prOnCurve)\n              Typr.U.P.moveTo(p, gl.xs[pr], gl.ys[pr]);\n            else\n              Typr.U.P.moveTo(p, (gl.xs[pr] + x) / 2, (gl.ys[pr] + y) / 2);\n          }\n        }\n        if (onCurve) {\n          if (prOnCurve)\n            Typr.U.P.lineTo(p, x, y);\n        } else {\n          if (nxOnCurve)\n            Typr.U.P.qcurveTo(p, x, y, gl.xs[nx], gl.ys[nx]);\n          else\n            Typr.U.P.qcurveTo(p, x, y, (x + gl.xs[nx]) / 2, (y + gl.ys[nx]) / 2);\n        }\n      }\n      Typr.U.P.closePath(p);\n    }\n  };\n  Typr.U._compoGlyph = function(gl, font, p) {\n    for (var j = 0; j < gl.parts.length; j++) {\n      var path = { cmds: [], crds: [] };\n      var prt = gl.parts[j];\n      Typr.U._drawGlyf(prt.glyphIndex, font, path);\n      var m = prt.m;\n      for (var i = 0; i < path.crds.length; i += 2) {\n        var x = path.crds[i], y = path.crds[i + 1];\n        p.crds.push(x * m.a + y * m.b + m.tx);\n        p.crds.push(x * m.c + y * m.d + m.ty);\n      }\n      for (var i = 0; i < path.cmds.length; i++)\n        p.cmds.push(path.cmds[i]);\n    }\n  };\n  Typr.U._getGlyphClass = function(g, cd) {\n    var intr = Typr._lctf.getInterval(cd, g);\n    return intr == -1 ? 0 : cd[intr + 2];\n  };\n  Typr.U.getPairAdjustment = function(font, g1, g2) {\n    if (font.GPOS) {\n      var ltab = null;\n      for (var i = 0; i < font.GPOS.featureList.length; i++) {\n        var fl = font.GPOS.featureList[i];\n        if (fl.tag == \"kern\") {\n          for (var j = 0; j < fl.tab.length; j++)\n            if (font.GPOS.lookupList[fl.tab[j]].ltype == 2)\n              ltab = font.GPOS.lookupList[fl.tab[j]];\n        }\n      }\n      if (ltab) {\n        for (var i = 0; i < ltab.tabs.length; i++) {\n          var tab = ltab.tabs[i];\n          var ind = Typr._lctf.coverageIndex(tab.coverage, g1);\n          if (ind == -1)\n            continue;\n          var adj;\n          if (tab.format == 1) {\n            var right = tab.pairsets[ind];\n            for (var j = 0; j < right.length; j++)\n              if (right[j].gid2 == g2)\n                adj = right[j];\n            if (adj == null)\n              continue;\n          } else if (tab.format == 2) {\n            var c1 = Typr.U._getGlyphClass(g1, tab.classDef1);\n            var c2 = Typr.U._getGlyphClass(g2, tab.classDef2);\n            var adj = tab.matrix[c1][c2];\n          }\n          return adj.val1[2];\n        }\n      }\n    }\n    if (font.kern) {\n      var ind1 = font.kern.glyph1.indexOf(g1);\n      if (ind1 != -1) {\n        var ind2 = font.kern.rval[ind1].glyph2.indexOf(g2);\n        if (ind2 != -1)\n          return font.kern.rval[ind1].vals[ind2];\n      }\n    }\n    return 0;\n  };\n  Typr.U.stringToGlyphs = function(font, str) {\n    var gls = [];\n    for (var i = 0; i < str.length; i++) {\n      var cc = str.codePointAt(i);\n      if (cc > 65535)\n        i++;\n      gls.push(Typr.U.codeToGlyph(font, cc));\n    }\n    var gsub = font[\"GSUB\"];\n    if (gsub == null)\n      return gls;\n    var llist = gsub.lookupList, flist = gsub.featureList;\n    var wsep = '\\n\t\" ,.:;!?()  ،';\n    var R2 = \"آأؤإاةدذرزوٱٲٳٵٶٷڈډڊڋڌڍڎڏڐڑڒړڔڕږڗژڙۀۃۄۅۆۇۈۉۊۋۍۏےۓەۮۯܐܕܖܗܘܙܞܨܪܬܯݍݙݚݛݫݬݱݳݴݸݹࡀࡆࡇࡉࡔࡧࡩࡪࢪࢫࢬࢮࢱࢲࢹૅેૉ૊૎૏ૐ૑૒૝ૡ૤૯஁ஃ஄அஉ஌எஏ஑னப஫஬\";\n    var L = \"ꡲ્૗\";\n    for (var ci = 0; ci < gls.length; ci++) {\n      var gl = gls[ci];\n      var slft = ci == 0 || wsep.indexOf(str[ci - 1]) != -1;\n      var srgt = ci == gls.length - 1 || wsep.indexOf(str[ci + 1]) != -1;\n      if (!slft && R2.indexOf(str[ci - 1]) != -1)\n        slft = true;\n      if (!srgt && R2.indexOf(str[ci]) != -1)\n        srgt = true;\n      if (!srgt && L.indexOf(str[ci + 1]) != -1)\n        srgt = true;\n      if (!slft && L.indexOf(str[ci]) != -1)\n        slft = true;\n      var feat = null;\n      if (slft)\n        feat = srgt ? \"isol\" : \"init\";\n      else\n        feat = srgt ? \"fina\" : \"medi\";\n      for (var fi = 0; fi < flist.length; fi++) {\n        if (flist[fi].tag != feat)\n          continue;\n        for (var ti = 0; ti < flist[fi].tab.length; ti++) {\n          var tab = llist[flist[fi].tab[ti]];\n          if (tab.ltype != 1)\n            continue;\n          Typr.U._applyType1(gls, ci, tab);\n        }\n      }\n    }\n    var cligs = [\"rlig\", \"liga\", \"mset\"];\n    for (var ci = 0; ci < gls.length; ci++) {\n      var gl = gls[ci];\n      var rlim = Math.min(3, gls.length - ci - 1);\n      for (var fi = 0; fi < flist.length; fi++) {\n        var fl = flist[fi];\n        if (cligs.indexOf(fl.tag) == -1)\n          continue;\n        for (var ti = 0; ti < fl.tab.length; ti++) {\n          var tab = llist[fl.tab[ti]];\n          for (var j = 0; j < tab.tabs.length; j++) {\n            if (tab.tabs[j] == null)\n              continue;\n            var ind = Typr._lctf.coverageIndex(tab.tabs[j].coverage, gl);\n            if (ind == -1)\n              continue;\n            if (tab.ltype == 4) {\n              var vals = tab.tabs[j].vals[ind];\n              for (var k = 0; k < vals.length; k++) {\n                var lig = vals[k], rl = lig.chain.length;\n                if (rl > rlim)\n                  continue;\n                var good = true;\n                for (var l = 0; l < rl; l++)\n                  if (lig.chain[l] != gls[ci + (1 + l)])\n                    good = false;\n                if (!good)\n                  continue;\n                gls[ci] = lig.nglyph;\n                for (var l = 0; l < rl; l++)\n                  gls[ci + l + 1] = -1;\n              }\n            } else if (tab.ltype == 5) {\n              var ltab = tab.tabs[j];\n              if (ltab.fmt != 2)\n                continue;\n              var cind = Typr._lctf.getInterval(ltab.cDef, gl);\n              var cls = ltab.cDef[cind + 2], scs = ltab.scset[cls];\n              for (var i = 0; i < scs.length; i++) {\n                var sc = scs[i], inp = sc.input;\n                if (inp.length > rlim)\n                  continue;\n                var good = true;\n                for (var l = 0; l < inp.length; l++) {\n                  var cind2 = Typr._lctf.getInterval(ltab.cDef, gls[ci + 1 + l]);\n                  if (cind == -1 && ltab.cDef[cind2 + 2] != inp[l]) {\n                    good = false;\n                    break;\n                  }\n                }\n                if (!good)\n                  continue;\n                var lrs = sc.substLookupRecords;\n                for (var k = 0; k < lrs.length; k += 2) {\n                  lrs[k];\n                  lrs[k + 1];\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    return gls;\n  };\n  Typr.U._applyType1 = function(gls, ci, tab) {\n    var gl = gls[ci];\n    for (var j = 0; j < tab.tabs.length; j++) {\n      var ttab = tab.tabs[j];\n      var ind = Typr._lctf.coverageIndex(ttab.coverage, gl);\n      if (ind == -1)\n        continue;\n      if (ttab.fmt == 1)\n        gls[ci] = gls[ci] + ttab.delta;\n      else\n        gls[ci] = ttab.newg[ind];\n    }\n  };\n  Typr.U.glyphsToPath = function(font, gls, clr) {\n    var tpath = { cmds: [], crds: [] };\n    var x = 0;\n    for (var i = 0; i < gls.length; i++) {\n      var gid = gls[i];\n      if (gid == -1)\n        continue;\n      var gid2 = i < gls.length - 1 && gls[i + 1] != -1 ? gls[i + 1] : 0;\n      var path = Typr.U.glyphToPath(font, gid);\n      for (var j = 0; j < path.crds.length; j += 2) {\n        tpath.crds.push(path.crds[j] + x);\n        tpath.crds.push(path.crds[j + 1]);\n      }\n      if (clr)\n        tpath.cmds.push(clr);\n      for (var j = 0; j < path.cmds.length; j++)\n        tpath.cmds.push(path.cmds[j]);\n      if (clr)\n        tpath.cmds.push(\"X\");\n      x += font.hmtx.aWidth[gid];\n      if (i < gls.length - 1)\n        x += Typr.U.getPairAdjustment(font, gid, gid2);\n    }\n    return tpath;\n  };\n  Typr.U.pathToSVG = function(path, prec) {\n    if (prec == null)\n      prec = 5;\n    var out = [], co = 0, lmap = { M: 2, L: 2, Q: 4, C: 6 };\n    for (var i = 0; i < path.cmds.length; i++) {\n      var cmd = path.cmds[i], cn = co + (lmap[cmd] ? lmap[cmd] : 0);\n      out.push(cmd);\n      while (co < cn) {\n        var c = path.crds[co++];\n        out.push(parseFloat(c.toFixed(prec)) + (co == cn ? \"\" : \" \"));\n      }\n    }\n    return out.join(\"\");\n  };\n  Typr.U.pathToContext = function(path, ctx) {\n    var c = 0, crds = path.crds;\n    for (var j = 0; j < path.cmds.length; j++) {\n      var cmd = path.cmds[j];\n      if (cmd == \"M\") {\n        ctx.moveTo(crds[c], crds[c + 1]);\n        c += 2;\n      } else if (cmd == \"L\") {\n        ctx.lineTo(crds[c], crds[c + 1]);\n        c += 2;\n      } else if (cmd == \"C\") {\n        ctx.bezierCurveTo(crds[c], crds[c + 1], crds[c + 2], crds[c + 3], crds[c + 4], crds[c + 5]);\n        c += 6;\n      } else if (cmd == \"Q\") {\n        ctx.quadraticCurveTo(crds[c], crds[c + 1], crds[c + 2], crds[c + 3]);\n        c += 4;\n      } else if (cmd.charAt(0) == \"#\") {\n        ctx.beginPath();\n        ctx.fillStyle = cmd;\n      } else if (cmd == \"Z\") {\n        ctx.closePath();\n      } else if (cmd == \"X\") {\n        ctx.fill();\n      }\n    }\n  };\n  Typr.U.P = {};\n  Typr.U.P.moveTo = function(p, x, y) {\n    p.cmds.push(\"M\");\n    p.crds.push(x, y);\n  };\n  Typr.U.P.lineTo = function(p, x, y) {\n    p.cmds.push(\"L\");\n    p.crds.push(x, y);\n  };\n  Typr.U.P.curveTo = function(p, a, b, c, d, e, f) {\n    p.cmds.push(\"C\");\n    p.crds.push(a, b, c, d, e, f);\n  };\n  Typr.U.P.qcurveTo = function(p, a, b, c, d) {\n    p.cmds.push(\"Q\");\n    p.crds.push(a, b, c, d);\n  };\n  Typr.U.P.closePath = function(p) {\n    p.cmds.push(\"Z\");\n  };\n  Typr.U._drawCFF = function(cmds, state2, font, p) {\n    var stack = state2.stack;\n    var nStems = state2.nStems, haveWidth = state2.haveWidth, width = state2.width, open = state2.open;\n    var i = 0;\n    var x = state2.x, y = state2.y, c1x = 0, c1y = 0, c2x = 0, c2y = 0, c3x = 0, c3y = 0, c4x = 0, c4y = 0, jpx = 0, jpy = 0;\n    var o = { val: 0, size: 0 };\n    while (i < cmds.length) {\n      Typr.CFF.getCharString(cmds, i, o);\n      var v = o.val;\n      i += o.size;\n      if (v == \"o1\" || v == \"o18\") {\n        var hasWidthArg;\n        hasWidthArg = stack.length % 2 !== 0;\n        if (hasWidthArg && !haveWidth) {\n          width = stack.shift() + font.Private.nominalWidthX;\n        }\n        nStems += stack.length >> 1;\n        stack.length = 0;\n        haveWidth = true;\n      } else if (v == \"o3\" || v == \"o23\") {\n        var hasWidthArg;\n        hasWidthArg = stack.length % 2 !== 0;\n        if (hasWidthArg && !haveWidth) {\n          width = stack.shift() + font.Private.nominalWidthX;\n        }\n        nStems += stack.length >> 1;\n        stack.length = 0;\n        haveWidth = true;\n      } else if (v == \"o4\") {\n        if (stack.length > 1 && !haveWidth) {\n          width = stack.shift() + font.Private.nominalWidthX;\n          haveWidth = true;\n        }\n        if (open)\n          Typr.U.P.closePath(p);\n        y += stack.pop();\n        Typr.U.P.moveTo(p, x, y);\n        open = true;\n      } else if (v == \"o5\") {\n        while (stack.length > 0) {\n          x += stack.shift();\n          y += stack.shift();\n          Typr.U.P.lineTo(p, x, y);\n        }\n      } else if (v == \"o6\" || v == \"o7\") {\n        var count = stack.length;\n        var isX = v == \"o6\";\n        for (var j = 0; j < count; j++) {\n          var sval = stack.shift();\n          if (isX)\n            x += sval;\n          else\n            y += sval;\n          isX = !isX;\n          Typr.U.P.lineTo(p, x, y);\n        }\n      } else if (v == \"o8\" || v == \"o24\") {\n        var count = stack.length;\n        var index = 0;\n        while (index + 6 <= count) {\n          c1x = x + stack.shift();\n          c1y = y + stack.shift();\n          c2x = c1x + stack.shift();\n          c2y = c1y + stack.shift();\n          x = c2x + stack.shift();\n          y = c2y + stack.shift();\n          Typr.U.P.curveTo(p, c1x, c1y, c2x, c2y, x, y);\n          index += 6;\n        }\n        if (v == \"o24\") {\n          x += stack.shift();\n          y += stack.shift();\n          Typr.U.P.lineTo(p, x, y);\n        }\n      } else if (v == \"o11\")\n        break;\n      else if (v == \"o1234\" || v == \"o1235\" || v == \"o1236\" || v == \"o1237\") {\n        if (v == \"o1234\") {\n          c1x = x + stack.shift();\n          c1y = y;\n          c2x = c1x + stack.shift();\n          c2y = c1y + stack.shift();\n          jpx = c2x + stack.shift();\n          jpy = c2y;\n          c3x = jpx + stack.shift();\n          c3y = c2y;\n          c4x = c3x + stack.shift();\n          c4y = y;\n          x = c4x + stack.shift();\n          Typr.U.P.curveTo(p, c1x, c1y, c2x, c2y, jpx, jpy);\n          Typr.U.P.curveTo(p, c3x, c3y, c4x, c4y, x, y);\n        }\n        if (v == \"o1235\") {\n          c1x = x + stack.shift();\n          c1y = y + stack.shift();\n          c2x = c1x + stack.shift();\n          c2y = c1y + stack.shift();\n          jpx = c2x + stack.shift();\n          jpy = c2y + stack.shift();\n          c3x = jpx + stack.shift();\n          c3y = jpy + stack.shift();\n          c4x = c3x + stack.shift();\n          c4y = c3y + stack.shift();\n          x = c4x + stack.shift();\n          y = c4y + stack.shift();\n          stack.shift();\n          Typr.U.P.curveTo(p, c1x, c1y, c2x, c2y, jpx, jpy);\n          Typr.U.P.curveTo(p, c3x, c3y, c4x, c4y, x, y);\n        }\n        if (v == \"o1236\") {\n          c1x = x + stack.shift();\n          c1y = y + stack.shift();\n          c2x = c1x + stack.shift();\n          c2y = c1y + stack.shift();\n          jpx = c2x + stack.shift();\n          jpy = c2y;\n          c3x = jpx + stack.shift();\n          c3y = c2y;\n          c4x = c3x + stack.shift();\n          c4y = c3y + stack.shift();\n          x = c4x + stack.shift();\n          Typr.U.P.curveTo(p, c1x, c1y, c2x, c2y, jpx, jpy);\n          Typr.U.P.curveTo(p, c3x, c3y, c4x, c4y, x, y);\n        }\n        if (v == \"o1237\") {\n          c1x = x + stack.shift();\n          c1y = y + stack.shift();\n          c2x = c1x + stack.shift();\n          c2y = c1y + stack.shift();\n          jpx = c2x + stack.shift();\n          jpy = c2y + stack.shift();\n          c3x = jpx + stack.shift();\n          c3y = jpy + stack.shift();\n          c4x = c3x + stack.shift();\n          c4y = c3y + stack.shift();\n          if (Math.abs(c4x - x) > Math.abs(c4y - y)) {\n            x = c4x + stack.shift();\n          } else {\n            y = c4y + stack.shift();\n          }\n          Typr.U.P.curveTo(p, c1x, c1y, c2x, c2y, jpx, jpy);\n          Typr.U.P.curveTo(p, c3x, c3y, c4x, c4y, x, y);\n        }\n      } else if (v == \"o14\") {\n        if (stack.length > 0 && !haveWidth) {\n          width = stack.shift() + font.nominalWidthX;\n          haveWidth = true;\n        }\n        if (stack.length == 4) {\n          var adx = stack.shift();\n          var ady = stack.shift();\n          var bchar = stack.shift();\n          var achar = stack.shift();\n          var bind = Typr.CFF.glyphBySE(font, bchar);\n          var aind = Typr.CFF.glyphBySE(font, achar);\n          Typr.U._drawCFF(font.CharStrings[bind], state2, font, p);\n          state2.x = adx;\n          state2.y = ady;\n          Typr.U._drawCFF(font.CharStrings[aind], state2, font, p);\n        }\n        if (open) {\n          Typr.U.P.closePath(p);\n          open = false;\n        }\n      } else if (v == \"o19\" || v == \"o20\") {\n        var hasWidthArg;\n        hasWidthArg = stack.length % 2 !== 0;\n        if (hasWidthArg && !haveWidth) {\n          width = stack.shift() + font.Private.nominalWidthX;\n        }\n        nStems += stack.length >> 1;\n        stack.length = 0;\n        haveWidth = true;\n        i += nStems + 7 >> 3;\n      } else if (v == \"o21\") {\n        if (stack.length > 2 && !haveWidth) {\n          width = stack.shift() + font.Private.nominalWidthX;\n          haveWidth = true;\n        }\n        y += stack.pop();\n        x += stack.pop();\n        if (open)\n          Typr.U.P.closePath(p);\n        Typr.U.P.moveTo(p, x, y);\n        open = true;\n      } else if (v == \"o22\") {\n        if (stack.length > 1 && !haveWidth) {\n          width = stack.shift() + font.Private.nominalWidthX;\n          haveWidth = true;\n        }\n        x += stack.pop();\n        if (open)\n          Typr.U.P.closePath(p);\n        Typr.U.P.moveTo(p, x, y);\n        open = true;\n      } else if (v == \"o25\") {\n        while (stack.length > 6) {\n          x += stack.shift();\n          y += stack.shift();\n          Typr.U.P.lineTo(p, x, y);\n        }\n        c1x = x + stack.shift();\n        c1y = y + stack.shift();\n        c2x = c1x + stack.shift();\n        c2y = c1y + stack.shift();\n        x = c2x + stack.shift();\n        y = c2y + stack.shift();\n        Typr.U.P.curveTo(p, c1x, c1y, c2x, c2y, x, y);\n      } else if (v == \"o26\") {\n        if (stack.length % 2) {\n          x += stack.shift();\n        }\n        while (stack.length > 0) {\n          c1x = x;\n          c1y = y + stack.shift();\n          c2x = c1x + stack.shift();\n          c2y = c1y + stack.shift();\n          x = c2x;\n          y = c2y + stack.shift();\n          Typr.U.P.curveTo(p, c1x, c1y, c2x, c2y, x, y);\n        }\n      } else if (v == \"o27\") {\n        if (stack.length % 2) {\n          y += stack.shift();\n        }\n        while (stack.length > 0) {\n          c1x = x + stack.shift();\n          c1y = y;\n          c2x = c1x + stack.shift();\n          c2y = c1y + stack.shift();\n          x = c2x + stack.shift();\n          y = c2y;\n          Typr.U.P.curveTo(p, c1x, c1y, c2x, c2y, x, y);\n        }\n      } else if (v == \"o10\" || v == \"o29\") {\n        var obj = v == \"o10\" ? font.Private : font;\n        if (stack.length == 0) {\n          console.log(\"error: empty stack\");\n        } else {\n          var ind = stack.pop();\n          var subr = obj.Subrs[ind + obj.Bias];\n          state2.x = x;\n          state2.y = y;\n          state2.nStems = nStems;\n          state2.haveWidth = haveWidth;\n          state2.width = width;\n          state2.open = open;\n          Typr.U._drawCFF(subr, state2, font, p);\n          x = state2.x;\n          y = state2.y;\n          nStems = state2.nStems;\n          haveWidth = state2.haveWidth;\n          width = state2.width;\n          open = state2.open;\n        }\n      } else if (v == \"o30\" || v == \"o31\") {\n        var count, count1 = stack.length;\n        var index = 0;\n        var alternate = v == \"o31\";\n        count = count1 & ~2;\n        index += count1 - count;\n        while (index < count) {\n          if (alternate) {\n            c1x = x + stack.shift();\n            c1y = y;\n            c2x = c1x + stack.shift();\n            c2y = c1y + stack.shift();\n            y = c2y + stack.shift();\n            if (count - index == 5) {\n              x = c2x + stack.shift();\n              index++;\n            } else\n              x = c2x;\n            alternate = false;\n          } else {\n            c1x = x;\n            c1y = y + stack.shift();\n            c2x = c1x + stack.shift();\n            c2y = c1y + stack.shift();\n            x = c2x + stack.shift();\n            if (count - index == 5) {\n              y = c2y + stack.shift();\n              index++;\n            } else\n              y = c2y;\n            alternate = true;\n          }\n          Typr.U.P.curveTo(p, c1x, c1y, c2x, c2y, x, y);\n          index += 4;\n        }\n      } else if ((v + \"\").charAt(0) == \"o\") {\n        console.log(\"Unknown operation: \" + v, cmds);\n        throw v;\n      } else\n        stack.push(v);\n    }\n    state2.x = x;\n    state2.y = y;\n    state2.nStems = nStems;\n    state2.haveWidth = haveWidth;\n    state2.width = width;\n    state2.open = open;\n  };\n  var typr_js = Typr;\n  try {\n    top.typrMapping = top.typrMapping || void 0;\n    top.jobs = top.jobs || [];\n    top.currentMedia = top.currentMedia || void 0;\n  } catch {\n  }\n  const state$3 = {\n    study: {\n      videojs: /* @__PURE__ */ Object.create({}),\n      hacked: false,\n      answererWrapperUnsetMessage: void 0,\n      playbackRateWarningListenerId: 0\n    }\n  };\n  const CXProject = lib.Project.create({\n    name: \"超星学习通\",\n    domains: [\n      \"chaoxing.com\",\n      \"edu.cn\",\n      \"org.cn\",\n      \"xueyinonline.com\",\n      \"hnsyu.net\",\n      \"qutjxjy.cn\",\n      \"ynny.cn\",\n      \"hnvist.cn\",\n      \"fjlecb.cn\",\n      \"gdhkmooc.com\",\n      \"cugbonline.cn\",\n      \"zjelib.cn\",\n      \"cqrspx.cn\",\n      \"neauce.com\",\n      \"zhihui-yun.com\",\n      \"cqie.cn\",\n      \"ccqmxx.com\",\n      \"jxgmxy.com\",\n      \"sslibrary.com\"\n    ],\n    scripts: {\n      env: new lib.Script({\n        name: \"环境准备脚本\",\n        matches: [[\"所有页面\", /.*/]],\n        hideInPanel: true,\n        onstart() {\n          let top2 = window.top;\n          try {\n            let _self = lib.$gm.unsafeWindow;\n            let _try_count = 10;\n            while (_self.parent !== void 0 && _try_count > 0) {\n              if (_self.location.href.includes(\"/mycourse/studentstudy\")) {\n                top2 = _self;\n                console.log(\"[ocsjs] top change to :\" + top2.location.href);\n                break;\n              } else {\n                _try_count--;\n                _self = _self.parent;\n              }\n            }\n          } catch (e) {\n            console.warn(\"[ocsjs] fail of find top\");\n            console.warn(e);\n            top2 = window.top;\n          }\n        }\n      }),\n      guide: new lib.Script({\n        name: \"💡 使用提示\",\n        matches: [\n          [\"首页\", \"https://www.chaoxing.com\"],\n          [\"旧版个人首页\", \"chaoxing.com/space/index\"],\n          [\"新版个人首页\", \"chaoxing.com/base\"],\n          [\"学习页面\", \"chaoxing.com/mycourse\"],\n          [\"新版学习页面\", \"chaoxing.com/mooc2-ans/mycourse\"]\n        ],\n        namespace: \"cx.guide\",\n        configs: {\n          notes: {\n            defaultValue: `请手动进入视频、作业、考试页面，脚本会自动运行。`\n          }\n        },\n        oncomplete() {\n          if ([\"mycourse/studentstudy\"].some((path) => location.href.includes(path))) {\n            lib.$message.success(\"已进入学习页面，请等待自动运行...\");\n            return;\n          }\n          lib.$message.info(\"请手动进入视频、作业、考试页面，脚本会自动运行。\");\n        }\n      }),\n      study: new lib.Script({\n        name: \"🖥️ 课程学习\",\n        namespace: \"cx.new.study\",\n        matches: [\n          [\"任务点页面\", \"/knowledge/cards\"],\n          [\"阅读任务点\", \"/readsvr/book/mooc\"]\n        ],\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              [\"任务点不是顺序执行，如果某一个任务没有动\", \"请查看是否有其他任务正在学习，耐心等待即可。\"],\n              \"闯关模式请注意题库如果没完成，需要自己完成才能解锁章节。\",\n              \"请勿凌晨刷课，部分学校课程可能会清空进度。\",\n              [\"⚠️目前超星倍速风控严重，如果高倍速\", \"完成后被清空还原，请调到1-2倍速学习！\"]\n            ]).outerHTML\n          },\n          playbackRate,\n          volume,\n          videoQuizStrategy: {\n            label: \"视频内题目\",\n            tag: \"select\",\n            options: [\n              [\"random\", \"随机答题\"],\n              [\"ignore\", \"忽略\"]\n            ],\n            attrs: {\n              title: \"视频有时在学习过程中会弹出题目，这个好像并不计算在分数内，所以可以忽略，视频可以正常观看，这里提供几个方法处理题目\"\n            },\n            defaultValue: \"random\"\n          },\n          mode: {\n            label: \"跳转模式\",\n            tag: \"select\",\n            options: [\n              [\"next\", \"完成后跳转下一节\", \"完成小节后，自动点击下一节按钮\"],\n              [\"job\", \"完成后跳转未完成任务点\", \"如果未找到任务点，则会直接结束脚本运行，目前处于试验阶段。\"],\n              [\"manually\", \"完成后暂停，等待手动跳转\", \"适用于自己手动运行\"]\n            ],\n            defaultValue: \"next\"\n          },\n          restudy: {\n            label: \"复习模式\",\n            attrs: { title: \"已经完成的视频继续学习，并从当前的章节往下开始学习\", type: \"checkbox\" },\n            defaultValue: false\n          },\n          forceLearn: {\n            label: \"强制学习\",\n            attrs: {\n              title: \"视频一般分为：非任务点、任务点、和已完成任务点，当遇到“非任务点”时需要开启此选项才会进行学习\",\n              type: \"checkbox\"\n            },\n            defaultValue: false\n          },\n          backToFirstWhenFinish: {\n            label: \"完成全部后重新学习\",\n            attrs: {\n              type: \"checkbox\",\n              title: \"当章节已经学习完成至最后一章时，跳转到第一个章节重新开始学习。\"\n            },\n            defaultValue: false\n          },\n          showTextareaWhenEdit: {\n            label: \"编辑时显示自定义编辑框\",\n            attrs: {\n              type: \"checkbox\",\n              title: \"超星默认禁止在编辑框中复制粘贴，开启此选项可以在文本框编辑时生成一个自定义编辑框进行编辑，脚本会将内容同步到编辑框中。\"\n            },\n            defaultValue: true\n          },\n          notifyWhenHasFaceRecognition: {\n            label: \"出现人脸识别时通知我\",\n            attrs: {\n              type: \"checkbox\"\n            },\n            defaultValue: true\n          },\n          enables: {\n            ...dropdownStyle,\n            label: \"高级设置\",\n            attrs: { type: \"checkbox\" },\n            defaultValue: false\n          },\n          enableMedia: {\n            elementClassName: \"config-details\",\n            showIf: \"cx.new.study.enables\",\n            label: \"视频/音频自动播放\",\n            attrs: { type: \"checkbox\", title: \"开启：音频和视频的自动播放\" },\n            defaultValue: true\n          },\n          enablePPT: {\n            elementClassName: \"config-details\",\n            showIf: \"cx.new.study.enables\",\n            label: \"PPT/书籍自动完成\",\n            attrs: { type: \"checkbox\", title: \"开启：PPT/书籍自动翻阅\" },\n            defaultValue: true\n          },\n          enableChapterTest: {\n            elementClassName: \"config-details\",\n            showIf: \"cx.new.study.enables\",\n            label: \"章节测试自动答题\",\n            attrs: { type: \"checkbox\", title: \"开启：章节测试自动答题\" },\n            defaultValue: true\n          },\n          enableHyperlink: {\n            elementClassName: \"config-details\",\n            showIf: \"cx.new.study.enables\",\n            label: \"链接任务自动完成\",\n            attrs: { type: \"checkbox\", title: \"开启：链接任务自动完成\" },\n            defaultValue: true\n          }\n        },\n        onrender({ panel }) {\n          var _a;\n          if (!((_a = CommonProject.scripts.settings.cfg.answererWrappers) == null ? void 0 : _a.length)) {\n            answerWrapperEmptyWarning(10);\n          }\n          this.offConfigChange(state$3.study.playbackRateWarningListenerId);\n          state$3.study.playbackRateWarningListenerId = this.onConfigChange(\"playbackRate\", (playbackRate2) => {\n            if (playbackRate2 > 2) {\n              lib.$modal.alert({\n                title: \"⚠️高倍速警告\",\n                content: lib.$ui.notes([\n                  \"⚠️高倍速可能导致学习记录清空/回退\",\n                  \"⚠️超星后台可以看到学习时长，请谨慎设置\",\n                  \"⚠️如已清空/回退，请降低倍速至1-2倍\"\n                ]),\n                maskCloseable: false,\n                confirmButtonText: \"我已知晓风险\"\n              });\n            }\n          }) || 0;\n        },\n        async oncomplete() {\n          if (/\\/readsvr\\/book\\/mooc/.test(location.href)) {\n            $console.log(\"正在完成书籍/PPT...\");\n            setTimeout(() => {\n              readweb.goto(epage);\n            }, 5e3);\n            return;\n          }\n          if (/\\/knowledge\\/cards/.test(location.href)) {\n            const updateMediaState = () => {\n              if (top.currentMedia) {\n                top.currentMedia.playbackRate = parseFloat(this.cfg.playbackRate.toString());\n                top.currentMedia.volume = this.cfg.volume;\n              }\n            };\n            this.onConfigChange(\"playbackRate\", updateMediaState);\n            this.onConfigChange(\"volume\", updateMediaState);\n            await study({\n              ...this.cfg,\n              playbackRate: parseFloat(this.cfg.playbackRate.toString()),\n              workOptions: CommonProject.scripts.settings.methods.getWorkOptions()\n            });\n          }\n        }\n      }),\n      work: new lib.Script({\n        name: \"✍️ 作业考试脚本\",\n        matches: [\n          [\"作业页面\", \"/mooc2/work/dowork\"],\n          [\"考试整卷预览页面\", \"/mooc2/exam/preview\"]\n        ],\n        namespace: \"cx.new.work\",\n        configs: { notes: workNotes },\n        async oncomplete() {\n          const isExam2 = /\\/exam\\/preview/.test(location.href);\n          commonWork(this, {\n            workerProvider: (opts) => workOrExam$1(isExam2 ? \"exam\" : \"work\", { ...opts, preview_mode: true }),\n            enable_control_panel: true\n          });\n        }\n      }),\n      autoRead: new lib.Script({\n        name: \"🖥️ 自动阅读\",\n        matches: [\n          [\"阅读页面\", \"/ztnodedetailcontroller/visitnodedetail\"],\n          [\"课程目录\", /chaoxing.com\\/course\\/\\d+\\.html/],\n          [\"课程目录\", /chaoxing.com\\/mooc-ans\\/course\\/\\d+\\.html/]\n        ],\n        namespace: \"cx.new.auto-read\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\"阅读任务次日才会统计阅读时长\"]).outerHTML\n          },\n          restartAfterFinish: {\n            label: \"无限阅读\",\n            attrs: { type: \"checkbox\", title: \"阅读完成最后一章后从头第一章继续阅读\" },\n            defaultValue: false\n          }\n        },\n        oncomplete() {\n          if (location.href.includes(\"/ztnodedetailcontroller/visitnodedetail\") === false) {\n            startAtFirst();\n            return;\n          }\n          let top2 = 0;\n          const interval = setInterval(() => {\n            top2 += (document.documentElement.scrollHeight - window.innerHeight) / 60;\n            window.scrollTo({\n              behavior: \"smooth\",\n              top: top2\n            });\n          }, 1e3);\n          setTimeout(() => {\n            clearInterval(interval);\n            const next2 = lib.$el(\".nodeItem.r i\");\n            if (next2) {\n              next2.click();\n            } else {\n              if (this.cfg.restartAfterFinish) {\n                setTimeout(() => startAtFirst(), 3e3);\n                lib.$message.info({ content: \"即将重新从头开始阅读\", duration: 10 });\n                $console.log(\"即将重新从头开始阅读\");\n              } else {\n                lib.$message.success({ content: \"阅读任务已完成\", duration: 0 });\n                $console.log(\"未检测到下一页\");\n              }\n            }\n          }, (60 + 3) * 1e3);\n          function startAtFirst() {\n            const texts = lib.$$el(\".course_section .chapterText\");\n            if (texts.length) {\n              texts[0].click();\n            }\n          }\n        }\n      }),\n      pageRedirect: new lib.Script({\n        name: \"章节页面自动切换脚本\",\n        matches: [[\"课程任务页面\", \"pageHeader=0\"]],\n        hideInPanel: true,\n        async oncomplete() {\n          if (top === window) {\n            const a = document.querySelector('a[title=\"章节\"]');\n            if (a) {\n              await $.sleep(1e3);\n              a.click();\n              lib.$message.info({\n                content: \"已经为您自动切换到章节列表页面，手动进入任意章节即可开始自动学习！\"\n              });\n            }\n          }\n        }\n      }),\n      versionRedirect: new lib.Script({\n        name: \"版本切换脚本\",\n        matches: [\n          [\"\", \"mooc2=0\"],\n          [\"\", \"mycourse/studentcourse\"],\n          [\"\", \"work/getAllWork\"],\n          [\"\", \"work/doHomeWorkNew\"],\n          [\"\", \"exam/test\\\\?\"],\n          [\"\", \"mooc-ans/mycourse/studentstudy\"]\n        ],\n        hideInPanel: true,\n        async oncomplete() {\n          if (top === window) {\n            lib.$message.warn({\n              content: \"OCS网课助手不支持旧版超星, 即将切换到超星新版, 如有其他第三方插件请关闭, 可能有兼容问题导致频繁切换。\",\n              duration: 0\n            });\n            await $.sleep(2e3);\n            await waitForFaceRecognition();\n            const experience = document.querySelector(\".experience\");\n            if (experience) {\n              experience.click();\n            } else {\n              const newUrl = new URL(window.location.href);\n              if (window.location.href.includes(\"mooc-ans/mycourse/studentstudy\")) {\n                newUrl.pathname = \"/mycourse/studentstudy\";\n              }\n              const params = newUrl.searchParams;\n              let changed = false;\n              if (params.get(\"mooc2\") !== \"1\") {\n                params.set(\"mooc2\", \"1\");\n                changed = true;\n              }\n              if (params.get(\"newMooc\") !== \"true\") {\n                params.set(\"newMooc\", \"true\");\n                changed = true;\n              }\n              if (changed)\n                window.location.replace(newUrl);\n            }\n          }\n        }\n      }),\n      examRedirect: new lib.Script({\n        name: \"考试整卷预览脚本\",\n        matches: [\n          [\"新版考试页面\", \"exam-ans/exam/test/reVersionTestStartNew\"],\n          [\"新版考试页面2\", \"mooc-ans/exam/test/reVersionTestStartNew\"]\n        ],\n        hideInPanel: true,\n        oncomplete() {\n          var _a, _b;\n          if ((_b = (_a = lib.$gm.unsafeWindow.document.querySelector(\".mark_info\")) == null ? void 0 : _a.textContent) == null ? void 0 : _b.includes(\"不允许整卷预览\")) {\n            lib.$message.warn({\n              content: lib.$ui.notes([\n                \"由于当前考试禁止整卷预览，各题为独立新页面，只能一个个答题\",\n                \"在考完前禁止手动切换题目，否则会导致重复答题！\",\n                \"完成后或者开考前请手动删除搜索结果！\",\n                \"想加快速度请更改通用-全局设置-高级设置-搜题间隔，设置为 1-3 秒即可。\"\n              ]),\n              duration: 0\n            });\n            const isExam2 = /\\/exam\\/test/.test(location.href);\n            const workOptions = CommonProject.scripts.settings.methods.getWorkOptions();\n            commonWork(CXProject.scripts.work, {\n              start_delay_seconds: workOptions.period,\n              enable_control_panel: true,\n              workerProvider: (opts) => workOrExam$1(isExam2 ? \"exam\" : \"work\", { ...opts, preview_mode: false, thread: 1 })\n            });\n            return;\n          }\n          lib.$message.info({ content: \"即将跳转到整卷预览页面进行考试。\" });\n          setTimeout(() => lib.$gm.unsafeWindow.topreview(), 3e3);\n        }\n      }),\n      rateHack: new lib.Script({\n        name: \"屏蔽倍速限制\",\n        hideInPanel: true,\n        matches: [[\"\", \"/ananas/modules/video/\"]],\n        onstart() {\n          rateHack();\n        }\n      }),\n      copyHack: new lib.Script({\n        name: \"屏蔽复制粘贴限制\",\n        hideInPanel: true,\n        matches: [[\"所有页面\", /.*/]],\n        methods() {\n          return {\n            hackEditorPaste() {\n              var _a, _b;\n              try {\n                const instants = ((_b = (_a = lib.$gm.unsafeWindow) == null ? void 0 : _a.UE) == null ? void 0 : _b.instants) || [];\n                for (const key in instants) {\n                  const ue = instants[key];\n                  if (ue == null ? void 0 : ue.textarea) {\n                    ue.body.addEventListener(\"click\", async () => {\n                      if (CXProject.scripts.study.cfg.showTextareaWhenEdit) {\n                        const defaultText = lib.h(\"span\", { innerHTML: ue.textarea.value }).textContent;\n                        lib.$modal.prompt({\n                          content: \"请在此文本框进行编辑，防止超星无法复制粘贴。(如需关闭请前往设置: 课程学习-编辑时显示自定义编辑框)\",\n                          width: 800,\n                          inputDefaultValue: defaultText || \"\",\n                          modalInputType: \"textarea\",\n                          onConfirm: (val = \"\") => {\n                            ue.setContent(\n                              val.split(\"\\n\").map((line) => `<p>${line}</p>`).join(\"\")\n                            );\n                          }\n                        });\n                      }\n                    });\n                    if (lib.$gm.unsafeWindow.editorPaste) {\n                      ue.removeListener(\"beforepaste\", lib.$gm.unsafeWindow.editorPaste);\n                    }\n                    if (lib.$gm.unsafeWindow.myEditor_paste) {\n                      ue.removeListener(\"beforepaste\", lib.$gm.unsafeWindow.myEditor_paste);\n                    }\n                  }\n                }\n              } catch {\n              }\n            }\n          };\n        },\n        oncomplete() {\n          const hackInterval = setInterval(() => {\n            if (typeof lib.$gm.unsafeWindow.UE !== \"undefined\") {\n              clearInterval(hackInterval);\n              this.methods.hackEditorPaste();\n              console.log(\"已解除输入框无法复制粘贴限制\");\n            }\n          }, 500);\n        }\n      }),\n      studyDispatcher: new lib.Script({\n        name: \"课程学习调度器\",\n        matches: [[\"课程学习页面\", \"/mycourse/studentstudy\"]],\n        namespace: \"cx.new.study-dispatcher\",\n        hideInPanel: true,\n        async oncomplete() {\n          const restudy2 = CXProject.scripts.study.cfg.restudy;\n          CommonProject.scripts.render.methods.pin(CXProject.scripts.study);\n          let chapters = await CXAnalyses.waitForChapterInfos();\n          if (!restudy2) {\n            const params = new URLSearchParams(window.location.href);\n            const mooc = params.get(\"mooc2\");\n            if (mooc === null) {\n              params.set(\"mooc2\", \"1\");\n              window.location.replace(decodeURIComponent(params.toString()));\n              return;\n            }\n            chapters = chapters.filter((chapter) => chapter.unFinishCount !== 0);\n            if (chapters.length === 0) {\n              lib.$message.warn({ content: \"页面任务点数量为空! 请刷新重试!\" });\n            } else {\n              const params2 = new URLSearchParams(window.location.href);\n              const courseId = params2.get(\"courseId\");\n              const classId = params2.get(\"clazzid\");\n              setTimeout(() => {\n                if (lib.$$el(`.posCatalog_active[id=\"cur${chapters[0].chapterId}\"]`).length === 0) {\n                  lib.$gm.unsafeWindow.getTeacherAjax(courseId, classId, chapters[0].chapterId);\n                  setTimeout(() => {\n                    CXAnalyses.scrollToActiveChapter();\n                  }, 1e3);\n                }\n              }, 1e3);\n            }\n          } else {\n            setTimeout(() => {\n              CXAnalyses.scrollToActiveChapter();\n            }, 1e3);\n          }\n        }\n      }),\n      cxSecretFontRecognize: new lib.Script({\n        name: \"繁体字识别\",\n        hideInPanel: true,\n        matches: [\n          [\"题目页面\", \"work/doHomeWorkNew\"],\n          [\"考试整卷预览\", \"/mooc2/exam/preview\"],\n          [\"作业\", \"/mooc2/work/dowork\"]\n        ],\n        async oncomplete() {\n          await mappingRecognize();\n        }\n      }),\n      jfkGuide: new lib.Script({\n        name: \"💡 积分课使用提示\",\n        matches: [[\"积分课页面\", \"/plaza\"]],\n        namespace: \"cx.jfk.guide\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"积分课请进入课程后，开启复习模式，并且关闭自动下一章\",\n              \"课程完成后请手动切换，如果由脚本进行自动跳转会出现乱跳转的可能。\"\n            ]).outerHTML\n          }\n        },\n        oncomplete(...args) {\n          CommonProject.scripts.render.methods.pin(this);\n        }\n      })\n    }\n  });\n  function workOrExam$1(type = \"work\", {\n    answererWrappers,\n    period,\n    thread,\n    redundanceWordsText,\n    answerSeparators,\n    answerMatchMode,\n    preview_mode\n  }) {\n    lib.$message.info(`开始${type === \"work\" ? \"作业\" : \"考试\"}`);\n    if (preview_mode) {\n      CommonProject.scripts.workResults.methods.init({\n        questionPositionSyncHandlerType: \"cx\"\n      });\n    }\n    const workOrExamQuestionTitleTransform = (titles) => {\n      const optimizationTitle = titles.map((titleElement) => {\n        if (titleElement) {\n          const titleCloneEl = titleElement.cloneNode(true);\n          const childNodes = titleCloneEl.childNodes;\n          childNodes[0].remove();\n          childNodes[0].remove();\n          return optimizationElementWithImage(titleCloneEl, true).innerText;\n        }\n        return \"\";\n      }).join(\",\");\n      return removeRedundantWords(\n        StringUtils.of(optimizationTitle).nowrap(\" \").nospace().toString().trim(),\n        redundanceWordsText.split(\"\\n\")\n      );\n    };\n    const worker = new OCSWorker({\n      root: \".questionLi\",\n      elements: {\n        title: [\n          (root2) => lib.$el(\"h3\", root2)\n        ],\n        options: \".answerBg .answer_p, .textDIV, .eidtDiv\",\n        type: type === \"exam\" ? 'input[name^=\"type\"]' : 'input[id^=\"answertype\"]',\n        lineAnswerInput: \".line_answer input[name^=answer]\",\n        lineSelectBox: \".line_answer_ct .selectBox \",\n        reading: \".reading_answer\",\n        filling: \".filling_answer\"\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        if (elements2.title) {\n          const title = workOrExamQuestionTitleTransform(elements2.title);\n          if (title) {\n            const typeInput = elements2.type[0];\n            return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n              await $.sleep((period != null ? period : 3) * 1e3);\n              return defaultAnswerWrapperHandler(answererWrappers, {\n                type: (typeInput ? getQuestionType(parseInt(typeInput.value)) : void 0) || \"unknown\",\n                title,\n                options: ctx.type === \"completion\" ? \"\" : ctx.elements.options.map((o) => optimizationElementWithImage(o, true).innerText).join(\"\\n\")\n              });\n            });\n          } else {\n            throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n          }\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      work: async (ctx) => {\n        var _a;\n        const { elements: elements2, searchInfos } = ctx;\n        const typeInput = elements2.type[0];\n        const type2 = getQuestionType(parseInt(typeInput.value));\n        if (type2 && (type2 === \"completion\" || type2 === \"multiple\" || type2 === \"judgement\" || type2 === \"single\")) {\n          const resolver = createDefaultQuestionResolver(ctx)[type2];\n          return await resolver(\n            searchInfos,\n            elements2.options.map((option) => optimizationElementWithImage(option)),\n            async (type3, answer, option) => {\n              var _a2, _b, _c;\n              if (type3 === \"judgement\" || type3 === \"single\" || type3 === \"multiple\") {\n                if ((option == null ? void 0 : option.parentElement) && lib.$$el('[class*=\"check_answer\"]', option.parentElement).length === 0) {\n                  option.click();\n                  await $.sleep(500);\n                }\n              } else if (type3 === \"completion\" && answer.trim()) {\n                const text = option == null ? void 0 : option.querySelector(\"textarea\");\n                const textareaFrame = option == null ? void 0 : option.querySelector(\"iframe\");\n                if (text) {\n                  text.value = answer;\n                }\n                if (textareaFrame == null ? void 0 : textareaFrame.contentDocument) {\n                  textareaFrame.contentDocument.body.innerHTML = answer;\n                }\n                if ((_a2 = option == null ? void 0 : option.parentElement) == null ? void 0 : _a2.parentElement) {\n                  (_c = lib.$el(\"[onclick*=saveQuestion]\", (_b = option == null ? void 0 : option.parentElement) == null ? void 0 : _b.parentElement)) == null ? void 0 : _c.click();\n                  await $.sleep(500);\n                }\n              }\n            }\n          );\n        } else if (type2 && type2 === \"line\") {\n          for (const answers of searchInfos.map((info) => info.results.map((res) => res.answer))) {\n            let ans = answers;\n            if (ans.length === 1) {\n              ans = splitAnswer(ans[0]);\n            }\n            if (ans.filter(Boolean).length !== 0 && elements2.lineAnswerInput) {\n              for (let index = 0; index < elements2.lineSelectBox.length; index++) {\n                const box = elements2.lineSelectBox[index];\n                if (ans[index]) {\n                  (_a = lib.$el(`li[data=${ans[index]}] a`, box)) == null ? void 0 : _a.click();\n                  await $.sleep(200);\n                }\n              }\n              return { finish: true };\n            }\n          }\n          return { finish: false };\n        } else if (type2 && type2 === \"fill\") {\n          return readerAndFillHandle(searchInfos, elements2.filling);\n        } else if (type2 && type2 === \"reader\") {\n          return readerAndFillHandle(searchInfos, elements2.reading);\n        }\n        return { finish: false };\n      },\n      async onResultsUpdate(current, _, res) {\n        var _a, _b;\n        if (!preview_mode) {\n          if ((_a = current.result) == null ? void 0 : _a.finish) {\n            await CommonProject.scripts.workResults.methods.appendResults(\n              simplifyWorkResult(res, workOrExamQuestionTitleTransform)\n            );\n            CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n              simplifyWorkResult([current], workOrExamQuestionTitleTransform)\n            );\n          }\n          return;\n        }\n        CommonProject.scripts.workResults.methods.setResults(simplifyWorkResult(res, workOrExamQuestionTitleTransform));\n        CommonProject.scripts.workResults.methods.updateWorkStateByResults(res);\n        if ((_b = current.result) == null ? void 0 : _b.finish) {\n          CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n            simplifyWorkResult([current], workOrExamQuestionTitleTransform)\n          );\n        }\n      }\n    });\n    if (preview_mode) {\n      worker.doWork().then(() => {\n        lib.$message.info({ content: \"作业/考试完成，请自行检查后保存或提交。\", duration: 0 });\n        worker.emit(\"done\");\n      }).catch((err) => {\n        console.error(err);\n        lib.$message.error(\"答题程序发生错误 : \" + err.message);\n      });\n    } else {\n      const getNextBtn = () => document.querySelector('[onclick=\"getTheNextQuestion(1)\"]');\n      let next2 = getNextBtn();\n      (async () => {\n        while (next2 && worker.isClose === false) {\n          await worker.doWork({ enable_debug: true });\n          await $.sleep(1e3);\n          next2 = getNextBtn();\n          next2 == null ? void 0 : next2.click();\n          await $.sleep(1e3);\n        }\n        lib.$message.success({ content: \"作业/考试完成，请自行检查后保存或提交。\", duration: 0 });\n        worker.emit(\"done\");\n        CommonProject.scripts.workResults.cfg.questionPositionSyncHandlerType = \"cx\";\n      })();\n    }\n    return worker;\n  }\n  async function mappingRecognize(doc = document) {\n    var _a, _b;\n    let typrMapping = /* @__PURE__ */ Object.create({});\n    try {\n      top.typrMapping = top.typrMapping || await loadTyprMapping();\n      typrMapping = top.typrMapping;\n    } catch {\n      typrMapping = await loadTyprMapping();\n    }\n    const fontFaceEl = Array.from(doc.head.querySelectorAll(\"style\")).find(\n      (style) => {\n        var _a2;\n        return (_a2 = style.textContent) == null ? void 0 : _a2.includes(\"font-cxsecret\");\n      }\n    );\n    const base64ToUint8Array = (base64) => {\n      const data = window.atob(base64);\n      const buffer = new Uint8Array(data.length);\n      for (let i = 0; i < data.length; ++i) {\n        buffer[i] = data.charCodeAt(i);\n      }\n      return buffer;\n    };\n    const fontMap = typrMapping;\n    if (fontFaceEl && Object.keys(fontMap).length > 0) {\n      const font = (_b = (_a = fontFaceEl.textContent) == null ? void 0 : _a.match(/base64,([\\w\\W]+?)'/)) == null ? void 0 : _b[1];\n      if (font) {\n        $console.log(\"正在识别繁体字\");\n        const code = typr_js.parse(base64ToUint8Array(font));\n        const match = {};\n        for (let i = 19968; i < 40870; i++) {\n          const Glyph = typr_js.U.codeToGlyph(code, i);\n          if (!Glyph)\n            continue;\n          const path = typr_js.U.glyphToPath(code, Glyph);\n          const hex = md5(JSON.stringify(path)).slice(24);\n          match[i.toString()] = fontMap[hex];\n        }\n        const fonts = CXAnalyses.getSecretFont(doc);\n        fonts.forEach((el, index) => {\n          let html = el.innerHTML;\n          for (const key in match) {\n            const word = String.fromCharCode(parseInt(key));\n            const value = String.fromCharCode(match[key]);\n            if (word === value) {\n              continue;\n            }\n            while (html.indexOf(word) !== -1) {\n              html = html.replace(word, value);\n            }\n          }\n          el.innerHTML = html;\n          el.classList.remove(\"font-cxsecret\");\n        });\n        $console.log(\"识别繁体字完成。\");\n      } else {\n        $console.log(\"未检测到繁体字。\");\n      }\n    }\n  }\n  async function loadTyprMapping() {\n    try {\n      $console.log(\"正在加载繁体字库。\");\n      return await request(\"https://cdn.ocsjs.com/resources/font/table.json\", {\n        type: \"GM_xmlhttpRequest\",\n        method: \"get\",\n        responseType: \"json\"\n      });\n    } catch (err) {\n      $console.error(\"载繁体字库加载失败，请刷新页面重试：\", String(err));\n    }\n  }\n  const CXAnalyses = {\n    isInSpecialMode() {\n      return Array.from((top == null ? void 0 : top.document.querySelectorAll(\".catalog_points_sa,.catalog_points_er\")) || []).length !== 0;\n    },\n    async isStuckInBreakingMode() {\n      if (this.isInSpecialMode()) {\n        const chapter = top == null ? void 0 : top.document.querySelector(\".posCatalog_active\");\n        if (chapter) {\n          const id = chapter.getAttribute(\"id\");\n          if (id) {\n            const counter = await lib.$store.getTab(\"chapter_counter\") || /* @__PURE__ */ Object.create({});\n            let count = Reflect.get(counter, id);\n            count = count ? count + 1 : 1;\n            Reflect.set(counter, id, count);\n            let res = false;\n            if (count >= 3) {\n              Reflect.set(counter, id, 1);\n              res = true;\n            }\n            await lib.$store.setTab(\"chapter_counter\", counter);\n            return res;\n          }\n        }\n      }\n      return false;\n    },\n    isInFinalTab() {\n      const tabs = Array.from((top == null ? void 0 : top.document.querySelectorAll(\".prev_ul li\")) || []);\n      if (tabs.length === 0) {\n        return true;\n      }\n      return tabs[tabs.length - 1].classList.contains(\"active\");\n    },\n    isInFinalChapter() {\n      var _a;\n      return (_a = Array.from((top == null ? void 0 : top.document.querySelectorAll(\".posCatalog_select\")) || []).pop()) == null ? void 0 : _a.classList.contains(\"posCatalog_active\");\n    },\n    isFinishedAllChapters() {\n      return this.getChapterInfos().every((chapter) => chapter.unFinishCount === 0);\n    },\n    getChapterInfos() {\n      return Array.from((top == null ? void 0 : top.document.querySelectorAll('[onclick^=\"getTeacherAjax\"]')) || []).map((el) => {\n        var _a, _b, _c;\n        return {\n          element: el,\n          chapterId: (_b = (_a = el.getAttribute(\"onclick\")) == null ? void 0 : _a.match(/\\('(.*)','(.*)','(.*)'\\)/)) == null ? void 0 : _b[3],\n          unFinishCount: parseInt(((_c = el.parentElement.querySelector(\".jobUnfinishCount\")) == null ? void 0 : _c.value) || \"0\")\n        };\n      });\n    },\n    scrollToActiveChapter() {\n      const activeChapter = top == null ? void 0 : top.document.querySelector(\".posCatalog_active\");\n      if (activeChapter) {\n        activeChapter.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n      }\n    },\n    waitForChapterInfos(timeout = 10) {\n      return new Promise((resolve, reject) => {\n        const interval = setInterval(() => {\n          const res = this.getChapterInfos();\n          if (res.length > 0) {\n            clearInterval(interval);\n            clearInterval(to);\n            resolve(res);\n          }\n        }, 1e3);\n        const to = setTimeout(() => {\n          clearInterval(interval);\n          resolve([]);\n        }, timeout * 1e3);\n      });\n    },\n    getSecretFont(doc = document) {\n      return Array.from(doc.querySelectorAll(\".font-cxsecret\")).map((font) => {\n        const after = font.querySelector(\".after\");\n        return after === null ? font : after;\n      });\n    },\n    isCurrentChapterFinished() {\n      const job = top == null ? void 0 : top.document.querySelector(\".posCatalog_active\");\n      if (job) {\n        if (job.querySelector(\".icon_Completed\") !== null) {\n          return true;\n        }\n      }\n      return false;\n    }\n  };\n  function rateHack() {\n    state$3.study.hacked = false;\n    let dragCount = 0;\n    try {\n      hack();\n      window.document.addEventListener(\"readystatechange\", hack);\n      window.addEventListener(\"load\", hack);\n    } catch (e) {\n      console.error(e);\n    }\n    function hack() {\n      const videojs = lib.$gm.unsafeWindow.videojs;\n      const Ext = lib.$gm.unsafeWindow.Ext;\n      if (typeof videojs !== \"undefined\" && typeof Ext !== \"undefined\") {\n        if (state$3.study.hacked) {\n          return;\n        }\n        state$3.study.hacked = true;\n        const _origin = videojs.getPlugin(\"seekBarControl\");\n        const plugin = videojs.extend(videojs.getPlugin(\"plugin\"), {\n          constructor: function(videoExt, data) {\n            const _sendLog = data.sendLog;\n            data.sendLog = (...args) => {\n              var _a;\n              if (args[1] === \"drag\") {\n                dragCount++;\n                if (dragCount > 100) {\n                  dragCount = 0;\n                  (_a = lib.$el(\"video\")) == null ? void 0 : _a.pause();\n                }\n              } else {\n                _sendLog.apply(data, args);\n              }\n            };\n            _origin.apply(_origin.prototype, [videoExt, data]);\n          }\n        });\n        videojs.registerPlugin(\"seekBarControl\", plugin);\n        Ext.define(\"ans.VideoJs\", {\n          override: \"ans.VideoJs\",\n          constructor: function(data) {\n            this.addEvents([\"seekstart\"]);\n            this.mixins.observable.constructor.call(this, data);\n            const vjs = videojs(data.videojs, this.params2VideoOpt(data.params), function() {\n            });\n            Ext.fly(data.videojs).on(\"contextmenu\", function(f) {\n              f.preventDefault();\n            });\n            Ext.fly(data.videojs).on(\"keydown\", function(f) {\n              if (f.keyCode === 32 || f.keyCode === 37 || f.keyCode === 39 || f.keyCode === 107) {\n                f.preventDefault();\n              }\n            });\n            if (vjs.videoJsResolutionSwitcher) {\n              vjs.on(\"resolutionchange\", function() {\n                const cr = vjs.currentResolution();\n                const re2 = cr.sources ? cr.sources[0].res : false;\n                Ext.setCookie(\"resolution\", re2);\n              });\n            }\n            if (vjs.videoJsPlayLine) {\n              vjs.on(\"playlinechange\", function() {\n                const cp = vjs.currentPlayline();\n                Ext.setCookie(\"net\", cp.net);\n              });\n            }\n          }\n        });\n      }\n    }\n  }\n  async function study(opts) {\n    var _a;\n    await $.sleep(3e3);\n    const searchedJobs = [];\n    let searching = true;\n    let attachmentCount = ((_a = lib.$gm.unsafeWindow.attachments) == null ? void 0 : _a.length) || 0;\n    setTimeout(() => {\n      searching = false;\n    }, 10 * 1e3);\n    const runJobs = async () => {\n      const job = searchJob(opts, searchedJobs);\n      if (job && job.func) {\n        try {\n          await job.func();\n        } catch (e) {\n          $console.error(\"未知错误\", e);\n        }\n        await $.sleep(1e3);\n        await runJobs();\n      } else if (attachmentCount > 0) {\n        attachmentCount--;\n        await $.sleep(1e3);\n        await runJobs();\n      } else if (searching) {\n        await $.sleep(1e3);\n        await runJobs();\n      }\n    };\n    await runJobs();\n    top._preChapterId = \"\";\n    const next2 = async () => {\n      if (CXAnalyses.isInFinalTab()) {\n        if (await CXAnalyses.isStuckInBreakingMode()) {\n          return lib.$modal.alert({\n            content: \"检测到此章节重复进入, 为了避免无限重复, 请自行手动完成后手动点击下一章, 或者刷新重试。\"\n          });\n        }\n      }\n      if (CXAnalyses.isInFinalChapter()) {\n        let content = \"\";\n        if (opts.backToFirstWhenFinish) {\n          content = \"已经抵达最后一个章节，10秒后返回第一个章节重新开始。\";\n          setTimeout(() => {\n            var _a2;\n            (_a2 = top == null ? void 0 : top.document.querySelector(\".posCatalog_name\")) == null ? void 0 : _a2.click();\n          }, 10 * 1e3);\n          lib.$message.info({ content, duration: 30 });\n        } else {\n          if (CXAnalyses.isFinishedAllChapters()) {\n            content = \"全部任务点已完成！\";\n          } else {\n            content = \"已经抵达最后一个章节！但仍然有任务点未完成，请手动切换至未完成的章节。\";\n          }\n          lib.$modal.alert({ content });\n        }\n        CommonProject.scripts.settings.methods.notificationBySetting(content, {\n          duration: 0,\n          extraTitle: \"超星学习通学习脚本\"\n        });\n        return;\n      }\n      if (CXProject.scripts.study.cfg.mode === \"job\") {\n        if (CXAnalyses.isInFinalTab()) {\n          const elements2 = CXAnalyses.getChapterInfos().filter((el) => {\n            var _a2;\n            return el.unFinishCount > 0 || ((_a2 = el.element.parentElement) == null ? void 0 : _a2.classList.contains(\"posCatalog_active\"));\n          }).map((el) => el.element.parentElement);\n          if (elements2.length === 0) {\n            const content = \"全部任务点已完成！\";\n            lib.$modal.alert({ content });\n            CommonProject.scripts.settings.methods.notificationBySetting(content, {\n              duration: 0,\n              extraTitle: \"超星学习通学习脚本\"\n            });\n            return;\n          }\n          let nextChapter = elements2[0];\n          const currentIndex = elements2.findIndex((el) => el.classList.contains(\"posCatalog_active\"));\n          if (currentIndex !== -1 && currentIndex + 1 < elements2.length) {\n            nextChapter = elements2[currentIndex + 1];\n            CXAnalyses.scrollToActiveChapter();\n            setTimeout(() => {\n              var _a2;\n              (_a2 = nextChapter.querySelector(\".posCatalog_name\")) == null ? void 0 : _a2.click();\n            }, 1e3);\n          }\n        }\n      } else if (CXProject.scripts.study.cfg.mode === \"next\") {\n        const curCourseId = lib.$el(\"#curCourseId\", top == null ? void 0 : top.document);\n        const curChapterId = lib.$el(\"#curChapterId\", top == null ? void 0 : top.document);\n        const curClazzId = lib.$el(\"#curClazzId\", top == null ? void 0 : top.document);\n        const count = lib.$$el(\"#prev_tab .prev_ul li\", top == null ? void 0 : top.document);\n        if (curChapterId && curCourseId && curClazzId) {\n          top._preChapterId = curChapterId.value;\n          CXAnalyses.scrollToActiveChapter();\n          await $.sleep(200);\n          top == null ? void 0 : top.PCount.next(count.length.toString(), curChapterId.value, curCourseId.value, curClazzId.value, \"\");\n        } else {\n          $console.warn(\"参数错误，无法跳转下一章，请尝试手动切换。\");\n        }\n      } else {\n        $console.warn(\"未知的跳转模式，请联系作者反馈\");\n      }\n    };\n    if (CXProject.scripts.study.cfg.mode !== \"manually\") {\n      const msg = \"页面任务点已完成，即将跳转。\";\n      lib.$message.success({ content: msg });\n      $console.info(msg);\n      await $.sleep(5e3);\n      next2();\n    } else {\n      const msg = \"页面任务点已完成，自动跳转已关闭，请手动跳转。\";\n      lib.$message.warn({ content: msg, duration: 0 });\n      $console.warn(msg);\n    }\n  }\n  function searchIFrame(root2) {\n    var _a, _b;\n    let list = Array.from(root2.querySelectorAll(\"iframe\"));\n    const result = [];\n    while (list.length) {\n      const frame = list.shift();\n      try {\n        if (frame && ((_a = frame == null ? void 0 : frame.contentWindow) == null ? void 0 : _a.document)) {\n          result.push(frame);\n          const frames = (_b = frame == null ? void 0 : frame.contentWindow) == null ? void 0 : _b.document.querySelectorAll(\"iframe\");\n          list = list.concat(Array.from(frames || []));\n        }\n      } catch (e) {\n        console.log(e.message);\n      }\n    }\n    return result;\n  }\n  function searchJob(opts, searchedJobs) {\n    const knowCardWin = lib.$gm.unsafeWindow;\n    const searchJobElement = (root2) => {\n      return domSearch(\n        {\n          videojs: \"#video,#audio\",\n          chapterTest: \".TiMu\",\n          read: \"#img.imglook\",\n          pptWithAudio: \".swiper-container\",\n          hyperlink: \"#hyperlink\"\n        },\n        root2.contentWindow.document\n      );\n    };\n    const search = (root2) => {\n      var _a, _b, _c, _d;\n      const win = root2.contentWindow;\n      const { videojs, read, chapterTest, hyperlink, pptWithAudio } = searchJobElement(root2);\n      if (win && (videojs || read || chapterTest || hyperlink || pptWithAudio)) {\n        const frame_data_str = ((_a = win.frameElement) == null ? void 0 : _a.getAttribute(\"data\")) || ((_d = (_c = (_b = win.frameElement) == null ? void 0 : _b.contentWindow) == null ? void 0 : _c.parent.frameElement) == null ? void 0 : _d.getAttribute(\"data\")) || \"{}\";\n        const frame_data = JSON.parse(frame_data_str);\n        const target_jobid = frame_data.jobid || frame_data._jobid;\n        if (!target_jobid) {\n          return;\n        }\n        const attachment = knowCardWin.attachments.find((attachment2) => {\n          const attachment_jobid = attachment2.jobid || attachment2.property._jobid;\n          if (!attachment_jobid) {\n            return false;\n          }\n          return String(attachment_jobid) === String(target_jobid);\n        });\n        if (attachment && searchedJobs.find((job2) => job2.mid === attachment.property.mid) === void 0) {\n          const { name, title, bookname, author } = attachment.property;\n          const jobName = name || title || (bookname ? bookname + author : void 0) || \"未知任务\";\n          const work_type = attachment.job ? \"job\" : attachment.isPassed ? \"finished\" : \"not-job\";\n          let func;\n          if (videojs) {\n            if (!CXProject.scripts.study.cfg.enableMedia) {\n              const msg = `音视频自动学习功能已被关闭（在上方菜单栏，超星学习通-课程学习中开启）。${jobName} 即将跳过`;\n              lib.$message.warn({ content: msg, duration: 10 });\n              $console.warn(msg);\n            } else {\n              if (work_type === \"job\" || work_type === \"finished\" && opts.restudy || work_type === \"not-job\" && opts.forceLearn) {\n                func = () => {\n                  const msg = `即将${work_type === \"finished\" && opts.restudy ? \"重新\" : work_type === \"not-job\" && opts.forceLearn ? \"强制\" : \"\"}播放 : ` + jobName;\n                  lib.$message.info({ content: msg });\n                  $console.log(msg);\n                  return JobRunner.media(opts, win.document);\n                };\n              }\n            }\n          } else if (chapterTest) {\n            if (!CXProject.scripts.study.cfg.enableChapterTest) {\n              const msg = `章节测试自动答题功能已被关闭（在上方菜单栏，超星学习通-课程学习中开启）。${jobName} 即将跳过`;\n              lib.$message.warn({ content: msg, duration: 10 });\n              $console.warn(msg);\n            } else {\n              const status = win.document.querySelector(\".testTit_status\");\n              if (status == null ? void 0 : status.classList.contains(\"testTit_status_complete\")) {\n                const msg = `章节测试已完成 : ` + jobName;\n                lib.$message.success({ content: msg });\n                $console.log(msg);\n              } else {\n                if (work_type === \"job\" || work_type === \"not-job\" && CommonProject.scripts.settings.cfg[\"work-when-no-job\"]) {\n                  func = () => {\n                    const msg = `开始答题 : ` + jobName;\n                    lib.$message.info({ content: msg });\n                    $console.log(msg);\n                    return JobRunner.chapter(root2, opts.workOptions);\n                  };\n                }\n                if (work_type === \"not-job\" && CommonProject.scripts.settings.cfg[\"work-when-no-job\"] === false) {\n                  const msg = `当前作业 ${jobName} 不是任务点，但待完成，如需开启自动答题请前往：通用-全局设置，开启强制答题。`;\n                  lib.$message.warn({ content: msg });\n                  $console.warn(msg);\n                }\n              }\n            }\n          } else if (read || pptWithAudio) {\n            if (!CXProject.scripts.study.cfg.enablePPT) {\n              const msg = `PPT/书籍阅读功能已被关闭（在上方菜单栏，超星学习通-课程学习中开启）。${jobName} 即将跳过`;\n              lib.$message.warn({ content: msg, duration: 10 });\n              $console.warn(msg);\n            } else {\n              if (attachment.job) {\n                func = () => {\n                  const msg = `正在学习 : ` + jobName;\n                  lib.$message.info({ content: msg });\n                  $console.log(msg);\n                  if (read) {\n                    return JobRunner.read(win);\n                  } else {\n                    return JobRunner.readPPTWithAudio(win);\n                  }\n                };\n              }\n            }\n          } else if (hyperlink) {\n            if (!CXProject.scripts.study.cfg.enableHyperlink) {\n              const msg = `链接任务点已被关闭（在上方菜单栏，超星学习通-课程学习中开启）。${jobName} 即将跳过`;\n              lib.$message.warn({ content: msg, duration: 10 });\n              $console.warn(msg);\n            } else {\n              if (attachment.job) {\n                func = () => {\n                  const msg = `正在完成链接阅读任务 : ` + jobName;\n                  lib.$message.info({ content: msg });\n                  $console.log(msg);\n                  return JobRunner.hyperlink(hyperlink);\n                };\n              }\n            }\n          }\n          const job2 = {\n            mid: attachment.property.mid,\n            attachment,\n            func\n          };\n          searchedJobs.push(job2);\n          return job2;\n        }\n      }\n    };\n    let job;\n    for (const iframe of searchIFrame(knowCardWin.document)) {\n      job = search(iframe);\n      if (job) {\n        return job;\n      }\n    }\n    return job;\n  }\n  function fixedVideoProgress() {\n    if (state$3.study.videojs) {\n      const { bar } = domSearch({ bar: \".vjs-control-bar\" }, state$3.study.videojs);\n      if (bar) {\n        bar.style.opacity = \"1\";\n      }\n    }\n  }\n  const JobRunner = {\n    async media(setting, doc) {\n      const { playbackRate: playbackRate2 = 1, volume: volume2 = 0 } = setting;\n      const media = await waitForMedia({ root: doc });\n      const { videojs } = domSearch({ videojs: \"#video,#audio\" }, doc);\n      if (!videojs || !media) {\n        $console.error(\"视频检测不到，请尝试刷新或者手动切换下一章。\");\n        return;\n      }\n      state$3.study.videojs = videojs;\n      top.currentMedia = media;\n      fixedVideoProgress();\n      if (setting.videoQuizStrategy === \"random\") {\n        const loop = async () => {\n          var _a;\n          const submitBtn = () => doc.querySelector(\"#videoquiz-submit\");\n          if (submitBtn()) {\n            const list = Array.from(doc.querySelectorAll(\".ans-videoquiz-opt label\"));\n            const answer = list[Math.floor(Math.random() * list.length)];\n            answer == null ? void 0 : answer.click();\n            (_a = submitBtn()) == null ? void 0 : _a.click();\n            await $.sleep(3e3);\n            const container2 = doc.querySelector(\"#video .ans-videoquiz\");\n            const components = Array.from(doc.querySelectorAll(\".x-component-default\"));\n            if (container2) {\n              container2.remove();\n            }\n            if (components.length) {\n              for (const com of components) {\n                com.style.display = \"none\";\n              }\n            }\n          }\n          await $.sleep(3e3);\n          await loop();\n        };\n        loop();\n      }\n      return new Promise((resolve, reject) => {\n        const reloadInterval = setInterval(() => {\n          const errorDiv = doc.querySelector(\".vjs-modal-dialog-content\");\n          if ([\"视频文件损坏\", \"网络错误导致视频下载中途失败\", \"视频因格式不支持\", \"网络的问题无法加载\"].some(\n            (s) => errorDiv == null ? void 0 : errorDiv.innerText.includes(s)\n          )) {\n            $console.error(\"检测到视频加载失败，即将跳过视频。\");\n            lib.$message.error(\"检测到视频加载失败，即将跳过视频。\");\n            setTimeout(resolve, 3e3);\n          }\n        }, 3e3);\n        const playFunction = async () => {\n          if (hasFaceRecognition())\n            await waitForFaceRecognition();\n          if (hasNewFaceRecognition())\n            await waitForNewFaceRecognition();\n          if (media.ended === false) {\n            await $.sleep(1e3);\n            media.play();\n            media.playbackRate = playbackRate2;\n          }\n        };\n        media.addEventListener(\"pause\", playFunction);\n        media.addEventListener(\"ended\", () => {\n          media.removeEventListener(\"pause\", playFunction);\n          $console.log(\"视频播放完毕\");\n          clearInterval(reloadInterval);\n          resolve();\n        });\n        $console.log(\"视频开始播放\");\n        media.volume = volume2;\n        media.currentTime = 0;\n        setTimeout(() => {\n          playMedia(() => media.play()).then(() => {\n            media.playbackRate = playbackRate2;\n          }).catch(reject);\n        }, 200);\n      });\n    },\n    async read(win) {\n      const finishJob = win.finishJob;\n      if (finishJob)\n        finishJob();\n      await $.sleep(3e3);\n    },\n    async chapter(frame, {\n      answererWrappers,\n      period,\n      upload,\n      thread,\n      stopSecondWhenFinish,\n      redundanceWordsText,\n      answerSeparators,\n      answerMatchMode\n    }) {\n      if (answererWrappers === void 0 || answererWrappers.length === 0) {\n        return answerWrapperEmptyWarning(0);\n      }\n      $console.info(\"开始章节测试\");\n      const visual_state = CommonProject.scripts.render.cfg.visual;\n      const frameWindow = frame.contentWindow;\n      const { TiMu } = domSearchAll({ TiMu: \".TiMu\" }, frameWindow.document);\n      CORSUtils.panelNormal();\n      CommonProject.scripts.workResults.methods.init();\n      CORSUtils.pinWorkPanel();\n      const chapterTestTaskQuestionTitleTransform = (titles) => {\n        const removed = removeRedundantWords(\n          titles.map((t2) => t2 ? optimizationElementWithImage(t2, true).innerText : \"\").join(\",\"),\n          redundanceWordsText.split(\"\\n\")\n        );\n        return removed.trim().replace(/^\\d+[。、.]/, \"\").replace(/（\\d+\\.\\d+分）/, \"\").replace(/\\(..题, \\d+?分\\)/, \"\").replace(/\\(..题, \\d+\\.\\d+分\\)/, \"\").replace(/[[(【（](..题|名词解释|完形填空|阅读理解)[\\])】）]/, \"\").trim();\n      };\n      const worker = new OCSWorker({\n        root: TiMu,\n        elements: {\n          title: \".Zy_TItle .clearfix\",\n          options: \"ul li .after,ul li textarea,ul textarea,ul li label:not(.before)\",\n          type: 'input[id^=\"answertype\"]',\n          lineAnswerInput: \".line_answer input[name^=answer]\",\n          lineSelectBox: \".line_answer_ct .selectBox \"\n        },\n        thread: thread != null ? thread : 1,\n        answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n        answerMatchMode,\n        answerer: (elements2, ctx) => {\n          const title = chapterTestTaskQuestionTitleTransform(elements2.title);\n          if (title) {\n            const typeInput = elements2.type[0];\n            return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n              await $.sleep((period != null ? period : 3) * 1e3);\n              return defaultAnswerWrapperHandler(answererWrappers, {\n                type: (typeInput ? getQuestionType(parseInt(typeInput.value)) : void 0) || \"unknown\",\n                title,\n                options: ctx.type === \"completion\" ? \"\" : ctx.elements.options.map((o) => optimizationElementWithImage(o, true).innerText).join(\"\\n\")\n              });\n            });\n          } else {\n            throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n          }\n        },\n        work: async (ctx) => {\n          var _a;\n          const { elements: elements2, searchInfos } = ctx;\n          const typeInput = elements2.type[0];\n          const type = typeInput ? getQuestionType(parseInt(typeInput.value)) : void 0;\n          if (type && (type === \"completion\" || type === \"multiple\" || type === \"judgement\" || type === \"single\")) {\n            const resolver = createDefaultQuestionResolver(ctx)[type];\n            const handler = (type2, answer, option, ctx2) => {\n              var _a2, _b, _c, _d, _e, _f, _g;\n              if (type2 === \"judgement\" || type2 === \"single\" || type2 === \"multiple\") {\n                const checked = ((_b = (_a2 = option == null ? void 0 : option.parentElement) == null ? void 0 : _a2.querySelector(\"label input\")) == null ? void 0 : _b.getAttribute(\"checked\")) === \"checked\" || ((_c = option == null ? void 0 : option.parentElement) == null ? void 0 : _c.getAttribute(\"aria-checked\")) === \"true\";\n                if (checked)\n                  ;\n                else {\n                  option == null ? void 0 : option.click();\n                }\n              } else if (type2 === \"completion\" && answer.trim()) {\n                const text = (_d = option == null ? void 0 : option.parentElement) == null ? void 0 : _d.querySelector(\"textarea\");\n                const textareaFrame = (_e = option == null ? void 0 : option.parentElement) == null ? void 0 : _e.querySelector(\"iframe\");\n                if (text) {\n                  text.value = answer;\n                }\n                if (textareaFrame == null ? void 0 : textareaFrame.contentDocument) {\n                  textareaFrame.contentDocument.body.innerHTML = answer;\n                }\n                if ((_f = option == null ? void 0 : option.parentElement) == null ? void 0 : _f.parentElement) {\n                  (_g = lib.$el(\"[onclick*=saveQuestion]\", option.parentElement.parentElement)) == null ? void 0 : _g.click();\n                }\n              }\n            };\n            return await resolver(\n              searchInfos,\n              elements2.options.map((option) => optimizationElementWithImage(option)),\n              handler\n            );\n          } else if (type && type === \"line\") {\n            for (const answers of searchInfos.map((info) => info.results.map((res) => res.answer))) {\n              let ans = answers;\n              if (ans.length === 1) {\n                ans = splitAnswer(ans[0]);\n              }\n              if (ans.filter(Boolean).length !== 0 && elements2.lineAnswerInput) {\n                for (let index = 0; index < elements2.lineSelectBox.length; index++) {\n                  const box = elements2.lineSelectBox[index];\n                  if (ans[index]) {\n                    (_a = lib.$el(`li[data=${ans[index]}] a`, box)) == null ? void 0 : _a.click();\n                    await $.sleep(200);\n                  }\n                }\n                return { finish: true };\n              }\n            }\n            return { finish: false };\n          }\n          return { finish: false };\n        },\n        async onResultsUpdate(curr, _, res) {\n          var _a, _b, _c, _d, _e, _f, _g, _h, _i, _j;\n          CommonProject.scripts.workResults.methods.setResults(\n            simplifyWorkResult(res, chapterTestTaskQuestionTitleTransform)\n          );\n          if ((_a = curr.result) == null ? void 0 : _a.finish) {\n            CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n              simplifyWorkResult([curr], chapterTestTaskQuestionTitleTransform)\n            );\n          }\n          CommonProject.scripts.workResults.methods.updateWorkStateByResults(res);\n          if (((_b = curr.result) == null ? void 0 : _b.finish) === false && curr.resolved === true) {\n            const options = ((_d = (_c = curr.ctx) == null ? void 0 : _c.elements) == null ? void 0 : _d.options) || [];\n            const typeInput = (_f = (_e = curr.ctx) == null ? void 0 : _e.elements) == null ? void 0 : _f.type[0];\n            const type = typeInput ? getQuestionType(parseInt(typeInput.value)) : void 0;\n            const commonSetting = CommonProject.scripts.settings.cfg;\n            if (commonSetting[\"randomWork-choice\"] && (type === \"judgement\" || type === \"single\" || type === \"multiple\")) {\n              $console.log(\"正在随机作答\");\n              const option = options[Math.floor(Math.random() * options.length)];\n              (_h = (_g = option == null ? void 0 : option.parentElement) == null ? void 0 : _g.querySelector(\"a,label\")) == null ? void 0 : _h.click();\n            } else if (commonSetting[\"randomWork-complete\"] && type === \"completion\") {\n              $console.log(\"正在随机作答\");\n              for (const option of options) {\n                const textarea = (_i = option == null ? void 0 : option.parentElement) == null ? void 0 : _i.querySelector(\"textarea\");\n                const completeTexts = commonSetting[\"randomWork-completeTexts-textarea\"].split(\"\\n\").filter(Boolean);\n                const text = completeTexts[Math.floor(Math.random() * completeTexts.length)];\n                const textareaFrame = (_j = option == null ? void 0 : option.parentElement) == null ? void 0 : _j.querySelector(\"iframe\");\n                if (text) {\n                  if (textarea) {\n                    textarea.value = text;\n                  }\n                  if (textareaFrame == null ? void 0 : textareaFrame.contentDocument) {\n                    textareaFrame.contentDocument.body.innerHTML = text;\n                  }\n                } else {\n                  $console.error(\"请设置随机填空的文案\");\n                }\n                await $.sleep(500);\n              }\n            }\n          }\n        },\n        async onElementSearched(elements2) {\n          const typeInput = elements2.type[0];\n          const type = typeInput ? getQuestionType(parseInt(typeInput.value)) : void 0;\n          if (type === \"judgement\") {\n            elements2.options.forEach((option) => {\n              var _a;\n              const opt = ((_a = option == null ? void 0 : option.textContent) == null ? void 0 : _a.trim()) || \"\";\n              if (opt.includes(\"对\") || opt.includes(\"错\"))\n                ;\n              else if (opt === \"True\") {\n                option.textContent = \"√\";\n              } else if (opt === \"False\") {\n                option.textContent = \"x\";\n              } else if (opt === \"對\") {\n                option.textContent = \"√\";\n              } else if (opt === \"錯\") {\n                option.textContent = \"x\";\n              } else {\n                const ri = option.querySelector(\".ri\");\n                const span = document.createElement(\"span\");\n                span.innerText = ri ? \"√\" : \"×\";\n                option.appendChild(span);\n              }\n            });\n          }\n        }\n      });\n      const results = await worker.doWork();\n      const msg = `答题完成，将等待 ${stopSecondWhenFinish} 秒后进行保存或提交。`;\n      $console.info(msg);\n      lib.$message.info({ content: msg, duration: stopSecondWhenFinish });\n      await $.sleep(stopSecondWhenFinish * 1e3);\n      await worker.uploadHandler({\n        type: upload,\n        results,\n        async callback(finishedRate, uploadable) {\n          const msg2 = `完成率 ${finishedRate.toFixed(2)}% :  ${uploadable ? \"3秒后将自动提交\" : \"3秒后将自动保存\"} `;\n          $console.info(msg2);\n          lib.$message.success({ content: msg2, duration: 3 });\n          await $.sleep(3e3);\n          if (uploadable) {\n            frameWindow.btnBlueSubmit();\n            await $.sleep(3e3);\n            frameWindow.submitCheckTimes();\n            top.$(\"#workpop\").hide();\n          } else {\n            frameWindow.alert = () => {\n            };\n            frameWindow.noSubmit();\n          }\n        }\n      });\n      if (visual_state === \"minimize\" && CommonProject.scripts.render.cfg.visual !== \"minimize\") {\n        CORSUtils.panelMinimize();\n      }\n      worker.emit(\"done\");\n    },\n    async readPPTWithAudio(win) {\n      var _a;\n      win.document.querySelectorAll(\"audio\").forEach((audio) => {\n        audio.addEventListener(\"play\", () => {\n          audio.muted = true;\n        });\n      });\n      const len = win.document.querySelectorAll(\".swiper-container .swiper-slide\").length;\n      for (let index = 0; index < len; index++) {\n        (_a = win.swiperNext) == null ? void 0 : _a.call(win);\n        await $.sleep(1e3);\n      }\n      await $.sleep(3e3);\n    },\n    async hyperlink(a) {\n      const _click = a.onclick;\n      a.onclick = () => false;\n      a.click();\n      a.onclick = _click;\n      await $.sleep(3e3);\n    }\n  };\n  function getQuestionType(val) {\n    return val === 0 ? \"single\" : val === 1 ? \"multiple\" : val === 3 ? \"judgement\" : [2, 4, 5, 6, 7, 8, 9, 10].some((t2) => t2 === val) ? \"completion\" : val === 11 ? \"line\" : val === 14 ? \"fill\" : val === 15 ? \"reader\" : void 0;\n  }\n  async function readerAndFillHandle(searchInfos, list) {\n    var _a;\n    for (const answers of searchInfos.map((info) => info.results.map((res) => res.answer))) {\n      let ans = answers;\n      if (ans.length === 1) {\n        ans = splitAnswer(ans[0]);\n      }\n      if (ans.filter(Boolean).length !== 0 && list.length !== 0) {\n        for (let index = 0; index < ans.length; index++) {\n          const item = list[index];\n          if (item) {\n            (_a = lib.$el(`span.saveSingleSelect[data=\"${ans[index]}\"]`, item)) == null ? void 0 : _a.click();\n            await $.sleep(200);\n          }\n        }\n        return { finish: true };\n      }\n    }\n    return { finish: false };\n  }\n  function hasFaceRecognition() {\n    const faces = lib.$$el(\"#fcqrimg\", top == null ? void 0 : top.document);\n    let active = false;\n    for (const face of faces) {\n      const src2 = face.getAttribute(\"src\");\n      if (src2) {\n        active = true;\n        break;\n      }\n    }\n    return active;\n  }\n  function hasNewFaceRecognition() {\n    const faces = lib.$$el(\".chapterVideoFaceMaskDiv\", top == null ? void 0 : top.document);\n    let active = false;\n    for (const face of faces) {\n      if (face.style.display !== \"none\") {\n        active = true;\n        break;\n      }\n    }\n    return active;\n  }\n  function waitForNewFaceRecognition() {\n    let notified = false;\n    return new Promise((resolve) => {\n      const interval = setInterval(() => {\n        const active = hasNewFaceRecognition();\n        if (active) {\n          if (!notified) {\n            notified = true;\n            const msg = \"检测到人脸识别，请手动进行识别后脚本才会继续运行。\";\n            if (CXProject.scripts.study.cfg.notifyWhenHasFaceRecognition) {\n              CommonProject.scripts.settings.methods.notificationBySetting(msg, { duration: 0 });\n            }\n            lib.$message.warn({ content: msg, duration: 0 });\n            $console.warn(msg);\n          }\n        } else {\n          clearInterval(interval);\n          resolve();\n        }\n      }, 3e3);\n    });\n  }\n  function waitForFaceRecognition() {\n    let notified = false;\n    return new Promise((resolve) => {\n      const interval = setInterval(() => {\n        const active = hasFaceRecognition();\n        if (active) {\n          if (!notified) {\n            notified = true;\n            const msg = \"检测到人脸识别，请手动进行识别后脚本才会继续运行。\";\n            if (CXProject.scripts.study.cfg.notifyWhenHasFaceRecognition) {\n              CommonProject.scripts.settings.methods.notificationBySetting(msg, { duration: 0 });\n            }\n            lib.$message.warn({ content: msg, duration: 0 });\n            $console.warn(msg);\n          }\n        } else {\n          clearInterval(interval);\n          resolve();\n        }\n      }, 3e3);\n    });\n  }\n  const CORSUtils = {\n    pinWorkPanel: lib.cors.defineTopFunction(() => {\n      CommonProject.scripts.render.methods.pin(CommonProject.scripts.workResults);\n    }),\n    panelNormal: lib.cors.defineTopFunction(() => {\n      CommonProject.scripts.render.methods.normal();\n    }),\n    panelMinimize: lib.cors.defineTopFunction(() => {\n      CommonProject.scripts.render.methods.minimize();\n    })\n  };\n  const state$2 = {\n    study: {\n      currentMedia: void 0,\n      currentStudyLockId: 0,\n      playbackRateWarningListenerId: 0,\n      courseLengthListenerId: 0\n    }\n  };\n  const $msg_and_log$1 = (type, msg) => {\n    lib.$message[type](msg);\n    $console[type](msg);\n  };\n  const _StudyLock = class {\n    constructor() {\n      _StudyLock.auto_inc++;\n      this.id = _StudyLock.auto_inc;\n      state$2.study.currentStudyLockId = this.id;\n    }\n    canStudy() {\n      return this.id === state$2.study.currentStudyLockId;\n    }\n    static getLock() {\n      return new _StudyLock();\n    }\n  };\n  let StudyLock = _StudyLock;\n  StudyLock.auto_inc = 0;\n  const IcveMoocProject = lib.Project.create({\n    name: \"智慧职教\",\n    domains: [\n      \"icve.com.cn\",\n      \"ai.icve.com.cn\",\n      \"course.icve.com.cn\",\n      \"courshare.cn\",\n      \"webtrn.cn\"\n    ],\n    scripts: {\n      guide: new lib.Script({\n        name: \"💡 使用提示\",\n        matches: [\n          [\"个人首页\", \"icve.com.cn/studycenter\"],\n          [\"学习页面\", \"icve.com.cn/study/directory\"],\n          [\"MOOC学院-个人首页\", \"user.icve.com.cn\"],\n          [\"MOOC学院-首页\", \"mooc.icve.com.cn\"]\n        ],\n        namespace: \"icve.guide\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\"请点击任意课程进入\", \"进入课程后点击任意章节进入，即可自动学习\"]).outerHTML\n          }\n        },\n        oncomplete() {\n          CommonProject.scripts.render.methods.pin(this);\n        }\n      }),\n      studyCenter: new lib.Script({\n        name: \"🖥️ 智慧职教-学习中心\",\n        namespace: \"icve.study.center\",\n        matches: [\n          [\"学习中心页面\", \"/study/directory/dir_course.html\"],\n          [\"课程列表\", \"icve.com.cn/study/directory/directory_list.html\"]\n        ],\n        configs: {\n          playbackRate,\n          volume,\n          currentCourseUrlList: {\n            defaultValue: []\n          }\n        },\n        async oncomplete() {\n          if (location.href.includes(\"icve.com.cn/study/directory/directory_list.html\")) {\n            await waitForElement(\".h_cells a\");\n            this.cfg.currentCourseUrlList = Array.from(document.querySelectorAll(\".h_cells a\")).map(\n              (a) => a.href\n            );\n            return;\n          }\n          if (this.cfg.currentCourseUrlList.length === 0) {\n            try {\n              const url = \"https://www.icve.com.cn/study/directory/directory_list.html?courseId=\" + new URL(location.href).searchParams.get(\"courseId\");\n              const res = await fetch(url).then((res2) => res2.text());\n              const doc = new DOMParser().parseFromString(res, \"text/html\");\n              this.cfg.currentCourseUrlList = Array.from(doc.querySelectorAll(\".h_cells a\")).map(\n                (a) => a.href\n              );\n            } catch (e) {\n              console.error(e);\n              lib.$message.error(\"课程列表获取失败，请刷新页面重试。\");\n              return;\n            }\n          }\n          CommonProject.scripts.render.methods.pin(this);\n          this.onConfigChange(\"playbackRate\", (playbackRate2) => {\n            state$2.study.currentMedia && (state$2.study.currentMedia.playbackRate = parseFloat(playbackRate2.toString()));\n          });\n          this.onConfigChange(\"volume\", (v) => state$2.study.currentMedia && (state$2.study.currentMedia.volume = v));\n          const study2 = async () => {\n            var _a;\n            const res = await Promise.race([waitForElement(\"video, audio\"), waitForElement(\".docBox\")]);\n            if (res) {\n              const jobName = ((_a = document.querySelector(\".tabsel.seled\")) == null ? void 0 : _a.getAttribute(\"title\")) || \"-\";\n              lib.$message.info(\"开始任务：\" + jobName);\n              $console.log(`任务 ${jobName} 开始。`);\n              if (document.querySelector(\"video, audio\")) {\n                const media = await waitForMedia();\n                state$2.study.currentMedia = media;\n                media.volume = this.cfg.volume;\n                await new Promise((resolve, reject) => {\n                  try {\n                    console.log(document.hasFocus());\n                    window.focus();\n                    lib.$gm.unsafeWindow.jwplayer().onComplete(async () => {\n                      $console.log(\"视频/音频播放完成。\");\n                      await $.sleep(3e3);\n                      resolve();\n                    });\n                    const play = () => {\n                      lib.$gm.unsafeWindow.jwplayer().play();\n                      lib.$gm.unsafeWindow.jwplayer().play();\n                      media.playbackRate = parseFloat(this.cfg.playbackRate.toString());\n                    };\n                    media.addEventListener(\"pause\", async () => {\n                      if (!media.ended) {\n                        await $.sleep(1e3);\n                        playMedia(play);\n                      }\n                    });\n                    playMedia(play);\n                  } catch (err) {\n                    reject(err);\n                  }\n                });\n              }\n              lib.$message.success(`任务 ${jobName} 完成，三秒后下一章`);\n              $console.log(`任务 ${jobName} 完成，三秒后下一章`);\n            } else {\n              $console.error(`不支持的任务页面，请跟作者进行反馈。三秒后下一章`);\n            }\n            await $.sleep(3e3);\n            next2();\n          };\n          const next2 = () => {\n            for (let index = 0; index < this.cfg.currentCourseUrlList.length; index++) {\n              const url = this.cfg.currentCourseUrlList[index];\n              const nextUrl = this.cfg.currentCourseUrlList[index + 1];\n              if (new URL(url).hash === new URL(location.href).hash) {\n                if (!nextUrl) {\n                  lib.$modal.alert({ content: \"全部任务已完成\" });\n                  CommonProject.scripts.settings.methods.notificationBySetting(\"全部任务点已完成！\", {\n                    duration: 0,\n                    extraTitle: \"智慧职教学习脚本\"\n                  });\n                  return;\n                } else {\n                  window.location.href = this.cfg.currentCourseUrlList[index + 1];\n                }\n              }\n            }\n          };\n          study2();\n        }\n      }),\n      study: new lib.Script({\n        name: \"🖥️ MOOC学院-课程学习\",\n        namespace: \"icve.study.main\",\n        matches: [[\"课程学习页面\", \"/learnspace/learn/learn/templateeight/index.action\"]],\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"如果视频无法播放，可以手动点击其他任务跳过视频。\",\n              \"经过测试视频倍速最多二倍，否则会判定无效。\",\n              \"手动进入作业页面才能使用自动答题。\"\n            ]).outerHTML\n          },\n          playbackRate,\n          volume,\n          restudy,\n          showScrollBar: {\n            label: \"显示右侧滚动条\",\n            attrs: { type: \"checkbox\" },\n            defaultValue: true\n          },\n          expandAll: {\n            label: \"展开所有章节\",\n            attrs: { type: \"checkbox\" },\n            defaultValue: true\n          },\n          switchPeriod: {\n            label: \"下一章节切换间隔（秒）\",\n            defaultValue: 10,\n            attrs: {\n              type: \"number\",\n              min: 0,\n              max: 999,\n              step: 1\n            }\n          }\n        },\n        onrender() {\n          this.offConfigChange(state$2.study.playbackRateWarningListenerId);\n          state$2.study.playbackRateWarningListenerId = this.onConfigChange(\"playbackRate\", (playbackRate2) => {\n            if (playbackRate2 > 4) {\n              lib.$modal.alert({\n                title: \"⚠️高倍速警告\",\n                content: lib.$ui.notes([\"高倍速可能导致视频无法完成！\"])\n              });\n            }\n          }) || 0;\n        },\n        async oncomplete() {\n          var _a;\n          CommonProject.scripts.render.methods.pin(this);\n          await $.sleep(3e3);\n          this.onConfigChange(\"volume\", (v) => state$2.study.currentMedia && (state$2.study.currentMedia.volume = v));\n          this.onConfigChange(\n            \"playbackRate\",\n            (r) => state$2.study.currentMedia && (state$2.study.currentMedia.playbackRate = parseFloat(r.toString()))\n          );\n          const mainContentWin = (_a = lib.$el(\"#mainContent\")) == null ? void 0 : _a.contentWindow;\n          if (mainContentWin) {\n            lib.$modal.confirm({\n              content: lib.h(\"div\", [\n                \"是否开始自动学习当前章节？\",\n                lib.h(\"br\"),\n                \"你也可以选择任意的章节进行点击，脚本会自动学习，并一直往下寻找章节。\"\n              ]),\n              cancelButtonText: \"我想手动选择章节\",\n              confirmButtonText: \"开始学习\",\n              async onConfirm() {\n                study2(StudyLock.getLock());\n                scrollToJob();\n              }\n            });\n          }\n          if (this.cfg.showScrollBar) {\n            const bar = lib.$el(\".dumascroll_area\", mainContentWin.document);\n            bar && (bar.style.overflow = \"auto\");\n          }\n          if (this.cfg.expandAll) {\n            lib.$$el(\".s_sectionlist,.s_sectionwrap\", mainContentWin.document).forEach((el) => el.style.display = \"block\");\n          }\n          for (const job of lib.$$el(\".s_point[itemtype]\", mainContentWin.document)) {\n            job.addEventListener(\"click\", (e) => {\n              const lock = StudyLock.getLock();\n              if (e.isTrusted) {\n                if (job.getAttribute(\"itemtype\") === \"exam\") {\n                  return lib.$message.info({\n                    duration: 60,\n                    content: \"检测到您手动选择了作业/考试章节，将不会自动跳转，请完成后手动选择其他章节，脚本会自动学习。\"\n                  });\n                } else {\n                  lib.$message.info(\"检测到章节切换，即将自动学习...\");\n                }\n              }\n              setTimeout(() => {\n                study2(lock);\n              }, 3e3);\n            });\n          }\n          const scrollToJob = () => {\n            var _a2;\n            return (_a2 = lib.$el(\".s_pointerct\", mainContentWin.document)) == null ? void 0 : _a2.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n          };\n          const study2 = async (studyLock) => {\n            var _a2;\n            const iframe = lib.$el(\"iframe\", mainContentWin.document);\n            const win = iframe == null ? void 0 : iframe.contentWindow;\n            if (win) {\n              const doc = win.document;\n              if (iframe.src.includes(\"content_video.action\") || iframe.src.includes(\"content_audio.action\")) {\n                $console.log(\"视频/音频播放中...\");\n                try {\n                  const media = await waitForMedia({ root: doc });\n                  state$2.study.currentMedia = media;\n                  media.playbackRate = parseFloat(this.cfg.playbackRate.toString());\n                  media.volume = this.cfg.volume;\n                  media.currentTime = 0;\n                  await new Promise((resolve, reject) => {\n                    try {\n                      win.jwplayer().onComplete(async () => {\n                        $console.log(\"视频/音频播放完成。\");\n                        await $.sleep(3e3);\n                        resolve();\n                      });\n                      media.addEventListener(\"pause\", async () => {\n                        if (!media.ended) {\n                          await Promise.race([\n                            waitForPopupQuestion(doc),\n                            handleContinueDialog()\n                          ]);\n                          await $.sleep(1e3);\n                          playMedia(() => media.play());\n                        }\n                      });\n                      playMedia(() => media.play());\n                    } catch (err) {\n                      reject(err);\n                    }\n                  });\n                } catch (err) {\n                  lib.$message.error(String(err));\n                }\n              } else if (iframe.src.includes(\"content_doc.action\")) {\n                await $.sleep(5e3);\n              }\n            }\n            $console.log(this.cfg.switchPeriod + \" 秒后切换下一章节。\");\n            await $.sleep(this.cfg.switchPeriod * 1e3);\n            if (studyLock.canStudy()) {\n              let nextEl;\n              let isBellowCurrentJob = false;\n              const jobs = lib.$$el(\".s_point[itemtype]\", mainContentWin.document);\n              for (let index = 0; index < jobs.length; index++) {\n                const job = jobs[index];\n                if (job.classList.contains(\"s_pointerct\")) {\n                  isBellowCurrentJob = true;\n                } else if (isBellowCurrentJob) {\n                  if (job.querySelector(\".done_icon_show\") === null || this.cfg.restudy) {\n                    $console.log(\"下一章：\", job.title || ((_a2 = lib.$el(\".s_pointti\", job)) == null ? void 0 : _a2.title) || \"未知\");\n                    nextEl = job;\n                    break;\n                  }\n                }\n              }\n              if (nextEl) {\n                nextEl.click();\n                scrollToJob();\n              } else {\n                lib.$modal.alert({ content: \"全部任务已完成\" });\n                CommonProject.scripts.settings.methods.notificationBySetting(\"全部任务点已完成！\", {\n                  duration: 0,\n                  extraTitle: \"智慧职教学习脚本\"\n                });\n              }\n            }\n          };\n        }\n      }),\n      work: new lib.Script({\n        name: \"✍️ 作业考试脚本\",\n        matches: [[\"作业考试页面\", \"/exam\"]],\n        namespace: \"icve.work\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"自动答题前请在 “通用-全局设置” 中设置题库配置。\",\n              \"可以搭配 “通用-在线搜题” 一起使用。\",\n              \"请手动进入作业考试页面才能使用自动答题。\"\n            ]).outerHTML\n          }\n        },\n        async oncomplete() {\n          lib.$message.warn({ content: \"自动答题时请勿切换题目，否则可能导致重复搜题或者脚本卡主。\", duration: 0 });\n          const resetToBegin = () => {\n            var _a;\n            (_a = document.querySelectorAll(`.sheet_nums [id*=\"sheetSeq\"]`).item(0)) == null ? void 0 : _a.click();\n          };\n          commonWork(this, {\n            workerProvider: work,\n            beforeRunning: async () => {\n              resetToBegin();\n              await $.sleep(1e3);\n            },\n            onRestart: () => resetToBegin()\n          });\n        }\n      }),\n      workDispatcher: new lib.Script({\n        name: \"作业调度脚本\",\n        matches: [\n          [\"作业进入页面\", \"/platformwebapi/student/exam/\"],\n          [\"确认作业页面\", \"/student/exam/studentExam_studentInfo.action\"]\n        ],\n        hideInPanel: true,\n        oncomplete() {\n          if (/\\/platformwebapi\\/student\\/exam/.test(window.location.href)) {\n            lib.cors.on(\"icve-work-start\", () => {\n              setTimeout(() => {\n                lib.$gm.unsafeWindow.openExamInfo();\n              }, 3e3);\n            });\n          }\n          if (/\\/student\\/exam\\/studentExam_studentInfo.action/.test(window.location.href)) {\n            setTimeout(() => {\n              lib.$gm.unsafeWindow.enterExamPage();\n            }, 3e3);\n          }\n        }\n      }),\n      \"ai-study\": new lib.Script({\n        name: \"🖥️ AI课程\",\n        namespace: \"icve.ai.study\",\n        matches: [\n          [\"课程页面\", \"ai.icve.com.cn/app/coursedetails-excellent\"],\n          [\"学习页面\", \"ai.icve.com.cn/excellent-study\"]\n        ],\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              [\n                \"如果脚本卡死或者您不想学习，\",\n                \"可以点击其他任意章节继续进行学习。\",\n                \"PPT请勿加快点击，否则可能无法记录学习进度。\"\n              ]\n            ]).outerHTML\n          },\n          volume,\n          playbackRate: {\n            label: \"视频倍速\",\n            tag: \"select\",\n            options: [1, 1.25, 1.5, 1.75, 2, 2.25, 2.5, 2.75, 3, 3.5, 4, 6, 8, 16].map((rate) => [\n              rate.toString(),\n              rate + \" x\"\n            ]),\n            defaultValue: \"1\"\n          },\n          autoOpenAllChapter: {\n            label: \"自动打开全部章节\",\n            attrs: {\n              title: \"如果没有打开全部章节，那么当任务点达到当前章节最后一个时将无法跳转到其他章节列表！\",\n              type: \"checkbox\"\n            },\n            defaultValue: true\n          },\n          restudy\n        },\n        onhistorychange(type) {\n          if (type !== \"replace\") {\n            return;\n          }\n          if (location.href.includes(\"kcnr\")) {\n            location.reload();\n          }\n        },\n        async oncomplete(type) {\n          CommonProject.scripts.render.methods.pin(this);\n          this.onConfigChange(\"volume\", (val) => {\n            if (state$2.study.currentMedia) {\n              state$2.study.currentMedia.volume = parseFloat(val.toString());\n            }\n          });\n          this.onConfigChange(\"playbackRate\", (val) => {\n            if (state$2.study.currentMedia) {\n              state$2.study.currentMedia.playbackRate = parseFloat(val.toString());\n            }\n          });\n          const waitForLoad2 = () => {\n            return new Promise((resolve) => {\n              const check = () => {\n                if (document.querySelector(\".contentBox\")) {\n                  resolve();\n                } else {\n                  setTimeout(check, 100);\n                }\n              };\n              check();\n            });\n          };\n          const closeStudyContinueDialog = () => {\n            return new Promise((resolve) => {\n              let stop = false;\n              const check = () => {\n                var _a, _b;\n                if (document.querySelector(\".el-message-box__wrapper\")) {\n                  (_a = lib.$el(\".el-message-box__wrapper\")) == null ? void 0 : _a.remove();\n                  (_b = lib.$el(\".v-modal\")) == null ? void 0 : _b.remove();\n                  resolve();\n                } else {\n                  !stop && setTimeout(check, 100);\n                }\n              };\n              check();\n              setTimeout(() => {\n                stop = true;\n                resolve();\n              }, 3 * 1e3);\n            });\n          };\n          await waitForLoad2();\n          await closeStudyContinueDialog();\n          await waitForLoad2();\n          await $.sleep(3e3);\n          $msg_and_log$1(\"info\", \"即将打开全部章节列表，请稍等\");\n          const openAllChapter = async () => {\n            var _a;\n            const model = lib.$modal.simple({\n              maskCloseable: false,\n              footer: void 0,\n              content: \"正在展开全部章节列表，请耐心等待不要操作...\"\n            });\n            const titles = Array.from(document.querySelectorAll(\".one-title\")).filter(\n              (el) => !el.querySelector(\".zhankai\")\n            );\n            const waitForChapterOpen = (title) => {\n              return new Promise((resolve) => {\n                let stop = false;\n                const check = () => {\n                  var _a2;\n                  const parent = (_a2 = title.parentElement) == null ? void 0 : _a2.parentElement;\n                  const content = parent == null ? void 0 : parent.querySelector(\".panel-content\");\n                  if ((content == null ? void 0 : content.style.display) !== \"none\" && ((content == null ? void 0 : content.querySelectorAll(\".node\").length) || 0) > 0) {\n                    resolve();\n                  } else {\n                    !stop && setTimeout(check, 100);\n                  }\n                };\n                check();\n                setTimeout(() => {\n                  stop = true;\n                  resolve();\n                }, 10 * 1e3);\n              });\n            };\n            for (const title of titles) {\n              try {\n                (_a = title.querySelector(\".jiantou\")) == null ? void 0 : _a.click();\n                title.focus();\n                title.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n                await waitForChapterOpen(title);\n                await $.sleep(1e3);\n              } catch (e) {\n                $console.error(\"打开章节失败\", e);\n              }\n            }\n            model == null ? void 0 : model.remove();\n          };\n          if (this.cfg.autoOpenAllChapter)\n            await openAllChapter();\n          let study_id = \"\";\n          document.querySelectorAll(\".node\").forEach((el) => {\n            el.addEventListener(\"click\", () => {\n              study2(study_id = Math.random().toString(36).substr(2, 9));\n            });\n          });\n          const study2 = async (id) => {\n            var _a;\n            $msg_and_log$1(\"info\", \"即将开始学习：\" + (((_a = lib.$el(\".contentBox\")) == null ? void 0 : _a.__vue__.nrdata.name) || \"未知任务点\"));\n            await $.sleep(3e3);\n            await (async () => {\n              var _a2;\n              const active = document.querySelector(\".panelList .node.active\");\n              active == null ? void 0 : active.focus();\n              active == null ? void 0 : active.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n              if ((active == null ? void 0 : active.querySelector(\".wc\")) && !this.cfg.restudy) {\n                return $msg_and_log$1(\"info\", \"当前任务已完成，即将跳过\");\n              }\n              const vue = (_a2 = lib.$el(\".FilePreview\")) == null ? void 0 : _a2.__vue__;\n              const img = lib.$el(\".ql-editor\");\n              const work2 = lib.$el(\".shiti\");\n              if (work2) {\n                return $msg_and_log$1(\"warn\", \"检测到当前为作业任务，请完成课程后手动进入自动答题。\");\n              } else if (img) {\n                return $msg_and_log$1(\"warn\", \"检测到当前为图片任务，即将跳过\");\n              } else {\n                if (!vue) {\n                  return lib.$message.error({ content: \"获取课程数据失败，或者未知任务点，即将跳过\" });\n                }\n                const watchOffice = async () => {\n                  const total = vue.photoList.length;\n                  for (let index = 0; index < total + 1; index++) {\n                    if (id !== study_id)\n                      return;\n                    vue.next();\n                    await $.sleep(3e3);\n                  }\n                };\n                lib.$message.info(\"开始学习\");\n                if ([\"video\", \"audio\"].includes(vue.curType)) {\n                  await closeStudyContinueDialog();\n                  await watchMedia$2();\n                } else if ([\"office\", \"ppt\"].includes(vue.curType)) {\n                  await watchOffice();\n                  if (id !== study_id)\n                    return;\n                  await $.sleep(1e3);\n                } else {\n                  $msg_and_log$1(\"warn\", \"未知的任务点，即将跳过\");\n                }\n              }\n            })();\n            if (id !== study_id)\n              return;\n            const next2 = getNext();\n            if (!next2) {\n              return $msg_and_log$1(\"warn\", \"没有找到下一章节！\");\n            }\n            $msg_and_log$1(\"info\", \"即将进入下一章节\");\n            await $.sleep(3e3);\n            if (id !== study_id)\n              return;\n            next2.click();\n          };\n          const getNext = () => {\n            const list = Array.from(document.querySelectorAll(\".panelList .node\"));\n            for (let index = 0; index < list.length; index++) {\n              const element = list[index];\n              if (element.classList.contains(\"active\")) {\n                return list[index + 1];\n              }\n            }\n          };\n          study2(study_id);\n        }\n      }),\n      \"ai-work\": new lib.Script({\n        name: \"✍️ AI作业\",\n        namespace: \"icve.ai.work\",\n        matches: [[\"作业页面\", \"ai.icve.com.cn/preview-exam\"]],\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"自动答题前请在 “通用-全局设置” 中设置题库配置。\",\n              \"可以搭配 “通用-在线搜题” 一起使用。\",\n              \"请手动进入作业考试页面才能使用自动答题。\",\n              \"自动答题时请勿切换题目，否则可能导致重复搜题或者脚本卡主！\"\n            ]).outerHTML\n          }\n        },\n        oncomplete() {\n          lib.$message.warn({ content: \"自动答题时请勿切换题目，否则可能导致重复搜题或者脚本卡主。\", duration: 0 });\n          const resetToBegin = () => {\n            var _a;\n            (_a = document.querySelectorAll(`.list-box span`).item(0)) == null ? void 0 : _a.click();\n          };\n          commonWork(this, {\n            workerProvider: aiWork,\n            beforeRunning: async () => {\n              resetToBegin();\n              await $.sleep(1e3);\n            },\n            onRestart: () => resetToBegin()\n          });\n        }\n      })\n    }\n  });\n  async function watchMedia$2() {\n    const media = await waitForMedia();\n    media.volume = parseFloat(IcveMoocProject.scripts[\"ai-study\"].cfg.volume.toString());\n    media.playbackRate = parseFloat(IcveMoocProject.scripts[\"ai-study\"].cfg.playbackRate.toString());\n    state$2.study.currentMedia = media;\n    const success = await playMedia(() => media.play());\n    if (!success) {\n      return;\n    }\n    return new Promise((resolve, reject) => {\n      media.addEventListener(\"ended\", () => {\n        resolve();\n      });\n      media.addEventListener(\"pause\", () => {\n        setTimeout(() => {\n          if (media.ended) {\n            resolve();\n          } else if (media.paused) {\n            media.play();\n            media.volume = parseFloat(IcveMoocProject.scripts[\"ai-study\"].cfg.volume.toString());\n            media.playbackRate = parseFloat(IcveMoocProject.scripts[\"ai-study\"].cfg.playbackRate.toString());\n          }\n        }, 1e3);\n      });\n    });\n  }\n  function work({ answererWrappers, period, thread, answerSeparators, answerMatchMode }) {\n    lib.$message.info(\"开始作业\");\n    CommonProject.scripts.workResults.methods.init();\n    console.log({ answererWrappers, period, thread });\n    const titleTransform = (titles) => {\n      return titles.filter((t2) => t2 == null ? void 0 : t2.innerText).map((t2) => {\n        var _a, _b;\n        if (t2) {\n          const title = t2.cloneNode(true);\n          (_a = title.querySelector('[name*=\"questionIndex\"]')) == null ? void 0 : _a.remove();\n          (_b = title.querySelector(\".q_score\")) == null ? void 0 : _b.remove();\n          return title.innerText.trim().replace(/^、/, \"\") || \"\";\n        }\n        return \"\";\n      }).join(\",\");\n    };\n    const workResults = [];\n    let totalQuestionCount = 0;\n    let requestedCount = 0;\n    let resolvedCount = 0;\n    function getType(options) {\n      const radio_len = options.map((o) => o.querySelector('[type=\"radio\"]')).reduce((a, b) => {\n        return a + (b ? 1 : 0);\n      }, 0);\n      return radio_len > 0 ? radio_len === 2 ? \"judgement\" : \"single\" : options.some((o) => o.querySelector('[type=\"checkbox\"]')) ? \"multiple\" : options.some((o) => o.querySelector(\"textarea\")) ? \"completion\" : options.some((o) => o.querySelector(\".fillblank_input input\")) ? \"fill-blank\" : void 0;\n    }\n    const worker = new OCSWorker({\n      root: \".q_content\",\n      elements: {\n        title: '.divQuestionTitle, [name=\"fillblankTitle\"]',\n        options: \".questionOptions .q_option, .questionOptions.divTextarea, .answerOption\"\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        const title = titleTransform(elements2.title);\n        if (title) {\n          return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n            await $.sleep((period != null ? period : 3) * 1e3);\n            return defaultAnswerWrapperHandler(answererWrappers, {\n              type: getType(ctx.elements.options) || \"unknown\",\n              title,\n              options: ctx.elements.options.map((o) => o.innerText).join(\"\\n\")\n            });\n          });\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      async work(ctx) {\n        const options = ctx.elements.options;\n        const type = getType(options);\n        if (!type) {\n          throw new Error(\"无法获取题目类型！\");\n        }\n        if (type === \"fill-blank\") {\n          const inputs = options.map((o) => Array.from(o.querySelectorAll(\".fillblank_input input\"))).flat();\n          for (const searchInfo of ctx.searchInfos) {\n            for (const result of searchInfo.results) {\n              const answers = splitAnswer(result.answer);\n              if (answers.length === inputs.length) {\n                for (let index = 0; index < inputs.length; index++) {\n                  inputs[index].value = answers[index];\n                }\n                return { finish: true };\n              }\n            }\n          }\n        } else {\n          const resolver = createDefaultQuestionResolver(ctx)[type];\n          const res = await resolver(ctx.searchInfos, ctx.elements.options, (type2, answer, option) => {\n            var _a, _b;\n            if (type2 === \"judgement\" || type2 === \"single\" || type2 === \"multiple\") {\n              if (option.querySelector(\".checkbox_on\") === null) {\n                (_a = lib.$el(\"div\", option)) == null ? void 0 : _a.click();\n              }\n            } else if (type2 === \"completion\" && answer.trim()) {\n              const text = option.querySelector(\"textarea\");\n              const textIframe = option.querySelector('iframe[id*=\"ueditor\"]');\n              if (text) {\n                text.value = answer;\n              }\n              if (textIframe) {\n                const view = (_b = textIframe.contentWindow) == null ? void 0 : _b.document.querySelector(\"body.view > p\");\n                if (view) {\n                  view.innerText = answer;\n                }\n              }\n            }\n          });\n          return res;\n        }\n        return { finish: false };\n      },\n      onElementSearched(elements2, root2) {\n        console.log(\"elements\", elements2);\n      },\n      onResultsUpdate(currentResult) {\n        var _a;\n        if (currentResult.resolved) {\n          workResults.push(...simplifyWorkResult([currentResult], titleTransform));\n          CommonProject.scripts.workResults.methods.setResults(workResults);\n          totalQuestionCount++;\n          requestedCount++;\n          resolvedCount++;\n          if ((_a = currentResult.result) == null ? void 0 : _a.finish) {\n            CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n              simplifyWorkResult([currentResult], titleTransform)\n            );\n          }\n          CommonProject.scripts.workResults.methods.updateWorkState({\n            totalQuestionCount,\n            requestedCount,\n            resolvedCount\n          });\n        }\n      }\n    });\n    const getNextBtn = () => document.querySelector(\".paging_next\");\n    let next2 = getNextBtn();\n    (async () => {\n      while (next2 && worker.isClose === false) {\n        await worker.doWork({ enable_debug: true });\n        await $.sleep(1e3);\n        next2 = getNextBtn();\n        if (next2.style.display === \"none\") {\n          break;\n        } else {\n          next2 == null ? void 0 : next2.click();\n          await $.sleep(1e3);\n        }\n      }\n      lib.$message.success({ content: \"作业/考试完成，请自行检查后保存或提交。\", duration: 0 });\n      worker.emit(\"done\");\n      CommonProject.scripts.workResults.cfg.questionPositionSyncHandlerType = \"icve\";\n    })();\n    return worker;\n  }\n  function aiWork({ answererWrappers, period, thread, answerSeparators, answerMatchMode }) {\n    lib.$message.info(\"开始作业\");\n    CommonProject.scripts.workResults.methods.init();\n    console.log({ answererWrappers, period, thread });\n    const titleTransform = (titles) => {\n      return titles.filter((t2) => t2 == null ? void 0 : t2.innerText).map((t2) => {\n        if (t2) {\n          return t2.innerText.trim();\n        }\n        return \"\";\n      }).join(\",\");\n    };\n    const workResults = [];\n    let totalQuestionCount = 0;\n    let requestedCount = 0;\n    let resolvedCount = 0;\n    function getType(options) {\n      const radio_len = options.map((o) => o.querySelector('[type=\"radio\"]')).reduce((a, b) => {\n        return a + (b ? 1 : 0);\n      }, 0);\n      return radio_len > 0 ? radio_len === 2 ? \"judgement\" : \"single\" : options.some((o) => o.querySelector('[type=\"checkbox\"]')) ? \"multiple\" : options.some((o) => o.querySelector(\"textarea\")) ? \"completion\" : options.some((o) => o.querySelector(\".fillblank_input input\")) ? \"fill-blank\" : void 0;\n    }\n    const worker = new OCSWorker({\n      root: \".content-item\",\n      elements: {\n        title: \".questions-content [class*=title-content]\",\n        options: \"label[class*=group-item]\"\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        const title = titleTransform(elements2.title);\n        if (title) {\n          return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n            await $.sleep((period != null ? period : 3) * 1e3);\n            return defaultAnswerWrapperHandler(answererWrappers, {\n              type: getType(ctx.elements.options) || \"unknown\",\n              title,\n              options: ctx.elements.options.map((o) => o.innerText).join(\"\\n\")\n            });\n          });\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      work: {\n        async handler(type, answer, option, ctx) {\n          if (type === \"judgement\" || type === \"single\" || type === \"multiple\") {\n            if (option.querySelector(\".ivu-radio-checked\") === null) {\n              option == null ? void 0 : option.click();\n            }\n          } else if (type === \"completion\" && answer.trim())\n            ;\n        }\n      },\n      onElementSearched(elements2, root2) {\n        console.log(\"elements\", elements2);\n      },\n      onResultsUpdate(currentResult) {\n        var _a;\n        if (currentResult.resolved) {\n          workResults.push(...simplifyWorkResult([currentResult], titleTransform));\n          CommonProject.scripts.workResults.methods.setResults(workResults);\n          totalQuestionCount++;\n          requestedCount++;\n          resolvedCount++;\n          if ((_a = currentResult.result) == null ? void 0 : _a.finish) {\n            CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(\n              simplifyWorkResult([currentResult], titleTransform)\n            );\n          }\n          CommonProject.scripts.workResults.methods.updateWorkState({\n            totalQuestionCount,\n            requestedCount,\n            resolvedCount\n          });\n        }\n      }\n    });\n    const getNextBtn = () => document.querySelector(\"div.center_btn > button:nth-child(2)\");\n    let next2 = getNextBtn();\n    (async () => {\n      while (next2 && worker.isClose === false) {\n        await worker.doWork({ enable_debug: true });\n        await $.sleep(1e3);\n        next2 = getNextBtn();\n        if (next2.getAttribute(\"disabled\")) {\n          break;\n        } else {\n          next2 == null ? void 0 : next2.click();\n          await $.sleep(1e3);\n        }\n      }\n      lib.$message.success({ content: \"作业/考试完成，请自行检查后保存或提交。\", duration: 0 });\n      worker.emit(\"done\");\n      CommonProject.scripts.workResults.cfg.questionPositionSyncHandlerType = \"icve\";\n    })();\n    return worker;\n  }\n  function waitForPopupQuestion(dom2) {\n    return new Promise((resolve) => {\n      const interval = setInterval(() => {\n        var _a, _b;\n        const el = lib.$el(\".popup-test\", dom2);\n        if (el) {\n          clearInterval(interval);\n          const right_answer = ((_a = lib.$el(\"#right_answer\", el)) == null ? void 0 : _a.value) || \"A\";\n          for (const answer of right_answer.split(\"\")) {\n            const item = lib.$el(`li.test-item-cell[curval=\"${answer}\"]`, el);\n            item == null ? void 0 : item.click();\n          }\n          (_b = lib.$el('[name=\"save_btn\"]', el)) == null ? void 0 : _b.click();\n          setTimeout(() => {\n            var _a2;\n            (_a2 = lib.$el('[name=\"continue_btn\"]', el)) == null ? void 0 : _a2.click();\n            resolve();\n          }, 3e3);\n        }\n      }, 1e3);\n      setTimeout(() => {\n        clearInterval(interval);\n        resolve();\n        console.log(\"未找到弹窗，继续执行\");\n      }, 60 * 1e3);\n    });\n  }\n  function handleContinueDialog() {\n    return new Promise((resolve, reject) => {\n      const interval = setInterval(() => {\n        const el = document.querySelector(\".layui-layer-btn0\");\n        if (el) {\n          el.click();\n          setTimeout(() => {\n            clearInterval(interval);\n            resolve();\n          }, 1e3);\n        }\n      }, 3e3);\n      setTimeout(() => {\n        clearInterval(interval);\n        resolve();\n        console.log(\"未找到弹窗，继续执行\");\n      }, 60 * 1e3);\n    });\n  }\n  const state$1 = {\n    studying: false,\n    studyingId: \"\",\n    media: null\n  };\n  const work_pages = [\n    [\"资源库keep作业页面\", \"study/spockeepTest\"],\n    [\"资源库job作业页面\", \"study/spocjobTest\"],\n    [\"资源库考试\", \"study/spoctest\"],\n    [\"作业页面\", \"icve-study/coursePreview/jobTes\"],\n    [\"考试页面\", \"icve-study/coursePreview/test\"],\n    [\"考试页面\", \"icve-study/test\"],\n    [\"资源库测验页面\", \"icve-study/coursePreview/keepTest\"]\n  ];\n  const isWork = () => {\n    return window.location.href.includes(\"icve-study/coursePreview/jobTes\") || window.location.href.includes(\"icve-study/coursePreview/keepTest\") || window.location.href.includes(\"study/spockeepTest\") || window.location.href.includes(\"study/spocjobTest\");\n  };\n  const isExam = () => {\n    return window.location.href.includes(\"icve-study/coursePreview/test\") || window.location.href.includes(\"icve-study/test\") || window.location.href.includes(\"study/spoctest\");\n  };\n  const ZJYProject = lib.Project.create({\n    name: \"职教云\",\n    domains: [\"icve.com.cn\", \"zjy2.icve.com.cn\", \"zyk.icve.com.cn\"],\n    scripts: {\n      guide: new lib.Script({\n        name: \"🖥️ 使用提示\",\n        matches: [\n          [\"学习页面\", \"zjy2.icve.com.cn/study\"],\n          [\"资源库\", \"zyk.icve.com.cn/icve-study/\"]\n        ],\n        namespace: \"zjy.study.guide\",\n        configs: {\n          notes: {\n            defaultValue: \"请点击任意章节，进入学习。\"\n          }\n        }\n      }),\n      dispatcher: new lib.Script({\n        name: \"调度器\",\n        matches: [\n          [\"学习页面\", \"zjy2.icve.com.cn/study\"],\n          [\"资源库\", \"zyk.icve.com.cn/icve-study/\"],\n          [\"内容资源页面\", \"zjy2.icve.com.cn/study/studentFast/classroomNow\"],\n          [\"在线课堂学习页面\", \"zjy2.icve.com.cn/study/studentFast/courseware\"]\n        ],\n        hideInPanel: true,\n        methods() {\n          return {\n            dispatch: async () => {\n              var _a, _b, _c;\n              if ([\"zjy2.icve.com.cn/study/studentFast/classroomNow\"].some((i) => window.location.href.includes(i))) {\n                await waitForElement(\".classroom_activities .active_list\");\n                const courseData = getCourseDataInClassroomNowPage();\n                console.log(courseData);\n                const courseId = ((_c = (_b = (_a = document.querySelector(\".teacherLayout\")) == null ? void 0 : _a.__vue__) == null ? void 0 : _b.courseInfo) == null ? void 0 : _c.id) || \"\";\n                if (!courseData || !courseId) {\n                  return;\n                }\n                ZJYProject.scripts.study.cfg.currentCourseId = courseId;\n                ZJYProject.scripts.study.cfg.courseList = courseData;\n                lib.$message.success(\"课程数据获取成功，请点击课程章节开始学习\");\n              } else if ([\n                \"zyk.icve.com.cn/icve-study/coursePreview/courseware\",\n                \"zjy2.icve.com.cn/study/coursePreview/spoccourseIndex/courseware\",\n                \"zjy2.icve.com.cn/study/studentFast/courseware\"\n              ].some((i) => window.location.href.includes(i))) {\n                const isClassroomNowStudy = location.href.includes(\"zjy2.icve.com.cn/study/studentFast/courseware\");\n                ZJYProject.scripts.study.methods.main(isClassroomNowStudy ? \"classroomNow\" : \"normal\");\n              } else if (work_pages.map(([_, p]) => p).some((i) => window.location.href.includes(i))) {\n                ZJYProject.scripts.work.methods.main();\n              }\n            }\n          };\n        },\n        onhistorychange(type) {\n          if (type === \"push\") {\n            this.methods.dispatch();\n          }\n        },\n        oncomplete() {\n          this.methods.dispatch();\n        }\n      }),\n      study: new lib.Script({\n        matches: [\n          [\"学习页面\", \"zjy2.icve.com.cn/study/coursePreview/spoccourseIndex/courseware\"],\n          [\"在线课堂学习页面\", \"zjy2.icve.com.cn/studentFast/courseware\"],\n          [\"资源库学习页面\", \"zyk.icve.com.cn/icve-study/coursePreview/courseware\"]\n        ],\n        name: \"✍️ 课程学习\",\n        namespace: \"zjy.study.main\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              [\"如果脚本卡死或者您不想学习，\", \"可以点击其他任意章节继续进行学习。\"],\n              \"提示：职教云无法使用倍速。\"\n            ]).outerHTML\n          },\n          volume,\n          playbackRate: {\n            label: \"视频倍速\",\n            tag: \"select\",\n            options: [1, 1.25, 1.5, 1.75, 2, 2.25, 2.5, 2.75, 3, 3.5, 4, 6, 8].map((rate) => [\n              rate.toString(),\n              rate + \" x\"\n            ]),\n            defaultValue: \"1\"\n          },\n          pptReadPeriod: {\n            label: \"PPT 阅读每页停留时间（秒）\",\n            defaultValue: 1,\n            attrs: { type: \"number\", min: 1, step: 1, max: 10 }\n          },\n          currentCourseId: {\n            defaultValue: \"\"\n          },\n          courseList: {\n            defaultValue: []\n          }\n        },\n        methods() {\n          return {\n            main: async (type) => {\n              var _a;\n              const id = new URL(window.location.href).searchParams.get(type === \"classroomNow\" ? \"activityId\" : \"id\");\n              if (!id) {\n                return;\n              }\n              if (state$1.studying && id === state$1.studyingId) {\n                return;\n              }\n              state$1.studyingId = id;\n              state$1.studying = true;\n              CommonProject.scripts.render.methods.pin(this);\n              this.onConfigChange(\"volume\", (val) => {\n                if (state$1.media) {\n                  state$1.media.volume = parseFloat(val.toString());\n                }\n              });\n              this.onConfigChange(\"playbackRate\", (val) => {\n                if (state$1.media) {\n                  state$1.media.playbackRate = parseFloat(val.toString());\n                }\n              });\n              await waitForLoad();\n              setTimeout(() => {\n                var _a2, _b;\n                (_a2 = lib.$el(\".el-message-box__wrapper\")) == null ? void 0 : _a2.remove();\n                (_b = lib.$el(\".v-modal\")) == null ? void 0 : _b.remove();\n              }, 3e3);\n              await waitForLoad();\n              if (type === \"normal\") {\n                const courseId = getUniqueCourseId();\n                if (!courseId) {\n                  lib.$message.error({ content: \"获取课程数据失败，请手动刷新页面\" });\n                  return;\n                }\n                const not_same_class = !ZJYProject.scripts.study.cfg.currentCourseId || ZJYProject.scripts.study.cfg.currentCourseId !== courseId;\n                if (not_same_class || !ZJYProject.scripts.study.cfg.courseList || ZJYProject.scripts.study.cfg.courseList.length === 0) {\n                  const courseData = await getCourseData();\n                  if (!courseData) {\n                    return;\n                  }\n                  ZJYProject.scripts.study.cfg.currentCourseId = courseId;\n                  ZJYProject.scripts.study.cfg.courseList = courseData;\n                }\n              }\n              const courseInfo = ZJYProject.scripts.study.cfg.courseList.find((i) => i.id === id);\n              if (!courseInfo) {\n                const btn = lib.h(\"button\", { className: \"base-style-button\" }, \"修复数据\");\n                btn.onclick = async () => {\n                  const courseId = getUniqueCourseId();\n                  if (!courseId) {\n                    lib.$message.error({ content: \"获取课程数据失败！\" });\n                    return;\n                  }\n                  const courseData = await getCourseData();\n                  if (!courseData) {\n                    return;\n                  }\n                  ZJYProject.scripts.study.cfg.currentCourseId = courseId;\n                  ZJYProject.scripts.study.cfg.courseList = courseData;\n                  lib.$modal.simple({\n                    title: \"提示\",\n                    content: \"数据已修复完毕，请刷新页面重新尝试运行。\"\n                  });\n                };\n                const err = \"获取课程信息失败，请手动刷新页面，或者尝试修复数据：\";\n                lib.$message.error({ content: lib.h(\"span\", [err, btn]), duration: 0 });\n                $console.error(err);\n                return;\n              }\n              const vue = getVueBindElement();\n              const courseType = vue.curType === \"video\" ? \"video\" : (courseInfo == null ? void 0 : courseInfo.fileType) || \"\";\n              const started_url = window.location.href;\n              let msg = \"开始学习：\" + courseType + \"-\" + courseInfo.name;\n              lib.$message.success(msg);\n              $console.info(msg);\n              if ([\"ppt\", \"doc\", \"pptx\", \"docx\", \"pdf\", \"txt\", \"ppt文档\"].some((i) => courseType === i)) {\n                await watchFile(this.cfg.pptReadPeriod);\n              } else if ([\"video\", \"audio\", \"mp4\", \"mp3\", \"flv\", \"视频\"].some((i) => courseType === i)) {\n                const text = ((_a = lib.$el(\".guide\")) == null ? void 0 : _a.textContent) || \"\";\n                msg = `任务点 ${courseInfo.name}，不支持播放。`;\n                if (text.includes(\"很抱歉，您的浏览器不支持播放此类文件\") || text.includes(\"此视频暂无法播放\")) {\n                  msg = `任务点 ${courseInfo.name}，不支持播放。`;\n                  lib.$message.error(msg);\n                  $console.error(msg);\n                } else {\n                  await watchMedia$1();\n                }\n              } else if ([\"png\", \"jpg\", \"图片\"].some((i) => courseType === i)) {\n                msg = `已查看图片任务点 ${courseInfo.name}，即将跳过。`;\n                lib.$message.info(msg);\n                $console.info(msg);\n              } else {\n                msg = `未知的任务点 ${courseInfo.name}，类型 ${courseType}，请跟作者进行反馈。`;\n                lib.$message.error(msg);\n                $console.error(msg);\n              }\n              if (started_url === window.location.href) {\n                msg = courseInfo.name + \" 任务点结束，五秒后下一章\";\n                lib.$message.warn(\"如果职教云一直卡在显示：“资源类型无法学习，请核对数据！” 请手动切换下一章。\");\n                lib.$message.info(msg);\n                $console.info(msg);\n                await $.sleep(5e3);\n                await next(type);\n              }\n            }\n          };\n        }\n      }),\n      work: new lib.Script({\n        matches: work_pages,\n        name: \"✍️ 作业考试脚本\",\n        namespace: \"zjy.work.main\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"自动答题前请在 “通用-全局设置” 中设置题库配置。\",\n              \"可以搭配 “通用-在线搜题” 一起使用。\",\n              \"请手动进入作业考试页面才能使用自动答题。\"\n            ]).outerHTML\n          }\n        },\n        methods() {\n          return {\n            main: async () => {\n              if (isWork() || isExam()) {\n                await waitForQuestions();\n                commonWork(this, {\n                  workerProvider: (opt) => workOrExam(isWork() ? \"work\" : \"exam\", opt)\n                });\n              }\n            }\n          };\n        }\n      })\n    }\n  });\n  async function watchMedia$1() {\n    const media = await waitForMedia();\n    media.volume = parseFloat(ZJYProject.scripts.study.cfg.volume.toString());\n    media.playbackRate = parseFloat(ZJYProject.scripts.study.cfg.playbackRate.toString());\n    state$1.media = media;\n    const success = await playMedia(() => media.play());\n    if (!success) {\n      return;\n    }\n    return new Promise((resolve, reject) => {\n      media.addEventListener(\"ended\", () => {\n        resolve();\n      });\n      media.addEventListener(\"pause\", () => {\n        setTimeout(() => {\n          if (media.ended) {\n            resolve();\n          } else if (media.paused) {\n            media.play();\n            media.volume = parseFloat(ZJYProject.scripts.study.cfg.volume.toString());\n            media.playbackRate = parseFloat(ZJYProject.scripts.study.cfg.playbackRate.toString());\n          }\n        }, 1e3);\n      });\n    });\n  }\n  async function watchFile(pptReadPeriod) {\n    var _a, _b;\n    const vue = getPPTVueBindElement();\n    if (!vue) {\n      return;\n    }\n    while (true) {\n      const [current, total] = ((_b = (_a = document.querySelector(\".preview .page\")) == null ? void 0 : _a.textContent) == null ? void 0 : _b.trim().replace(\"上一页\", \"\").replace(\"下一页\", \"\").split(\"/\").map((i) => parseInt(i.trim()))) || [];\n      if (!current || !total) {\n        break;\n      }\n      if (current >= total - 1) {\n        break;\n      }\n      await $.sleep(pptReadPeriod * 1e3);\n      try {\n        vue.next && vue.next();\n      } catch {\n      }\n      try {\n        vue.skip && vue.skip();\n      } catch {\n      }\n    }\n  }\n  function getUniqueCourseId() {\n    var _a, _b, _c, _d;\n    return ((_d = (_c = (_b = (_a = document.querySelector(\".coursePreviewIndex\")) == null ? void 0 : _a.__vue__) == null ? void 0 : _b.list) == null ? void 0 : _c[0]) == null ? void 0 : _d.courseId) || \"\";\n  }\n  function isZyk() {\n    return location.href.includes(\"zyk.icve.com.cn\");\n  }\n  function getVueBindElement() {\n    var _a, _b;\n    return ((_a = lib.$el(\".guide\")) == null ? void 0 : _a.__vue__) || ((_b = lib.$el(\".teach\")) == null ? void 0 : _b.__vue__);\n  }\n  function getPPTVueBindElement() {\n    var _a, _b, _c;\n    return ((_a = lib.$el(\".FilePreview\")) == null ? void 0 : _a.__vue__) || ((_b = lib.$el(\".guide\")) == null ? void 0 : _b.__vue__) || ((_c = lib.$el(\".teach\")) == null ? void 0 : _c.__vue__);\n  }\n  async function next(type) {\n    var _a;\n    const field = type === \"classroomNow\" ? \"activityId\" : \"id\";\n    const id = new URL(window.location.href).searchParams.get(field);\n    let nextObject;\n    const data = ZJYProject.scripts.study.cfg.courseList;\n    for (let index = 0; index < data.length; index++) {\n      const item = data[index];\n      if ([\"测验\", \"讨论\"].some((i) => item.fileType === i)) {\n        continue;\n      }\n      if (item.id === id) {\n        nextObject = data[index + 1];\n        break;\n      }\n    }\n    if (id && nextObject) {\n      const vue = getVueBindElement();\n      if (((_a = vue == null ? void 0 : vue.nextObj) == null ? void 0 : _a.id) && nextObject.id === vue.nextObj.id) {\n        vue.preNext(vue.nextObj);\n        return;\n      }\n      await $.sleep(3e3);\n      const url = new URL(window.location.href);\n      if (nextObject.courseDesignId) {\n        url.searchParams.set(\"courseDesignId\", nextObject.courseDesignId);\n      }\n      url.searchParams.set(field, nextObject.id);\n      window.location.replace(url.href);\n    } else {\n      lib.$message.success({\n        duration: 0,\n        content: \"全部任务已完成。\"\n      });\n      $console.info(\"全部任务已完成。\");\n      CommonProject.scripts.settings.methods.notificationBySetting(\"全部任务点已完成！\", {\n        duration: 0,\n        extraTitle: \"职教云学习脚本\"\n      });\n      state$1.studying = false;\n    }\n  }\n  function getCourseDataInClassroomNowPage() {\n    var _a, _b, _c;\n    const list = ((_b = (_a = document.querySelector(\".classroom_activities\")) == null ? void 0 : _a.__vue__) == null ? void 0 : _b.activeList) || [];\n    const data = [];\n    const temp = JSON.parse(JSON.stringify(list));\n    while (temp.length > 0) {\n      const item = temp.shift();\n      if (((_c = item == null ? void 0 : item.children) == null ? void 0 : _c.length) > 0) {\n        temp.unshift(...item.children);\n      } else {\n        data.push({\n          name: item.title,\n          id: item.activityId,\n          fileType: item.fileType,\n          courseDesignId: item.courseDesignId,\n          levelName: item.levelName || \"\"\n        });\n      }\n    }\n    return data;\n  }\n  async function getCourseData() {\n    var _a;\n    const getDataList = () => {\n      var _a2, _b, _c;\n      const list = ((_b = (_a2 = document.querySelector(\".coursePreviewIndex\")) == null ? void 0 : _a2.__vue__) == null ? void 0 : _b.list) || [];\n      const data = [];\n      const temp = JSON.parse(JSON.stringify(list));\n      while (temp.length > 0) {\n        const item = temp.shift();\n        if (((_c = item == null ? void 0 : item.children) == null ? void 0 : _c.length) > 0) {\n          temp.unshift(...item.children);\n        } else {\n          data.push({\n            name: item.name,\n            id: item.id,\n            fileType: item.fileType,\n            levelName: item.levelName || \"\",\n            courseDesignId: item.courseDesignId || \"\"\n          });\n        }\n      }\n      return data;\n    };\n    if (isZyk() === false) {\n      const progress = lib.h(\"div\");\n      const modal_content = lib.h(\"div\", [\n        lib.h(\"div\", { className: \"notes card\" }, [\n          lib.$ui.notes([\n            \"职教云由于大章节之间无自动下一节按钮，需要在课程开始前\",\n            \"由程序读取全部章节数据，这样才能自动运行\",\n            \"数据只需读取一遍即可，后续无需重新读取\"\n          ])\n        ]),\n        progress\n      ]);\n      let force_pause = false;\n      const modal2 = lib.$modal.confirm({\n        content: modal_content,\n        maskCloseable: false,\n        title: \"正在获取课程数据中，请勿操作...\",\n        confirmButton: null,\n        cancelButtonText: \"强制暂停\",\n        onCancel() {\n          force_pause = true;\n        }\n      });\n      const kejianListEl = document.querySelector(\".kejianList\");\n      if (!kejianListEl) {\n        lib.$message.error({ content: \"获取课程数据失败，请手动刷新页面\" });\n        return void 0;\n      }\n      if (kejianListEl.style.display === \"none\") {\n        (_a = Array.from(document.querySelectorAll(\".courseBtn div.customBtn\")).find((el) => {\n          var _a2;\n          return (_a2 = el.textContent) == null ? void 0 : _a2.includes(\"课件目录\");\n        })) == null ? void 0 : _a.click();\n        await $.sleep(1e3);\n      }\n      const folders = [];\n      while (true) {\n        const itemsElList = Array.from(document.querySelectorAll(\".items\"));\n        const unsaved = itemsElList.find((item) => folders.includes(item) === false);\n        if (!unsaved) {\n          break;\n        }\n        const list = getDataList();\n        const course_info = list.find(\n          (item) => {\n            var _a2;\n            return `${item.levelName || \"\"}${item.name}`.replace(/\\s/g, \"\") === (((_a2 = unsaved.textContent) == null ? void 0 : _a2.trim().replace(/\\s/g, \"\")) || \"\");\n          }\n        );\n        if (!course_info || [\"父节点\", \"子节点\"].includes(course_info.fileType) === false) {\n          folders.push(unsaved);\n          continue;\n        }\n        if (force_pause) {\n          const err = \"已强制暂停，请手动刷新页面后才能重新运行\";\n          lib.$message.error({ content: err, duration: 0 });\n          lib.$modal.alert({ content: err });\n          return void 0;\n        }\n        folders.push(unsaved);\n        if (modal2) {\n          progress.innerHTML = \"<br><b>当前已获取 \" + document.querySelectorAll(\".fIteml,.iChild\").length + \" 个小节</b>\";\n        }\n        unsaved.click();\n        await $.sleep(1e3);\n      }\n      modal2 == null ? void 0 : modal2.remove();\n    }\n    return getDataList();\n  }\n  function waitForLoad() {\n    return waitForElement(() => getVueBindElement());\n  }\n  async function waitForQuestions() {\n    return waitForElement(\".subjectList\");\n  }\n  function workOrExam(type, { answererWrappers, period, thread, answerSeparators, answerMatchMode }) {\n    lib.$message.info({ content: \"开始作业\" });\n    CommonProject.scripts.workResults.methods.init({\n      questionPositionSyncHandlerType: \"zjy\"\n    });\n    const titleTransform = (titles) => {\n      return titles.filter((t2) => t2 == null ? void 0 : t2.innerText).map((t2) => t2 == null ? void 0 : t2.innerText).join(\",\");\n    };\n    const worker = new OCSWorker({\n      root: \".subjectDet\",\n      elements: {\n        title: type === \"work\" ? \"h2,h3,h4,h5,h6\" : \".titleTest span:not(.xvhao)\",\n        options: \".optionList div , .tkInput .el-input, .tkInput .el-textarea\"\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        const title = titleTransform(elements2.title);\n        if (title) {\n          return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n            await $.sleep((period != null ? period : 3) * 1e3);\n            return defaultAnswerWrapperHandler(answererWrappers, {\n              type: ctx.type || \"unknown\",\n              title,\n              options: ctx.elements.options.map((o) => o.innerText).join(\"\\n\")\n            });\n          });\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      work: {\n        type(ctx) {\n          const options = ctx.elements.options;\n          const radio_len = options.map((o) => o.querySelector('[type=\"radio\"]')).reduce((a, b) => {\n            return a + (b ? 1 : 0);\n          }, 0);\n          return radio_len > 0 ? radio_len === 2 ? \"judgement\" : \"single\" : options.some((o) => o.querySelector('[type=\"checkbox\"]')) ? \"multiple\" : options.some((o) => o.querySelector('[type=\"text\"]')) || options.some((o) => o.querySelector(\"textarea\")) ? \"completion\" : void 0;\n        },\n        handler(type2, answer, option, ctx) {\n          var _a, _b;\n          if (type2 === \"judgement\" || type2 === \"single\" || type2 === \"multiple\") {\n            if (((_a = option.querySelector(\"input\")) == null ? void 0 : _a.checked) !== true) {\n              (_b = option.querySelector(\"label\")) == null ? void 0 : _b.click();\n            }\n          } else if (type2 === \"completion\" && answer.trim()) {\n            const text = option.querySelector('input[type=\"text\"]');\n            const textarea = option.querySelector(\"textarea\");\n            if (text) {\n              text.value = answer;\n              text.dispatchEvent(new Event(\"input\", { bubbles: true }));\n            } else if (textarea) {\n              textarea.value = answer;\n              textarea.dispatchEvent(new Event(\"input\", { bubbles: true }));\n            }\n          }\n        }\n      },\n      onResultsUpdate(curr, _, res) {\n        var _a;\n        CommonProject.scripts.workResults.methods.setResults(simplifyWorkResult(res, titleTransform));\n        if ((_a = curr.result) == null ? void 0 : _a.finish) {\n          CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(simplifyWorkResult([curr], titleTransform));\n        }\n        CommonProject.scripts.workResults.methods.updateWorkStateByResults(res);\n      }\n    });\n    worker.doWork({ enable_debug: true }).then(() => {\n      lib.$message.info({ content: \"作业/考试完成，请自行检查后保存或提交。\", duration: 0 });\n      worker.emit(\"done\");\n    }).catch((err) => {\n      lib.$message.error({ content: `作业/考试失败: ${err}`, duration: 0 });\n    });\n    return worker;\n  }\n  const $msg_and_log = (type, msg) => {\n    lib.$message[type](msg);\n    $console[type](msg);\n  };\n  const state = {\n    currentMedia: void 0,\n    currentUrlHash: \"\",\n    currentRunningScriptName: \"\",\n    current_job_id: \"\"\n  };\n  const ICourseProject = lib.Project.create({\n    name: \"中国大学MOOC\",\n    domains: [\"icourse163.org\"],\n    scripts: {\n      dispatcher: new lib.Script({\n        name: \"调度器\",\n        hideInPanel: true,\n        matches: [[\"所有页面\", \"icourse163.org\"]],\n        oncomplete() {\n          setInterval(() => {\n            var _a, _b;\n            const hash = new URL(window.location.href).hash;\n            if (state.currentUrlHash !== hash) {\n              state.currentRunningScriptName = \"\";\n            }\n            state.currentUrlHash = hash;\n            for (const key in ICourseProject.scripts) {\n              if (Object.prototype.hasOwnProperty.call(ICourseProject.scripts, key)) {\n                const script2 = ICourseProject.scripts[key];\n                const runAtHash = Array.isArray(script2.cfg.runAtHash) ? script2.cfg.runAtHash : [script2.cfg.runAtHash];\n                if (runAtHash.length && runAtHash.some((h2) => state.currentUrlHash.includes(h2))) {\n                  if (state.currentRunningScriptName !== script2.name) {\n                    state.currentRunningScriptName = script2.name;\n                    state.current_job_id = Math.random().toString(16).slice(2);\n                    (_b = (_a = script2.methods) == null ? void 0 : _a.main) == null ? void 0 : _b.call(_a, {\n                      canRun: () => {\n                        return state.currentUrlHash && runAtHash.some((h2) => state.currentUrlHash.includes(h2));\n                      },\n                      job_id: state.current_job_id\n                    });\n                  }\n                  break;\n                }\n              }\n            }\n          }, 1e3);\n        }\n      }),\n      guide: new lib.Script({\n        name: \"💡 使用提示\",\n        matches: [[\"\", \"icourse163.org\"]],\n        namespace: \"icourse.guide-v1\",\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\"手动进入任意课程里的课件/作业，即可开始自动学习\"]).outerHTML\n          },\n          runAtHash: {\n            defaultValue: [\"/home/course\"]\n          }\n        },\n        methods() {\n          return {\n            main: async () => {\n              console.log(state, this.cfg.runAtHash);\n              CommonProject.scripts.render.methods.pin(this);\n            }\n          };\n        }\n      }),\n      study: new lib.Script({\n        name: \"🖥️ 学习脚本\",\n        namespace: \"icourse.study-v1\",\n        matches: [\n          [\"MOOC作业页面\", \"icourse163.org/learn\"],\n          [\"SPOC作业页面\", \"icourse163.org/spoc/learn\"]\n        ],\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\n              \"请勿在使用过程中最小化浏览器\",\n              \"自动讨论默认关闭，如需开启请在下方设置中设置\",\n              \"作业请完成课程后手动进入\"\n            ]).outerHTML\n          },\n          runAtHash: {\n            defaultValue: \"/learn/content?type=detail\"\n          },\n          playbackRate,\n          volume,\n          readSpeed: {\n            label: \"PPT翻阅速度（秒）\",\n            attrs: { type: \"number\", step: \"1\", min: \"1\", max: \"10\" },\n            defaultValue: 1\n          },\n          discussionStrategy: {\n            label: \"讨论自动回复方式\",\n            tag: \"select\",\n            defaultValue: \"not-reply\",\n            options: [\n              [\"not-reply\", \"不讨论回复\"],\n              [\"max-show-up\", \"获取出现最多的评论进行回复\"],\n              [\"max-fav\", \"获取最多点赞的评论进行回复\"],\n              [\"use-newest\", \"获取最新的评论进行回复\"]\n            ]\n          },\n          enableChapterTest: {\n            label: \"随堂测验自动答题\",\n            attrs: {\n              type: \"checkbox\",\n              title: \"是否开启随堂测验自动答题，默认关闭，测试时只需点击即可完成测验，但这里保留选项防止需要开启。\"\n            },\n            defaultValue: false\n          }\n        },\n        oncomplete() {\n          this.onConfigChange(\"playbackRate\", (playbackRate2) => {\n            state.currentMedia && (state.currentMedia.playbackRate = parseFloat(playbackRate2.toString()));\n          });\n          this.onConfigChange(\"volume\", (v) => state.currentMedia && (state.currentMedia.volume = v));\n        },\n        methods() {\n          return {\n            main: async ({ canRun, job_id }) => {\n              CommonProject.scripts.render.methods.pin(this);\n              const remotePage = await BackgroundProject.scripts.dev.methods.getRemotePlaywrightCurrentPage();\n              if (!remotePage) {\n                return $playwright.showError();\n              }\n              $render.moveToEdge();\n              const handleVideoTest = async () => {\n                if (!canRun() || job_id !== state.current_job_id)\n                  return;\n                setTimeout(async () => {\n                  const question = document.querySelector(\".u-questionItem\");\n                  const media = document.querySelector(\"video,audio\");\n                  if (question && media) {\n                    $msg_and_log(\"info\", \"检测到视频弹窗测验，开始答题\");\n                    await new Promise((resolve) => {\n                      ICourseProject.scripts.work.methods.start(\"chapter-test\", canRun, (worker) => {\n                        console.log(\"worker\", worker);\n                        worker.once(\"done\", resolve);\n                        worker.once(\"close\", resolve);\n                        worker.once(\"stop\", resolve);\n                      });\n                    });\n                    await $.sleep(1e3);\n                    await remotePage.click(\".j-unitctBox .u-btn-default.j-continue\");\n                    $msg_and_log(\"info\", \"测验完成\");\n                  }\n                  handleVideoTest();\n                }, 3e3);\n              };\n              handleVideoTest();\n              const study2 = async () => {\n                var _a, _b;\n                const lessonName = (_a = document.querySelector(\".j-lesson .j-up\")) == null ? void 0 : _a.textContent;\n                const currentUnitItem = document.querySelector(\".j-unitslist  li.current\");\n                const unitName = (_b = currentUnitItem == null ? void 0 : currentUnitItem.querySelector(\".unit-name\")) == null ? void 0 : _b.textContent;\n                $msg_and_log(\"info\", `正在学习：${lessonName || \"\"} - ${unitName || \"\"}`);\n                const isJob = (iconName) => currentUnitItem == null ? void 0 : currentUnitItem.querySelector(`[class*=${iconName}]`);\n                let hasJob = true;\n                if (isJob(\"u-icon-video\")) {\n                  await waitForElement(\"video, audio\");\n                  await watchMedia(this.cfg.playbackRate, this.cfg.volume);\n                  $msg_and_log(\"info\", \"视频学习完成\");\n                } else if (isJob(\"u-icon-doc\")) {\n                  await waitForElement(\".ux-pdf-reader\");\n                  await readPPT(remotePage, this.cfg.readSpeed);\n                  $msg_and_log(\"info\", \"PPT完成\");\n                } else if (isJob(\"u-icon-discuss\")) {\n                  await waitForElement(\".j-reply-all\");\n                  await discussion(remotePage, this.cfg.discussionStrategy);\n                  $msg_and_log(\"info\", \"讨论完成\");\n                } else if (isJob(\"u-icon-test\")) {\n                  const replay = await waitForElement(\".j-replay\");\n                  if ((replay == null ? void 0 : replay.style.display) === \"none\") {\n                    if (this.cfg.enableChapterTest) {\n                      await new Promise((resolve) => {\n                        ICourseProject.scripts.work.methods.start(\"chapter-test\", canRun, (worker) => {\n                          console.log(\"worker\", worker);\n                          worker.once(\"done\", resolve);\n                          worker.once(\"close\", resolve);\n                          worker.once(\"stop\", resolve);\n                        });\n                      });\n                      $msg_and_log(\"info\", \"测验完成\");\n                    } else {\n                      $msg_and_log(\n                        \"warn\",\n                        \"随堂测验自动答题功能已关闭（上方菜单栏-中国大学MOOC-学习脚本中开启），即将跳过。\"\n                      );\n                    }\n                  } else {\n                    $msg_and_log(\"info\", \"随堂测验已完成，即将跳过。\");\n                  }\n                } else if (isJob(\"u-icon-text\")) {\n                  const key = \"text-job-reload\";\n                  if (await lib.$store.getTab(key) === \"1\") {\n                    lib.$store.setTab(key, \"0\");\n                    $msg_and_log(\"info\", \"文档已完成，即将跳过。\");\n                  } else {\n                    lib.$store.setTab(key, \"1\");\n                    $msg_and_log(\"info\", \"文档无需处理，将在刷新完成后跳过。\");\n                    await $.sleep(3e3);\n                    window.location.reload();\n                    return;\n                  }\n                } else {\n                  hasJob = false;\n                }\n                await $.sleep(3e3);\n                if (canRun()) {\n                  if (hasJob) {\n                    $msg_and_log(\"info\", \"准备跳转下一章\");\n                  } else {\n                    $msg_and_log(\"warn\", \"未找到学习内容，或者此章节不支持自动学习！即将跳过本章节\");\n                  }\n                  await gotoNextJob();\n                }\n              };\n              study2();\n              async function gotoNextJob() {\n                const list = await next2();\n                for (const item of list) {\n                  const el = typeof item === \"function\" ? item() : item;\n                  if (el) {\n                    await (remotePage == null ? void 0 : remotePage.click(el));\n                  }\n                }\n                if (list.length === 0) {\n                  lib.$message.success({ content: \"所有章节学习完成！\", duration: 0 });\n                  $console.info(\"所有章节学习完成！\");\n                  CommonProject.scripts.settings.methods.notificationBySetting(\"所有章节学习完成！\", {\n                    duration: 0,\n                    extraTitle: \"中国大学MOOC学习脚本\"\n                  });\n                }\n              }\n              async function next2() {\n                var _a;\n                const nextEl = (_a = document.querySelector(\".unitslist .current\")) == null ? void 0 : _a.nextElementSibling;\n                if (nextEl) {\n                  return [nextEl.querySelector(\".unit-name\")];\n                }\n                const getName = (node) => {\n                  var _a2;\n                  return (_a2 = node == null ? void 0 : node.textContent) == null ? void 0 : _a2.replace(/\\s/g, \"\");\n                };\n                const lessonName = getName(document.querySelector(\".j-lesson .j-up\"));\n                if (!lessonName) {\n                  throw Error(\"无法读取章节名!\");\n                }\n                const lessonList = Array.from(document.querySelectorAll(\".j-lesson .j-list .list\"));\n                let nextLesson = void 0;\n                for (const item of lessonList) {\n                  const itemName = getName(item);\n                  if (itemName === lessonName) {\n                    if (item.nextElementSibling) {\n                      nextLesson = item.nextElementSibling;\n                      break;\n                    }\n                  }\n                }\n                if (nextLesson) {\n                  return [\n                    document.querySelector(\".j-lesson\"),\n                    nextLesson\n                  ];\n                }\n                const chapterName = getName(document.querySelector(\".j-chapter .j-up\"));\n                if (!chapterName) {\n                  throw Error(\"无法读取单元名!\");\n                }\n                const chapterList = Array.from(document.querySelectorAll(\".j-chapter .j-list .list\"));\n                let nextChapter = void 0;\n                for (const item of chapterList) {\n                  const itemName = getName(item);\n                  if (itemName === chapterName) {\n                    if (item.nextElementSibling) {\n                      nextChapter = item.nextElementSibling;\n                      break;\n                    }\n                  }\n                }\n                if (nextChapter) {\n                  return [\n                    () => document.querySelector(\".j-chapter\"),\n                    () => nextChapter,\n                    () => document.querySelector(\".j-lesson\"),\n                    () => document.querySelectorAll(\".j-lesson .j-list .list\")[0]\n                  ];\n                } else {\n                  return [];\n                }\n              }\n            }\n          };\n        }\n      }),\n      work: new lib.Script({\n        name: \"✍️ 作业考试脚本\",\n        namespace: \"icourse.work-v2\",\n        matches: [\n          [\"MOOC作业页面\", \"icourse163.org/learn\"],\n          [\"SPOC作业页面\", \"icourse163.org/spoc/learn\"],\n          [\"考试页面\", \"icourse163.org/mooc/main/newExam\"]\n        ],\n        configs: {\n          notes: workNotes,\n          runAtHash: {\n            defaultValue: [\"/learn/quiz\", \"/learn/examObject\"]\n          }\n        },\n        methods() {\n          const start2 = async (type, canRun, onWorkerCreated) => {\n            const remotePage = await BackgroundProject.scripts.dev.methods.getRemotePlaywrightCurrentPage();\n            if (!remotePage) {\n              return $playwright.showError();\n            }\n            await waitForQuestion();\n            CommonProject.scripts.render.methods.pin(this);\n            CommonProject.scripts.render.methods.normal();\n            $msg_and_log(\"info\", \"开始答题\");\n            CommonProject.scripts.render.methods.pin(this);\n            commonWork(this, {\n              workerProvider: (opts) => {\n                const worker = workAndExam(remotePage, type, opts);\n                worker.once(\"close\", () => {\n                  clearInterval(interval);\n                });\n                const interval = setInterval(() => {\n                  if (canRun() === false) {\n                    $msg_and_log(\"warn\", \"检测到页面切换，无法继续答题，将关闭自动答题。\");\n                    clearInterval(interval);\n                    worker.emit(\"close\");\n                  }\n                }, 1e3);\n                return worker;\n              },\n              onWorkerCreated,\n              enable_control_panel: true,\n              start_delay_seconds: 3\n            });\n          };\n          return {\n            main: async ({ canRun }) => {\n              if (location.hash.includes(\"learn/quizscore\")) {\n                lib.$message.success(\"当前作业已完成，自动答题关闭。\");\n                return;\n              }\n              return start2(\"work\", canRun);\n            },\n            start: start2\n          };\n        },\n        oncomplete() {\n          if (location.href.includes(\"/learn/examObject\") && !location.href.includes(\"learn/examObjectScore\") || location.href.includes(\"/mooc/main/newExam\")) {\n            this.methods.start(\"exam\", () => true);\n          }\n        }\n      }),\n      passportRedirect: new lib.Script({\n        name: \"登录重定向修复\",\n        matches: [[\"登录重定向\", \"passport/logingate/changeCookie.htm\"]],\n        configs: {\n          notes: {\n            defaultValue: lib.$ui.notes([\"检测到页面重定向到空白页面\", \"程序将会自动修复\"]).outerHTML\n          }\n        },\n        hideInPanel: true,\n        oncomplete(...args) {\n          CommonProject.scripts.render.methods.pin(this);\n          lib.$message.info(\"检测到中国大学MOOC空白页面，即将重定向修复...\");\n          setTimeout(() => {\n            location.href = \"https://www.icourse163.org/\";\n          }, 3e3);\n        }\n      })\n    }\n  });\n  function waitForQuestion() {\n    return new Promise((resolve, reject) => {\n      const interval = setInterval(() => {\n        if (document.querySelector(\".u-questionItem,[class*=questionBody]\")) {\n          clearInterval(interval);\n          resolve();\n        }\n      }, 1e3);\n    });\n  }\n  function workAndExam(remotePage, type, {\n    answererWrappers,\n    period,\n    thread,\n    redundanceWordsText,\n    upload,\n    stopSecondWhenFinish,\n    answerSeparators,\n    answerMatchMode\n  }) {\n    CommonProject.scripts.workResults.methods.init({\n      questionPositionSyncHandlerType: \"icourse\"\n    });\n    const titleTransform = (titles) => {\n      return removeRedundantWords(\n        titles.map((t2) => t2 ? optimizationElementWithImage(t2, true).innerText : \"\").filter((t2) => t2.trim() !== \"\").join(\",\").replace(/[\\u200A-\\u200F]/g, \"\"),\n        redundanceWordsText.split(\"\\n\")\n      );\n    };\n    const work_type = type;\n    const worker = new OCSWorker({\n      root: type === \"exam\" ? \"[class*=questionBody]\" : \".u-questionItem\",\n      elements: {\n        title: type === \"exam\" ? \"[class*=questionInfo]\" : \".j-title .j-richTxt\",\n        options: type === \"exam\" ? \"[class*=index-module__optionBody]\" : \".choices li,.inputArea\"\n      },\n      thread: thread != null ? thread : 1,\n      answerSeparators: answerSeparators.split(\",\").map((s) => s.trim()),\n      answerMatchMode,\n      answerer: (elements2, ctx) => {\n        const title = titleTransform(elements2.title);\n        if (title) {\n          return CommonProject.scripts.apps.methods.searchAnswerInCaches(title, async () => {\n            await $.sleep((period != null ? period : 3) * 1e3);\n            return defaultAnswerWrapperHandler(answererWrappers, {\n              type: ctx.type || \"unknown\",\n              title,\n              options: ctx.elements.options.map((o) => o.innerText).join(\"\\n\")\n            });\n          });\n        } else {\n          throw new Error(\"题目为空，请查看题目是否为空，或者忽略此题\");\n        }\n      },\n      work: {\n        async handler(type2, answer, option) {\n          if (type2 === \"judgement\" || type2 === \"single\" || type2 === \"multiple\") {\n            if (work_type === \"exam\") {\n              const input2 = option.querySelector(\"input\");\n              if (input2 && !(input2 == null ? void 0 : input2.checked)) {\n                await $.sleep(200);\n                return input2.click();\n              }\n            }\n            const text = option.querySelector(\".f-richEditorText\");\n            const input = option.querySelector(\"input\");\n            if (input && !(input == null ? void 0 : input.checked) && text) {\n              await $.sleep(200);\n              await remotePage.click(text);\n            }\n          } else if (type2 === \"completion\" && answer.trim()) {\n            const text = option.querySelector(\"textarea\");\n            if (text) {\n              text.value = answer.trim();\n              await remotePage.fill(\"textarea\", answer.trim());\n            }\n          }\n        }\n      },\n      onElementSearched(elements2, root2) {\n        elements2.options.forEach((el) => {\n          const correct = el.querySelector(\".u-icon-correct\");\n          const wrong = el.querySelector(\".u-icon-wrong\");\n          if (correct) {\n            correct.replaceWith(\"对\");\n          }\n          if (wrong) {\n            wrong.replaceWith(\"错\");\n          }\n        });\n      },\n      onResultsUpdate(curr, _, res) {\n        var _a;\n        CommonProject.scripts.workResults.methods.setResults(simplifyWorkResult(res, titleTransform));\n        if ((_a = curr.result) == null ? void 0 : _a.finish) {\n          CommonProject.scripts.apps.methods.addQuestionCacheFromWorkResult(simplifyWorkResult([curr], titleTransform));\n        }\n        CommonProject.scripts.workResults.methods.updateWorkStateByResults(res);\n      }\n    });\n    worker.doWork({ enable_debug: true }).then(async (results) => {\n      if (worker.isClose) {\n        return;\n      }\n      if (type === \"chapter-test\") {\n        $msg_and_log(\"info\", `答题完成，将等待 ${stopSecondWhenFinish} 秒后进行保存或提交。`);\n        await $.sleep(stopSecondWhenFinish * 1e3);\n        if (worker.isClose) {\n          return;\n        }\n        await worker.uploadHandler({\n          type: upload,\n          results,\n          async callback(finishedRate, uploadable) {\n            const content = `完成率 ${finishedRate.toFixed(2)}% :  ${uploadable ? \"3秒后将自动提交\" : \"3秒后将自动跳过（没保存按钮）\"} `;\n            $console.info(content);\n            lib.$message.success({ content, duration: type === \"chapter-test\" ? 10 : 0 });\n            await $.sleep(3e3);\n            if (worker.isClose) {\n              return;\n            }\n            if (uploadable) {\n              const sumbit = document.querySelector(\".j-submit\");\n              if (sumbit) {\n                await remotePage.click(sumbit);\n              } else {\n                $msg_and_log(\"warn\", \"没有找到提交按钮，将跳过提交。\");\n              }\n            }\n          }\n        });\n      } else {\n        lib.$message.success({ content: \"作业/考试完成，请自行检查后保存或提交。\", duration: 0 });\n      }\n      worker.emit(\"done\");\n    }).catch((err) => {\n      lib.$message.error({ content: \"答题程序发生错误 : \" + err.message, duration: 0 });\n    });\n    return worker;\n  }\n  async function watchMedia(playbackRate2, volume2) {\n    return new Promise((resolve, reject) => {\n      waitForMedia().then((video) => {\n        video.playbackRate = playbackRate2;\n        video.volume = volume2;\n        state.currentMedia = video;\n        playMedia(() => video == null ? void 0 : video.play());\n        video.onpause = async () => {\n          if (!(video == null ? void 0 : video.ended)) {\n            video == null ? void 0 : video.play();\n          }\n        };\n        video.onended = () => {\n          resolve();\n        };\n      }).catch(reject);\n    });\n  }\n  async function readPPT(remotePage, readSpeed) {\n    var _a, _b, _c, _d;\n    const reader = document.querySelector(\".ux-pdf-reader\");\n    if (reader) {\n      const total = parseInt(\n        ((_c = (_b = (_a = document.querySelector(\".ux-h5pdfreader_container_footer_pages_total\")) == null ? void 0 : _a.childNodes[1]) == null ? void 0 : _b.textContent) == null ? void 0 : _c.replace(/\\s/, \"\")) || \"0\"\n      );\n      const start2 = parseInt(\n        ((_d = document.querySelector(\".ux-h5pdfreader_container_footer_pages_in\")) == null ? void 0 : _d.value) || \"1\"\n      );\n      for (let index = start2; index < total + 1; index++) {\n        const next2 = document.querySelector(\".ux-h5pdfreader_container_footer_pages_next\");\n        if (next2) {\n          await remotePage.click(next2);\n        } else {\n          $msg_and_log(\"error\", \"未找到PPT的下一页按钮！\");\n        }\n        await $.sleep(readSpeed * 1e3);\n      }\n    }\n  }\n  async function discussion(remotePage, discussionStrategy) {\n    var _a, _b, _c, _d, _e;\n    if (discussionStrategy === \"not-reply\") {\n      return $msg_and_log(\"warn\", \"讨论自动回复功能已关闭（上方菜单栏-中国大学MOOC-学习脚本中开启）。\");\n    }\n    let res = \"\";\n    if (discussionStrategy === \"max-show-up\") {\n      const list = Array.from(document.querySelectorAll(\".j-reply-all .f-pr .j-content\"));\n      const mapping = /* @__PURE__ */ new Map();\n      for (const item of list) {\n        mapping.set(item.textContent, (mapping.get(item.textContent) || 0) + 1);\n      }\n      const content = (_b = (_a = [...mapping.entries()].sort((a, b) => b[1] - a[1])) == null ? void 0 : _a[0]) == null ? void 0 : _b[0];\n      if (!content) {\n        $msg_and_log(\"error\", \"读取出现最多评论失败！\");\n      }\n      res = content;\n    } else if (discussionStrategy === \"max-fav\") {\n      const list = Array.from(document.querySelectorAll(\".j-reply-all .f-pr\"));\n      let max = 0;\n      let maxEl = void 0;\n      for (const item of list) {\n        const num = parseInt(((_c = item.querySelector(\".bar .num\")) == null ? void 0 : _c.textContent) || \"0\");\n        if (num > max) {\n          max = num;\n          maxEl = item;\n        }\n      }\n      const content = ((_d = maxEl == null ? void 0 : maxEl.querySelector(\".j-content\")) == null ? void 0 : _d.textContent) || \"\";\n      if (!content) {\n        $msg_and_log(\"error\", \"读取最多点赞评论失败！\");\n      }\n      res = content;\n    } else if (discussionStrategy === \"use-newest\") {\n      const content = ((_e = document.querySelector(\".j-reply-all .f-pr .first .j-content\")) == null ? void 0 : _e.textContent) || \"\";\n      if (!content) {\n        $msg_and_log(\"error\", \"读取最新评论失败！\");\n      }\n      res = content;\n    }\n    const p = document.querySelector(\".j-reply-add div.ql-editor.ql-blank p\");\n    if (p) {\n      p.innerText = res;\n      await $.sleep(1e3);\n      const submit = document.querySelector(\".j-reply-add .editbtn\");\n      if (submit) {\n        await remotePage.click(submit);\n        lib.$message.info(\"提交回复成功！\");\n      } else {\n        $msg_and_log(\"error\", \"获取提交按钮失败！\");\n      }\n      await $.sleep(2e3);\n    } else {\n      $msg_and_log(\"error\", \"获取评论输入框失败！\");\n    }\n  }\n  function definedProjects() {\n    return [ZHSProject, CXProject, IcveMoocProject, ZJYProject, ICourseProject, CommonProject, BackgroundProject];\n  }\n  exports2.$ = $;\n  exports2.$const = $const;\n  exports2.$elements = lib.$elements;\n  exports2.$store = lib.$store;\n  exports2.$string = $string;\n  exports2.AnswerWrapperHandlerConfig = AnswerWrapperHandlerConfig;\n  exports2.AnswerWrapperParser = AnswerWrapperParser;\n  exports2.BackgroundProject = BackgroundProject;\n  exports2.CXProject = CXProject;\n  exports2.CommonProject = CommonProject;\n  exports2.CustomOCSWorker = CustomOCSWorker;\n  exports2.ICourseProject = ICourseProject;\n  exports2.IcveMoocProject = IcveMoocProject;\n  exports2.OCSWorker = OCSWorker;\n  exports2.RemotePlaywright = RemotePlaywright;\n  exports2.RenderScript = RenderScript;\n  exports2.StringUtils = StringUtils;\n  exports2.ZHSProject = ZHSProject;\n  exports2.ZJYProject = ZJYProject;\n  exports2.answerExactMatch = answerExactMatch;\n  exports2.answerSimilar = answerSimilar;\n  exports2.clearString = clearString;\n  exports2.createDefaultQuestionResolver = createDefaultQuestionResolver;\n  exports2.defaultAnswerWrapperHandler = defaultAnswerWrapperHandler;\n  exports2.defaultWorkTypeResolver = defaultWorkTypeResolver;\n  exports2.definedProjects = definedProjects;\n  exports2.domSearch = domSearch;\n  exports2.domSearchAll = domSearchAll;\n  exports2.isPlainAnswer = isPlainAnswer;\n  exports2.removeRedundant = removeRedundant;\n  exports2.request = request;\n  exports2.resolvePlainAnswer = resolvePlainAnswer;\n  exports2.splitAnswer = splitAnswer;\n  exports2.start = lib.start;\n  Object.defineProperties(exports2, { __esModule: { value: true }, [Symbol.toStringTag]: { value: \"Module\" } });\n});\n\n\nconst STYLE = `/** 默认字体 */\n/** 输入框默认边距 */\nul,\nol {\n\tline-height: 26px;\n\tpadding-left: 22px;\n\tmargin: 0px;\n}\na {\n\tcolor: #1890ff;\n}\nhr {\n\tborder-style: solid;\n\tborder-color: #63636346;\n\tborder-width: 0px;\n\tborder-bottom: 1px solid #63636346;\n\tmargin-block-start: 1em;\n\tmargin-block-end: 1em;\n}\n.base-style-active-form-control {\n\tborder: 1px solid #ffffff00;\n}\n.base-style-active-form-control:focus {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n}\n.base-style-active-form-control:focus:not([type='checkbox'], [type='radio']) {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n\tbackground-color: white !important;\n}\n.base-style-active-form-control:hover {\n\tbackground-color: #ebeef4;\n}\n.base-style-input {\n\toutline: none;\n\tborder: 1px solid #ffffff00;\n\tpadding: 2px 8px;\n\tmargin: 0px;\n\tbackground-color: #eef2f7;\n\tborder-radius: 2px;\n\tcolor: black;\n}\n.base-style-input::placeholder {\n\tcolor: #bababa;\n}\n.base-style-switch {\n\tappearance: none;\n\t-moz-appearance: none;\n\t-webkit-appearance: none;\n\twidth: fit-content;\n\tmin-width: 36px;\n\theight: 20px;\n\tborder-radius: 100px;\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 2px 4px;\n\ttransition: all 0.2s ease-in-out;\n\twidth: auto;\n\tbackground: gainsboro;\n}\n.base-style-switch:checked {\n\tbackground: #1890ff;\n}\n.base-style-switch:disabled {\n\tbackground-color: #f7f7f78b;\n}\n.base-style-switch:checked::before {\n\ttransform: translate(100%, 0px);\n}\n.base-style-switch::before {\n\tbackground-color: #fff;\n\tborder-radius: 9px;\n\tbox-shadow: 0 2px 4px #00230b33;\n\twidth: 14px;\n\theight: 14px;\n\tcontent: '';\n}\n.base-style-button {\n\tappearance: none;\n\t-moz-appearance: none;\n\t-webkit-appearance: none;\n\tborder-radius: 4px;\n\tbackground-color: white;\n\tborder: 1px solid #2c92ff;\n\tcolor: #409eff;\n\tcursor: pointer !important;\n\tmargin-bottom: 4px;\n}\n.base-style-button:active {\n\tbox-shadow: 0px 0px 8px #0e8de2a5;\n}\n.base-style-button + .base-style-button {\n\tmargin-left: 12px;\n}\n.base-style-button:hover {\n\tbackground-color: #7abbff24;\n}\n.base-style-button.danger:hover {\n\tbackground-color: #ffdede86;\n}\n.base-style-button:disabled {\n\tbackground-color: white;\n\tborder: 1px solid #c0c0c0;\n\tcolor: #aeaeae;\n\tcursor: not-allowed;\n}\n.base-style-button.danger {\n\tcolor: #f36669;\n\tborder-color: #dd5a5d;\n}\n.base-style-button:disabled:active {\n\tbox-shadow: none;\n}\n.base-style-button-secondary {\n\tappearance: none;\n\t-moz-appearance: none;\n\t-webkit-appearance: none;\n\tborder-radius: 4px;\n\tborder: 1px solid #2c92ff;\n\tcolor: #409eff;\n\tcursor: pointer !important;\n\tmargin-bottom: 4px;\n\tcolor: gray;\n\tbackground-color: white;\n\tborder: 1px solid #dcdcdc;\n}\n.base-style-button-secondary:active {\n\tbox-shadow: 0px 0px 8px #0e8de2a5;\n}\n.base-style-button-secondary + .base-style-button-secondary {\n\tmargin-left: 12px;\n}\n.base-style-button-secondary:hover {\n\tbackground-color: #7abbff24;\n}\n.base-style-button-secondary.danger:hover {\n\tbackground-color: #ffdede86;\n}\n.base-style-button-secondary:disabled {\n\tbackground-color: white;\n\tborder: 1px solid #c0c0c0;\n\tcolor: #aeaeae;\n\tcursor: not-allowed;\n}\n.base-style-button-secondary.danger {\n\tcolor: #f36669;\n\tborder-color: #dd5a5d;\n}\n.base-style-button-secondary:disabled:active {\n\tbox-shadow: none;\n}\ncontainer-element.hidden {\n\tdisplay: none;\n}\ncontainer-element.minimize {\n\tmin-width: unset;\n}\ncontainer-element {\n\tposition: fixed;\n\ttop: 10%;\n\tleft: 10%;\n\tz-index: 99999;\n\ttext-align: left;\n\tmin-width: 300px;\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n\tcolor: #636363;\n\tbox-shadow: 0 0 24px -12px #3f3f3f;\n\tborder-radius: 8px;\n\tletter-spacing: 0.5px;\n\tborder: 1px solid #c1c1c1;\n}\nheader-element {\n\tdisplay: flex;\n\talign-items: center;\n\tbackground-color: white;\n\tborder-radius: 8px 8px 0px 0px;\n\tuser-select: none;\n\tpadding: 4px;\n\tpadding-bottom: 0px;\n}\nheader-element .extra-menu-bar {\n\twidth: 100%;\n\tpadding: 4px;\n\tpadding-bottom: 0px;\n\tmargin-top: 4px;\n\tborder-top: 1px solid #e8e8e8;\n\t/** 默认隐藏，一直到需要激活的时候再更改 */\n\tdisplay: none;\n}\nheader-element .extra-menu-bar .script-panel-link {\n\tappearance: none;\n\t-moz-appearance: none;\n\t-webkit-appearance: none;\n\tborder-radius: 4px;\n\tborder: 1px solid #2c92ff;\n\tcolor: #409eff;\n\tcursor: pointer !important;\n\tmargin-bottom: 4px;\n\tcolor: gray;\n\tbackground-color: white;\n\tborder: 1px solid #dcdcdc;\n\tpadding-bottom: 2px;\n\tmargin-bottom: 0px;\n}\nheader-element .extra-menu-bar .script-panel-link:active {\n\tbox-shadow: 0px 0px 8px #0e8de2a5;\n}\nheader-element .extra-menu-bar .script-panel-link + header-element .extra-menu-bar .script-panel-link {\n\tmargin-left: 12px;\n}\nheader-element .extra-menu-bar .script-panel-link:hover {\n\tbackground-color: #7abbff24;\n}\nheader-element .extra-menu-bar .script-panel-link.danger:hover {\n\tbackground-color: #ffdede86;\n}\nheader-element .extra-menu-bar .script-panel-link:disabled {\n\tbackground-color: white;\n\tborder: 1px solid #c0c0c0;\n\tcolor: #aeaeae;\n\tcursor: not-allowed;\n}\nheader-element .extra-menu-bar .script-panel-link.danger {\n\tcolor: #f36669;\n\tborder-color: #dd5a5d;\n}\nheader-element .extra-menu-bar .script-panel-link:disabled:active {\n\tbox-shadow: none;\n}\nheader-element .extra-menu-bar .script-panel-link.active {\n\tbackground-color: #1890ff1a;\n\tborder-color: #1890ff;\n\tcolor: #1890ff;\n}\nheader-element .extra-menu-bar .script-panel-link + .script-panel-link {\n\tmargin-left: 4px;\n}\nheader-element .profile {\n\tflex: 1;\n\tcursor: move;\n}\nheader-element .switch:hover,\nheader-element .dropdown:hover {\n\tbackground-color: #f3f3f3;\n}\nheader-element .close:hover {\n\tbackground-color: #ff000038;\n}\nheader-element .switch,\nheader-element .close {\n\tcursor: pointer;\n}\nheader-element .dropdown {\n\tline-height: 24px;\n\ttext-decoration: underline;\n}\nheader-element .switch,\nheader-element .close,\nheader-element .profile {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tpadding: 0px 8px;\n}\n.logo {\n\twidth: 18px;\n\theight: 18px;\n\tcursor: pointer;\n}\n.project-selector {\n\tdisplay: flex;\n\talign-items: center;\n}\n.project-selector select {\n\tbackground: #ffffff00;\n\tborder-radius: 4px;\n\tborder: 1px solid #63636346;\n\tpadding: 4px;\n}\n.project-selector.expand-all {\n\tdisplay: none;\n}\n.body {\n\toverflow: auto;\n\twidth: auto;\n\theight: 100%;\n}\nscript-panel-element {\n\tdisplay: block;\n\tbackground-color: white;\n\tborder-radius: 0px 0px 8px 8px;\n\tpadding: 0px 8px 12px 8px;\n\toverflow: auto;\n}\nscript-panel-element .script-panel-body {\n\tpadding: 0px 8px;\n}\nscript-panel-element + script-panel-element {\n\tmargin-top: 12px;\n}\n.card + .card {\n\tmargin-top: 12px;\n}\n.card {\n\tbackground-color: white;\n\tborder-radius: 2px;\n\tpadding: 0px 8px;\n}\n.notes {\n\tbackground: #0099ff0e;\n\tborder-left: 4px solid #0099ff65;\n\twidth: -webkit-fill-available;\n\tmargin: 0px 8px;\n\tline-height: 26px;\n\tletter-spacing: 1px;\n}\n.secondary {\n\tfont-size: 12px;\n\tcolor: #8b8b8b;\n}\n.tooltip-container {\n\tz-index: 99999999999999;\n\tmargin: 12px 0px 0px 12px;\n\tpadding: 4px;\n\tcolor: black;\n\tbackground: #f0f0f0;\n\tbox-shadow: 0px 0px 4px #949494;\n\tposition: fixed;\n\twhite-space: normal;\n\tmax-width: 200px;\n\theight: auto;\n\tborder-radius: 2px;\n\tline-height: 18px;\n}\n.configs-container.lock {\n\tfilter: blur(1px);\n\tuser-select: none;\n\t-webkit-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n}\n.configs-container .lock-wrapper {\n\tcursor: not-allowed !important;\n\tborder-radius: 4px;\n\tposition: absolute;\n\tleft: 0px;\n\tz-index: 1;\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n}\n.configs-container .lock-message {\n\tbackground-color: #ffffff7d;\n\tborder-radius: 4px;\n\tbox-shadow: 0px 0px 12px #6a6a6a98;\n\tpadding: 2px;\n}\n.configs {\n\tdisplay: table;\n\tbackground: #e1e1e107;\n\twidth: -webkit-fill-available;\n}\n.configs .configs-body {\n\tdisplay: table-row-group;\n}\n.configs .configs-body config-element + config-element label {\n\tpadding-top: 4px;\n}\n.configs .configs-body config-element + config-element .config-wrapper {\n\tpadding-top: 4px;\n}\n.configs .configs-body config-element {\n\twidth: 100%;\n\tdisplay: table-row;\n\tline-height: 26px;\n}\n.configs .configs-body config-element label {\n\twhite-space: nowrap;\n\tcolor: #4e5969;\n\tdisplay: table-cell;\n\tpadding-right: 12px;\n\ttext-align: left;\n\tvertical-align: top;\n\tmargin-right: 12px;\n}\n.configs .configs-body config-element .config-wrapper {\n\tdisplay: table-cell;\n\tvertical-align: middle;\n\t/** check box 的样式 */\n}\n.configs .configs-body config-element .config-wrapper select {\n\toutline: none;\n\tborder: none;\n\tborder: 1px solid #e4e4e4;\n\tborder-radius: 4px;\n\tpadding: 2px 8px;\n\tborder: 1px solid #ffffff00;\n}\n.configs .configs-body config-element .config-wrapper select:focus {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n}\n.configs .configs-body config-element .config-wrapper select:focus:not([type='checkbox'], [type='radio']) {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n\tbackground-color: white !important;\n}\n.configs .configs-body config-element .config-wrapper select:hover {\n\tbackground-color: #ebeef4;\n}\n.configs .configs-body config-element .config-wrapper textarea {\n\tpadding: 2px 8px;\n\toutline: none;\n\tborder: none;\n\tborder: 1px solid #ffffff00;\n}\n.configs .configs-body config-element .config-wrapper textarea:focus {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n}\n.configs .configs-body config-element .config-wrapper textarea:focus:not([type='checkbox'], [type='radio']) {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n\tbackground-color: white !important;\n}\n.configs .configs-body config-element .config-wrapper textarea:hover {\n\tbackground-color: #ebeef4;\n}\n.configs .configs-body config-element .config-wrapper input:not([type='button']) {\n\toutline: none;\n\tpadding: 2px 8px;\n\tmargin: 0px;\n\tbackground-color: #eef2f7;\n\tborder-radius: 2px;\n\tcolor: black;\n\tborder: 1px solid #ffffff00;\n}\n.configs .configs-body config-element .config-wrapper input:not([type='button'])::placeholder {\n\tcolor: #bababa;\n}\n.configs .configs-body config-element .config-wrapper input:not([type='button']):focus {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n}\n.configs\n\t.configs-body\n\tconfig-element\n\t.config-wrapper\n\tinput:not([type='button']):focus:not([type='checkbox'], [type='radio']) {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n\tbackground-color: white !important;\n}\n.configs .configs-body config-element .config-wrapper input:not([type='button']):hover {\n\tbackground-color: #ebeef4;\n}\n.configs .configs-body config-element .config-wrapper input[type='range'] {\n\tpadding: 0px;\n}\n.configs .configs-body config-element .config-wrapper input[type='button'] {\n\tappearance: none;\n\t-moz-appearance: none;\n\t-webkit-appearance: none;\n\tborder-radius: 4px;\n\tbackground-color: white;\n\tborder: 1px solid #2c92ff;\n\tcolor: #409eff;\n\tcursor: pointer !important;\n\tmargin-bottom: 4px;\n}\n.configs .configs-body config-element .config-wrapper input[type='button']:active {\n\tbox-shadow: 0px 0px 8px #0e8de2a5;\n}\n.configs\n\t.configs-body\n\tconfig-element\n\t.config-wrapper\n\tinput[type='button']\n\t+ .configs\n\t.configs-body\n\tconfig-element\n\t.config-wrapper\n\tinput[type='button'] {\n\tmargin-left: 12px;\n}\n.configs .configs-body config-element .config-wrapper input[type='button']:hover {\n\tbackground-color: #7abbff24;\n}\n.configs .configs-body config-element .config-wrapper input[type='button'].danger:hover {\n\tbackground-color: #ffdede86;\n}\n.configs .configs-body config-element .config-wrapper input[type='button']:disabled {\n\tbackground-color: white;\n\tborder: 1px solid #c0c0c0;\n\tcolor: #aeaeae;\n\tcursor: not-allowed;\n}\n.configs .configs-body config-element .config-wrapper input[type='button'].danger {\n\tcolor: #f36669;\n\tborder-color: #dd5a5d;\n}\n.configs .configs-body config-element .config-wrapper input[type='button']:disabled:active {\n\tbox-shadow: none;\n}\n.configs .configs-body config-element .config-wrapper input[type='checkbox'] {\n\tappearance: none;\n\t-moz-appearance: none;\n\t-webkit-appearance: none;\n\twidth: fit-content;\n\tmin-width: 36px;\n\theight: 20px;\n\tborder-radius: 100px;\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 2px 4px;\n\ttransition: all 0.2s ease-in-out;\n\twidth: auto;\n\tbackground: gainsboro;\n}\n.configs .configs-body config-element .config-wrapper input[type='checkbox']:checked {\n\tbackground: #1890ff;\n}\n.configs .configs-body config-element .config-wrapper input[type='checkbox']:disabled {\n\tbackground-color: #f7f7f78b;\n}\n.configs .configs-body config-element .config-wrapper input[type='checkbox']:checked::before {\n\ttransform: translate(100%, 0px);\n}\n.configs .configs-body config-element .config-wrapper input[type='checkbox']::before {\n\tbackground-color: #fff;\n\tborder-radius: 9px;\n\tbox-shadow: 0 2px 4px #00230b33;\n\twidth: 14px;\n\theight: 14px;\n\tcontent: '';\n}\n.configs .configs-body config-element .config-wrapper input:not([type='checkbox'], [type='radio']),\n.configs .configs-body config-element .config-wrapper textarea,\n.configs .configs-body config-element .config-wrapper select {\n\twidth: -webkit-fill-available;\n\tfont-size: inherit;\n}\n.configs .configs-body config-element .config-wrapper input[type='checkbox'],\n.configs .configs-body config-element .config-wrapper input[type='radio'],\n.configs .configs-body config-element .config-wrapper input[type='range'] {\n\taccent-color: #0e8ee2;\n}\n.configs .configs-body config-element .config-wrapper > *:not(.tooltip) {\n\tbackground-color: #eef2f7;\n\tborder-radius: 2px;\n\tcolor: black;\n\tfloat: right;\n}\n.configs .configs-body config-element .config-wrapper > *:disabled {\n\tcursor: not-allowed;\n\tbackground-color: #f7f7f78b;\n}\n.message-container {\n\tmargin-bottom: 4px;\n\tposition: absolute;\n\tbottom: 100%;\n\tleft: 50%;\n\twidth: 100%;\n\ttransform: translate(-50%, 0px);\n\tmin-width: 300px;\n}\n.message-container message-element {\n\tdisplay: flex;\n\tborder-radius: 4px;\n\tpadding: 4px 12px;\n\tmargin-bottom: 4px;\n}\n.message-container message-element .message-content-container {\n\tmargin-right: 8px;\n\tflex: auto;\n}\n.message-container message-element .message-text {\n\tletter-spacing: 1px;\n\tfont-weight: bold;\n}\n.message-container message-element .message-closer {\n\twidth: 18px;\n\tmin-width: 18px;\n\tcursor: pointer;\n\tbackground-color: #ffffffb3;\n\tcolor: #a1a1a1;\n\tborder-radius: 100%;\n\ttext-align: center;\n\theight: 18px;\n\tvertical-align: middle;\n\tfont-size: 12px;\n}\n.message-container message-element.error {\n\tbackground-color: #ffe6e6;\n\tcolor: #c70208;\n\tborder: 1px solid #ff6b6ded;\n}\n.message-container message-element.info {\n\tbackground-color: #c9e7ff;\n\tcolor: #004d95;\n\tborder: 1px solid #1890ff69;\n}\n.message-container message-element.success {\n\tbackground-color: #e8ffe0;\n\tcolor: #3e8d0d;\n\tborder: 1px solid #6fd91d;\n}\n.message-container message-element.warn {\n\tbackground-color: #ffefc8;\n\tcolor: #9b7400;\n\tborder: 1px solid #ffc107;\n}\nmodal-element {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\tbackground-color: white;\n\tborder-radius: 4px;\n\tbox-shadow: 0px 0px 24px -12px black;\n\tborder: 1px solid #929292;\n\theight: fit-content;\n\ttransform: translate(-50%, -50%);\n\tpadding: 12px 18px 18px 18px;\n\tfont-family: Menlo, Monaco, Consolas, 'Courier New', monospace;\n\tz-index: 99999999999;\n\tline-height: 24px;\n}\nmodal-element .modal-profile {\n\tzoom: 0.9;\n\tcolor: #969696;\n\tuser-select: none;\n\tmargin-bottom: 4px;\n}\nmodal-element .modal-title {\n\tfont-size: 18px;\n\tfont-weight: bold;\n\tuser-select: none;\n}\nmodal-element .modal-body {\n\tmargin: 12px 0px;\n\toverflow: auto;\n}\nmodal-element .modal-footer {\n\tdisplay: flex;\n\twhite-space: nowrap;\n\tjustify-content: end;\n\talign-items: end;\n}\nmodal-element .modal-footer > * + * {\n\tmargin-left: 12px;\n}\nmodal-element .modal-input {\n\toutline: none;\n\tpadding: 2px 8px;\n\tmargin: 0px;\n\tbackground-color: #eef2f7;\n\tborder-radius: 2px;\n\tcolor: black;\n\tborder: 1px solid #ffffff00;\n\twidth: -webkit-fill-available;\n}\nmodal-element .modal-input::placeholder {\n\tcolor: #bababa;\n}\nmodal-element .modal-input:focus {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n}\nmodal-element .modal-input:focus:not([type='checkbox'], [type='radio']) {\n\tborder: 1px solid #0e8de290;\n\tbox-shadow: 0px 0px 4px #0e8de252;\n\tbackground-color: white !important;\n}\nmodal-element .modal-input:hover {\n\tbackground-color: #ebeef4;\n}\nmodal-element .modal-cancel-button {\n\tappearance: none;\n\t-moz-appearance: none;\n\t-webkit-appearance: none;\n\tborder-radius: 4px;\n\tborder: 1px solid #2c92ff;\n\tcolor: #409eff;\n\tcursor: pointer !important;\n\tmargin-bottom: 4px;\n\tcolor: gray;\n\tbackground-color: white;\n\tborder: 1px solid #dcdcdc;\n}\nmodal-element .modal-cancel-button:active {\n\tbox-shadow: 0px 0px 8px #0e8de2a5;\n}\nmodal-element .modal-cancel-button + modal-element .modal-cancel-button {\n\tmargin-left: 12px;\n}\nmodal-element .modal-cancel-button:hover {\n\tbackground-color: #7abbff24;\n}\nmodal-element .modal-cancel-button.danger:hover {\n\tbackground-color: #ffdede86;\n}\nmodal-element .modal-cancel-button:disabled {\n\tbackground-color: white;\n\tborder: 1px solid #c0c0c0;\n\tcolor: #aeaeae;\n\tcursor: not-allowed;\n}\nmodal-element .modal-cancel-button.danger {\n\tcolor: #f36669;\n\tborder-color: #dd5a5d;\n}\nmodal-element .modal-cancel-button:disabled:active {\n\tbox-shadow: none;\n}\nmodal-element .modal-confirm-button {\n\tappearance: none;\n\t-moz-appearance: none;\n\t-webkit-appearance: none;\n\tborder-radius: 4px;\n\tbackground-color: white;\n\tborder: 1px solid #2c92ff;\n\tcolor: #409eff;\n\tcursor: pointer !important;\n\tmargin-bottom: 4px;\n}\nmodal-element .modal-confirm-button:active {\n\tbox-shadow: 0px 0px 8px #0e8de2a5;\n}\nmodal-element .modal-confirm-button + modal-element .modal-confirm-button {\n\tmargin-left: 12px;\n}\nmodal-element .modal-confirm-button:hover {\n\tbackground-color: #7abbff24;\n}\nmodal-element .modal-confirm-button.danger:hover {\n\tbackground-color: #ffdede86;\n}\nmodal-element .modal-confirm-button:disabled {\n\tbackground-color: white;\n\tborder: 1px solid #c0c0c0;\n\tcolor: #aeaeae;\n\tcursor: not-allowed;\n}\nmodal-element .modal-confirm-button.danger {\n\tcolor: #f36669;\n\tborder-color: #dd5a5d;\n}\nmodal-element .modal-confirm-button:disabled:active {\n\tbox-shadow: none;\n}\nmodal-element.alert .modal-input,\nmodal-element.alert .modal-cancel-button {\n\tdisplay: none;\n}\nmodal-element.alert .modal-confirm-button {\n\tmargin: 0;\n}\nmodal-element.prompt .modal-input,\nmodal-element.prompt .modal-cancel-button,\nmodal-element.prompt .modal-confirm-button {\n\tdisplay: block;\n}\nmodal-element.confirm .modal-input {\n\tdisplay: none;\n}\n.modal-wrapper {\n\twidth: 100%;\n\theight: 100%;\n\tz-index: 9999;\n\tposition: fixed;\n\ttop: 0px;\n\tleft: 0px;\n\tz-index: 9999999;\n\tbackground-color: rgba(0, 0, 0, 0.265);\n\tcolor: #636363;\n\tfont: 14px Menlo, Monaco, Consolas, 'Courier New', monospace;\n}\n.pointer {\n\tcursor: pointer;\n}\n.separator {\n\tdisplay: flex;\n\talign-items: center;\n\ttext-align: center;\n\tpadding: 4px 0px 8px 0px;\n}\n.separator::before,\n.separator::after {\n\tcontent: '';\n\tflex: 1;\n\tborder-bottom: 1px solid #63636346;\n}\n.separator:not(:empty)::before {\n\tmargin-right: 0.25em;\n}\n.separator:not(:empty)::after {\n\tmargin-left: 0.25em;\n}\ncontainer-element.minimize .body,\ncontainer-element.minimize header-element .dropdown,\ncontainer-element.minimize .footer {\n\tdisplay: none;\n}\ncontainer-element.minimize header-element {\n\tpadding: 8px;\n\tborder-radius: 8px;\n\tbox-shadow: 0px 0px 24px -12px black;\n}\n.user-guide > li {\n\tpadding: 4px 0px;\n}\n.search-infos-num {\n\twidth: 26px;\n\tmargin: 2px;\n\theight: 20px;\n\tborder-radius: 4px;\n\tdisplay: inline-block;\n\tbackground-color: white;\n\ttext-align: center;\n\tcursor: pointer;\n\tborder: 1px solid #b6b6b6;\n}\n.search-infos-num.requested {\n\tborder: 1px solid #63b4ff;\n\tcolor: #63b4ff;\n}\n.search-infos-num.active {\n\tbackground-color: #127de1 !important;\n\tcolor: white;\n}\n.search-infos-num.error {\n\tborder: 1px solid #ff8789ed;\n\tbackground-color: #ff6b6ded;\n\tcolor: white;\n}\n.search-infos-num.finish {\n\tbackground-color: #63b4ff;\n\tborder: 1px solid #63b4ff;\n\tcolor: white;\n}\nsearch-infos-element {\n\tdisplay: block;\n\toverflow: auto;\n}\nsearch-infos-element .search-result {\n\tmargin-bottom: 12px;\n\tpadding-left: 12px;\n}\nsearch-infos-element .search-result .question {\n\tfont-weight: bold;\n\tmax-height: 200px;\n\toverflow: auto;\n}\nsearch-infos-element .search-result .answer {\n\tcolor: #7c7c7c;\n}\nsearch-infos-element .search-result .answer code {\n\tborder-bottom: 1px solid #dcdcdc;\n\tpadding: 2px 0px;\n\tborder-radius: 2px;\n\tmargin: 4px;\n\tline-height: 22px;\n}\nsearch-infos-element .search-result .answer code + code {\n\tmargin-left: 4px;\n}\nsearch-infos-element .search-result .search-result-answer-tag {\n\tpadding: 2px 6px;\n\tborder-radius: 2px;\n\tfont-size: 12px;\n\tcursor: pointer;\n\tmargin-right: 6px;\n}\nsearch-infos-element .search-result .search-result-answer-tag + .search-result-answer-tag {\n\tmargin-left: 4px;\n}\nsearch-infos-element .search-result .search-result-answer-tag.blue {\n\tbackground-color: #e6f7ff;\n\tborder: 1px solid #91d5ff;\n\tcolor: #1890ff;\n}\nsearch-infos-element .search-result .search-result-answer-tag.green {\n\tbackground-color: #f6ffed;\n\tborder: 1px solid #b7eb8f;\n\tcolor: #52c41a;\n}\nsearch-infos-element .search-result .search-result-answer-tag.gray {\n\tbackground-color: #fafafa;\n\tborder: 1px solid #d9d9d9;\n\tcolor: #595959;\n}\nsearch-infos-element .search-result .search-result-answer-tag.red {\n\tbackground-color: #fff1f0;\n\tborder: 1px solid #ffa39e;\n\tcolor: #ff4d4f;\n}\nsearch-infos-element .search-result .search-result-answer-tag.yellow {\n\tbackground-color: #fffbe6;\n\tborder: 1px solid #ffe58f;\n\tcolor: #faad14;\n}\nsearch-infos-element .search-result-question-type {\n\tbackground-color: #e6f7ff;\n\tborder: 1px solid #91d5ff;\n\tcolor: #1890ff;\n\tmargin-right: 8px;\n\tpadding: 0px 4px;\n\tborder-radius: 4px;\n}\nsearch-infos-element .error {\n\tcolor: #ff6b6ded;\n\tdisplay: inline-block;\n\tpadding-left: 12px;\n}\n.copy,\n.question-title-extra-btn {\n\tmargin-left: 4px;\n\tpadding: 2px 4px;\n\tborder-radius: 2px;\n\tbox-shadow: 0 0 4px #b1b1b1;\n\tcursor: pointer !important;\n\tfont-weight: normal;\n\tfont-size: 12px;\n}\n.work-result-question-container {\n\tposition: absolute;\n\twidth: 400px;\n\tleft: -100%;\n\ttop: 0px;\n\tbackground: white;\n\tborder: 1px solid #cbcbcb;\n\tborder-radius: 4px;\n\tbox-shadow: 0px 0px 12px #d1cfcf;\n\tpadding: 12px;\n}\n.work-result-question-container .close-search-result {\n\tfont-size: 12px;\n\tmargin-left: 8px;\n\ttext-decoration: underline;\n\tcolor: gray;\n\tcursor: pointer;\n}\n.work-result-list {\n\tmax-height: 400px;\n\toverflow: auto;\n\tmargin: 12px 0px;\n\tpadding: 6px;\n\tborder: 1px solid #e1e1e1;\n\tborder-radius: 4px;\n}\n.search-info-title {\n\tborder: 1px solid #e1e1e1;\n\tborder-radius: 4px;\n\tpadding: 8px 12px;\n\tmargin-bottom: 12px;\n\tline-height: 20px;\n\tmax-height: 400px;\n\toverflow: auto;\n}\n.search-info-details {\n\tmargin-left: 4px;\n}\n.console {\n\tmax-height: 300px;\n\tmax-width: 400px;\n\toverflow: auto;\n\tbackground-color: #292929;\n\tpadding: 12px 6px;\n\tcolor: #ececec;\n\tfont-size: 12px;\n}\n.console .item {\n\tpadding: 3px 0px;\n\tborder-radius: 2px;\n}\n.console .item .time {\n\tcolor: #757575;\n}\n.console .item .info {\n\tbackground-color: #2196f3a3;\n}\n.console .item .warn {\n\tbackground-color: #ffc107db;\n}\n.console .item .error {\n\tbackground-color: #f36c71cc;\n}\n.console .item .debug,\n.console .item .log {\n\tbackground-color: #9e9e9ec4;\n}\n.console *::selection {\n\tbackground-color: #ffffff6b;\n}\n.markdown {\n\tmax-width: 400px;\n\tmax-height: 50vh;\n\toverflow: auto;\n}\n.markdown code {\n\tpadding: 2px 4px;\n\tbackground-color: #f0f0f0;\n\tborder-radius: 6px;\n\tfont-size: 12px;\n}\n.markdown blockquote {\n\tpadding: 4px 4px 4px 12px;\n\tmargin: 0px;\n\tcolor: #b5b5b5;\n\tborder-left: #ababab 2px solid;\n}\n.markdown blockquote p {\n\tmargin: 0px;\n}\n.markdown h1,\n.markdown h2,\n.markdown h3,\n.markdown h4,\n.markdown h5,\n.markdown h6,\n.markdown p {\n\tmargin: 8px 0px;\n}\n.dropdown {\n\tposition: relative;\n\tdisplay: inline-block;\n}\n.dropdown.active .dropdown-trigger-element {\n\tcolor: #1890ff;\n}\n.dropdown-trigger-element {\n\tcursor: pointer;\n}\n.dropdown-content {\n\tdisplay: none;\n\tposition: absolute;\n\tbackground-color: #ffffff;\n\toverflow: auto;\n\tbox-shadow: 0px 8px 16px 0px #00000033;\n\tz-index: 1;\n\tborder-radius: 4px;\n\tpadding: 8px 12px;\n\tmin-width: 120px;\n}\n.dropdown-content.show {\n\tdisplay: block;\n}\n.dropdown-content {\n\tcursor: pointer;\n\tz-index: 999;\n}\n.dropdown-content .dropdown-option {\n\tpadding-left: 4px;\n\twhite-space: nowrap;\n}\n.dropdown-content .dropdown-option:hover {\n\tbackground-color: #f3f3f3;\n}\n.dropdown-content .dropdown-option.active {\n\tbackground-color: #1890ff1a;\n\tcolor: #1890ff;\n}\n.space {\n\tdisplay: inline-flex;\n}\n.config-details {\n\tanimation: fade-in 0.5s;\n}\n.config-details label {\n\tpadding-left: 12px;\n}\n.alert-info-wrapper {\n\tmargin-bottom: 8px;\n}\n.alert-info-wrapper .result-info {\n\tpadding: 12px;\n\ttext-align: center;\n\tborder-radius: 6px;\n}\n.alert-info-wrapper .unresolved {\n\tcolor: #a1a1a1;\n\tbackground-color: #f7f7f7;\n}\n.alert-info-wrapper .no-answer {\n\tcolor: #a1a1a1;\n\tbackground-color: #f7f7f7;\n}\n.alert-info-wrapper .error {\n\tcolor: #ff4d4f;\n\tbackground-color: #fff1f0;\n}\nmessage-element {\n\tanimation: show 0.5s;\n}\nscript-panel-element > div,\nscript-panel-link,\ncontainer-element,\nmodal-element {\n\tanimation: fade-in 0.3s;\n}\n@keyframes show {\n\t0% {\n\t\ttransform: translateY(20px);\n\t\topacity: 0;\n\t}\n\t100% {\n\t\ttransform: translateY(0);\n\t\topacity: 1;\n\t}\n}\n@keyframes fade-in {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n@keyframes fade-out {\n\t0% {\n\t\topacity: 1;\n\t}\n\t100% {\n\t\topacity: 0;\n\t}\n}\n.checkbox-label {\n\tdisplay: inline-block !important;\n\tposition: relative;\n\tcursor: pointer;\n\tfont-size: 16px;\n\tcolor: #2c3e50;\n}\n/* 隐藏原始复选框 */\n.checkbox-input {\n\tposition: absolute;\n\topacity: 0;\n\twidth: 0;\n\theight: 0;\n}\n/* 自定义按钮样式 */\n.checkbox-label::after {\n\tcontent: '';\n\tdisplay: inline-block;\n\tborder-radius: 50%;\n\ttransition: all 0.1s ease;\n\tposition: relative;\n\tmargin-left: 4px;\n\tvertical-align: middle;\n}\n/* 向下箭头（未选中状态） */\n.checkbox-label::before {\n\tcontent: '🔽';\n\tposition: absolute;\n\twidth: 0;\n\theight: 0;\n\tright: 8px;\n\ttransition: all 0.1s ease;\n\tz-index: 2;\n}\n/* 向上箭头（选中状态） */\n.checked .checkbox-label::before {\n\tcontent: '🔼';\n}\n`;\n\n/* eslint-disable no-undef */\n/// <reference path=\"./global.d.ts\" />\n\n// 环境检测\nif (\n\t[\n\t\t'GM_getTab',\n\t\t'GM_saveTab',\n\t\t'GM_setValue',\n\t\t'GM_getValue',\n\t\t'unsafeWindow',\n\t\t'GM_listValues',\n\t\t'GM_deleteValue',\n\t\t'GM_notification',\n\t\t'GM_xmlhttpRequest',\n\t\t'GM_getResourceText',\n\t\t'GM_addValueChangeListener',\n\t\t'GM_removeValueChangeListener'\n\t].some((api) => typeof Reflect.get(globalThis, api) === 'undefined')\n) {\n\tconst open = confirm(\n\t\t`OCS网课脚本不支持当前的脚本管理器（${GM_info.scriptHandler}）。` +\n\t\t\t'请前往 https://docs.ocsjs.com/docs/script 下载指定的脚本管理器，例如 “Scriptcat 脚本猫” 或者 “Tampermonkey 油猴”'\n\t);\n\n\tif (open) {\n\t\twindow.location.href = 'https://docs.ocsjs.com/docs/script';\n\t}\n\treturn;\n}\n\nconst { start, definedProjects, CommonProject, RenderScript } = OCS;\n\nconst infos = GM_info;\n\n(function () {\n\t'use strict';\n\n\tconst projects = definedProjects();\n\n\t// 运行脚本\n\tstart({\n\t\tprojects: projects,\n\t\trenderConfig: {\n\t\t\trenderScript: RenderScript,\n\t\t\tstyles: [STYLE],\n\t\t\tdefaultPanelName: CommonProject.scripts.guide.namespace,\n\t\t\ttitle: `OCS-${infos.script.version}`\n\t\t},\n\t\tupdatePage: 'https://docs.ocsjs.com/docs/update'\n\t});\n})();\n","isHtml":false,"htmlPath":"","htmlFiles":[],"prefix":"","pcRepo":"PakePlus-v2.1.5","iosRepo":"PakePlus-iOS-v2.1.5","androidRepo":"PakePlus-Android-v2.1.5","more":{"windows":{"label":"","title":"chaoxing","url":"https://i.chaoxing.com/","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.0 Safari/605.1.15","width":768,"height":1024,"theme":null,"resizable":true,"fullscreen":false,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":false,"alwaysOnBottom":false,"center":false,"shadow":true,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":false,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":false,"create":false,"backgroundColor":null,"backgroundThrottling":null,"javascriptDisabled":false}},"phone":{"fullScreen":false,"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"aceabe","showName":"chaoxing","version":"0.0.1","webUrl":"https://i.chaoxing.com/","id":"com.chaoxing.app.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":false,"safeArea":"fullscreen"},"android":{"name":"aceabe","showName":"chaoxing","version":"0.0.1","webUrl":"https://i.chaoxing.com/","id":"com.chaoxing.app.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":false,"safeArea":"fullscreen"},"desktop":{"name":"aceabe","showName":"chaoxing","version":"0.0.1","id":"com.chaoxing.app.desktop","desc":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","webUrl":"https://i.chaoxing.com/","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","isHtml":false,"single":true,"state":true,"injectJq":false,"tauriApi":false,"buildMethod":"local","debug":false}}